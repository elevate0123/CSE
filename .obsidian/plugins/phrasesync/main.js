/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var x=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var I=(d,o)=>{for(var t in o)x(d,t,{get:o[t],enumerable:!0})},E=(d,o,t,e)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of y(o))!T.call(d,n)&&n!==t&&x(d,n,{get:()=>o[n],enumerable:!(e=f(o,n))||e.enumerable});return d};var m=d=>E(x({},"__esModule",{value:!0}),d);var v={};I(v,{default:()=>g});module.exports=m(v);var c=require("obsidian");function b(d,o){let t=d.toLowerCase().split(""),e=o.toLowerCase(),n=0;for(let i of t){let s=e.indexOf(i,n);if(s===-1)return!1;n=s+1}return!0}var g=class extends c.Plugin{constructor(){super(...arguments);this.index=new Map;this.isIndexing=!1}normalizeText(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^\p{L}\p{N}]/gu,"")}async deleteFromIndex(t){for(let[e,n]of this.index.entries()){let i=n.filter(s=>s.notePath!==t.path);i.length>0?this.index.set(e,i):this.index.delete(e)}}renameInIndex(t,e){for(let[n,i]of this.index.entries()){let s=i.map(a=>a.notePath===e?{...a,notePath:t.path,noteTitle:t.basename}:a);this.index.set(n,s)}}async onload(){this.metadataCache=this.app.metadataCache,this.vault=this.app.vault,await this.buildFullIndex(),this.registerEvent(this.metadataCache.on("changed",t=>this.debouncedIndexUpdate(t))),this.registerEvent(this.vault.on("create",t=>{t instanceof c.TFile&&this.debouncedIndexUpdate(t)})),this.registerEvent(this.vault.on("delete",t=>{t instanceof c.TFile&&this.deleteFromIndex(t)})),this.registerEvent(this.vault.on("rename",(t,e)=>{t instanceof c.TFile&&this.renameInIndex(t,e)})),this.registerEditorSuggest(new p(this))}async buildFullIndex(){if(this.isIndexing)return;this.isIndexing=!0,this.index.clear();let t=this.vault.getMarkdownFiles();for(let e of t)await this.indexFile(e);this.isIndexing=!1}async indexFile(t){var s;if(t.extension!=="md")return;let e=t.basename,n=t.path;this.addToIndex(e,{type:"title",notePath:n,noteTitle:e,target:e,displayText:e});let i=this.metadataCache.getFileCache(t);(s=i==null?void 0:i.frontmatter)!=null&&s.tags&&(Array.isArray(i.frontmatter.tags)?i.frontmatter.tags:i.frontmatter.tags.split(",").map(r=>r.trim())).forEach(r=>{this.addToIndex(r,{type:"tag",notePath:n,noteTitle:e,target:r,displayText:`#${r}`})}),i!=null&&i.headings&&i.headings.forEach(a=>{this.addToIndex(a.heading,{type:"heading",notePath:n,noteTitle:e,target:a.heading,displayText:`${e} > ${a.heading}`})}),i!=null&&i.sections&&i.sections.forEach(a=>{a.id&&this.addToIndex(a.id,{type:"block",notePath:n,noteTitle:e,target:a.id,displayText:`${e} > #${a.id}`})})}addToIndex(t,e){let n=this.normalizeText(t),i=this.index.get(n)||[];i.some(s=>s.type===e.type&&s.notePath===e.notePath&&s.target===e.target)||i.push(e),this.index.set(n,i)}debouncedIndexUpdate(t){this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeout=window.setTimeout(()=>{this.deleteFromIndex(t),this.indexFile(t)},300)}getSuggestions(t){let e=this.normalizeText(t);if(!e)return[];let n=[];for(let[r,l]of this.index.entries())r.startsWith(e)&&n.push(...l.map(h=>({...h,score:0})));let i=[];for(let[r,l]of this.index.entries())b(e,r)&&i.push(...l.map(h=>({...h,score:.5})));return[...n,...i].filter((r,l,h)=>l===h.findIndex(u=>u.type===r.type&&u.notePath===r.notePath&&u.target===r.target)).slice(0,100)}},p=class extends c.EditorSuggest{constructor(t){super(t.app);this.plugin=t}onTrigger(t,e){let n=e.getLine(t.line);if(!n)return null;let i=n.match(/\b\d{4}-\d{2}-\d{2}\b/);if(i){let[l]=i;return{start:{line:t.line,ch:n.indexOf(l)},end:{line:t.line,ch:n.indexOf(l)+l.length},query:l}}let s=t.ch;for(;s>0&&!/[\s\p{P}]/u.test(n.charAt(s-1));)s--;let a=t.ch;for(;a<n.length&&!/[\s\p{P}]/u.test(n.charAt(a));)a++;let r=n.substring(s,a);return r?{start:{line:t.line,ch:s},end:{line:t.line,ch:a},query:r}:null}async getSuggestions(t){return this.plugin.getSuggestions(t.query)}renderSuggestion(t,e){let n=e.createDiv({cls:"smart-autolinker-suggestion"}),i={title:"file-text",heading:"heading",block:"link",tag:"tag"},s=n.createDiv({cls:"smart-autolinker-icon"});(0,c.setIcon)(s,i[t.type]),n.createDiv({cls:"smart-autolinker-text"}).createEl("strong",{text:t.displayText}),n.createEl("small",{text:`${t.type==="tag"?"Tag":t.type} in ${t.noteTitle}`,cls:"smart-autolinker-subtext"})}selectSuggestion(t){if(!this.context)return;let{editor:e,start:n,end:i,query:s}=this.context,a="";switch(t.type){case"title":a=`[[${t.target}|${s}]]`;break;case"heading":a=`[[${t.noteTitle}#${t.target}|${s}]]`;break;case"block":a=`[[${t.noteTitle}#^${t.target}|${s}]]`;break;case"tag":a=`[[${t.target}|${s}]]`;break}e.replaceRange(a,n,i),this.close()}};
