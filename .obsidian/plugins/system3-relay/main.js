/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var tv=Object.create;var ms=Object.defineProperty;var rv=Object.getOwnPropertyDescriptor;var ov=Object.getOwnPropertyNames;var nv=Object.getPrototypeOf,sv=Object.prototype.hasOwnProperty;var av=(o,e,t)=>e in o?ms(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Nl=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),Hl=(o,e)=>{for(var t in e)ms(o,t,{get:e[t],enumerable:!0})},dp=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ov(e))!sv.call(o,n)&&n!==t&&ms(o,n,{get:()=>e[n],enumerable:!(r=rv(e,n))||r.enumerable});return o};var mn=(o,e,t)=>(t=o!=null?tv(nv(o)):{},dp(e||!o||!o.__esModule?ms(t,"default",{value:o,enumerable:!0}):t,o)),iv=o=>dp(ms({},"__esModule",{value:!0}),o);var Xe=(o,e,t)=>(av(o,typeof e!="symbol"?e+"":e,t),t);var hs=Nl((jT,mp)=>{"use strict";function kr(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function pp(o,e){for(var t="",r=0,n=-1,s=0,a,i=0;i<=o.length;++i){if(i<o.length)a=o.charCodeAt(i);else{if(a===47)break;a=47}if(a===47){if(!(n===i-1||s===1))if(n!==i-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),n=i,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,n=i,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(n+1,i):t=o.slice(n+1,i),r=i-n-1;n=i,s=0}else a===46&&s!==-1?++s:s=-1}return t}function lv(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var hn={resolve:function(){for(var e="",t=!1,r,n=arguments.length-1;n>=-1&&!t;n--){var s;n>=0?s=arguments[n]:(r===void 0&&(r=process.cwd()),s=r),kr(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=pp(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(kr(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=pp(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return kr(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];kr(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":hn.normalize(e)},relative:function(e,t){if(kr(e),kr(t),e===t||(e=hn.resolve(e),t=hn.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var n=e.length,s=n-r,a=1;a<t.length&&t.charCodeAt(a)===47;++a);for(var i=t.length,l=i-a,c=s<l?s:l,f=-1,u=0;u<=c;++u){if(u===c){if(l>c){if(t.charCodeAt(a+u)===47)return t.slice(a+u+1);if(u===0)return t.slice(a+u)}else s>c&&(e.charCodeAt(r+u)===47?f=u:u===0&&(f=0));break}var d=e.charCodeAt(r+u),m=t.charCodeAt(a+u);if(d!==m)break;d===47&&(f=u)}var p="";for(u=r+f+1;u<=n;++u)(u===n||e.charCodeAt(u)===47)&&(p.length===0?p+="..":p+="/..");return p.length>0?p+t.slice(a+f):(a+=f,t.charCodeAt(a)===47&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(kr(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,n=-1,s=!0,a=e.length-1;a>=1;--a)if(t=e.charCodeAt(a),t===47){if(!s){n=a;break}}else s=!1;return n===-1?r?"/":".":r&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');kr(e);var r=0,n=-1,s=!0,a;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var i=t.length-1,l=-1;for(a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(c===47){if(!s){r=a+1;break}}else l===-1&&(s=!1,l=a+1),i>=0&&(c===t.charCodeAt(i)?--i===-1&&(n=a):(i=-1,n=l))}return r===n?n=l:n===-1&&(n=e.length),e.slice(r,n)}else{for(a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===47){if(!s){r=a+1;break}}else n===-1&&(s=!1,n=a+1);return n===-1?"":e.slice(r,n)}},extname:function(e){kr(e);for(var t=-1,r=0,n=-1,s=!0,a=0,i=e.length-1;i>=0;--i){var l=e.charCodeAt(i);if(l===47){if(!s){r=i+1;break}continue}n===-1&&(s=!1,n=i+1),l===46?t===-1?t=i:a!==1&&(a=1):t!==-1&&(a=-1)}return t===-1||n===-1||a===0||a===1&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return lv("/",e)},parse:function(e){kr(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),n=r===47,s;n?(t.root="/",s=1):s=0;for(var a=-1,i=0,l=-1,c=!0,f=e.length-1,u=0;f>=s;--f){if(r=e.charCodeAt(f),r===47){if(!c){i=f+1;break}continue}l===-1&&(c=!1,l=f+1),r===46?a===-1?a=f:u!==1&&(u=1):a!==-1&&(u=-1)}return a===-1||l===-1||u===0||u===1&&a===l-1&&a===i+1?l!==-1&&(i===0&&n?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(i,l)):(i===0&&n?(t.name=e.slice(1,a),t.base=e.slice(1,l)):(t.name=e.slice(i,a),t.base=e.slice(i,l)),t.ext=e.slice(a,l)),i>0?t.dir=e.slice(0,i-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};hn.posix=hn;mp.exports=hn});var jh=Nl((wA,Gh)=>{var Vh=require("url").parse,zS=require("events"),WS=require("https"),KS=require("http"),GS=require("util"),jS=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],Kh=[239,187,191],JS=58,QS=32,zh=10,XS=13,Wh=1024*256,YS=/^(cookie|authorization)$/i;function ZS(o){return Kh.every(function(e,t){return o[t]===e})}function Ye(o,e){var t=Ye.CONNECTING,r=e&&e.headers,n=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var s=this;s.reconnectInterval=1e3,s.connectionInProgress=!1;function a(y){t!==Ye.CLOSED&&(t=Ye.CONNECTING,p("error",new Vs("error",{message:y})),d&&(o=d,d=null,n=!1),setTimeout(function(){t!==Ye.CONNECTING||s.connectionInProgress||(s.connectionInProgress=!0,m())},s.reconnectInterval))}var i,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var c=!1,f="",u="",d=null;function m(){var y=Vh(o),g=y.protocol==="https:";if(y.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(y.headers["Last-Event-ID"]=l),r){var I=n?t1(r):r;for(var T in I){var P=I[T];P&&(y.headers[T]=P)}}y.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(y.createConnection=e.createConnection);var A=e&&e.proxy;if(A){var F=Vh(e.proxy);g=F.protocol==="https:",y.protocol=g?"https:":"http:",y.path=o,y.headers.Host=y.host,y.hostname=F.hostname,y.host=F.host,y.port=F.port}if(e&&e.https){for(var S in e.https)if(jS.indexOf(S)!==-1){var L=e.https[S];L!==void 0&&(y[S]=L)}}e&&e.withCredentials!==void 0&&(y.withCredentials=e.withCredentials),i=(g?WS:KS).request(y,function($){if(s.connectionInProgress=!1,$.statusCode===500||$.statusCode===502||$.statusCode===503||$.statusCode===504){p("error",new Vs("error",{status:$.statusCode,message:$.statusMessage})),a();return}if($.statusCode===301||$.statusCode===302||$.statusCode===307){var O=$.headers.location;if(!O){p("error",new Vs("error",{status:$.statusCode,message:$.statusMessage}));return}var Q=new URL(o).origin,U=new URL(O).origin;n=Q!==U,$.statusCode===307&&(d=o),o=O,process.nextTick(m);return}if($.statusCode!==200)return p("error",new Vs("error",{status:$.statusCode,message:$.statusMessage})),s.close();t=Ye.OPEN,$.on("close",function(){$.removeAllListeners("close"),$.removeAllListeners("end"),a()}),$.on("end",function(){$.removeAllListeners("close"),$.removeAllListeners("end"),a()}),p("open",new Vs("open"));var V,oe,ve=0,N=-1,j=0,_e=0;$.on("data",function(Ne){V?(Ne.length>V.length-_e&&(j=V.length*2+Ne.length,j>Wh&&(j=V.length+Ne.length+Wh),oe=Buffer.alloc(j),V.copy(oe,0,0,_e),V=oe),Ne.copy(V,_e),_e+=Ne.length):(V=Ne,ZS(V)&&(V=V.slice(Kh.length)),_e=V.length);for(var Ee=0,te=_e;Ee<te;){c&&(V[Ee]===zh&&++Ee,c=!1);for(var re=-1,Y=N,xe,$e=ve;re<0&&$e<te;++$e)xe=V[$e],xe===JS?Y<0&&(Y=$e-Ee):xe===XS?(c=!0,re=$e-Ee):xe===zh&&(re=$e-Ee);if(re<0){ve=te-Ee,N=Y;break}else ve=0,N=-1;x(V,Ee,Y,re),Ee+=re+1}Ee===te?(V=void 0,_e=0):Ee>0&&(V=V.slice(Ee,_e),_e=V.length)})}),i.on("error",function($){s.connectionInProgress=!1,a($.message)}),i.setNoDelay&&i.setNoDelay(!0),i.end()}m();function p(){s.listeners(arguments[0]).length>0&&s.emit.apply(s,arguments)}this._close=function(){t!==Ye.CLOSED&&(t=Ye.CLOSED,i.abort&&i.abort(),i.xhr&&i.xhr.abort&&i.xhr.abort())};function x(y,g,I,T){if(T===0){if(f.length>0){var P=u||"message";p(P,new e1(P,{data:f.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),f=""}u=void 0}else if(I>0){var A=I<0,F=0,S=y.slice(g,g+(A?T:I)).toString();A?F=T:y[g+I+1]!==QS?F=I+1:F=I+2,g+=F;var L=T-F,$=y.slice(g,g+L).toString();if(S==="data")f+=$+`
`;else if(S==="event")u=$;else if(S==="id")l=$;else if(S==="retry"){var O=parseInt($,10);Number.isNaN(O)||(s.reconnectInterval=O)}}}}Gh.exports=Ye;GS.inherits(Ye,zS.EventEmitter);Ye.prototype.constructor=Ye;["open","error","message"].forEach(function(o){Object.defineProperty(Ye.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(Ye,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(Ye,"OPEN",{enumerable:!0,value:1});Object.defineProperty(Ye,"CLOSED",{enumerable:!0,value:2});Ye.prototype.CONNECTING=0;Ye.prototype.OPEN=1;Ye.prototype.CLOSED=2;Ye.prototype.close=function(){this._close()};Ye.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};Ye.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};Ye.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function Vs(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function e1(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function t1(o){var e={};for(var t in o)YS.test(t)||(e[t]=o[t]);return e}});var xu=Nl((p3,ts)=>{var Z=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},qe=-1,ze=1,Le=0;Z.Diff=function(o,e){return[o,e]};Z.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var n=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new Z.Diff(Le,o)]:[];typeof t=="undefined"&&(t=!0);var s=t,a=this.diff_commonPrefix(o,e),i=o.substring(0,a);o=o.substring(a),e=e.substring(a),a=this.diff_commonSuffix(o,e);var l=o.substring(o.length-a);o=o.substring(0,o.length-a),e=e.substring(0,e.length-a);var c=this.diff_compute_(o,e,s,n);return i&&c.unshift(new Z.Diff(Le,i)),l&&c.push(new Z.Diff(Le,l)),this.diff_cleanupMerge(c),c};Z.prototype.diff_compute_=function(o,e,t,r){var n;if(!o)return[new Z.Diff(ze,e)];if(!e)return[new Z.Diff(qe,o)];var s=o.length>e.length?o:e,a=o.length>e.length?e:o,i=s.indexOf(a);if(i!=-1)return n=[new Z.Diff(ze,s.substring(0,i)),new Z.Diff(Le,a),new Z.Diff(ze,s.substring(i+a.length))],o.length>e.length&&(n[0][0]=n[2][0]=qe),n;if(a.length==1)return[new Z.Diff(qe,o),new Z.Diff(ze,e)];var l=this.diff_halfMatch_(o,e);if(l){var c=l[0],f=l[1],u=l[2],d=l[3],m=l[4],p=this.diff_main(c,u,t,r),x=this.diff_main(f,d,t,r);return p.concat([new Z.Diff(Le,m)],x)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};Z.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var n=r.lineArray,s=this.diff_main(o,e,!1,t);this.diff_charsToLines_(s,n),this.diff_cleanupSemantic(s),s.push(new Z.Diff(Le,""));for(var a=0,i=0,l=0,c="",f="";a<s.length;){switch(s[a][0]){case ze:l++,f+=s[a][1];break;case qe:i++,c+=s[a][1];break;case Le:if(i>=1&&l>=1){s.splice(a-i-l,i+l),a=a-i-l;for(var u=this.diff_main(c,f,!1,t),d=u.length-1;d>=0;d--)s.splice(a,0,u[d]);a=a+u.length}l=0,i=0,c="",f="";break}a++}return s.pop(),s};Z.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,n=e.length,s=Math.ceil((r+n)/2),a=s,i=2*s,l=new Array(i),c=new Array(i),f=0;f<i;f++)l[f]=-1,c[f]=-1;l[a+1]=0,c[a+1]=0;for(var u=r-n,d=u%2!=0,m=0,p=0,x=0,y=0,g=0;g<s&&!(new Date().getTime()>t);g++){for(var I=-g+m;I<=g-p;I+=2){var T=a+I,P;I==-g||I!=g&&l[T-1]<l[T+1]?P=l[T+1]:P=l[T-1]+1;for(var A=P-I;P<r&&A<n&&o.charAt(P)==e.charAt(A);)P++,A++;if(l[T]=P,P>r)p+=2;else if(A>n)m+=2;else if(d){var F=a+u-I;if(F>=0&&F<i&&c[F]!=-1){var S=r-c[F];if(P>=S)return this.diff_bisectSplit_(o,e,P,A,t)}}}for(var L=-g+x;L<=g-y;L+=2){var F=a+L,S;L==-g||L!=g&&c[F-1]<c[F+1]?S=c[F+1]:S=c[F-1]+1;for(var $=S-L;S<r&&$<n&&o.charAt(r-S-1)==e.charAt(n-$-1);)S++,$++;if(c[F]=S,S>r)y+=2;else if($>n)x+=2;else if(!d){var T=a+u-L;if(T>=0&&T<i&&l[T]!=-1){var P=l[T],A=a+P-T;if(S=r-S,P>=S)return this.diff_bisectSplit_(o,e,P,A,t)}}}}return[new Z.Diff(qe,o),new Z.Diff(ze,e)]};Z.prototype.diff_bisectSplit_=function(o,e,t,r,n){var s=o.substring(0,t),a=e.substring(0,r),i=o.substring(t),l=e.substring(r),c=this.diff_main(s,a,!1,n),f=this.diff_main(i,l,!1,n);return c.concat(f)};Z.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function n(l){for(var c="",f=0,u=-1,d=t.length;u<l.length-1;){u=l.indexOf(`
`,f),u==-1&&(u=l.length-1);var m=l.substring(f,u+1);(r.hasOwnProperty?r.hasOwnProperty(m):r[m]!==void 0)?c+=String.fromCharCode(r[m]):(d==s&&(m=l.substring(f),u=l.length),c+=String.fromCharCode(d),r[m]=d,t[d++]=m),f=u+1}return c}var s=4e4,a=n(o);s=65535;var i=n(e);return{chars1:a,chars2:i,lineArray:t}};Z.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],n=[],s=0;s<r.length;s++)n[s]=e[r.charCodeAt(s)];o[t][1]=n.join("")}};Z.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(s,n)==e.substring(s,n)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};Z.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(o.length-n,o.length-s)==e.substring(e.length-n,e.length-s)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};Z.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var n=Math.min(t,r);if(o==e)return n;for(var s=0,a=1;;){var i=o.substring(n-a),l=e.indexOf(i);if(l==-1)return s;a+=l,(l==0||o.substring(n-a)==e.substring(0,a))&&(s=a,a++)}};Z.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var n=this;function s(p,x,y){for(var g=p.substring(y,y+Math.floor(p.length/4)),I=-1,T="",P,A,F,S;(I=x.indexOf(g,I+1))!=-1;){var L=n.diff_commonPrefix(p.substring(y),x.substring(I)),$=n.diff_commonSuffix(p.substring(0,y),x.substring(0,I));T.length<$+L&&(T=x.substring(I-$,I)+x.substring(I,I+L),P=p.substring(0,y-$),A=p.substring(y+L),F=x.substring(0,I-$),S=x.substring(I+L))}return T.length*2>=p.length?[P,A,F,S,T]:null}var a=s(t,r,Math.ceil(t.length/4)),i=s(t,r,Math.ceil(t.length/2)),l;if(!a&&!i)return null;i?a?l=a[4].length>i[4].length?a:i:l=i:l=a;var c,f,u,d;o.length>e.length?(c=l[0],f=l[1],u=l[2],d=l[3]):(u=l[0],d=l[1],c=l[2],f=l[3]);var m=l[4];return[c,f,u,d,m]};Z.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,n=null,s=0,a=0,i=0,l=0,c=0;s<o.length;)o[s][0]==Le?(t[r++]=s,a=l,i=c,l=0,c=0,n=o[s][1]):(o[s][0]==ze?l+=o[s][1].length:c+=o[s][1].length,n&&n.length<=Math.max(a,i)&&n.length<=Math.max(l,c)&&(o.splice(t[r-1],0,new Z.Diff(qe,n)),o[t[r-1]+1][0]=ze,r--,r--,s=r>0?t[r-1]:-1,a=0,i=0,l=0,c=0,n=null,e=!0)),s++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),s=1;s<o.length;){if(o[s-1][0]==qe&&o[s][0]==ze){var f=o[s-1][1],u=o[s][1],d=this.diff_commonOverlap_(f,u),m=this.diff_commonOverlap_(u,f);d>=m?(d>=f.length/2||d>=u.length/2)&&(o.splice(s,0,new Z.Diff(Le,u.substring(0,d))),o[s-1][1]=f.substring(0,f.length-d),o[s+1][1]=u.substring(d),s++):(m>=f.length/2||m>=u.length/2)&&(o.splice(s,0,new Z.Diff(Le,f.substring(0,m))),o[s-1][0]=ze,o[s-1][1]=u.substring(0,u.length-m),o[s+1][0]=qe,o[s+1][1]=f.substring(m),s++),s++}s++}};Z.prototype.diff_cleanupSemanticLossless=function(o){function e(m,p){if(!m||!p)return 6;var x=m.charAt(m.length-1),y=p.charAt(0),g=x.match(Z.nonAlphaNumericRegex_),I=y.match(Z.nonAlphaNumericRegex_),T=g&&x.match(Z.whitespaceRegex_),P=I&&y.match(Z.whitespaceRegex_),A=T&&x.match(Z.linebreakRegex_),F=P&&y.match(Z.linebreakRegex_),S=A&&m.match(Z.blanklineEndRegex_),L=F&&p.match(Z.blanklineStartRegex_);return S||L?5:A||F?4:g&&!T&&P?3:T||P?2:g||I?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==Le&&o[t+1][0]==Le){var r=o[t-1][1],n=o[t][1],s=o[t+1][1],a=this.diff_commonSuffix(r,n);if(a){var i=n.substring(n.length-a);r=r.substring(0,r.length-a),n=i+n.substring(0,n.length-a),s=i+s}for(var l=r,c=n,f=s,u=e(r,n)+e(n,s);n.charAt(0)===s.charAt(0);){r+=n.charAt(0),n=n.substring(1)+s.charAt(0),s=s.substring(1);var d=e(r,n)+e(n,s);d>=u&&(u=d,l=r,c=n,f=s)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=c,f?o[t+1][1]=f:(o.splice(t+1,1),t--))}t++}};Z.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;Z.whitespaceRegex_=/\s/;Z.linebreakRegex_=/[\r\n]/;Z.blanklineEndRegex_=/\n\r?\n$/;Z.blanklineStartRegex_=/^\r?\n\r?\n/;Z.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,n=null,s=0,a=!1,i=!1,l=!1,c=!1;s<o.length;)o[s][0]==Le?(o[s][1].length<this.Diff_EditCost&&(l||c)?(t[r++]=s,a=l,i=c,n=o[s][1]):(r=0,n=null),l=c=!1):(o[s][0]==qe?c=!0:l=!0,n&&(a&&i&&l&&c||n.length<this.Diff_EditCost/2&&a+i+l+c==3)&&(o.splice(t[r-1],0,new Z.Diff(qe,n)),o[t[r-1]+1][0]=ze,r--,n=null,a&&i?(l=c=!0,r=0):(r--,s=r>0?t[r-1]:-1,l=c=!1),e=!0)),s++;e&&this.diff_cleanupMerge(o)};Z.prototype.diff_cleanupMerge=function(o){o.push(new Z.Diff(Le,""));for(var e=0,t=0,r=0,n="",s="",a;e<o.length;)switch(o[e][0]){case ze:r++,s+=o[e][1],e++;break;case qe:t++,n+=o[e][1],e++;break;case Le:t+r>1?(t!==0&&r!==0&&(a=this.diff_commonPrefix(s,n),a!==0&&(e-t-r>0&&o[e-t-r-1][0]==Le?o[e-t-r-1][1]+=s.substring(0,a):(o.splice(0,0,new Z.Diff(Le,s.substring(0,a))),e++),s=s.substring(a),n=n.substring(a)),a=this.diff_commonSuffix(s,n),a!==0&&(o[e][1]=s.substring(s.length-a)+o[e][1],s=s.substring(0,s.length-a),n=n.substring(0,n.length-a))),e-=t+r,o.splice(e,t+r),n.length&&(o.splice(e,0,new Z.Diff(qe,n)),e++),s.length&&(o.splice(e,0,new Z.Diff(ze,s)),e++),e++):e!==0&&o[e-1][0]==Le?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,n="",s="";break}o[o.length-1][1]===""&&o.pop();var i=!1;for(e=1;e<o.length-1;)o[e-1][0]==Le&&o[e+1][0]==Le&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),i=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),i=!0)),e++;i&&this.diff_cleanupMerge(o)};Z.prototype.diff_xIndex=function(o,e){var t=0,r=0,n=0,s=0,a;for(a=0;a<o.length&&(o[a][0]!==ze&&(t+=o[a][1].length),o[a][0]!==qe&&(r+=o[a][1].length),!(t>e));a++)n=t,s=r;return o.length!=a&&o[a][0]===qe?s:s+(e-n)};Z.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,n=/>/g,s=/\n/g,a=0;a<o.length;a++){var i=o[a][0],l=o[a][1],c=l.replace(t,"&amp;").replace(r,"&lt;").replace(n,"&gt;").replace(s,"&para;<br>");switch(i){case ze:e[a]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case qe:e[a]='<del style="background:#ffe6e6;">'+c+"</del>";break;case Le:e[a]="<span>"+c+"</span>";break}}return e.join("")};Z.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==ze&&(e[t]=o[t][1]);return e.join("")};Z.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==qe&&(e[t]=o[t][1]);return e.join("")};Z.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,n=0;n<o.length;n++){var s=o[n][0],a=o[n][1];switch(s){case ze:t+=a.length;break;case qe:r+=a.length;break;case Le:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};Z.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case ze:e[t]="+"+encodeURI(o[t][1]);break;case qe:e[t]="-"+o[t][1].length;break;case Le:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};Z.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,n=0,s=e.split(/\t/g),a=0;a<s.length;a++){var i=s[a].substring(1);switch(s[a].charAt(0)){case"+":try{t[r++]=new Z.Diff(ze,decodeURI(i))}catch(f){throw new Error("Illegal escape in diff_fromDelta: "+i)}break;case"-":case"=":var l=parseInt(i,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+i);var c=o.substring(n,n+=l);s[a].charAt(0)=="="?t[r++]=new Z.Diff(Le,c):t[r++]=new Z.Diff(qe,c);break;default:if(s[a])throw new Error("Invalid diff operation in diff_fromDelta: "+s[a])}}if(n!=o.length)throw new Error("Delta length ("+n+") does not equal source text length ("+o.length+").");return t};Z.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};Z.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),n=this;function s(P,A){var F=P/e.length,S=Math.abs(t-A);return n.Match_Distance?F+S/n.Match_Distance:S?1:F}var a=this.Match_Threshold,i=o.indexOf(e,t);i!=-1&&(a=Math.min(s(0,i),a),i=o.lastIndexOf(e,t+e.length),i!=-1&&(a=Math.min(s(0,i),a)));var l=1<<e.length-1;i=-1;for(var c,f,u=e.length+o.length,d,m=0;m<e.length;m++){for(c=0,f=u;c<f;)s(m,t+f)<=a?c=f:u=f,f=Math.floor((u-c)/2+c);u=f;var p=Math.max(1,t-f+1),x=Math.min(t+f,o.length)+e.length,y=Array(x+2);y[x+1]=(1<<m)-1;for(var g=x;g>=p;g--){var I=r[o.charAt(g-1)];if(m===0?y[g]=(y[g+1]<<1|1)&I:y[g]=(y[g+1]<<1|1)&I|((d[g+1]|d[g])<<1|1)|d[g+1],y[g]&l){var T=s(m,g-1);if(T<=a)if(a=T,i=g-1,i>t)p=Math.max(1,2*t-i);else break}}if(s(m+1,t)>a)break;d=y}return i};Z.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};Z.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var n=e.substring(o.start2-r,o.start2);n&&o.diffs.unshift(new Z.Diff(Le,n));var s=e.substring(o.start2+o.length1,o.start2+o.length1+r);s&&o.diffs.push(new Z.Diff(Le,s)),o.start1-=n.length,o.start2-=n.length,o.length1+=n.length+s.length,o.length2+=n.length+s.length}};Z.prototype.patch_make=function(o,e,t){var r,n;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,n=this.diff_main(r,e,!0),n.length>2&&(this.diff_cleanupSemantic(n),this.diff_cleanupEfficiency(n));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")n=o,r=this.diff_text1(n);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,n=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,n=t;else throw new Error("Unknown call format to patch_make.");if(n.length===0)return[];for(var s=[],a=new Z.patch_obj,i=0,l=0,c=0,f=r,u=r,d=0;d<n.length;d++){var m=n[d][0],p=n[d][1];switch(!i&&m!==Le&&(a.start1=l,a.start2=c),m){case ze:a.diffs[i++]=n[d],a.length2+=p.length,u=u.substring(0,c)+p+u.substring(c);break;case qe:a.length1+=p.length,a.diffs[i++]=n[d],u=u.substring(0,c)+u.substring(c+p.length);break;case Le:p.length<=2*this.Patch_Margin&&i&&n.length!=d+1?(a.diffs[i++]=n[d],a.length1+=p.length,a.length2+=p.length):p.length>=2*this.Patch_Margin&&i&&(this.patch_addContext_(a,f),s.push(a),a=new Z.patch_obj,i=0,f=u,l=c);break}m!==ze&&(l+=p.length),m!==qe&&(c+=p.length)}return i&&(this.patch_addContext_(a,f),s.push(a)),s};Z.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],n=new Z.patch_obj;n.diffs=[];for(var s=0;s<r.diffs.length;s++)n.diffs[s]=new Z.Diff(r.diffs[s][0],r.diffs[s][1]);n.start1=r.start1,n.start2=r.start2,n.length1=r.length1,n.length2=r.length2,e[t]=n}return e};Z.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,n=[],s=0;s<o.length;s++){var a=o[s].start2+r,i=this.diff_text1(o[s].diffs),l,c=-1;if(i.length>this.Match_MaxBits?(l=this.match_main(e,i.substring(0,this.Match_MaxBits),a),l!=-1&&(c=this.match_main(e,i.substring(i.length-this.Match_MaxBits),a+i.length-this.Match_MaxBits),(c==-1||l>=c)&&(l=-1))):l=this.match_main(e,i,a),l==-1)n[s]=!1,r-=o[s].length2-o[s].length1;else{n[s]=!0,r=l-a;var f;if(c==-1?f=e.substring(l,l+i.length):f=e.substring(l,c+this.Match_MaxBits),i==f)e=e.substring(0,l)+this.diff_text2(o[s].diffs)+e.substring(l+i.length);else{var u=this.diff_main(i,f,!1);if(i.length>this.Match_MaxBits&&this.diff_levenshtein(u)/i.length>this.Patch_DeleteThreshold)n[s]=!1;else{this.diff_cleanupSemanticLossless(u);for(var d=0,m,p=0;p<o[s].diffs.length;p++){var x=o[s].diffs[p];x[0]!==Le&&(m=this.diff_xIndex(u,d)),x[0]===ze?e=e.substring(0,l+m)+x[1]+e.substring(l+m):x[0]===qe&&(e=e.substring(0,l+m)+e.substring(l+this.diff_xIndex(u,d+x[1].length))),x[0]!==qe&&(d+=x[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,n]};Z.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var n=o[0],s=n.diffs;if(s.length==0||s[0][0]!=Le)s.unshift(new Z.Diff(Le,t)),n.start1-=e,n.start2-=e,n.length1+=e,n.length2+=e;else if(e>s[0][1].length){var a=e-s[0][1].length;s[0][1]=t.substring(s[0][1].length)+s[0][1],n.start1-=a,n.start2-=a,n.length1+=a,n.length2+=a}if(n=o[o.length-1],s=n.diffs,s.length==0||s[s.length-1][0]!=Le)s.push(new Z.Diff(Le,t)),n.length1+=e,n.length2+=e;else if(e>s[s.length-1][1].length){var a=e-s[s.length-1][1].length;s[s.length-1][1]+=t.substring(0,a),n.length1+=a,n.length2+=a}return t};Z.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var n=r.start1,s=r.start2,a="";r.diffs.length!==0;){var i=new Z.patch_obj,l=!0;for(i.start1=n-a.length,i.start2=s-a.length,a!==""&&(i.length1=i.length2=a.length,i.diffs.push(new Z.Diff(Le,a)));r.diffs.length!==0&&i.length1<e-this.Patch_Margin;){var c=r.diffs[0][0],f=r.diffs[0][1];c===ze?(i.length2+=f.length,s+=f.length,i.diffs.push(r.diffs.shift()),l=!1):c===qe&&i.diffs.length==1&&i.diffs[0][0]==Le&&f.length>2*e?(i.length1+=f.length,n+=f.length,l=!1,i.diffs.push(new Z.Diff(c,f)),r.diffs.shift()):(f=f.substring(0,e-i.length1-this.Patch_Margin),i.length1+=f.length,n+=f.length,c===Le?(i.length2+=f.length,s+=f.length):l=!1,i.diffs.push(new Z.Diff(c,f)),f==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(f.length))}a=this.diff_text2(i.diffs),a=a.substring(a.length-this.Patch_Margin);var u=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);u!==""&&(i.length1+=u.length,i.length2+=u.length,i.diffs.length!==0&&i.diffs[i.diffs.length-1][0]===Le?i.diffs[i.diffs.length-1][1]+=u:i.diffs.push(new Z.Diff(Le,u))),l||o.splice(++t,0,i)}}};Z.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};Z.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var s=t[r].match(n);if(!s)throw new Error("Invalid patch string: "+t[r]);var a=new Z.patch_obj;for(e.push(a),a.start1=parseInt(s[1],10),s[2]===""?(a.start1--,a.length1=1):s[2]=="0"?a.length1=0:(a.start1--,a.length1=parseInt(s[2],10)),a.start2=parseInt(s[3],10),s[4]===""?(a.start2--,a.length2=1):s[4]=="0"?a.length2=0:(a.start2--,a.length2=parseInt(s[4],10)),r++;r<t.length;){var i=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(c){throw new Error("Illegal escape in patch_fromText: "+l)}if(i=="-")a.diffs.push(new Z.Diff(qe,l));else if(i=="+")a.diffs.push(new Z.Diff(ze,l));else if(i==" ")a.diffs.push(new Z.Diff(Le,l));else{if(i=="@")break;if(i!=="")throw new Error('Invalid patch mode "'+i+'" in: '+l)}r++}}return e};Z.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};Z.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case ze:r="+";break;case qe:r="-";break;case Le:r=" ";break}t[n+1]=r+encodeURI(this.diffs[n][1])+`
`}return t.join("").replace(/%20/g," ")};ts.exports=Z;ts.exports.diff_match_patch=Z;ts.exports.DIFF_DELETE=qe;ts.exports.DIFF_INSERT=ze;ts.exports.DIFF_EQUAL=Le});var KT={};Hl(KT,{default:()=>kl});module.exports=iv(KT);var Ze=require("obsidian"),Xb=require("obsidian"),Yb=mn(hs());var Oe=require("obsidian");var dt=()=>new Map,ma=o=>{let e=dt();return o.forEach((t,r)=>{e.set(r,t)}),e},cr=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},hp=(o,e)=>{let t=[];for(let[r,n]of o)t.push(e(n,r));return t},gp=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var Cr=()=>new Set;var ha=o=>o[o.length-1];var yp=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},fr=Array.from;var Vl=Array.isArray;var ga=class{constructor(){this._observers=dt()}on(e,t){return cr(this._observers,e,Cr).add(t),t}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return fr((this._observers.get(e)||dt()).values()).forEach(r=>r(...t))}destroy(){this._observers=dt()}},gn=class{constructor(){this._observers=dt()}on(e,t){cr(this._observers,e,Cr).add(t)}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return fr((this._observers.get(e)||dt()).values()).forEach(r=>r(...t))}destroy(){this._observers=dt()}};var Mt=Math.floor;var yn=Math.abs;var xn=(o,e)=>o<e?o:e,ur=(o,e)=>o>e?o:e,QT=Number.isNaN;var ya=o=>o!==0?o<0:1/o<0;var Wl=Number.MAX_SAFE_INTEGER,XT=Number.MIN_SAFE_INTEGER,YT=1<<31;var xp=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&Mt(o)===o),ZT=Number.isNaN,eP=Number.parseInt;var cv=String.fromCharCode,tP=String.fromCodePoint,rP=cv(65535),fv=o=>o.toLowerCase(),uv=/^\s*/g,dv=o=>o.replace(uv,""),pv=/([A-Z])/g,Kl=(o,e)=>dv(o.replace(pv,t=>`${e}${fv(t)}`));var mv=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},wn=typeof TextEncoder!="undefined"?new TextEncoder:null,hv=o=>wn.encode(o),vp=wn?hv:mv;var vn=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});vn&&vn.decode(new Uint8Array).length===1&&(vn=null);var qo=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},zo=()=>new qo;var gv=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var qt=o=>{let e=new Uint8Array(gv(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},yv=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(ur(t,e)*2),o.cpos=0)},pt=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var ba=pt;var ke=(o,e)=>{for(;e>127;)pt(o,128|127&e),e=Mt(e/128);pt(o,127&e)},va=(o,e)=>{let t=ya(e);for(t&&(e=-e),pt(o,(e>63?128:0)|(t?64:0)|63&e),e=Mt(e/64);e>0;)pt(o,(e>127?128:0)|127&e),e=Mt(e/128)},jl=new Uint8Array(3e4),xv=jl.length/3,bv=(o,e)=>{if(e.length<xv){let t=wn.encodeInto(e,jl).written||0;ke(o,t);for(let r=0;r<t;r++)pt(o,jl[r])}else mt(o,vp(e))},vv=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;ke(o,r);for(let n=0;n<r;n++)pt(o,t.codePointAt(n))},zr=wn&&wn.encodeInto?bv:vv;var xs=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=xn(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(ur(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},mt=(o,e)=>{ke(o,e.byteLength),xs(o,e)},Jl=(o,e)=>{yv(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},wv=(o,e)=>Jl(o,4).setFloat32(0,e,!1),_v=(o,e)=>Jl(o,8).setFloat64(0,e,!1),Sv=(o,e)=>Jl(o,8).setBigInt64(0,e,!1);var _p=new DataView(new ArrayBuffer(4)),kv=o=>(_p.setFloat32(0,o),_p.getFloat32(0)===o),Sn=(o,e)=>{switch(typeof e){case"string":pt(o,119),zr(o,e);break;case"number":xp(e)&&yn(e)<=2147483647?(pt(o,125),va(o,e)):kv(e)?(pt(o,124),wv(o,e)):(pt(o,123),_v(o,e));break;case"bigint":pt(o,122),Sv(o,e);break;case"object":if(e===null)pt(o,126);else if(Vl(e)){pt(o,117),ke(o,e.length);for(let t=0;t<e.length;t++)Sn(o,e[t])}else if(e instanceof Uint8Array)pt(o,116),mt(o,e);else{pt(o,118);let t=Object.keys(e);ke(o,t.length);for(let r=0;r<t.length;r++){let n=t[r];zr(o,n),Sn(o,e[n])}}break;case"boolean":pt(o,e?120:121);break;default:pt(o,127)}},ys=class extends qo{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ke(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var Sp=o=>{o.count>0&&(va(o.encoder,o.count===1?o.s:-o.s),o.count>1&&ke(o.encoder,o.count-2))},Vo=class{constructor(){this.encoder=new qo,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Sp(this),this.count=1,this.s=e)}toUint8Array(){return Sp(this),qt(this.encoder)}};var kp=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);va(o.encoder,e),o.count>1&&ke(o.encoder,o.count-2)}},kn=class{constructor(){this.encoder=new qo,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(kp(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return kp(this),qt(this.encoder)}},xa=class{constructor(){this.sarr=[],this.s="",this.lensE=new Vo}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new qo;return this.sarr.push(this.s),this.s="",zr(e,this.sarr.join("")),xs(e,this.lensE.toUint8Array()),qt(e)}};var Yt=o=>new Error(o),dr=()=>{throw Yt("Method unimplemented")},Zt=()=>{throw Yt("Unexpected case")};var Cp=Yt("Unexpected end of array"),Ip=Yt("Integer out of Range"),Cn=class{constructor(e){this.arr=e,this.pos=0}},mr=o=>new Cn(o),Lp=o=>o.pos!==o.arr.length;var Cv=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},xt=o=>Cv(o,Se(o));var Wo=o=>o.arr[o.pos++];var Se=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&127)*t,t*=128,n<128)return e;if(e>Wl)throw Ip}throw Cp},_a=o=>{let e=o.arr[o.pos++],t=e&63,r=64,n=(e&64)>0?-1:1;if(!(e&128))return n*t;let s=o.arr.length;for(;o.pos<s;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return n*t;if(t>Wl)throw Ip}throw Cp};var Iv=o=>{let e=Se(o);if(e===0)return"";{let t=String.fromCodePoint(Wo(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(Wo(o));else for(;e>0;){let r=e<1e4?e:1e4,n=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,n),e-=r}return decodeURIComponent(escape(t))}},Lv=o=>vn.decode(xt(o)),pr=vn?Lv:Iv;var Yl=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},Tv=o=>Yl(o,4).getFloat32(0,!1),Pv=o=>Yl(o,8).getFloat64(0,!1),Fv=o=>Yl(o,8).getBigInt64(0,!1);var Av=[o=>{},o=>null,_a,Tv,Pv,Fv,o=>!1,o=>!0,pr,o=>{let e=Se(o),t={};for(let r=0;r<e;r++){let n=pr(o);t[n]=In(o)}return t},o=>{let e=Se(o),t=[];for(let r=0;r<e;r++)t.push(In(o));return t},xt],In=o=>Av[127-Wo(o)](o),bs=class extends Cn{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Lp(this)?this.count=Se(this)+1:this.count=-1),this.count--,this.s}};var Ko=class extends Cn{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=_a(this);let e=ya(this.s);this.count=1,e&&(this.s=-this.s,this.count=Se(this)+2)}return this.count--,this.s}};var Ln=class extends Cn{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=_a(this),t=e&1;this.diff=Mt(e/2),this.count=1,t&&(this.count=Se(this)+2)}return this.s+=this.diff,this.count--,this.s}},wa=class{constructor(e){this.decoder=new Ko(e),this.str=pr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var sP=crypto.subtle,Tp=crypto.getRandomValues.bind(crypto);var vs=()=>Tp(new Uint32Array(1))[0];var Ev=[1e7]+-1e3+-4e3+-8e3+-1e11,Tn=()=>Ev.replace(/[018]/g,o=>(o^vs()&15>>o/4).toString(16));var Go=Date.now;var Wr=o=>new Promise(o);var Dv=Promise.all.bind(Promise);var ec=o=>o===void 0?null:o;var tc=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Ap=new tc,Rv=!0;try{typeof localStorage!="undefined"&&localStorage&&(Ap=localStorage,Rv=!1)}catch(o){}var Ep=Ap;var Dp=Object.assign,Uv=Object.keys,Mp=(o,e)=>{for(let t in o)e(o[t],t)};var ws=o=>Uv(o).length;var Rp=o=>{for(let e in o)return!1;return!0},Ov=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},rc=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),oc=(o,e)=>o===e||ws(o)===ws(e)&&Ov(o,(t,r)=>(t!==void 0||rc(e,r))&&e[r]===t);var _s=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&_s(o,e,t+1)}};var Up=o=>o,Bv=(o,e)=>o===e;var Pn=(o,e)=>{if(o==null||e==null)return Bv(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!Pn(o.get(t),e.get(t)))return!1;break}case Object:if(ws(o)!==ws(e))return!1;for(let t in o)if(!rc(o,t)||!Pn(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!Pn(o[t],e[t]))return!1;break;default:return!1}return!0},Op=(o,e)=>e.includes(o);var Ss=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var lP=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,Ir,Nv=[],Hv=()=>{if(Ir===void 0)if(Ss){Ir=dt();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&Ir.set(e,""),e=r):e!==null?(Ir.set(e,r),e=null):Nv.push(r)}e!==null&&Ir.set(e,"")}else typeof location=="object"?(Ir=dt(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");Ir.set(`--${Kl(e,"-")}`,t),Ir.set(`-${Kl(e,"-")}`,t)}})):Ir=dt();return Ir},sc=o=>Hv().has(o);var ac=o=>Ss?ec(process.env[o.toUpperCase().replaceAll("-","_")]):ec(Ep.getItem(o));var qv=o=>sc("--"+o)||ac(o)!==null,cP=qv("production"),Bp=Ss&&Op(process.env.FORCE_COLOR,["true","1","2"]),Np=!sc("no-colors")&&(!Ss||process.stdout.isTTY||Bp)&&(!Ss||sc("color")||Bp||ac("COLORTERM")!==null||(ac("TERM")||"").includes("color"));var zv=o=>new Uint8Array(o);var Hp=o=>{let e=zv(o.byteLength);return e.set(o),e};var ic=class{constructor(e,t){this.left=e,this.right=t}},St=(o,e)=>new ic(o,e);var qp=(o,e)=>o.forEach(t=>e(t.left,t.right));var Lr=typeof document!="undefined"?document:{},Kv=o=>Lr.createElement(o),Gv=()=>Lr.createDocumentFragment(),jv=o=>Lr.createTextNode(o),fP=typeof DOMParser!="undefined"?new DOMParser:null;var Jv=(o,e)=>(qp(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var Qv=o=>{let e=Gv();for(let t=0;t<o.length;t++)Wp(e,o[t]);return e},Vp=(o,e)=>(Wp(o,Qv(e)),o);var ks=(o,e=[],t=[])=>Vp(Jv(Kv(o),e),t);var Fn=jv;var zp=o=>hp(o,(e,t)=>`${t}:${e};`).join("");var Wp=(o,e)=>o.appendChild(e),uP=Lr.ELEMENT_NODE,dP=Lr.TEXT_NODE,pP=Lr.CDATA_SECTION_NODE,mP=Lr.COMMENT_NODE,hP=Lr.DOCUMENT_NODE,gP=Lr.DOCUMENT_TYPE_NODE,yP=Lr.DOCUMENT_FRAGMENT_NODE;var Tr=Symbol;var Cs=Tr(),Is=Tr(),cc=Tr(),fc=Tr(),uc=Tr(),Ls=Tr(),dc=Tr(),Ts=Tr(),pc=Tr(),Gp=o=>{var n;o.length===1&&((n=o[0])==null?void 0:n.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let s=o[r];s===void 0?e.push("undefined"):s.constructor===String||s.constructor===Number?e.push(s):s.constructor===Object&&t.push(JSON.stringify(s))}return t};var xP=Go();var Zv={[Cs]:St("font-weight","bold"),[Is]:St("font-weight","normal"),[cc]:St("color","blue"),[uc]:St("color","green"),[fc]:St("color","grey"),[Ls]:St("color","red"),[dc]:St("color","purple"),[Ts]:St("color","orange"),[pc]:St("color","black")},ew=o=>{var a;o.length===1&&((a=o[0])==null?void 0:a.constructor)===Function&&(o=o[0]());let e=[],t=[],r=dt(),n=[],s=0;for(;s<o.length;s++){let i=o[s],l=Zv[i];if(l!==void 0)r.set(l.left,l.right);else{if(i===void 0)break;if(i.constructor===String||i.constructor===Number){let c=zp(r);s>0||c.length>0?(e.push("%c"+i),t.push(c)):e.push(i)}else break}}for(s>0&&(n=t,n.unshift(e.join("")));s<o.length;s++){let i=o[s];i instanceof Symbol||n.push(i)}return n},tw=Np?ew:Gp,jp=(...o)=>{console.log(...tw(o)),rw.forEach(e=>e.print(o))};var rw=Cr();var Jp=o=>({[Symbol.iterator](){return this},next:o}),Qp=(o,e)=>Jp(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),ka=(o,e)=>Jp(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var Fs=class{constructor(e,t){this.clock=e,this.len=t}},jo=class{constructor(){this.clients=new Map}},um=(o,e,t)=>e.clients.forEach((r,n)=>{let s=o.doc.store.clients.get(n);for(let a=0;a<r.length;a++){let i=r[a];vm(o,s,i.clock,i.len,t)}}),iw=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let n=Mt((t+r)/2),s=o[n],a=s.clock;if(a<=e){if(e<a+s.len)return n;t=n+1}else r=n-1}return null},Pc=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&iw(t,e.clock)!==null},Fc=o=>{o.clients.forEach(e=>{e.sort((n,s)=>n.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){let n=e[r-1],s=e[t];n.clock+n.len>=s.clock?n.len=ur(n.len,s.clock+s.len-n.clock):(r<t&&(e[r]=s),r++)}e.length=r})},hc=o=>{let e=new jo;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,n)=>{if(!e.clients.has(n)){let s=r.slice();for(let a=t+1;a<o.length;a++)yp(s,o[a].clients.get(n)||[]);e.clients.set(n,s)}});return Fc(e),e},Aa=(o,e,t,r)=>{cr(o.clients,e,()=>[]).push(new Fs(t,r))},Ac=()=>new jo,lw=o=>{let e=Ac();return o.clients.forEach((t,r)=>{let n=[];for(let s=0;s<t.length;s++){let a=t[s];if(a.deleted){let i=a.id.clock,l=a.length;if(s+1<t.length)for(let c=t[s+1];s+1<t.length&&c.deleted;c=t[++s+1])l+=c.length;n.push(new Fs(i,l))}}n.length>0&&e.clients.set(r,n)}),e},vo=(o,e)=>{ke(o.restEncoder,e.clients.size),fr(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),ke(o.restEncoder,t);let n=r.length;ke(o.restEncoder,n);for(let s=0;s<n;s++){let a=r[s];o.writeDsClock(a.clock),o.writeDsLen(a.len)}})},As=o=>{let e=new jo,t=Se(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let n=Se(o.restDecoder),s=Se(o.restDecoder);if(s>0){let a=cr(e.clients,n,()=>[]);for(let i=0;i<s;i++)a.push(new Fs(o.readDsClock(),o.readDsLen()))}}return e},Zp=(o,e,t)=>{let r=new jo,n=Se(o.restDecoder);for(let s=0;s<n;s++){o.resetDsCurVal();let a=Se(o.restDecoder),i=Se(o.restDecoder),l=t.clients.get(a)||[],c=at(t,a);for(let f=0;f<i;f++){let u=o.readDsClock(),d=u+o.readDsLen();if(u<c){c<d&&Aa(r,a,c,d-c);let m=Fr(l,u),p=l[m];for(!p.deleted&&p.id.clock<u&&(l.splice(m+1,0,Na(e,p,u-p.id.clock)),m++);m<l.length&&(p=l[m++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&l.splice(m,0,Na(e,p,d-p.id.clock)),p.delete(e))}else Aa(r,a,u,d-u)}}if(r.clients.size>0){let s=new Kr;return ke(s.restEncoder,0),vo(s,r),s.toUint8Array()}return null};var dm=vs,Vt=class extends ga{constructor({guid:e=Tn(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:s=null,autoLoad:a=!1,shouldLoad:i=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=dm(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new $a,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=i,this.autoLoad=a,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Wr(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});let l=()=>Wr(c=>{let f=u=>{(u===void 0||u===!0)&&(this.off("sync",f),c())};this.on("sync",f)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&Ue(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(fr(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Ue(this,e,t)}get(e,t=ct){let r=cr(this.share,e,()=>{let s=new t;return s._integrate(this,null),s}),n=r.constructor;if(t!==ct&&n!==t)if(n===ct){let s=new t;s._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=s}),s._start=r._start;for(let a=s._start;a!==null;a=a.right)a.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Pr)}getText(e=""){return this.get(e,So)}getMap(e=""){return this.get(e,Gr)}getXmlElement(e=""){return this.get(e,ko)}getXmlFragment(e=""){return this.get(e,jr)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){fr(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new Vt({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Ue(e.parent.doc,r=>{let n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Dn=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Se(this.restDecoder)}readDsLen(){return Se(this.restDecoder)}},Ea=class extends Dn{readLeftID(){return Te(Se(this.restDecoder),Se(this.restDecoder))}readRightID(){return Te(Se(this.restDecoder),Se(this.restDecoder))}readClient(){return Se(this.restDecoder)}readInfo(){return Wo(this.restDecoder)}readString(){return pr(this.restDecoder)}readParentInfo(){return Se(this.restDecoder)===1}readTypeRef(){return Se(this.restDecoder)}readLen(){return Se(this.restDecoder)}readAny(){return In(this.restDecoder)}readBuf(){return Hp(xt(this.restDecoder))}readJSON(){return JSON.parse(pr(this.restDecoder))}readKey(){return pr(this.restDecoder)}},gc=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Se(this.restDecoder),this.dsCurrVal}readDsLen(){let e=Se(this.restDecoder)+1;return this.dsCurrVal+=e,e}},wo=class extends gc{constructor(e){super(e),this.keys=[],Se(e),this.keyClockDecoder=new Ln(xt(e)),this.clientDecoder=new Ko(xt(e)),this.leftClockDecoder=new Ln(xt(e)),this.rightClockDecoder=new Ln(xt(e)),this.infoDecoder=new bs(xt(e),Wo),this.stringDecoder=new wa(xt(e)),this.parentInfoDecoder=new bs(xt(e),Wo),this.typeRefDecoder=new Ko(xt(e)),this.lenDecoder=new Ko(xt(e))}readLeftID(){return new bo(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new bo(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return In(this.restDecoder)}readBuf(){return xt(this.restDecoder)}readJSON(){return In(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},Mn=class{constructor(){this.restEncoder=zo()}toUint8Array(){return qt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ke(this.restEncoder,e)}writeDsLen(e){ke(this.restEncoder,e)}},Jo=class extends Mn{writeLeftID(e){ke(this.restEncoder,e.client),ke(this.restEncoder,e.clock)}writeRightID(e){ke(this.restEncoder,e.client),ke(this.restEncoder,e.clock)}writeClient(e){ke(this.restEncoder,e)}writeInfo(e){ba(this.restEncoder,e)}writeString(e){zr(this.restEncoder,e)}writeParentInfo(e){ke(this.restEncoder,e?1:0)}writeTypeRef(e){ke(this.restEncoder,e)}writeLen(e){ke(this.restEncoder,e)}writeAny(e){Sn(this.restEncoder,e)}writeBuf(e){mt(this.restEncoder,e)}writeJSON(e){zr(this.restEncoder,JSON.stringify(e))}writeKey(e){zr(this.restEncoder,e)}},Da=class{constructor(){this.restEncoder=zo(),this.dsCurrVal=0}toUint8Array(){return qt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,ke(this.restEncoder,t)}writeDsLen(e){e===0&&Zt(),ke(this.restEncoder,e-1),this.dsCurrVal+=e}},Kr=class extends Da{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new kn,this.clientEncoder=new Vo,this.leftClockEncoder=new kn,this.rightClockEncoder=new kn,this.infoEncoder=new ys(ba),this.stringEncoder=new xa,this.parentInfoEncoder=new ys(ba),this.typeRefEncoder=new Vo,this.lenEncoder=new Vo}toUint8Array(){let e=zo();return ke(e,0),mt(e,this.keyClockEncoder.toUint8Array()),mt(e,this.clientEncoder.toUint8Array()),mt(e,this.leftClockEncoder.toUint8Array()),mt(e,this.rightClockEncoder.toUint8Array()),mt(e,qt(this.infoEncoder)),mt(e,this.stringEncoder.toUint8Array()),mt(e,qt(this.parentInfoEncoder)),mt(e,this.typeRefEncoder.toUint8Array()),mt(e,this.lenEncoder.toUint8Array()),xs(e,qt(this.restEncoder)),qt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Sn(this.restEncoder,e)}writeBuf(e){mt(this.restEncoder,e)}writeJSON(e){Sn(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},cw=(o,e,t,r)=>{r=ur(r,e[0].id.clock);let n=Fr(e,r);ke(o.restEncoder,e.length-n),o.writeClient(t),ke(o.restEncoder,r);let s=e[n];s.write(o,r-s.id.clock);for(let a=n+1;a<e.length;a++)e[a].write(o,0)},Ec=(o,e,t)=>{let r=new Map;t.forEach((n,s)=>{at(e,s)>n&&r.set(s,n)}),Ha(e).forEach((n,s)=>{t.has(s)||r.set(s,0)}),ke(o.restEncoder,r.size),fr(r.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{cw(o,e.clients.get(n),n,s)})},fw=(o,e)=>{let t=dt(),r=Se(o.restDecoder);for(let n=0;n<r;n++){let s=Se(o.restDecoder),a=new Array(s),i=o.readClient(),l=Se(o.restDecoder);t.set(i,{i:0,refs:a});for(let c=0;c<s;c++){let f=o.readInfo();switch(31&f){case 0:{let u=o.readLen();a[c]=new Rt(Te(i,l),u),l+=u;break}case 10:{let u=Se(o.restDecoder);a[c]=new $t(Te(i,l),u),l+=u;break}default:{let u=(f&192)===0,d=new Ge(Te(i,l),null,(f&128)===128?o.readLeftID():null,null,(f&64)===64?o.readRightID():null,u?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,u&&(f&32)===32?o.readString():null,Bm(o,f));a[c]=d,l+=d.length}}}}return t},uw=(o,e,t)=>{let r=[],n=fr(t.keys()).sort((m,p)=>m-p);if(n.length===0)return null;let s=()=>{if(n.length===0)return null;let m=t.get(n[n.length-1]);for(;m.refs.length===m.i;)if(n.pop(),n.length>0)m=t.get(n[n.length-1]);else return null;return m},a=s();if(a===null)return null;let i=new $a,l=new Map,c=(m,p)=>{let x=l.get(m);(x==null||x>p)&&l.set(m,p)},f=a.refs[a.i++],u=new Map,d=()=>{for(let m of r){let p=m.id.client,x=t.get(p);x?(x.i--,i.clients.set(p,x.refs.slice(x.i)),t.delete(p),x.i=0,x.refs=[]):i.clients.set(p,[m]),n=n.filter(y=>y!==p)}r.length=0};for(;;){if(f.constructor!==$t){let p=cr(u,f.id.client,()=>at(e,f.id.client))-f.id.clock;if(p<0)r.push(f),c(f.id.client,f.id.clock-1),d();else{let x=f.getMissing(o,e);if(x!==null){r.push(f);let y=t.get(x)||{refs:[],i:0};if(y.refs.length===y.i)c(x,at(e,x)),d();else{f=y.refs[y.i++];continue}}else(p===0||p<f.length)&&(f.integrate(o,p),u.set(f.id.client,f.id.clock+f.length))}}if(r.length>0)f=r.pop();else if(a!==null&&a.i<a.refs.length)f=a.refs[a.i++];else{if(a=s(),a===null)break;f=a.refs[a.i++]}}if(i.clients.size>0){let m=new Kr;return Ec(m,i,new Map),ke(m.restEncoder,0),{missing:l,update:m.toUint8Array()}}return null},dw=(o,e)=>Ec(o,e.doc.store,e.beforeState),pw=(o,e,t,r=new wo(o))=>Ue(e,n=>{n.local=!1;let s=!1,a=n.doc,i=a.store,l=fw(r,a),c=uw(n,i,l),f=i.pendingStructs;if(f){for(let[d,m]of f.missing)if(m<at(i,d)){s=!0;break}if(c){for(let[d,m]of c.missing){let p=f.missing.get(d);(p==null||p>m)&&f.missing.set(d,m)}f.update=Ua([f.update,c.update])}}else i.pendingStructs=c;let u=Zp(r,n,i);if(i.pendingDs){let d=new wo(mr(i.pendingDs));Se(d.restDecoder);let m=Zp(d,n,i);u&&m?i.pendingDs=Ua([u,m]):i.pendingDs=u||m}else i.pendingDs=u;if(s){let d=i.pendingStructs.update;i.pendingStructs=null,pm(n.doc,d)}},t,!1);var pm=(o,e,t,r=wo)=>{let n=mr(e);pw(n,o,t,new r(n))},Ar=(o,e,t)=>pm(o,e,t,Ea),mw=(o,e,t=new Map)=>{Ec(o,e.store,t),vo(o,lw(e.store))},hw=(o,e=new Uint8Array([0]),t=new Kr)=>{let r=mm(e);mw(t,o,r);let n=[t.toUint8Array()];if(o.store.pendingDs&&n.push(o.store.pendingDs),o.store.pendingStructs&&n.push(Tw(o.store.pendingStructs.update,e)),n.length>1){if(t.constructor===Jo)return Iw(n.map((s,a)=>a===0?s:Fw(s)));if(t.constructor===Kr)return Ua(n)}return n[0]},Zo=(o,e)=>hw(o,e,new Jo),gw=o=>{let e=new Map,t=Se(o.restDecoder);for(let r=0;r<t;r++){let n=Se(o.restDecoder),s=Se(o.restDecoder);e.set(n,s)}return e},mm=o=>gw(new Dn(mr(o))),hm=(o,e)=>(ke(o.restEncoder,e.size),fr(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{ke(o.restEncoder,t),ke(o.restEncoder,r)}),o),yw=(o,e)=>hm(o,Ha(e.store)),xw=(o,e=new Da)=>(o instanceof Map?hm(e,o):yw(e,o),e.toUint8Array()),gm=o=>xw(o,new Mn),yc=class{constructor(){this.l=[]}},em=()=>new yc,tm=(o,e)=>o.l.push(e),rm=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(n=>e!==n),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},ym=(o,e,t)=>_s(o.l,[e,t]),bo=class{constructor(e,t){this.client=e,this.clock=t}},En=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,Te=(o,e)=>new bo(o,e);var xm=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw Zt()};var Ma=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let n=(s,a)=>{let i=s.get("ds"),l=s.get("ids"),c=f=>this.clients.set(f,a);i.observe(f=>{f.changes.added.forEach(u=>{u.content.getContent().forEach(d=>{d instanceof Uint8Array&&this.dss.set(a,hc([this.dss.get(a)||Ac(),As(new Dn(mr(d)))]))})})}),this.dss.set(a,hc(i.map(f=>As(new Dn(mr(f)))))),l.observe(f=>f.changes.added.forEach(u=>u.content.getContent().forEach(c))),l.forEach(c)};t.observe(s=>{s.keysChanged.forEach(a=>n(t.get(a),a))}),t.forEach(n)}setUserMapping(e,t,r,{filter:n=()=>!0}={}){let s=this.yusers,a=s.get(r);a||(a=new Gr,a.set("ids",new Pr),a.set("ds",new Pr),s.set(r,a)),a.get("ids").push([t]),s.observe(i=>{setTimeout(()=>{let l=s.get(r);if(l!==a){a=l,this.clients.forEach((u,d)=>{r===u&&a.get("ids").push([d])});let c=new Mn,f=this.dss.get(r);f&&(vo(c,f),a.get("ds").push([c.toUint8Array()]))}},0)}),e.on("afterTransaction",i=>{setTimeout(()=>{let l=a.get("ds"),c=i.deleteSet;if(i.local&&c.clients.size>0&&n(i,c)){let f=new Mn;vo(f,c),l.push([f.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(Pc(r,e))return t;return null}},Ra=class{constructor(e,t,r,n=0){this.type=e,this.tname=t,this.item=r,this.assoc=n}};var Dc=o=>new Ra(o.type==null?null:Te(o.type.client,o.type.clock),o.tname||null,o.item==null?null:Te(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),xc=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},bw=(o,e,t=0)=>new xc(o,e,t),Ca=(o,e,t)=>{let r=null,n=null;return o._item===null?n=xm(o):r=Te(o._item.id.client,o._item.id.clock),new Ra(r,n,e,t)},Mc=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return Ca(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return Ca(o,Te(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return Ca(o,r.lastId,t);r=r.right}return Ca(o,null,t)};var Rc=(o,e)=>{let t=e.store,r=o.item,n=o.type,s=o.tname,a=o.assoc,i=null,l=0;if(r!==null){if(at(t,r.client)<=r.clock)return null;let c=fm(t,r),f=c.item;if(!(f instanceof Ge))return null;if(i=f.parent,i._item===null||!i._item.deleted){l=f.deleted||!f.countable?0:c.diff+(a>=0?0:1);let u=f.left;for(;u!==null;)!u.deleted&&u.countable&&(l+=u.length),u=u.left}}else{if(s!==null)i=e.get(s);else if(n!==null){if(at(t,n.client)<=n.clock)return null;let{item:c}=fm(t,n);if(c instanceof Ge&&c.content instanceof tr)i=c.content.type;else return null}else throw Zt();a>=0?l=i._length:l=0}return bw(i,l,o.assoc)},$c=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&En(o.item,e.item)&&En(o.type,e.type)&&o.assoc===e.assoc,bc=class{constructor(e,t){this.ds=e,this.sv=t}};var vw=(o,e)=>new bc(o,e),TP=vw(Ac(),new Map);var An=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!Pc(e.ds,o.id),vc=(o,e)=>{let t=cr(o.meta,vc,Cr),r=o.doc.store;t.has(e)||(e.sv.forEach((n,s)=>{n<at(r,s)&&_o(o,Te(s,n))}),um(o,e.ds,n=>{}),t.add(e))};var $a=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},Ha=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let n=t[t.length-1];e.set(r,n.id.clock+n.length)}),e},at=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},bm=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Zt()}t.push(e)},Fr=(o,e)=>{let t=0,r=o.length-1,n=o[r],s=n.id.clock;if(s===e)return r;let a=Mt(e/(s+n.length-1)*r);for(;t<=r;){if(n=o[a],s=n.id.clock,s<=e){if(e<s+n.length)return a;t=a+1}else r=a-1;a=Mt((t+r)/2)}throw Zt()},ww=(o,e)=>{let t=o.clients.get(e.client);return t[Fr(t,e.clock)]},Ta=ww,wc=(o,e,t)=>{let r=Fr(e,t),n=e[r];return n.id.clock<t&&n instanceof Ge?(e.splice(r+1,0,Na(o,n,t-n.id.clock)),r+1):r},_o=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[wc(o,t,e.clock)]},om=(o,e,t)=>{let r=e.clients.get(t.client),n=Fr(r,t.clock),s=r[n];return t.clock!==s.id.clock+s.length-1&&s.constructor!==Rt&&r.splice(n+1,0,Na(o,s,t.clock-s.id.clock+1)),s},_w=(o,e,t)=>{let r=o.clients.get(e.id.client);r[Fr(r,e.id.clock)]=t},vm=(o,e,t,r,n)=>{if(r===0)return;let s=t+r,a=wc(o,e,t),i;do i=e[a++],s<i.id.clock+i.length&&wc(o,e,s),n(i);while(a<e.length&&e[a].id.clock<s)},_c=class{constructor(e,t,r){this.doc=e,this.deleteSet=new jo,this.beforeState=Ha(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},nm=(o,e)=>e.deleteSet.clients.size===0&&!gp(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Fc(e.deleteSet),dw(o,e),vo(o,e.deleteSet),!0),sm=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&cr(o.changed,e,Cr).add(t)},Pa=(o,e)=>{let t=o[e],r=o[e-1],n=e;for(;n>0;t=r,r=o[--n-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof Ge&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let s=e-n;return s&&o.splice(e+1-s,s),s},Sw=(o,e,t)=>{for(let[r,n]of o.clients.entries()){let s=e.clients.get(r);for(let a=n.length-1;a>=0;a--){let i=n[a],l=i.clock+i.len;for(let c=Fr(s,i.clock),f=s[c];c<s.length&&f.id.clock<l;f=s[++c]){let u=s[c];if(i.clock+i.len<=u.id.clock)break;u instanceof Ge&&u.deleted&&!u.keep&&t(u)&&u.gc(e,!1)}}}},kw=(o,e)=>{o.clients.forEach((t,r)=>{let n=e.clients.get(r);for(let s=t.length-1;s>=0;s--){let a=t[s],i=xn(n.length-1,1+Fr(n,a.clock+a.len-1));for(let l=i,c=n[l];l>0&&c.id.clock>=a.clock;c=n[l])l-=1+Pa(n,l)}})};var wm=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,n=r.store,s=t.deleteSet,a=t._mergeStructs;try{Fc(s),t.afterState=Ha(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let i=[];t.changed.forEach((l,c)=>i.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),i.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(f=>f.target._item===null||!f.target._item.deleted),l.forEach(f=>{f.currentTarget=c,f._path=null}),l.sort((f,u)=>f.path.length-u.path.length),ym(c._dEH,l,t))})}),i.push(()=>r.emit("afterTransaction",[t,r])),_s(i,[]),t._needFormattingCleanup&&Hw(t)}finally{r.gc&&Sw(s,n,r.gcFilter),kw(s,n),t.afterState.forEach((f,u)=>{let d=t.beforeState.get(u)||0;if(d!==f){let m=n.clients.get(u),p=ur(Fr(m,d),1);for(let x=m.length-1;x>=p;)x-=1+Pa(m,x)}});for(let f=a.length-1;f>=0;f--){let{client:u,clock:d}=a[f].id,m=n.clients.get(u),p=Fr(m,d);p+1<m.length&&Pa(m,p+1)>1||p>0&&Pa(m,p)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(jp(Ts,Cs,"[yjs] ",Is,Ls,"Changed the client-id because another client seems to be using it."),r.clientID=dm()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let f=new Jo;nm(f,t)&&r.emit("update",[f.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let f=new Kr;nm(f,t)&&r.emit("updateV2",[f.toUint8Array(),t.origin,r,t])}let{subdocsAdded:i,subdocsLoaded:l,subdocsRemoved:c}=t;(i.size>0||c.size>0||l.size>0)&&(i.forEach(f=>{f.clientID=r.clientID,f.collectionid==null&&(f.collectionid=r.collectionid),r.subdocs.add(f)}),c.forEach(f=>r.subdocs.delete(f)),r.emit("subdocs",[{loaded:l,added:i,removed:c},r,t]),c.forEach(f=>f.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):wm(o,e+1)}}},Ue=(o,e,t=null,r=!0)=>{let n=o._transactionCleanups,s=!1,a=null;o._transaction===null&&(s=!0,o._transaction=new _c(o,t,r),n.push(o._transaction),n.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{a=e(o._transaction)}finally{if(s){let i=o._transaction===n[0];o._transaction=null,i&&wm(n,0)}}return a};function*Cw(o){let e=Se(o.restDecoder);for(let t=0;t<e;t++){let r=Se(o.restDecoder),n=o.readClient(),s=Se(o.restDecoder);for(let a=0;a<r;a++){let i=o.readInfo();if(i===10){let l=Se(o.restDecoder);yield new $t(Te(n,s),l),s+=l}else if(31&i){let l=(i&192)===0,c=new Ge(Te(n,s),null,(i&128)===128?o.readLeftID():null,null,(i&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(i&32)===32?o.readString():null,Bm(o,i));yield c,s+=c.length}else{let l=o.readLen();yield new Rt(Te(n,s),l),s+=l}}}}var Es=class{constructor(e,t){this.gen=Cw(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===$t);return this.curr}};var Ds=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},Iw=o=>Ua(o,Ea,Jo);var Lw=(o,e)=>{if(o.constructor===Rt){let{client:t,clock:r}=o.id;return new Rt(Te(t,r+e),o.length-e)}else if(o.constructor===$t){let{client:t,clock:r}=o.id;return new $t(Te(t,r+e),o.length-e)}else{let t=o,{client:r,clock:n}=t.id;return new Ge(Te(r,n+e),null,Te(r,n+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},Ua=(o,e=wo,t=Kr)=>{if(o.length===1)return o[0];let r=o.map(f=>new e(mr(f))),n=r.map(f=>new Es(f,!0)),s=null,a=new t,i=new Ds(a);for(;n=n.filter(d=>d.curr!==null),n.sort((d,m)=>{if(d.curr.id.client===m.curr.id.client){let p=d.curr.id.clock-m.curr.id.clock;return p===0?d.curr.constructor===m.curr.constructor?0:d.curr.constructor===$t?1:-1:p}else return m.curr.id.client-d.curr.id.client}),n.length!==0;){let f=n[0],u=f.curr.id.client;if(s!==null){let d=f.curr,m=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=f.next(),m=!0;if(d===null||d.id.client!==u||m&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(u!==s.struct.id.client)yo(i,s.struct,s.offset),s={struct:d,offset:0},f.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===$t)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{yo(i,s.struct,s.offset);let p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new $t(Te(u,s.struct.id.clock+s.struct.length),p),offset:0}}else{let p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===$t?s.struct.length-=p:d=Lw(d,p)),s.struct.mergeWith(d)||(yo(i,s.struct,s.offset),s={struct:d,offset:0},f.next())}}else s={struct:f.curr,offset:0},f.next();for(let d=f.curr;d!==null&&d.id.client===u&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==$t;d=f.next())yo(i,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(yo(i,s.struct,s.offset),s=null),Uc(i);let l=r.map(f=>As(f)),c=hc(l);return vo(a,c),a.toUint8Array()},Tw=(o,e,t=wo,r=Kr)=>{let n=mm(e),s=new r,a=new Ds(s),i=new t(mr(o)),l=new Es(i,!1);for(;l.curr;){let f=l.curr,u=f.id.client,d=n.get(u)||0;if(l.curr.constructor===$t){l.next();continue}if(f.id.clock+f.length>d)for(yo(a,f,ur(d-f.id.clock,0)),l.next();l.curr&&l.curr.id.client===u;)yo(a,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===u&&l.curr.id.clock+l.curr.length<=d;)l.next()}Uc(a);let c=As(i);return vo(s,c),s.toUint8Array()};var _m=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:qt(o.encoder.restEncoder)}),o.encoder.restEncoder=zo(),o.written=0)},yo=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&_m(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),ke(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},Uc=o=>{_m(o);let e=o.encoder.restEncoder;ke(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];ke(e,r.written),xs(e,r.restEncoder)}},Pw=(o,e,t,r)=>{let n=new t(mr(o)),s=new Es(n,!1),a=new r,i=new Ds(a);for(let c=s.curr;c!==null;c=s.next())yo(i,e(c),0);Uc(i);let l=As(n);return vo(a,l),a.toUint8Array()};var Fw=o=>Pw(o,Up,wo,Jo),am="You must not compute changes after the event-handler fired.",Rn=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Aw(this.currentTarget,this.target))}deletes(e){return Pc(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Yt(am);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(n=>{if(n!==null){let s=t._map.get(n),a,i;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))a="delete",i=ha(l.content.getContent());else return;else l!==null&&this.deletes(l)?(a="update",i=ha(l.content.getContent())):(a="add",i=void 0)}else if(this.deletes(s))a="delete",i=ha(s.content.getContent());else return;e.set(n,{action:a,oldValue:i})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Yt(am);let t=this.target,r=Cr(),n=Cr(),s=[];if(e={added:r,deleted:n,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let i=null,l=()=>{i&&s.push(i)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((i===null||i.delete===void 0)&&(l(),i={delete:0}),i.delete+=c.length,n.add(c)):this.adds(c)?((i===null||i.insert===void 0)&&(l(),i={insert:[]}),i.insert=i.insert.concat(c.content.getContent()),r.add(c)):((i===null||i.retain===void 0)&&(l(),i={retain:0}),i.retain+=c.length);i!==null&&i.retain===void 0&&l()}this._changes=e}return e}},Aw=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,n=e._item.parent._start;for(;n!==e._item&&n!==null;)n.deleted||r++,n=n.right;t.unshift(r)}e=e._item.parent}return t},Sm=80,Oc=0,Sc=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Oc++}},Ew=o=>{o.timestamp=Oc++},km=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=Oc++},Dw=(o,e,t)=>{if(o.length>=Sm){let r=o.reduce((n,s)=>n.timestamp<s.timestamp?n:s);return km(r,e,t),r}else{let r=new Sc(e,t);return o.push(r),r}},qa=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((s,a)=>yn(e-s.index)<yn(e-a.index)?s:a),r=o._start,n=0;for(t!==null&&(r=t.p,n=t.index,Ew(t));r.right!==null&&n<e;){if(!r.deleted&&r.countable){if(e<n+r.length)break;n+=r.length}r=r.right}for(;r.left!==null&&n>e;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);return t!==null&&yn(t.index-n)<r.parent.length/Sm?(km(t,r,n),t):Dw(o._searchMarker,r,n)},Ms=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let n=o[r];if(t>0){let s=n.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(n.index-=s.length);if(s===null||s.marker===!0){o.splice(r,1);continue}n.p=s,s.marker=!0}(e<n.index||t>0&&e===n.index)&&(n.index=ur(e,n.index+t))}};var Va=(o,e,t)=>{let r=o,n=e.changedParentTypes;for(;cr(n,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;ym(r._eH,t,e)},ct=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=em(),this._dEH=em(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw dr()}clone(){throw dr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){tm(this._eH,e)}observeDeep(e){tm(this._dEH,e)}unobserve(e){rm(this._eH,e)}unobserveDeep(e){rm(this._dEH,e)}toJSON(){}},Cm=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,n=[],s=o._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){let a=s.content.getContent();if(a.length<=e)e-=a.length;else{for(let i=e;i<a.length&&r>0;i++)n.push(a[i]),r--;e=0}}s=s.right}return n},Im=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let n=0;n<r.length;n++)e.push(r[n])}t=t.right}return e};var Rs=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let n=r.content.getContent();for(let s=0;s<n.length;s++)e(n[s],t++,o)}r=r.right}},Lm=(o,e)=>{let t=[];return Rs(o,(r,n)=>{t.push(e(r,n,o))}),t},Mw=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let n=t[r++];return t.length<=r&&(t=null),{done:!1,value:n}}}},Tm=(o,e)=>{let t=qa(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Oa=(o,e,t,r)=>{let n=t,s=o.doc,a=s.clientID,i=s.store,l=t===null?e._start:t.right,c=[],f=()=>{c.length>0&&(n=new Ge(Te(a,at(i,a)),n,n&&n.lastId,l,l&&l.id,e,null,new Qr(c)),n.integrate(o,0),c=[])};r.forEach(u=>{if(u===null)c.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(u);break;default:switch(f(),u.constructor){case Uint8Array:case ArrayBuffer:n=new Ge(Te(a,at(i,a)),n,n&&n.lastId,l,l&&l.id,e,null,new Qo(new Uint8Array(u))),n.integrate(o,0);break;case Vt:n=new Ge(Te(a,at(i,a)),n,n&&n.lastId,l,l&&l.id,e,null,new Yo(u)),n.integrate(o,0);break;default:if(u instanceof ct)n=new Ge(Te(a,at(i,a)),n,n&&n.lastId,l,l&&l.id,e,null,new tr(u)),n.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),f()},Pm=()=>Yt("Length exceeded!"),Fm=(o,e,t,r)=>{if(t>e._length)throw Pm();if(t===0)return e._searchMarker&&Ms(e._searchMarker,t,r.length),Oa(o,e,null,r);let n=t,s=qa(e,t),a=e._start;for(s!==null&&(a=s.p,t-=s.index,t===0&&(a=a.prev,t+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(t<=a.length){t<a.length&&_o(o,Te(a.id.client,a.id.clock+t));break}t-=a.length}return e._searchMarker&&Ms(e._searchMarker,n,r.length),Oa(o,e,a,r)},Rw=(o,e,t)=>{let n=(e._searchMarker||[]).reduce((s,a)=>a.index>s.index?a:s,{index:0,p:e._start}).p;if(n)for(;n.right;)n=n.right;return Oa(o,e,n,t)},Am=(o,e,t,r)=>{if(r===0)return;let n=t,s=r,a=qa(e,t),i=e._start;for(a!==null&&(i=a.p,t-=a.index);i!==null&&t>0;i=i.right)!i.deleted&&i.countable&&(t<i.length&&_o(o,Te(i.id.client,i.id.clock+t)),t-=i.length);for(;r>0&&i!==null;)i.deleted||(r<i.length&&_o(o,Te(i.id.client,i.id.clock+r)),i.delete(o),r-=i.length),i=i.right;if(r>0)throw Pm();e._searchMarker&&Ms(e._searchMarker,n,-s+r)},Ba=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},Bc=(o,e,t,r)=>{let n=e._map.get(t)||null,s=o.doc,a=s.clientID,i;if(r==null)i=new Qr([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:i=new Qr([r]);break;case Uint8Array:i=new Qo(r);break;case Vt:i=new Yo(r);break;default:if(r instanceof ct)i=new tr(r);else throw new Error("Unexpected content type")}new Ge(Te(a,at(s.store,a)),n,n&&n.lastId,null,null,e,t,i).integrate(o,0)},Nc=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},Em=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Dm=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var $w=(o,e)=>{let t={};return o._map.forEach((r,n)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&An(s,e)&&(t[n]=s.content.getContent()[s.length-1])}),t},Ia=o=>Qp(o.entries(),e=>!e[1].deleted),kc=class extends Rn{constructor(e,t){super(e,t),this._transaction=t}},Pr=class extends ct{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new Pr;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Pr}clone(){let e=new Pr;return e.insert(0,this.toArray().map(t=>t instanceof ct?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),Va(this,e,new kc(this,e))}insert(e,t){this.doc!==null?Ue(this.doc,r=>{Fm(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Ue(this.doc,t=>{Rw(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Ue(this.doc,r=>{Am(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Tm(this,e)}toArray(){return Im(this)}slice(e=0,t=this.length){return Cm(this,e,t)}toJSON(){return this.map(e=>e instanceof ct?e.toJSON():e)}map(e){return Lm(this,e)}forEach(e){Rs(this,e)}[Symbol.iterator](){return Mw(this)}_write(e){e.writeTypeRef(o_)}},Uw=o=>new Pr,Cc=class extends Rn{constructor(e,t,r){super(e,t),this.keysChanged=r}},Gr=class extends ct{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new Gr}clone(){let e=new Gr;return this.forEach((t,r)=>{e.set(r,t instanceof ct?t.clone():t)}),e}_callObserver(e,t){Va(this,e,new Cc(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let n=t.content.getContent()[t.length-1];e[r]=n instanceof ct?n.toJSON():n}}),e}get size(){return[...Ia(this._map)].length}keys(){return ka(Ia(this._map),e=>e[0])}values(){return ka(Ia(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return ka(Ia(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ue(this.doc,t=>{Ba(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Ue(this.doc,r=>{Bc(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return Nc(this,e)}has(e){return Dm(this,e)}clear(){this.doc!==null?Ue(this.doc,e=>{this.forEach(function(t,r,n){Ba(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(n_)}},Ow=o=>new Gr,xo=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&oc(o,e),$s=class{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){switch(this.right===null&&Zt(),this.right.content.constructor){case rt:this.right.deleted||Bn(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},im=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case rt:e.right.deleted||Bn(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&_o(o,Te(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},La=(o,e,t,r)=>{let n=new Map,s=r?qa(e,t):null;if(s){let a=new $s(s.p.left,s.p,s.index,n);return im(o,a,t-s.index)}else{let a=new $s(null,e._start,0,n);return im(o,a,t)}},Mm=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===rt&&xo(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let n=o.doc,s=n.clientID;r.forEach((a,i)=>{let l=t.left,c=t.right,f=new Ge(Te(s,at(n.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new rt(i,a));f.integrate(o,0),t.right=f,t.forward()})},Bn=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},Rm=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===rt&&xo((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},$m=(o,e,t,r)=>{var i;let n=o.doc,s=n.clientID,a=new Map;for(let l in r){let c=r[l],f=(i=t.currentAttributes.get(l))!=null?i:null;if(!xo(f,c)){a.set(l,f);let{left:u,right:d}=t;t.right=new Ge(Te(s,at(n.store,s)),u,u&&u.lastId,d,d&&d.id,e,null,new rt(l,c)),t.right.integrate(o,0),t.forward()}}return a},mc=(o,e,t,r,n)=>{t.currentAttributes.forEach((d,m)=>{n[m]===void 0&&(n[m]=null)});let s=o.doc,a=s.clientID;Rm(t,n);let i=$m(o,e,t,n),l=r.constructor===String?new er(r):r instanceof ct?new tr(r):new Jr(r),{left:c,right:f,index:u}=t;e._searchMarker&&Ms(e._searchMarker,t.index,l.getLength()),f=new Ge(Te(a,at(s.store,a)),c,c&&c.lastId,f,f&&f.id,e,null,l),f.integrate(o,0),t.right=f,t.index=u,t.forward(),Mm(o,e,t,i)},lm=(o,e,t,r,n)=>{let s=o.doc,a=s.clientID;Rm(t,n);let i=$m(o,e,t,n);e:for(;t.right!==null&&(r>0||i.size>0&&(t.right.deleted||t.right.content.constructor===rt));){if(!t.right.deleted)switch(t.right.content.constructor){case rt:{let{key:l,value:c}=t.right.content,f=n[l];if(f!==void 0){if(xo(f,c))i.delete(l);else{if(r===0)break e;i.set(l,c)}t.right.delete(o)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&_o(o,Te(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new Ge(Te(a,at(s.store,a)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new er(l)),t.right.integrate(o,0),t.forward()}Mm(o,e,t,i)},Um=(o,e,t,r,n)=>{var c,f;let s=e,a=dt();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===rt){let u=s.content;a.set(u.key,u)}s=s.right}let i=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){let u=e.content;switch(u.constructor){case rt:{let{key:d,value:m}=u,p=(c=r.get(d))!=null?c:null;(a.get(d)!==u||p===m)&&(e.delete(o),i++,!l&&((f=n.get(d))!=null?f:null)===m&&p!==m&&(p===null?n.delete(d):n.set(d,p))),!l&&!e.deleted&&Bn(n,u);break}}}e=e.right}return i},Bw=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===rt){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},Nw=o=>{let e=0;return Ue(o.doc,t=>{let r=o._start,n=o._start,s=dt(),a=ma(s);for(;n;){if(n.deleted===!1)switch(n.content.constructor){case rt:Bn(a,n.content);break;default:e+=Um(t,r,n,s,a),s=ma(a),r=n;break}n=n.right}}),e},Hw=o=>{let e=new Set,t=o.doc;for(let[r,n]of o.afterState.entries()){let s=o.beforeState.get(r)||0;n!==s&&vm(o,t.store.clients.get(r),s,n,a=>{!a.deleted&&a.content.constructor===rt&&a.constructor!==Rt&&e.add(a.parent)})}Ue(t,r=>{um(o,o.deleteSet,n=>{if(n instanceof Rt||!n.parent._hasFormatting||e.has(n.parent))return;let s=n.parent;n.content.constructor===rt?e.add(s):Bw(r,n)});for(let n of e)Nw(n)})},cm=(o,e,t)=>{let r=t,n=ma(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case tr:case Jr:case er:t<e.right.length&&_o(o,Te(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}s&&Um(o,s,e.right,n,e.currentAttributes);let a=(e.left||e.right).parent;return a._searchMarker&&Ms(a._searchMarker,e.index,-r+t),e},Ic=class extends Rn{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];Ue(e,r=>{var m,p,x;let n=new Map,s=new Map,a=this.target._start,i=null,l={},c="",f=0,u=0,d=()=>{if(i!==null){let y=null;switch(i){case"delete":u>0&&(y={delete:u}),u=0;break;case"insert":(typeof c=="object"||c.length>0)&&(y={insert:c},n.size>0&&(y.attributes={},n.forEach((g,I)=>{g!==null&&(y.attributes[I]=g)}))),c="";break;case"retain":f>0&&(y={retain:f},Rp(l)||(y.attributes=Dp({},l))),f=0;break}y&&t.push(y),i=null}};for(;a!==null;){switch(a.content.constructor){case tr:case Jr:this.adds(a)?this.deletes(a)||(d(),i="insert",c=a.content.getContent()[0],d()):this.deletes(a)?(i!=="delete"&&(d(),i="delete"),u+=1):a.deleted||(i!=="retain"&&(d(),i="retain"),f+=1);break;case er:this.adds(a)?this.deletes(a)||(i!=="insert"&&(d(),i="insert"),c+=a.content.str):this.deletes(a)?(i!=="delete"&&(d(),i="delete"),u+=a.length):a.deleted||(i!=="retain"&&(d(),i="retain"),f+=a.length);break;case rt:{let{key:y,value:g}=a.content;if(this.adds(a)){if(!this.deletes(a)){let I=(m=n.get(y))!=null?m:null;xo(I,g)?g!==null&&a.delete(r):(i==="retain"&&d(),xo(g,(p=s.get(y))!=null?p:null)?delete l[y]:l[y]=g)}}else if(this.deletes(a)){s.set(y,g);let I=(x=n.get(y))!=null?x:null;xo(I,g)||(i==="retain"&&d(),l[y]=I)}else if(!a.deleted){s.set(y,g);let I=l[y];I!==void 0&&(xo(I,g)?I!==null&&a.delete(r):(i==="retain"&&d(),g===null?delete l[y]:l[y]=g))}a.deleted||(i==="insert"&&d(),Bn(n,a.content));break}}a=a.right}for(d();t.length>0;){let y=t[t.length-1];if(y.retain!==void 0&&y.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},So=class extends ct{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new So}clone(){let e=new So;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new Ic(this,e,t);Va(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===er&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Ue(this.doc,r=>{let n=new $s(null,this._start,0,new Map);for(let s=0;s<e.length;s++){let a=e[s];if(a.insert!==void 0){let i=!t&&typeof a.insert=="string"&&s===e.length-1&&n.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof i!="string"||i.length>0)&&mc(r,this,n,i,a.attributes||{})}else a.retain!==void 0?lm(r,this,n,a.retain,a.attributes||{}):a.delete!==void 0&&cm(r,n,a.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let n=[],s=new Map,a=this.doc,i="",l=this._start;function c(){if(i.length>0){let u={},d=!1;s.forEach((p,x)=>{d=!0,u[x]=p});let m={insert:i};d&&(m.attributes=u),n.push(m),i=""}}let f=()=>{for(;l!==null;){if(An(l,e)||t!==void 0&&An(l,t))switch(l.content.constructor){case er:{let u=s.get("ychange");e!==void 0&&!An(l,e)?(u===void 0||u.user!==l.id.client||u.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!An(l,t)?(u===void 0||u.user!==l.id.client||u.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):u!==void 0&&(c(),s.delete("ychange")),i+=l.content.str;break}case tr:case Jr:{c();let u={insert:l.content.getContent()[0]};if(s.size>0){let d={};u.attributes=d,s.forEach((m,p)=>{d[p]=m})}n.push(u);break}case rt:An(l,e)&&(c(),Bn(s,l.content));break}l=l.right}c()};return e||t?Ue(a,u=>{e&&vc(u,e),t&&vc(u,t),f()},"cleanup"):f(),n}insert(e,t,r){if(t.length<=0)return;let n=this.doc;n!==null?Ue(n,s=>{let a=La(s,this,e,!r);r||(r={},a.currentAttributes.forEach((i,l)=>{r[l]=i})),mc(s,this,a,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let n=this.doc;n!==null?Ue(n,s=>{let a=La(s,this,e,!r);mc(s,this,a,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?Ue(r,n=>{cm(n,La(n,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let n=this.doc;n!==null?Ue(n,s=>{let a=La(s,this,e,!1);a.right!==null&&lm(s,this,a,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Ue(this.doc,t=>{Ba(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Ue(this.doc,r=>{Bc(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return Nc(this,e)}getAttributes(){return Em(this)}_write(e){e.writeTypeRef(s_)}},qw=o=>new So,Ps=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===ko||t.constructor===jr)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},jr=class extends ct{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new jr}clone(){let e=new jr;return e.insert(0,this.toArray().map(t=>t instanceof ct?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Ps(this,e)}querySelector(e){e=e.toUpperCase();let r=new Ps(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),fr(new Ps(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Va(this,e,new Lc(this,t,e))}toString(){return Lm(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),Rs(this,s=>{n.insertBefore(s.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?Ue(this.doc,r=>{Fm(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Ue(this.doc,r=>{let n=e&&e instanceof ct?e._item:e;Oa(r,this,n,t)});else{let r=this._prelimContent,n=e===null?0:r.findIndex(s=>s===e)+1;if(n===0&&e!==null)throw Yt("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){this.doc!==null?Ue(this.doc,r=>{Am(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return Im(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Tm(this,e)}slice(e=0,t=this.length){return Cm(this,e,t)}forEach(e){Rs(this,e)}_write(e){e.writeTypeRef(i_)}},Vw=o=>new jr,ko=class extends jr{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new ko(this.nodeName)}clone(){let e=new ko(this.nodeName),t=this.getAttributes();return Mp(t,(r,n)=>{typeof r=="string"&&e.setAttribute(n,r)}),e.insert(0,this.toArray().map(r=>r instanceof ct?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let i in e)r.push(i);r.sort();let n=r.length;for(let i=0;i<n;i++){let l=r[i];t.push(l+'="'+e[l]+'"')}let s=this.nodeName.toLocaleLowerCase(),a=t.length>0?" "+t.join(" "):"";return`<${s}${a}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Ue(this.doc,t=>{Ba(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Ue(this.doc,r=>{Bc(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return Nc(this,e)}hasAttribute(e){return Dm(this,e)}getAttributes(e){return e?$w(this,e):Em(this)}toDOM(e=document,t={},r){let n=e.createElement(this.nodeName),s=this.getAttributes();for(let a in s){let i=s[a];typeof i=="string"&&n.setAttribute(a,i)}return Rs(this,a=>{n.appendChild(a.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(a_),e.writeKey(this.nodeName)}},zw=o=>new ko(o.readKey()),Lc=class extends Rn{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}},$n=class extends Gr{constructor(e){super(),this.hookName=e}_copy(){return new $n(this.hookName)}clone(){let e=new $n(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let n=t[this.hookName],s;return n!==void 0?s=n.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(l_),e.writeKey(this.hookName)}},Ww=o=>new $n(o.readKey()),Un=class extends So{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Un}clone(){let e=new Un;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{let t=[];for(let n in e.attributes){let s=[];for(let a in e.attributes[n])s.push({key:a,value:e.attributes[n][a]});s.sort((a,i)=>a.key<i.key?-1:1),t.push({nodeName:n,attrs:s})}t.sort((n,s)=>n.nodeName<s.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){let s=t[n];r+=`<${s.nodeName}`;for(let a=0;a<s.attrs.length;a++){let i=s.attrs[a];r+=` ${i.key}="${i.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(c_)}},Kw=o=>new Un,Us=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw dr()}mergeWith(e){return!1}write(e,t,r){throw dr()}integrate(e,t){throw dr()}},Gw=0,Rt=class extends Us{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),bm(e.doc.store,this)}write(e,t){e.writeInfo(Gw),e.writeLen(this.length-t)}getMissing(e,t){return null}},Qo=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Qo(this.content)}splice(e){throw dr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},jw=o=>new Qo(o.readBuf()),Xo=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Xo(this.len)}splice(e){let t=new Xo(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){Aa(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},Jw=o=>new Xo(o.readLen()),Om=(o,e)=>new Vt({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),Yo=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Yo(Om(this.doc.guid,this.opts))}splice(e){throw dr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},Qw=o=>new Yo(Om(o.readString(),o.readAny())),Jr=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Jr(this.embed)}splice(e){throw dr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},Xw=o=>new Jr(o.readJSON()),rt=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new rt(this.key,this.value)}splice(e){throw dr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},Yw=o=>new rt(o.readKey(),o.readJSON()),On=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new On(this.arr)}splice(e){let t=new On(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}},Zw=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let n=o.readString();n==="undefined"?t.push(void 0):t.push(JSON.parse(n))}return new On(t)},Qr=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Qr(this.arr)}splice(e){let t=new Qr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeAny(s)}}getRef(){return 8}},e_=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new Qr(t)},er=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new er(this.str)}splice(e){let t=new er(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},t_=o=>new er(o.readString()),r_=[Uw,Ow,qw,zw,Vw,Ww,Kw],o_=0,n_=1,s_=2,a_=3,i_=4,l_=5,c_=6,tr=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new tr(this.type._copy())}splice(e){throw dr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},f_=o=>new tr(r_[o.readTypeRef()](o)),fm=(o,e)=>{let t=e,r=0,n;do r>0&&(t=Te(t.client,t.clock+r)),n=Ta(o,t),r=t.clock-n.id.clock,t=n.redone;while(t!==null&&n instanceof Ge);return{item:n,diff:r}};var Na=(o,e,t)=>{let{client:r,clock:n}=e.id,s=new Ge(Te(r,n+t),e,Te(r,n+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Te(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),o._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};var Ge=class extends Us{constructor(e,t,r,n,s,a,i,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=s,this.parent=a,this.parentSub=i,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=at(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=at(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===bo&&this.id.client!==this.parent.client&&this.parent.clock>=at(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=om(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=_o(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Rt||this.right&&this.right.constructor===Rt)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ge&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Ge&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===bo){let r=Ta(t,this.parent);r.constructor===Rt?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=om(e,e.doc.store,Te(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;let s=new Set,a=new Set;for(;n!==null&&n!==this.right;){if(a.add(n),s.add(n),En(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,s.clear();else if(En(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&a.has(Ta(e.doc.store,n.origin)))s.has(Ta(e.doc.store,n.origin))||(r=n,s.clear());else break;n=n.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),bm(e.doc.store,this),this.content.integrate(e,this),sm(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Rt(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Te(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&En(e.origin,this.lastId)&&this.right===e&&En(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),Aa(e.deleteSet,this.id.client,this.id.clock,this.length),sm(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Zt();this.content.gc(e),t?_w(e,this,new Rt(this.id,this.length)):this.content=new Xo(this.length)}write(e,t){let r=t>0?Te(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,s=this.parentSub,a=this.content.getRef()&31|(r===null?0:128)|(n===null?0:64)|(s===null?0:32);if(e.writeInfo(a),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){let i=this.parent;if(i._item!==void 0){let l=i._item;if(l===null){let c=xm(i);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else i.constructor===String?(e.writeParentInfo(!0),e.writeString(i)):i.constructor===bo?(e.writeParentInfo(!1),e.writeLeftID(i)):Zt();s!==null&&e.writeString(s)}this.content.write(e,t)}},Bm=(o,e)=>u_[e&31](o),u_=[()=>{Zt()},Jw,Zw,jw,t_,Xw,Yw,f_,e_,Qw,()=>{Zt()}],d_=10,$t=class extends Us{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Zt()}write(e,t){e.writeInfo(d_),ke(e.restEncoder,this.length-t)}getMissing(e,t){return null}},Nm=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},Hm="__ $YJS$ __";Nm[Hm]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Nm[Hm]=!0;var en=o=>Wr((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),qm=(o,e)=>Wr((t,r)=>{let n=indexedDB.open(o);n.onupgradeneeded=s=>e(s.target.result),n.onerror=s=>r(Yt(s.target.error)),n.onsuccess=s=>{let a=s.target.result;a.onversionchange=()=>{a.close()},t(a)}}),Vm=o=>en(indexedDB.deleteDatabase(o)),zm=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),rr=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(n=>g_(r,n))},Xr=(o,e)=>en(o.count(e)),Wm=(o,e)=>en(o.get(e)),Hc=(o,e)=>en(o.delete(e)),Km=(o,e,t)=>en(o.put(e,t));var za=(o,e)=>en(o.add(e)),Gm=(o,e,t)=>en(o.getAll(e,t));var p_=(o,e,t)=>{let r=null;return h_(o,e,n=>(r=n,!1),t).then(()=>r)},jm=(o,e=null)=>p_(o,e,"prev");var m_=(o,e)=>Wr((t,r)=>{o.onerror=r,o.onsuccess=async n=>{let s=n.target.result;if(s===null||await e(s)===!1)return t();s.continue()}});var h_=(o,e,t,r="next")=>m_(o.openKeyCursor(e,r),n=>t(n.key)),g_=(o,e)=>o.objectStore(e);var Jm=(o,e)=>IDBKeyRange.upperBound(o,e),Qm=(o,e)=>IDBKeyRange.lowerBound(o,e);var qc="custom",Xm="updates",Ym=500,Zm=(o,e=()=>{},t=()=>{})=>{let[r]=rr(o.db,[Xm]);return Gm(r,Qm(o._dbref,!1)).then(n=>{o._destroyed||(e(r),Ue(o.doc,()=>{n.forEach(s=>Ar(o.doc,s))},o,!1),t(r))}).then(()=>jm(r).then(n=>{o._dbref=n+1})).then(()=>Xr(r).then(n=>{o._dbsize=n})).then(()=>r)},y_=(o,e=!0)=>Zm(o).then(t=>{(e||o._dbsize>=Ym)&&za(t,Zo(o.doc)).then(()=>Hc(t,Jm(o._dbref,!0))).then(()=>Xr(t).then(r=>{o._dbsize=r}))});var Co=class extends gn{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=qm(e,r=>zm(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Wr(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Zm(this,a=>za(a,Zo(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,n)=>{if(this.db&&n!==this){let[s]=rr(this.db,[Xm]);za(s,r),++this._dbsize>=Ym&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{y_(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{Vm(this.name)})}get(e){return this._db.then(t=>{let[r]=rr(t,[qc],"readonly");return Wm(r,e)})}set(e,t){return this._db.then(r=>{let[n]=rr(r,[qc]);return Km(n,t,e)})}del(e){return this._db.then(t=>{let[r]=rr(t,[qc]);return Hc(r,e)})}};var Gt=mn(hs());var eh=0,Ka=1,th=2,Ga=(o,e)=>{ke(o,eh);let t=gm(e);mt(o,t)},Vc=(o,e,t)=>{ke(o,Ka),mt(o,Zo(e,t))},x_=(o,e,t)=>Vc(e,t,xt(o)),rh=(o,e,t)=>{try{Ar(e,xt(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},oh=(o,e)=>{ke(o,th),mt(o,e)},b_=rh,nh=(o,e,t,r)=>{let n=Se(o);switch(n){case eh:x_(o,e,t);break;case Ka:rh(o,t,r);break;case th:b_(o,t,r);break;default:throw new Error("Unknown message type")}return n};var w_=0;var sh=(o,e,t)=>{switch(Se(o)){case w_:t(e,pr(o))}};var zc=3e4,ja=class extends gn{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=Go();this.getLocalState()!==null&&zc/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((n,s)=>{s!==this.clientID&&zc<=t-n.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&Ja(this,r,"timeout")},Mt(zc/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),n=r===void 0?0:r.clock+1,s=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:Go()});let a=[],i=[],l=[],c=[];e===null?c.push(t):s==null?e!=null&&a.push(t):(i.push(t),Pn(s,e)||l.push(t)),(a.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:a,updated:l,removed:c},"local"]),this.emit("update",[{added:a,updated:i,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},Ja=(o,e,t)=>{let r=[];for(let n=0;n<e.length;n++){let s=e[n];if(o.states.has(s)){if(o.states.delete(s),s===o.clientID){let a=o.meta.get(s);o.meta.set(s,{clock:a.clock+1,lastUpdated:Go()})}r.push(s)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},Hn=(o,e,t=o.states)=>{let r=e.length,n=zo();ke(n,r);for(let s=0;s<r;s++){let a=e[s],i=t.get(a)||null,l=o.meta.get(a).clock;ke(n,a),ke(n,l),zr(n,JSON.stringify(i))}return qt(n)};var ah=(o,e,t)=>{let r=mr(e),n=Go(),s=[],a=[],i=[],l=[],c=Se(r);for(let f=0;f<c;f++){let u=Se(r),d=Se(r),m=JSON.parse(pr(r)),p=o.meta.get(u),x=o.states.get(u),y=p===void 0?0:p.clock;(y<d||y===d&&m===null&&o.states.has(u))&&(m===null?u===o.clientID&&o.getLocalState()!=null?d++:o.states.delete(u):o.states.set(u,m),o.meta.set(u,{clock:d,lastUpdated:n}),p===void 0&&m!==null?s.push(u):p!==void 0&&m===null?l.push(u):m!==null&&(Pn(m,x)||i.push(u),a.push(u)))}(s.length>0||i.length>0||l.length>0)&&o.emit("change",[{added:s,updated:i,removed:l},t]),(s.length>0||a.length>0||l.length>0)&&o.emit("update",[{added:s,updated:a,removed:l},t])};var Vn=()=>new Map,uh=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},dh=()=>new Set,k_=Array.from,EP=Array.isArray,ph=String.fromCharCode,DP=String.fromCodePoint,MP=ph(65535),C_=o=>o.toLowerCase(),I_=/^\s*/g,L_=o=>o.replace(I_,""),T_=/([A-Z])/g,ih=(o,e)=>L_(o.replace(T_,t=>`${e}${C_(t)}`)),P_=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},Os=typeof TextEncoder!="undefined"?new TextEncoder:null,F_=o=>Os.encode(o),A_=Os?F_:P_,Wc=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Wc&&Wc.decode(new Uint8Array).length===1&&(Wc=null);var lh=o=>o===void 0?null:o,E_=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},mh=new E_,Xc=!0;try{typeof localStorage!="undefined"&&(mh=localStorage,Xc=!1)}catch(o){}var hh=mh,D_=o=>Xc||addEventListener("storage",o),M_=o=>Xc||removeEventListener("storage",o),R_=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},$_=(o,e)=>e.includes(o),Kn=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),gh=typeof window!="undefined"&&typeof document!="undefined"&&!Kn,RP=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,Er,U_=[],O_=()=>{if(Er===void 0)if(Kn){Er=Vn();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&Er.set(e,""),e=r):e!==null?(Er.set(e,r),e=null):U_.push(r)}e!==null&&Er.set(e,"")}else typeof location=="object"?(Er=Vn(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");Er.set(`--${ih(e,"-")}`,t),Er.set(`-${ih(e,"-")}`,t)}})):Er=Vn();return Er},Gc=o=>O_().has(o),jc=o=>lh(Kn?process.env[o.toUpperCase()]:hh.getItem(o)),B_=o=>Gc("--"+o)||jc(o)!==null,$P=B_("production"),ch=Kn&&$_(process.env.FORCE_COLOR,["true","1","2"]),UP=!Gc("no-colors")&&(!Kn||process.stdout.isTTY||ch)&&(!Kn||Gc("color")||ch||jc("COLORTERM")!==null||(jc("TERM")||"").includes("color")),yh=Math.floor,xh=(o,e)=>o<e?o:e,N_=(o,e)=>o>e?o:e,OP=Number.isNaN,H_=Math.pow,bh=128,q_=1<<17,V_=1<<18,z_=1<<19,W_=1<<20,K_=1<<21,G_=1<<22,j_=1<<23,J_=1<<24,Q_=1<<25,X_=1<<26,Y_=1<<27,Z_=1<<28,eS=1<<29,tS=1<<30,BP=1<<31,Qa=127,NP=q_-1,HP=V_-1,qP=z_-1,VP=W_-1,zP=K_-1,WP=G_-1,KP=j_-1,GP=J_-1,jP=Q_-1,JP=X_-1,QP=Y_-1,XP=Z_-1,YP=eS-1,ZP=tS-1,rS=Number.MAX_SAFE_INTEGER,eF=Number.MIN_SAFE_INTEGER,tF=1<<31,rF=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&yh(o)===o),oF=Number.isNaN,nF=Number.parseInt,oS=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},hr=()=>new oS,Yc=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},or=o=>{let e=new Uint8Array(Yc(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(_h(o.cbuf.buffer,0,o.cpos),t),e},Xa=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},kt=(o,e)=>{for(;e>Qa;)Xa(o,bh|Qa&e),e=yh(e/128);Xa(o,Qa&e)},Jc=new Uint8Array(3e4),nS=Jc.length/3,sS=(o,e)=>{if(e.length<nS){let t=Os.encodeInto(e,Jc).written||0;kt(o,t);for(let r=0;r<t;r++)Xa(o,Jc[r])}else zn(o,A_(e))},aS=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;kt(o,r);for(let n=0;n<r;n++)Xa(o,t.codePointAt(n))},sF=Os&&Os.encodeInto?sS:aS,iS=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=xh(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(N_(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},zn=(o,e)=>{kt(o,e.byteLength),iS(o,e)},aF=new DataView(new ArrayBuffer(4)),vh=o=>new Error(o),lS=vh("Unexpected end of array"),cS=vh("Integer out of Range"),fS=class{constructor(o){this.arr=o,this.pos=0}},uS=o=>new fS(o),dS=(o,e)=>{let t=_h(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},pS=o=>dS(o,wh(o)),wh=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&Qa)*t,t*=128,n<bh)return e;if(e>rS)throw cS}throw lS},mS=o=>new Uint8Array(o),_h=(o,e,t)=>new Uint8Array(o,e,t),hS=o=>new Uint8Array(o),gS=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=ph(o[t]);return btoa(e)},yS=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),xS=o=>{let e=atob(o),t=mS(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},bS=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},vS=gh?gS:yS,wS=gh?xS:bS,Sh=new Map,_S=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:wS(e.newValue||"")}),D_(this._onChange)}postMessage(o){hh.setItem(this.room,vS(hS(o)))}close(){M_(this._onChange)}},SS=typeof BroadcastChannel=="undefined"?_S:BroadcastChannel,Zc=o=>uh(Sh,o,()=>{let e=dh(),t=new SS(o);return t.onmessage=r=>e.forEach(n=>n(r.data,"broadcastchannel")),{bc:t,subs:e}}),kS=(o,e)=>(Zc(o).subs.add(e),e),CS=(o,e)=>{let t=Zc(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),Sh.delete(o)),r},qn=(o,e,t=null)=>{let r=Zc(o);r.bc.postMessage(e),r.subs.forEach(n=>n(e,t))},Qc=Date.now,IS=class{constructor(){this._observers=Vn()}on(o,e){uh(this._observers,o,dh).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return k_((this._observers.get(o)||Vn()).values()).forEach(t=>t(...e))}destroy(){this._observers=Vn()}},LS=o=>R_(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),tn=0,kh=3,Wn=1,TS=2,Bs=[];Bs[tn]=(o,e,t,r,n)=>{kt(o,tn);let s=nh(e,o,t.doc,t);r&&s===Ka&&!t.synced&&(t.synced=!0)};Bs[kh]=(o,e,t,r,n)=>{kt(o,Wn),zn(o,Hn(t.awareness,Array.from(t.awareness.getStates().keys())))};Bs[Wn]=(o,e,t,r,n)=>{ah(t.awareness,pS(e),t)};Bs[TS]=(o,e,t,r,n)=>{sh(e,t.doc,(s,a)=>PS(t,a))};var fh=3e4,PS=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),Ch=(o,e,t)=>{let r=uS(e),n=hr(),s=wh(r),a=o.messageHandlers[s];return a?a(n,r,o,t,s):console.error("Unable to compute message"),n},Ih=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=Qc();let r=Ch(o,new Uint8Array(t.data),!0);Yc(r)>1&&e.send(or(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,Ja(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(Ih,xh(H_(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=Qc(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=hr();if(kt(t,tn),Ga(t,o.doc),e.send(or(t)),o.awareness.getLocalState()!==null){let r=hr();kt(r,Wn),zn(r,Hn(o.awareness,[o.doc.clientID])),e.send(or(r))}},o.emit("status",[{status:"connecting"}])}},Kc=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&qn(o.bcChannel,e,o)},Lh=class extends IS{constructor(o,e,t,{connect:r=!0,awareness:n=new ja(t),params:s={},WebSocketPolyfill:a=WebSocket,resyncInterval:i=-1,maxBackoffTime:l=2500,disableBc:c=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let f=LS(s);this.maxBackoffTime=l,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(f.length===0?"":"?"+f),this.roomname=e,this.doc=t,this._WS=a,this.awareness=n,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=c,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Bs.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,i>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let u=hr();kt(u,tn),Ga(u,t),this.ws.send(or(u))}},i)),this._bcSubscriber=(u,d)=>{if(d!==this){let m=Ch(this,new Uint8Array(u),!1);Yc(m)>1&&qn(this.bcChannel,or(m),this)}},this._updateHandler=(u,d)=>{if(d!==this){let m=hr();kt(m,tn),oh(m,u),Kc(this,or(m))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:u,updated:d,removed:m},p)=>{let x=u.concat(d).concat(m),y=hr();kt(y,Wn),zn(y,Hn(n,x)),Kc(this,or(y))},this._unloadHandler=()=>{Ja(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),n.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var u;this.wsconnected&&fh<Qc()-this.wsLastMessageReceived&&((u=this.ws)==null||u.close())},fh/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(kS(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=hr();kt(o,tn),Ga(o,this.doc),qn(this.bcChannel,or(o),this);let e=hr();kt(e,tn),Vc(e,this.doc),qn(this.bcChannel,or(e),this);let t=hr();kt(t,kh),qn(this.bcChannel,or(t),this);let r=hr();kt(r,Wn),zn(r,Hn(this.awareness,[this.doc.clientID])),qn(this.bcChannel,or(r),this)}disconnectBc(){let o=hr();kt(o,Wn),zn(o,Hn(this.awareness,[this.doc.clientID],new Map)),Kc(this,or(o)),this.bcconnected&&(CS(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Ih(this),this.connectBc())}};var ht=new WeakMap,Th=!1;function Za(o){Th=o}var gr={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3},Ct,It,Ya=[];function Ph(o,e,t,r){It=o,Ct=t,r&&(gr={...gr,...r}),e.setInterval(ef,gr.batchInterval)}async function ef(){if(Ya.length===0)return;let o=[...Ya];Ya.length=0;for(let e=0;e<gr.maxRetries;e++)try{await FS();let t=o.map(Fh).join(`
`)+`
`;await It.append(Ct,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===gr.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function FS(){let o=await It.stat(Ct);if(o&&o.size>gr.maxFileSize){for(let e=gr.maxBackups;e>0;e--){let t=`${Ct}.${e}`,r=`${Ct}.${e+1}`;await It.exists(t)&&(e===gr.maxBackups?await It.remove(t):await It.rename(t,r))}await It.exists(Ct)&&await It.rename(Ct,`${Ct}.1`),await It.write(Ct,"")}}function Fh(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}function AS(o,e){return e?t=>(o.notify(t.name+`
`+t.message),t):t=>(o.notify(t.name+`:
An error has occurred, please reload Obsidian.`),t)}var ES=["token","authorization","email","key"];function DS(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var n;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&ES.some(s=>t.toLowerCase().includes(s.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(n=r.stack)==null?void 0:n.split(`
`).map(s=>s.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function be(o,e="log"){return(...t)=>{if(Th){let r=new Date().toISOString(),n=new Error().stack,s=n?n.split(`
`)[2].trim():"",a=t.map(DS).join(" "),i={timestamp:r,level:e,message:`${o}: ${a}`,callerInfo:s};gr.disableConsole||console[e](Fh(i)),Ya.push(i)}}}async function ei(){let o=[];await It.exists(Ct)&&o.push(Ct);for(let e=1;e<=gr.maxBackups;e++){let t=`${Ct}.${e}`;await It.exists(t)&&o.push(t)}return o}async function Ah(){let o=[];if(await It.exists(Ct)){let e=await It.read(Ct);o.push(e)}for(let e=1;e<=gr.maxBackups;e++){let t=`${Ct}.${e}`;if(await It.exists(t)){let r=await It.read(t);o.push(r)}}return o.reverse().join(`
`)}var it=class{constructor(e){let t=e||this.constructor.name;this.debug=be(`[${t}]`,"debug"),this.log=be(`[${t}]`,"log"),this.warn=be(`[${t}]`,"warn"),this.error=be(`[${t}]`,"error")}setLoggers(e){this.debug=be(`[${e}]`,"debug"),this.log=be(`[${e}]`,"log"),this.warn=be(`[${e}]`,"warn"),this.error=be(`[${e}]`,"error")}},MS=!1;function Eh(o){return AS(o,MS)}var tf=class{constructor(){this.platform="s3rn";this.product="relay"}},rf=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},Yr=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},nr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},Lt=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.canvasId=r;this.platform="s3rn";this.product="relay"}},Zr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.fileId=r;this.platform="s3rn";this.product="relay"}},of=class{constructor(e,t,r,n,s,a){this.relayId=e;this.folderId=t;this.fileId=r;this.hash=n;this.contentType=s;this.contentLength=a;this.platform="s3rn";this.product="relay"}},sr=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},eo=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},rn=class{constructor(e,t){this.folderId=e;this.canvasId=t;this.platform="s3rn";this.product="relay"}},Ns=class{constructor(e,t){this.folderId=e;this.fileId=t;this.platform="s3rn";this.product="relay"}},je=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}if("canvasId"in e){if(!this.validateUUID(e.canvasId))throw new Error("Invalid document UUID");t+=`:canvas:${e.canvasId}`}if("fileId"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");if(t+=`:file:${e.fileId}`,"hash"in e&&e.hash&&"contentType"in e&&"contentLength"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");t+=`:sha256:${e.hash}`,t+=`:contentType:${e.contentType}`,t+=`:contentLength:${e.contentLength}`}}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,n,s,a,i,l,c,f,u,d,m,p,x]=t;if(!this.validateUUID(s))throw new Error("Invalid UUID");if(i&&!this.validateUUID(i))throw new Error("Invalid UUID");if(c&&!this.validateUUID(c))throw new Error("Invalid UUID");if(r==="relay"&&n==="relay"&&a==="folder"&&l==="doc")return new nr(s,i,c);if(r==="relay"&&n==="relay"&&a==="folder"&&l==="canvas")return new Lt(s,i,c);if(r==="relay"&&n==="relay"&&a==="folder"&&l==="file"&&f==="hash"&&d==="contentType"&&p==="contentLength")return new of(s,i,c,u,m,x);if(r==="relay"&&n==="relay"&&a==="folder"&&l==="file")return new Zr(s,i,c);if(r==="relay"&&n==="relay"&&a=="folder")return new Yr(s,i);if(r==="relay"&&n==="folder"&&a==="document")return new eo(s,i);if(r==="relay"&&n==="folder"&&a==="canvas")return new rn(s,i);if(r==="relay"&&n==="folder")return new sr(s);if(r==="relay"&&n==="relay")return new rf(s);if(n===void 0)return new tf;throw new Error("Invalid s3rn format for the given product type")}};function RS(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function Dh(o){let e=JSON.stringify(o),t=RS(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var ti={enableUpdateYDocFromDiskBuffer:!1,enableDocumentStatus:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableHTTPSync:!1,enableSyncMenu:!0,enableDocumentServer:!1,enableDocumentHistory:!1,enableEditorTweens:!1,enableSyncModal:!1,enableDesyncPill:!1,enableAttachmentSync:!0,enableNetworkLogging:!1,enableCanvasSync:!1,enableVerifyUploads:!1};function $S(){return new Proxy({},{get:(o,e)=>e})}var Dr=$S();var Gn=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...n)},t)}}};var bt=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return bt.instance||(bt.instance=new bt(new Gn),ht.set(this.instance,"postie")),bt.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let n={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(n),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=be("[postie]","debug");for(let[t,r]of this.mailboxes){for(let n of r)t(n),e("send",n.constructor.name,t),this.deliveredMailLog.push({sender:n,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){be("[postie]","warn")("All Mail Log:"),this.prettyPrintMailLog(this.allMailLog)}prettyPrintDeliveredMailLog(){be("[postie]","warn")("Delivered Mail Log:"),this.prettyPrintMailLog(this.deliveredMailLog)}prettyPrintMailLog(e){let t=be("[postie]","warn");e.forEach((r,n)=>{t(`Mail #${n+1}:`),t(`  Timestamp: ${new Date(r.timestamp).toISOString()}`),t(`  Transaction ID: ${r.transactionId}`),t(`  Sender: ${r.sender.observableName||r.sender.constructor.name}`),t(`  Recipient: ${r.recipient.name||"Anonymous function"}`),t(`  Recipient Origin: ${r.recipientOrigin||"Unknown"}`),t("---")})}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let n=200,s=t.replace(/\s+/g," ").slice(0,n);return s.length===n&&(s+="..."),`AnonymousFunction(${s})`}static destroy(){bt.instance&&(bt.instance.mailboxes=null,bt.instance.allMailLog=[],bt.instance.deliveredMailLog=[],bt.instance.timeProvider.destroy(),bt.instance.timeProvider=null,bt.instance.isDelivering=!1,bt.instance.isInTransaction=!1,bt.instance.currentTransactionId=0,bt._destroyed=!0,bt.instance=void 0)}},ar=bt;ar._destroyed=!1;var nf=new Map;function Mh(){for(let[,o]of nf)o();nf.clear()}var Ve=class extends it{constructor(t){super();this.observableName=t;this.destroyed=!1;nf.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners on ${this.observableName}`)}),this._listeners=new Set,this.unsubscribes=[]}notifyListeners(){for(let t of this._listeners)ar.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),ar.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners&&this._listeners.delete(t)}destroy(){var t;this.destroyed=!0,this.unsubscribes&&this.unsubscribes.forEach(r=>{r()}),(t=this._listeners)==null||t.clear(),this._listeners=null}};function Re(){return{...gt.getInstance().flags}}function to(o,e,t=()=>{}){gt.getInstance().flags[o]?e():t()}function Rh(o,e,t=()=>{}){o.forEach(r=>{if(gt.getInstance().flags[r]){e();return}}),t()}var gt=class extends Ve{constructor(){super();this.flags=ti}async applyServerFlags(t){if(!this.settings)return;let n=t.filter(s=>s.override).reduce((s,a)=>(s[a.name]=a.value,s),{});this.log("applying server flags",n),await this.settings.update(s=>({...s,...n}),!0)}static getInstance(){return gt.instance||(gt.instance=new gt),gt.instance}setSettings(t){this.settings=t,this.settings.subscribe(r=>{this.flags={...this.flags,...r},this.notifyListeners()})}getFlag(t){return this.flags[t]}setFlag(t,r){this.settings&&this.settings.update(n=>({...n,[t]:r}))}static destroy(){gt.instance=null}};var US={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function $h(o,e,t){let r={token:o.token},n=new Lh(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&n.awareness.setLocalStateField("user",{name:t.name,id:t.id,color:t.color.color,colorLight:t.color.light}),n}var ro=class extends it{constructor(t,r,n,s){var c;super();this.guid=t;this._s3rn=r;this.tokenStore=n;this.loginManager=s;this._providerSynced=!1;this.PROVIDER_MAX_ERRORS=3;this.listeners=new Map,this.loginManager=s;let a=(c=this.loginManager)==null?void 0:c.user;this.ydoc=new Vt,Re().enableDocumentHistory&&(this.ydoc.gc=!1),a&&new Ma(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,a.id),this.tokenStore=n,this.clientToken=this.tokenStore.getTokenSync(je.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=$h(this.clientToken,this.ydoc,a);let i=this.providerConnectionErrorSubscription(f=>{this.log(`[${this.path}] disconnection event`,f);let u=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),u&&this.connect()});i.on(),this._offConnectionError=i.off;let l=this.providerStateSubscription(f=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${Dh(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(je.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,n=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!n}return!1}refreshProvider(t){var a;this.clientToken=t;let r=new Vt,n=$h(t,r),s=n.url;if(this._provider){if(this._provider.url!==s){this._provider.url=s,this._provider.wsUnsuccessfulReconnects=0;let i=this._provider.url.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${i}`),(a=this._provider.ws)==null||a.close()}}else throw new Error("missing provider!");n.awareness.destroy(),n.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:US[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._providerSynced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=n=>{n.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}reset(){this.disconnect(),this.clientToken={token:"",url:"",docId:"-",expiryTime:0}}_injectIntent(t){return n=>{t({status:n.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var oo=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},ri=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=n=>{n.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((n,s)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>s(l.error),l.onsuccess=()=>n()}catch(a){s(a)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let i=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);i.onerror=()=>n(i.error),i.onsuccess=()=>r(i.result?i.result.contents:null)}catch(s){n(s)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let i=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);i.onerror=()=>n(i.error),i.onsuccess=()=>r()}catch(s){n(s)}})}};var yr=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=n=>{if(this.currentPromise&&this.resolver){let s=this.resolver;s(n),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let n=r(t);if(n)return n}return this.currentPromise||(this.currentPromise=new Promise((n,s)=>{this.resolver=n,this.timeoutId=window.setTimeout(()=>{be("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[a,i]=this.checkFunction();a&&r(i)},3e3),this.promiseFunction().then(a=>{this.timeoutId&&clearTimeout(this.timeoutId),n(a)},a=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,s(a)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},oi=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{be("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function Uh(o,...e){return new Promise((t,r)=>{let n=window.setTimeout(()=>{be("[Promise]","debug")("Promise stuck after 3s:",...e)},3e3);o.then(s=>{clearTimeout(n),t(s)},s=>{clearTimeout(n),r(s)})})}var OS={md:"text/markdown",txt:"text/plain",json:"application/json",js:"application/javascript",ts:"application/typescript",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",pdf:"application/pdf",canvas:"application/canvas+json",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",mp3:"audio/mpeg",wav:"audio/wav",m4a:"audio/x-m4a",flac:"audio/flac",ogg:"audio/ogg",oga:"audio/ogg",opus:"audio/opus",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",mov:"video/quicktime",mkv:"video/x-matroska","3gp":"video/3gpp"};function Io(o){var t;let e=((t=o.split(".").pop())==null?void 0:t.toLowerCase())||"";return OS[e]||"application/octet-stream"}function xr(o){return o instanceof ot}var ot=class extends ro{constructor(t,r,n,s){let a=s.relayId?new nr(s.relayId,s.guid,r):new eo(s.guid,r);super(r,a,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let i=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new Co(i,this.ydoc)}catch(i){throw this.warn("Unable to open persistence.",this.guid),console.error(i),i}this.whenSynced().then(()=>{let i=l=>{let c=l.transaction.origin;l.changes.keys.size!==0&&c!=this&&this.updateStats()};this.ytext.observe(i),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(i)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",je.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),to(Dr.enableDeltaLogging,()=>{let i=l=>{var f,u;let c="";c+=`Transaction origin: ${l.transaction.origin} ${(u=(f=l.transaction.origin)==null?void 0:f.constructor)==null?void 0:u.name}
`;for(let d of l.changes.delta)c+=`insert: ${d.insert}

retain: ${d.retain}

delete: ${d.delete}
`;this.debug(c)};this.ytext.observe(i),this.unsubscribes.push(()=>{this.ytext.unobserve(i)})}),this._tfile=null}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let n=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(s=>null);return n!==null&&n!==""?r=n:r=await this._parent.read(this),this.setDiskBuffer(r.replace(`\r
`,`
`))}catch(n){throw console.error(n),n}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new oo(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,n=this.text!==r;return n||this.clearDiskBuffer(),n}async connect(){return this.sharedFolder.s3rn instanceof sr?!1:(this.s3rn instanceof eo&&(this.sharedFolder.relayId?this.s3rn=new nr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new eo(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new yr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new yr(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}get mimetype(){return Io(this.path)}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=rr(this._persistence.db,["updates"],"readonly"),r=await Xr(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}static checkExtension(t){return t.endsWith(".md")}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}async read(){return this.text}async rename(t){this.move(t)}async cleanup(){var t;(t=this._diskBufferStore)==null||t.removeDiskBuffer(this.guid)}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var Lo=class extends Ve{constructor(){super();this._set=new Set}add(t){return this._set.add(t),this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let n of this._set)t(n)&&r.push(n);return r}};var no=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let n=r.split(`${this.namespace}${this.seperator}`)[1],s=this.get(n);e.call(t,s,n,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var sf=require("obsidian");function af(o){return o instanceof To}var To=class extends it{constructor(t,r,n){super();this.path=t;this.guid=r;this._tfolder=null;this.ready=!1;this.createPromise=null;this.connected=!0;this._parent=n,this.name=this.path.split("/").pop()||"",this.vault=this._parent.vault;let s=()=>{let a=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(t));return a instanceof sf.TFolder?(this._tfolder=a,this.ready=!0,!0):!1};s()||(this.createPromise=this.vault.createFolder(this.sharedFolder.getPath(t)),this.createPromise.then(a=>{this._tfolder=a,this.ready=!0}).catch(()=>{s()})),this.synctime=0,this.setLoggers(`[SyncFolder](${this.path})`),this.offFolderStatusListener=this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()}),(async()=>(this.createPromise&&await this.createPromise,n.markUploaded(this)))(),this.log("created")}static fromTFolder(t,r){return console.log("virtualpath for new syncfolder",t.getVirtualPath(r.path)),new To(t.getVirtualPath(r.path),Tn(),t)}disconnect(){this.connected=!1}move(t){t!==this.path&&(this.log("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.setLoggers(`[SharedFolder](${this.path})`))}get tfolder(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof sf.TFolder)return t;throw new Error("TFolder API used before file existed")}get parent(){var t;return((t=this.tfolder)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected))}async rename(t){this.move(t)}async delete(){return this.vault.delete(this.tfolder)}cleanup(){}destroy(){var t;(t=this.offFolderStatusListener)==null||t.call(this),this.offFolderStatusListener=null,this._parent=null,this._tfolder=null}};var Mr=mn(hs());var ni,BS=new Uint8Array(16);function lf(){if(!ni&&(ni=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ni))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ni(BS)}var vt=[];for(let o=0;o<256;++o)vt.push((o+256).toString(16).slice(1));function Oh(o,e=0){return vt[o[e+0]]+vt[o[e+1]]+vt[o[e+2]]+vt[o[e+3]]+"-"+vt[o[e+4]]+vt[o[e+5]]+"-"+vt[o[e+6]]+vt[o[e+7]]+"-"+vt[o[e+8]]+vt[o[e+9]]+"-"+vt[o[e+10]]+vt[o[e+11]]+vt[o[e+12]]+vt[o[e+13]]+vt[o[e+14]]+vt[o[e+15]]}var NS=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),cf={randomUUID:NS};function HS(o,e,t){if(cf.randomUUID&&!e&&!o)return cf.randomUUID();o=o||{};let r=o.random||(o.rng||lf)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=r[n];return e}return Oh(r)}var jn=HS;var qS={images:"image",audio:"audio",videos:"video",pdfs:"pdf",otherTypes:"file"};function si(o){return(o==null?void 0:o.type)==="markdown"}function Bh(o){return(o==null?void 0:o.type)==="folder"}function qs(o){return{version:0,id:o,type:"markdown"}}function Nh(o){return{version:0,id:o,type:"canvas"}}function ai(o){return{version:0,id:o,type:"folder"}}function Hh(o,e,t,r,n){return n||(n=Date.now()),{version:0,id:e,type:o,mimetype:t,synctime:n,hash:r}}var ff=class extends Ve{constructor(t,r){super();this.syncSettings=t;this.configs=r;this.protocols=new Map;r=r||ff.defaults,r.forEach(([n,s])=>this.protocols.set(n,s)),this.unsubscribes.push(t.subscribe(n=>{this.updateFromSettings(n)}))}setEnabled(t,r){let n=this.protocols.get(t);n&&this.protocols.set(t,{...n,enabled:r})}canSync(t,r){var a,i;if(t.endsWith(".md")||Re().enableCanvasSync&&t.endsWith(".canvas")||!((a=t.split("/").pop())==null?void 0:a.includes(".")))return!0;if(!Re().enableAttachmentSync)return!1;if(r){let l=this.protocols.get(r.type);return l?l.enabled&&r.version<=l.maxVersion:!1}let s=this.getTypeForPath(t);return!!((i=this.protocols.get(s))!=null&&i.enabled)}updateFromSettings(t){Object.entries(qS).forEach(([r,n])=>{this.setEnabled(n,t[r])})}getEnabledFileSyncTypes(){if(!Re().enableAttachmentSync)return["markdown","canvas"];let t=[];return this.protocols.forEach((r,n)=>{r!=null&&r.enabled&&n!=="folder"&&t.push(n)}),t}getTypeForPath(t){let r=Io(t);for(let[n,s]of this.protocols)if(s.mimetypes.includes(r))return!Re().enableCanvasSync&&n==="canvas"?"file":n;return"file"}},Hs=ff;Hs.defaults=[["folder",{maxVersion:0,mimetypes:[],enabled:!0}],["markdown",{maxVersion:0,mimetypes:["text/markdown"],enabled:!0}],["image",{maxVersion:0,mimetypes:["image/png","image/jpeg","image/gif","image/svg+xml","image/webp","image/avif","image/bmp"],enabled:!0}],["pdf",{maxVersion:0,mimetypes:["application/pdf"],enabled:!0}],["audio",{maxVersion:0,mimetypes:["audio/mpeg","audio/wav","audio/flac","audio/mp4","audio/x-m4a","audio/ogg","audio/opus"],enabled:!0}],["video",{maxVersion:0,mimetypes:["video/mp4","video/webm","video/ogg","video/quicktime","video/x-matroska"],enabled:!0}],["canvas",{maxVersion:0,mimetypes:["application/canvas+json"],enabled:!0}],["file",{maxVersion:0,mimetypes:["application/octet-stream"],enabled:!1}]];var ii=class extends Ve{constructor(t,r,n,s){super();this.ydoc=t;this.namespace=r;this.pendingUpload=n;this.syncSettingsManager=s;this.legacyIds=this.ydoc.getMap("docs"),this.meta=this.ydoc.getMap("filemeta_v0"),this.overlay=new Map,this.renames=new Map,this.deleteSet=new Set,this.typeRegistry=new Hs(this.syncSettingsManager)}assertVPath(t){if(t.startsWith(this.namespace+Mr.sep))throw new Error("Expected virtual path"+t)}print(){this.log("files",Array.from(this.meta.entries()).map(([t,r])=>({path:t,...r}))),this.log("pending...",Array.from(this.pendingUpload.entries()).map(([t,r])=>({path:t,guid:r})))}canSync(t){let r=this.getMeta(t);return this.typeRegistry.canSync(t,r)}resolveMove(t){this.log("resolving alias",t),this.renames.delete(t)}resolveAll(){this.renames.clear()}move(t,r){this.log("moving file",t,"to",r),this.assertVPath(t),this.assertVPath(r),this.renames.set(t,r);let n=this.pendingUpload.get(t);n&&(this.pendingUpload.set(r,n),this.pendingUpload.delete(t)),this.deleteSet.has(t)&&(this.deleteSet.add(r),this.deleteSet.delete(t));let s=this.overlay.get(t);s&&(this.overlay.set(r,s),this.overlay.delete(t));let a=this.meta.get(t);Bh(a)?this.moveFolder(t,r):a&&(this.set(r,a),this.delete(t))}new(t){this.assertVPath(t);let r=jn();return this.pendingUpload.set(t,r),r}forEach(t){this.meta.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)}),this.overlay.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)})}has(t){return this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t)?!1:this.meta.has(t)||this.legacyIds.has(t)||this.overlay.has(t)||this.pendingUpload.has(t)}willSet(t,r){if(this.assertVPath(t),si(r)&&this.legacyIds.get(t)!==r.id)return this.log("legacy vpath set to a different ID",this.legacyIds.get(t),r.id),!0;let n=this.meta.get(t);return n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash?!1:(this.log("new meta diff",n,r),!0)}set(t,r){this.assertVPath(t),si(r)&&this.legacyIds.get(t)!==r.id&&this.legacyIds.set(t,r.id);let n=this.meta.get(t);n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash||(this.log("metadata write (path, existing, meta)",t,n,r),this.meta.set(t,r),this.pendingUpload.has(t)&&this.pendingUpload.delete(t))}processFolderOperation(t){let r=new Map,n=new Map;t.changes.keys.forEach((s,a)=>{if(s.action==="delete"){let i=s.oldValue;(i==null?void 0:i.type)==="folder"&&r.set(i.id,a)}else if(s.action==="add"||s.action==="update"){let i=this.meta.get(a);(i==null?void 0:i.type)==="folder"&&n.set(i.id,a)}}),r.forEach((s,a)=>{let i=n.get(a);if(i&&s!==i){this.log(`Detected folder move from ${s} to ${i}`);let l=new Map;this.meta.forEach((c,f)=>{f.startsWith(i+Mr.sep)&&l.set(f,c)}),this.renames.set(s,i),this.log("setting alias",s,i),this.log("paths to move",l),l.forEach((c,f)=>{let u=f.slice(i.length),d=s+u;this.renames.set(d,f),this.log("setting alias",d,f)})}})}start(){to(Dr.enableDeltaLogging,()=>{let n=s=>{var i,l;let a="";a+=`Transaction origin: ${s.transaction.origin}${(l=(i=s.transaction.origin)==null?void 0:i.constructor)==null?void 0:l.name}
`,s.changes.keys.forEach((c,f)=>{c.action==="add"&&(a+=`Added ${f}: ${this.get(f)}
`),c.action==="update"&&(a+=`Updated ${f}: ${this.get(f)}
`),c.action==="delete"&&(a+=`Deleted ${f}
`)}),this.debug(a)};this.legacyIds.observe(n),this.meta.observe(n),this.unsubscribes.push(()=>{this.legacyIds.unobserve(n)}),this.unsubscribes.push(()=>{this.meta.unobserve(n)})});let t=async n=>{if(n.changes.keys.size===0){this.log("no changes detected");return}n.transaction.origin!=this&&(this.processFolderOperation(n),this.notifyListeners())},r=async n=>{this.migrateUp(),this.notifyListeners()};this.legacyIds.observe(r),this.meta.observe(t),this.unsubscribes.push(()=>{this.legacyIds.unobserve(r)}),this.unsubscribes.push(()=>{this.meta.unobserve(t)}),this.unsubscribes.push(this.typeRegistry.subscribe(()=>{this.log("type registry change"),this.notifyListeners()}))}get(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.pendingUpload.get(t);if(r)return r;let n=this.getMeta(t);if(n)return n.id}getMeta(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.meta.get(t)||this.overlay.get(t),n=this.legacyIds.has(t);if(!r&&this.legacyIds.has(t)){let s=this.legacyIds.get(t),a=qs(s);return this.overlay.set(t,a),a}if(r){if(si(r)&&!n){this.deleteSet.add(t);return}return r}}delete(t){return this.assertVPath(t),this.legacyIds.delete(t),this.pendingUpload.delete(t),this.meta.delete(t)}get remoteIds(){let t=new Set;return this.forEach(r=>{t.add(r.id)}),t}commit(){this.overlay.size>0&&this.log("committing overlay",[...this.overlay.keys()]),this.overlay.forEach((t,r)=>{this.set(r,t),t.type==="markdown"&&this.legacyIds.get(r)!==t.id&&this.legacyIds.set(r,t.id)}),this.overlay=new Map,this.deleteSet.size>0&&this.log("committing deleteSet",[...this.deleteSet]),this.deleteSet.forEach(t=>this.delete(t)),this.deleteSet=new Set}detectFolderMoves(){let t=new Map,r=new Set;this.legacyIds.forEach((s,a)=>{let i;if(this.meta.forEach((l,c)=>{l.type==="markdown"&&l.id===s&&c!==a&&(i=c)}),i){let l=(0,Mr.dirname)(i),c=(0,Mr.dirname)(a);l!==c&&t.set(l,c)}}),Array.from(t.entries()).sort(([s],[a])=>a.length-s.length).forEach(([s,a])=>{r.has(s)||(this.moveFolder(s,a),r.add(s))})}moveFolder(t,r){this.log("moving folder",t,"to",r);let n=new Map;this.meta.forEach((a,i)=>{(i===t||i.startsWith(t+Mr.sep))&&n.set(i,a)}),this.overlay.forEach((a,i)=>{(i===t||i.startsWith(t+Mr.sep))&&n.set(i,a)});let s=this.meta.get(t);s&&(this.meta.set(r,s),this.meta.delete(t)),n.forEach((a,i)=>{if(i===t)return;let l=i.slice(t.length),c=r+l;this.move(i,c)})}markUploaded(t,r){if(!this.has(t))throw new Error(`unexpected vpath ${t} marked uploaded`);this.set(t,r)}migrateFile(t,r){var i;if(this.assertVPath(r),((i=this.meta.get(r))==null?void 0:i.id)===t)return;let n=new Set,s=r.split(Mr.sep),a="";for(let l=0;l<s.length-1;l++)a=s.slice(0,l+1).join(Mr.sep),n.add(a);this.meta.has(r)||this.overlay.has(r)||r.endsWith(".md")&&(this.warn(`migrated legacy key on ${r}`),this.overlay.set(r,qs(t))),n.forEach(l=>{if(l&&!(this.meta.has(l)||this.overlay.has(l))){let c=jn();console.log("creating folder path",l,c),this.overlay.set(l,ai(c))}})}migrateUp(){this.detectFolderMoves(),this.legacyIds.forEach((t,r)=>{this.migrateFile(t,r)})}destroy(){super.destroy(),this.overlay.clear(),this.deleteSet.clear(),this.renames.clear(),this.legacyIds=null,this.meta=null}};function qh(o,e,t=(r,n)=>r.substring(n.length).replace(/^\/+/,"")){return new Proxy(o,{get(r,n){let s=r[n];return typeof s=="function"?function(...a){return a.length>0&&typeof a[0]=="string"&&(a[0]=t(a[0],e)),s.apply(r,a)}:s}})}var Jh=require("obsidian"),Qh=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkFetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(Qh.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=jh()));var nt=async(o,e)=>{let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",n=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.5.6"}),s={url:t,method:r,body:e==null?void 0:e.body,headers:n,throw:!1},a;if(a=await(0,Jh.requestUrl)(s),!a.arrayBuffer.byteLength)return new Response(null,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});let i=new Response(a.arrayBuffer,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});if(Object.defineProperty(i,"json",{value:async()=>JSON.parse(a.text)}),Re().enableNetworkLogging){let c=a.status>=500?"error":a.status>=400?"warn":"debug",f=a.text,u;if((a.headers["content-type"]||"").includes("application/json"))try{u=JSON.parse(f)}catch(m){}be("[CustomFetch]",c)(a.status.toString(),r,t,u||f)}if(a.status>=500)throw new Error(a.text);return i};var Tt=class extends Error{constructor(e){var t,r,n,s;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,Tt.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof Tt||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(s=(n=(r=this.originalError)==null?void 0:r.cause)==null?void 0:n.message)!=null&&s.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},li=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function r1(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||o1,n=0;for(;n<o.length;){let s=o.indexOf("=",n);if(s===-1)break;let a=o.indexOf(";",n);if(a===-1)a=o.length;else if(a<s){n=o.lastIndexOf(";",s-1)+1;continue}let i=o.slice(n,s).trim();if(t[i]===void 0){let l=o.slice(s+1,a).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[i]=r(l)}catch(c){t[i]=l}}n=a+1}return t}function Xh(o,e,t){let r=Object.assign({},t||{}),n=r.encode||n1;if(!li.test(o))throw new TypeError("argument name is invalid");let s=n(e);if(s&&!li.test(s))throw new TypeError("argument val is invalid");let a=o+"="+s;if(r.maxAge!=null){let i=r.maxAge-0;if(isNaN(i)||!isFinite(i))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(i)}if(r.domain){if(!li.test(r.domain))throw new TypeError("option domain is invalid");a+="; Domain="+r.domain}if(r.path){if(!li.test(r.path))throw new TypeError("option path is invalid");a+="; Path="+r.path}if(r.expires){if(!function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");a+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":a+="; Priority=Low";break;case"medium":a+="; Priority=Medium";break;case"high":a+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a}function o1(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function n1(o){return encodeURIComponent(o)}var eg;function ci(o){if(o)try{let e=decodeURIComponent(eg(o.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function tg(o,e=0){let t=ci(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}eg=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,n=0,s=0,a="";r=e.charAt(s++);~r&&(t=n%4?64*t+r:r,n++%4)?a+=String.fromCharCode(255&t>>(-2*n&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};var Yh="pb_auth",zs=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!tg(this.token)}get isAdmin(){return ci(this.token).type==="admin"}get isAuthRecord(){return ci(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=Yh){let r=r1(e||"")[t]||"",n={};try{n=JSON.parse(r),(typeof n===null||typeof n!="object"||Array.isArray(n))&&(n={})}catch(s){}this.save(n.token||"",n.model||null)}exportToCookie(e,t=Yh){var l,c;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=ci(this.token);r.expires=n!=null&&n.exp?new Date(1e3*n.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let s={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},a=Xh(t,JSON.stringify(s),e),i=typeof Blob!="undefined"?new Blob([a]).size:a.length;if(s.model&&i>4096){s.model={id:(l=s==null?void 0:s.model)==null?void 0:l.id,email:(c=s==null?void 0:s.model)==null?void 0:c.email};let f=["collectionId","username","verified"];for(let u in this.model)f.includes(u)&&(s.model[u]=this.model[u]);a=Xh(t,JSON.stringify(s),e)}return a}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},df=class extends zs{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},so=class{constructor(e){this.client=e}},pf=class extends so{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,n,s,a){return a=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:n,duration:s}},a),this.client.send("/api/settings/apple/generate-client-secret",a)}},Ws=class extends so{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(n=>{var s;return n.items=((s=n.items)==null?void 0:s.map(a=>this.decode(a)))||[],n})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var n;if(!((n=r==null?void 0:r.items)!=null&&n.length))throw new Tt({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new Tt({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(n=>this.decode(n))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],n=async s=>this.getList(s,e||500,t).then(a=>{let i=a.items;return r=r.concat(i),i.length==a.perPage?n(s+1):r});return n(1)}};function zt(o,e,t,r){let n=r!==void 0;return n||t!==void 0?n?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function uf(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var mf=class extends Ws{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,a;return((s=this.client.authStore.model)==null?void 0:s.id)===n.id&&((a=this.client.authStore.model)==null?void 0:a.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s;return r&&((n=this.client.authStore.model)==null?void 0:n.id)===e&&((s=this.client.authStore.model)==null?void 0:s.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};s=zt("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",s,r,n);let a=s.autoRefreshThreshold;delete s.autoRefreshThreshold,s.autoRefresh||uf(this.client);let i=await this.client.send(this.baseCrudPath+"/auth-with-password",s);return i=this.authResponse(i),a&&function(c,f,u,d){uf(c);let m=c.beforeSend,p=c.authStore.model,x=c.authStore.onChange((y,g)=>{(!y||(g==null?void 0:g.id)!=(p==null?void 0:p.id)||(g!=null&&g.collectionId||p!=null&&p.collectionId)&&(g==null?void 0:g.collectionId)!=(p==null?void 0:p.collectionId))&&uf(c)});c._resetAutoRefresh=function(){x(),c.beforeSend=m,delete c._resetAutoRefresh},c.beforeSend=async(y,g)=>{var A;let I=c.authStore.token;if((A=g.query)!=null&&A.autoRefresh)return m?m(y,g):{url:y,sendOptions:g};let T=c.authStore.isValid;if(T&&tg(c.authStore.token,f))try{await u()}catch(F){T=!1}T||await d();let P=g.headers||{};for(let F in P)if(F.toLowerCase()=="authorization"&&I==P[F]&&c.authStore.token){P[F]=c.authStore.token;break}return g.headers=P,m?m(y,g):{url:y,sendOptions:g}}}(this.client,a,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},s))),i}async authRefresh(e,t){let r={method:"POST"};return r=zt("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=zt("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=zt("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",a,n,s),this.client.send(this.baseCrudPath+"/confirm-password-reset",a).then(()=>!0)}},s1=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function rg(o){if(o){o.query=o.query||{};for(let e in o)s1.includes(e)||(o.query[e]=o[e],delete o[e])}}var fi=class extends so{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var a;if(!e)throw new Error("topic must be set.");let n=e;if(r){rg(r);let i="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));n+=(n.includes("?")?"&":"?")+i}let s=function(i){let l=i,c;try{c=JSON.parse(l==null?void 0:l.data)}catch(f){}t(c||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(s),this.isConnected?this.subscriptions[n].length===1?await this.submitSubscriptions():(a=this.eventSource)==null||a.addEventListener(n,s):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,s)}async unsubscribe(e){var r;let t=!1;if(e){let n=this.getSubscriptionsByTopic(e);for(let s in n)if(this.hasSubscriptionListeners(s)){for(let a of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,a);delete this.subscriptions[s],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let n in this.subscriptions)if((n+"?").startsWith(e)){t=!0;for(let s of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,s);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var s;let r=!1,n=this.getSubscriptionsByTopic(e);for(let a in n){if(!Array.isArray(this.subscriptions[a])||!this.subscriptions[a].length)continue;let i=!1;for(let l=this.subscriptions[a].length-1;l>=0;l--)this.subscriptions[a][l]===t&&(i=!0,delete this.subscriptions[a][l],this.subscriptions[a].splice(l,1),(s=this.eventSource)==null||s.removeEventListener(a,t));i&&(this.subscriptions[a].length||delete this.subscriptions[a],r||this.hasSubscriptionListeners(a)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let n in this.subscriptions)if((r=this.subscriptions[n])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let n in r)for(let s of r[n])s(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new Tt(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},hf=class extends Ws{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,a,i;return((s=this.client.authStore.model)==null?void 0:s.id)!==(n==null?void 0:n.id)||((a=this.client.authStore.model)==null?void 0:a.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s,a;return!r||((n=this.client.authStore.model)==null?void 0:n.id)!==e||((s=this.client.authStore.model)==null?void 0:s.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};return s=zt("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/auth-with-password",s).then(a=>this.authResponse(a))}async authWithOAuth2Code(e,t,r,n,s,a,i){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:n,createData:s}};return l=zt("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,a,i),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then(c=>this.authResponse(c))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(l=>l.name===t.provider);if(!r)throw new Tt(new Error(`Missing or invalid provider "${t.provider}".`));let n=this.client.buildUrl("/api/oauth2-redirect"),s=new fi(this.client),a=null;function i(){a==null||a.close(),s.unsubscribe()}return t.urlCallback||(a=Zh(void 0)),new Promise(async(l,c)=>{var f;try{await s.subscribe("@oauth2",async p=>{let x=s.clientId;try{if(!p.state||x!==p.state)throw new Error("State parameters don't match.");let y=Object.assign({},t);delete y.provider,delete y.scopes,delete y.createData,delete y.urlCallback;let g=await this.authWithOAuth2Code(r.name,p.code,r.codeVerifier,n,t.createData,y);l(g)}catch(y){c(new Tt(y))}i()});let u={state:s.clientId};(f=t.scopes)!=null&&f.length&&(u.scope=t.scopes.join(" "));let d=this._replaceQueryParams(r.authUrl+n,u);await(t.urlCallback||function(p){a?a.location.href=p:a=Zh(p)})(d)}catch(u){i(),c(new Tt(u))}})}async authRefresh(e,t){let r={method:"POST"};return r=zt("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(n=>this.authResponse(n))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=zt("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=zt("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",a,n,s),this.client.send(this.baseCollectionPath+"/confirm-password-reset",a).then(()=>!0)}async requestVerification(e,t,r){let n={method:"POST",body:{email:e}};return n=zt("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-verification",n).then(()=>!0)}async confirmVerification(e,t,r){let n={method:"POST",body:{token:e}};return n=zt("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then(()=>!0)}async requestEmailChange(e,t,r){let n={method:"POST",body:{newEmail:e}};return n=zt("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",n).then(()=>!0)}async confirmEmailChange(e,t,r,n){let s={method:"POST",body:{token:e,password:t}};return s=zt("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",s).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,n="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),n=e.substring(e.indexOf("?")+1));let s={},a=n.split("&");for(let i of a){if(i=="")continue;let l=i.split("=");s[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let i in t)t.hasOwnProperty(i)&&(t[i]==null?delete s[i]:s[i]=t[i]);n="";for(let i in s)s.hasOwnProperty(i)&&(n!=""&&(n+="&"),n+=encodeURIComponent(i.replace(/%20/g,"+"))+"="+encodeURIComponent(s[i].replace(/%20/g,"+")));return n!=""?r+"?"+n:r}};function Zh(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new Tt(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,n=window.innerHeight;e=e>r?r:e,t=t>n?n:t;let s=r/2-e/2,a=n/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+a+",left="+s+",resizable,menubar=no")}var gf=class extends Ws{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},yf=class extends so{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new Tt({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},xf=class extends so{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},bf=class extends so{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(e.collectionId||e.collectionName)),n.push(encodeURIComponent(e.id)),n.push(encodeURIComponent(t));let s=this.client.buildUrl(n.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let a=new URLSearchParams(r);s+=(s.includes("?")?"&":"?")+a}return s}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},vf=class extends so{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},Jn=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new df,this.admins=new mf(this),this.collections=new gf(this),this.files=new bf(this),this.logs=new yf(this),this.settings=new pf(this),this.realtime=new fi(this),this.health=new xf(this),this.backups=new vf(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new hf(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let n=t[r];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=n===null?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",n)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let n=Object.assign({},await this.beforeSend(r,t));n.url!==void 0||n.options!==void 0?(r=n.url||r,t=n.options||t):Object.keys(n).length&&(t=n,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let n=this.serializeQueryParams(t.query);n&&(r+=(r.includes("?")?"&":"?")+n),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async n=>{let s={};try{s=await n.json()}catch(a){}if(this.afterSend&&(s=await this.afterSend(n,s)),n.status>=400)throw new Tt({url:n.url,status:n.status,data:s});return s}).catch(n=>{throw new Tt(n)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),rg(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let n=new AbortController;this.cancelControllers[r]=n,t.signal=n.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let n=this.normalizeFormDataValue(e[r]),s=Array.isArray(n)?n:[n];if(s.length)for(let a of s)t.append(r,a);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let n of r)if(typeof Blob!="undefined"&&n instanceof Blob||typeof File!="undefined"&&n instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let n=e[r],s=encodeURIComponent(r);if(Array.isArray(n))for(let a of n)t.push(s+"="+encodeURIComponent(a));else n instanceof Date?t.push(s+"="+encodeURIComponent(n.toISOString())):typeof n!==null&&typeof n=="object"?t.push(s+"="+encodeURIComponent(JSON.stringify(n))):t.push(s+"="+encodeURIComponent(n))}return t.join("&")}};var ui=class extends it{constructor(t){super();this.sharedFolder=t;this.pb=new Jn("https://auth.system3.md",t.loginManager.authStore),this.tokenStore=t.tokenStore}async verify(t){if(!t.meta)throw new Error("cannot head file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(je.encode(t.s3rn),r,t.mimetype,0);return(await nt(n.baseUrl,{method:"HEAD",headers:{Authorization:`Bearer ${n.token}`}})).status===200}async readFile(t){if(!t.meta)throw new Error("cannot pull file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(je.encode(t.s3rn),r,t.mimetype,0),s=await nt(n.baseUrl+"/download-url",{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(s.status===404)throw new Error(`[${this.sharedFolder.path}] File is missing: ${t.guid} ${t.meta.hash} ${t.meta.type}`);let i=(await s.json()).downloadUrl;return(await nt(i)).arrayBuffer()}async writeFile(t){let r=await t.caf.read(),n=await t.caf.hash();if(this.log("writeFile",n),!(r&&n))throw new Error("invalid caf");let s=await this.tokenStore.getFileToken(je.encode(t.s3rn),n,t.mimetype,r.byteLength),a=await nt(s.baseUrl+"/upload-url",{method:"POST",headers:{Authorization:`Bearer ${s.token}`}}),i=await a.json();if(a.status!==200)throw new Error(i.error);let l=i.uploadUrl;await nt(l,{method:"PUT",headers:{"Content-Type":t.mimetype},body:r})}destroy(){this.pb.cancelAllRequests(),this.pb=null,this.tokenStore=null,this.sharedFolder=null}};var Ut=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var di=class extends Ve{constructor(t,r){super();this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.log("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),n=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(n)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},Wt=class extends Ve{constructor(t,r){super();this.settings=t;this.patterns=[];this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new Ut("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new Ut(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new Ut("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let s=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([i])=>s.test(i)).reduce((i,[l,c])=>(i[l]=c,i),{})}let n=this.getNestedValue(t);return n===void 0?{}:n}async set(t){if(this.destroyed)throw new Ut("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new Ut("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let n=this.patterns.find(this.isWildcardPattern);if(n){if(this.path.length===1){let l=new RegExp(`^${n.wildcardPattern}$`),c={...r};return Object.entries(t).forEach(([f,u])=>{l.test(f)&&(c[f]=u)}),c}let s={...r},a=s;this.path.forEach(l=>{a[l]=a[l]||{},a=a[l]});let i=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(t).forEach(([l,c])=>{i.test(l)&&(a[l]=c)}),s}return this.setNestedValue(r,t)})}catch(r){let n=r instanceof Error?r.message:"Unknown error";throw new Ut(`Failed to set value at path ${this.getPath()}: ${n}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new Ut("Cannot use destroyed settings",this.getPath());let n=this.get(),s=t(n);!r&&JSON.stringify(n)===JSON.stringify(s)||await this.set(s)}async flush(){if(this.destroyed)throw new Ut("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(i=>i),n=[],s=[],a=[];return r.forEach((i,l)=>{let c=i.match(/^\[(\w+)=(.+)\]$/),f=i.match(/^\((.+?)\)$/);if(c){let[,u,d]=c,m=l>0?s[l-1]:i.split("[")[0];a.push({type:"arrayMatch",key:u,value:d,level:l}),n.push(i),s.push(m)}else if(f){let[,u]=f;a.push({type:"wildcard",wildcardPattern:this.createPatternRegex(u),level:l}),n.push(i),s.push(i)}else n.push(i),s.push(i)}),[n,s,a]}getNestedValue(t){let r=t,n=this.patterns.find(this.isWildcardPattern);if(n&&this.path.length===1){let a=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(r).filter(([l])=>a.test(l)).reduce((l,[c,f])=>(l[c]=f,l),{})}let s=this.patterns[0];if((s==null?void 0:s.type)==="arrayMatch"){let a=this.basePath[0];if(!Array.isArray(r[a]))return;let i=r[a].find(c=>c[s.key]===s.value);if(!i)return;let l=this.basePath.slice(s.level+1);if(l.length>0){let c=i;for(let f of l){if(!c||typeof c!="object")return;c=c[f]}return c}return i}for(let a=0;a<this.basePath.length;a++){if(!r)return;r=r[this.basePath[a]]}return r}setNestedValue(t,r){let n={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];n[l]||(n[l]=[]);let c=n[l].findIndex(u=>u[s.key]===s.value),f=this.basePath.slice(s.level+1);if(c>=0)if(f.length>0){let u=n[l][c];for(let m=0;m<f.length-1;m++){let p=f[m];u[p]=u[p]||{},u=u[p]}let d=f[f.length-1];u[d]=r}else n[l][c]={...n[l][c],...r,[s.key]:s.value};else if(f.length>0){let u={[s.key]:s.value},d=u;for(let p=0;p<f.length-1;p++){let x=f[p];d[x]={},d=d[x]}let m=f[f.length-1];d[m]=r,n[l].push(u)}else n[l].push({...r,[s.key]:s.value});return n}let a=n;for(let l=0;l<this.basePath.length-1;l++){let c=this.basePath[l];a[c]=a[c]||{},a=a[c]}let i=this.basePath[this.basePath.length-1];return a[i]=r,n}getParent(){if(this.destroyed)throw new Ut("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new Wt(this.settings,t)}getChild(t,r){let n=[...this.path,t].join("/");return r?r(this.settings,n):(this.log("getChild",this.path,t,n,this.patterns),new Wt(this.settings,n))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new Ut("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new Ut("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(c=>c[n.key]!==n.value),r[l].length===0&&delete r[l]),r}let s=r,a=this.basePath.slice(0,-1);for(let l of a){if(!s[l])return r;s=s[l]}let i=this.basePath[this.basePath.length-1];return delete s[i],r})}subscribe(t){if(this.destroyed)throw new Ut("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var Po=class extends Wt{constructor(t,r,n=!0){super(t,r);this.enabled=n}isExtensionEnabled(t){var s,a;let n=(t.split(".").pop()||"").toLowerCase();if(n==="md"||Re().enableCanvasSync&&n==="canvas")return!0;if(!this.enabled||!Re().enableAttachmentSync)return!1;for(let[i,l]of Object.entries(Po.schema)){let c=i;if(((s=this.get()[c])!=null?s:l.defaultEnabled)&&l.extensions.includes(n))return!0}return(a=this.get().otherTypes)!=null?a:Po.schema.otherTypes.defaultEnabled}getCategory(t){var s;let r=Po.schema[t];return{enabled:(s=this.get()[t])!=null?s:r.defaultEnabled,name:r.name,description:r.description,extensions:r.extensions}}getCategories(){return Object.keys(Po.schema).reduce((t,r)=>(t[r]=this.getCategory(r),t),{})}async toggleCategory(t,r){await this.update(n=>({...n,[t]:r})),this.log(`setting ${t} to ${r}`),this.notifyListeners()}async resetToDefault(){await this.update(()=>({...Po.defaultFlags}))}},Fo=Po;Fo.schema={images:{name:"Images",description:"Sync image files (.bmp, .png, .jpg, .jpeg, .gif, .svg, .webp, .avif)",extensions:["bmp","png","jpg","jpeg","gif","svg","webp","avif"],defaultEnabled:!0},audio:{name:"Audio",description:"Sync audio files (.mp3, .wav, .m4a, .3gp, .flac, .ogg, .oga, .opus)",extensions:["mp3","wav","m4a","3gp","flac","ogg","oga","opus"],defaultEnabled:!0},videos:{name:"Videos",description:"Sync video files (.mp4, .webm, .ogv, .mov, .mkv)",extensions:["mp4","webm","ogv","mov","mkv"],defaultEnabled:!0},pdfs:{name:"PDFs",description:"Sync PDF files (.pdf)",extensions:["pdf"],defaultEnabled:!0},otherTypes:{name:"Other files",description:"Sync unsupported file types",extensions:[],defaultEnabled:!1}},Fo.defaultFlags=Object.fromEntries(Object.entries(Po.schema).map(([t,r])=>[t,r.defaultEnabled]));var Ks=require("obsidian");async function wf(o){let e=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function ir(o){return!!o&&o instanceof Ao}var pi=class extends it{constructor(t){super();this.db=null;this.setLoggers("[ContentAddressedFileStore]"),this.dbName=`${t}-relay-hashes`,this.ready=this.openDB()}async openDB(){return new Promise((t,r)=>{let n=indexedDB.open(this.dbName,1);n.onupgradeneeded=s=>{let a=n.result;a.objectStoreNames.contains("files")||a.createObjectStore("files",{keyPath:"path"})},n.onsuccess=s=>{this.db=n.result,t()},n.onerror=s=>{this.error("Error opening ContentAddressedFile database:",n.error),r(n.error)}})}async saveHash(t,r,n){if(await this.ready,!!this.db)return new Promise((s,a)=>{if(!this.db)return;let c=this.db.transaction(["files"],"readwrite").objectStore("files").put({path:t,hash:r,modifiedAt:n});c.onsuccess=()=>s(),c.onerror=()=>{this.error("Error saving hash:",c.error),a(c.error)}})}async getHash(t){return await this.ready,this.db?new Promise((r,n)=>{if(!this.db)return null;let i=this.db.transaction(["files"],"readonly").objectStore("files").get(t);i.onsuccess=()=>{r(i.result||null)},i.onerror=()=>{this.error("Error retrieving hash:",i.error),n(i.error)}}):null}async removeHash(t){if(await this.ready,!!this.db)return new Promise((r,n)=>{if(!this.db)return null;let i=this.db.transaction(["files"],"readwrite").objectStore("files").delete(t);i.onsuccess=()=>r(),i.onerror=()=>{this.error("Error removing hash:",i.error),n(i.error)}})}destroy(){this.db&&(this.db.close(),this.db=null)}},_f=class extends it{constructor(t,r,n){super();this.vault=t;this.path=r;this.store=n;this.content=null;this._tfile=null;let s=this.vault.getAbstractFileByPath(r);s&&s instanceof Ks.TFile&&(this._tfile=s)}get tfile(){if(!this._tfile){let t=this.vault.getAbstractFileByPath(this.path);if(t&&t instanceof Ks.TFile)this._tfile=t;else throw new Error(`missing tfile: ${this.path}`)}return this._tfile}async loadHashFromStore(){try{let t=await this.store.getHash(this.path);if(t&&t.modifiedAt===this.tfile.stat.mtime)return t.hash}catch(t){this.warn("Failed to load hash from store:",t)}}get modifiedAt(){if(!this.tfile)throw new Error("missing tfile");return this.tfile.stat.mtime}async read(){this.log("reading content from disk");let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await wf(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return r}async _hash(){let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await wf(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return n}exists(){if(this._tfile)return!0;let t=this.vault.getAbstractFileByPath(this.path);return t&&t instanceof Ks.TFile?(this._tfile=t,!0):!1}async clear(){this._tfile=null,this.store.removeHash(this.path).catch(t=>{this.warn("Failed to remove hash from store:",t)})}async hash(){let t=await this.loadHashFromStore();return t||(t=await this._hash(),t)}destroy(){this.vault=null,this._tfile=null}},Ao=class extends Ve{constructor(t,r,n,s){super();this.path=t;this.guid=r;this.hashStore=n;this.ready=!1;this.connected=!0;this.offFileInfo=()=>{};this.uploadError=void 0;this.s3rn=s.relayId?new Zr(s.relayId,s.guid,r):new Ns(s.guid,r),this._parent=s,this.setLoggers(`[SharedFile](${this.path})`),this.name=this.path.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault;let a=this.sharedFolder.syncStore.typeRegistry.getTypeForPath(t);if(!a)throw new Error("unexpected synctype");this.type=a,this.caf=new _f(this.vault,this.sharedFolder.getPath(t),this.hashStore),this.log("created")}get mimetype(){return Io(this.path)}disconnect(){}get inMeta(){return!!this.sharedFolder.syncStore.getMeta(this.path)}get pending(){return!!this.sharedFolder.syncStore.pendingUpload.has(this.path)}get tag(){return this.inMeta?"":this.uploadError?this.uploadError:this.pending?"pending":"unknown"}move(t){t!==this.path&&(this.debug("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedFile](${this.path})`))}get lastModified(){return this.stat.mtime}_refreshMeta(){let t=this.sharedFolder.syncStore.getMeta(this.path);return this.meta=t,t}async push(t=!1){if(this.log("push"),!this.sharedFolder.connected){this.log("skipping push -- folder is disconnected");return}if(!this.sharedFolder.syncStore.canSync(this.path)){this.log("skipping push -- filetype is disabled");return}let r=await this.caf.hash();if(this._refreshMeta(),!this.meta||r&&this.meta.hash!==r||t)try{await this.sharedFolder.cas.writeFile(this),await this.sharedFolder.markUploaded(this),this.uploadError=void 0,this.notifyListeners()}catch(n){let s="Failed to push file";try{s=n.toString()}catch(a){}this.uploadError=s.replace(/^Error:/,"").trim(),this.notifyListeners()}}async sync(){var t;if(this.log("sync"),this._refreshMeta(),this.caf.exists()){if(!this.meta){await this.push();return}}else{if(!this.meta)throw new Error("unexpected case");await this.pull();return}try{let r=await this.caf.hash();if(Re().enableVerifyUploads)try{this.verifyUpload()||(this.warn("file in metadata, but not on the server!"),await this.push())}catch(n){}if(r!==this.meta.hash){if(this.stat.mtime>this.meta.synctime){await this.push();return}this.warn("synctime",this.meta.synctime,(t=this.meta)==null?void 0:t.synctime,this.stat.mtime),await this.pull();return}}catch(r){this.warn("unable to compute hash",r)}}shouldPull(t){return!this.tfile||t.synctime>this.stat.mtime}async verifyUpload(){if(this.log("verify upload"),this._refreshMeta(),!this.meta)throw new Error("cannot verify upload without meta");return this.sharedFolder.cas.verify(this)}async pull(){if(this.log("pull"),this._refreshMeta(),!this.meta)throw new Error("cannot pull without meta");if(!(this.caf.exists()&&await this.caf.hash()===this.meta.hash))try{let t=await this.sharedFolder.cas.readFile(this);await this.vault.adapter.writeBinary(this.sharedFolder.getPath(this.path),t),await this.caf.hash()}catch(t){this.error(t);return}}get tfile(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof Ks.TFile)return t;throw new Error("TFile API used before file existed")}get stat(){return this.tfile.stat}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.s3rn instanceof sr?!1:(this.s3rn instanceof eo&&(this.sharedFolder.relayId?this.s3rn=new Zr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Ns(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected)))}async read(){return this.vault.read(this.tfile)}async rename(t){this.move(t)}async delete(){return await this.caf.clear(),this.vault.delete(this.tfile)}async write(t){this.vault.adapter.write(this.tfile.path,t),await this.caf.hash()}async append(t){this.vault.append(this.tfile,t),await this.caf.hash()}cleanup(){}destroy(){var t;(t=this.offFileInfo)==null||t.call(this),this.offFileInfo=null,this._parent=null,this.caf.destroy()}};function Rr(o,e){if(!o||!e)return!1;for(let t in o)if(typeof o[t]=="object"&&o[t]!==null){if(!Rr(o[t],e[t]))return!1}else if(o[t]!==e[t])return!1;for(let t in e)if(!(t in o))return!1;return!0}function Kt(o){return o instanceof Je}var Je=class extends ro{constructor(t,r,n,s){let a=s.relayId?new Lt(s.relayId,s.guid,r):new rn(s.guid,r);super(r,a,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this.unsubscribes.push(this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[Canvas](${this.path})`);try{let i=`${this.sharedFolder.appId}-relay-canvas-${this.guid}`;this._persistence=new Co(i,this.ydoc)}catch(i){throw this.warn("Unable to open persistence.",this.guid),console.error(i),i}this.whenSynced().then(()=>{this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",je.encode(this.s3rn))}catch(i){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),this._tfile=null}get yedges(){return this.ydoc.getMap("edges")}get ynodes(){return this.ydoc.getMap("nodes")}textNode(t){let r=this.ydoc.getText(t.id);return r.toString()===""&&r.insert(0,t.text),r}static exportCanvasData(t){let r=t.getMap("edges"),n=t.getMap("nodes"),s=[],a=[];for(let[,i]of r.entries())s.push({...i});for(let[,i]of n.entries()){let l=t.getText(i.id);a.push({...i,text:l.toString()||i.text})}return{edges:s,nodes:a}}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async connect(){return this.sharedFolder.s3rn instanceof sr?!1:(this.s3rn instanceof rn&&(this.sharedFolder.relayId?this.s3rn=new Lt(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new rn(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=rr(this._persistence.db,["updates"],"readonly"),r=await Xr(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new yr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new yr(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}get sharedFolder(){return this._parent}static checkExtension(t){return t.endsWith(".canvas")&&Re().enableCanvasSync}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async applyJSON(t){if(t==="")return;let r=JSON.parse(t);return await this.applyData(r)}async importFromView(t){if(t.file&&this.sharedFolder.getVirtualPath(t.file.path)===this.path)return await this.applyData(t.canvas.getData());console.warn("tried to apply updates from another file",this.path)}async applyData(t){let r=this.yedges,n=this.ynodes,s=new Set,a=new Map,i=new Set,l=new Map,c=new Set;t.nodes.forEach(f=>{s.add(f.id);let u=n.get(f.id);u?Rr(u,f)||a.set(f.id,f):(a.set(f.id,f),f.type==="text"&&this.textNode(f))});for(let f of n.keys())s.has(f)||i.add(f);t.edges.forEach(f=>{s.add(f.id);let u=r.get(f.id);u&&Rr(u,f)||l.set(f.id,f)});for(let f of r.keys())s.has(f)||c.add(f);(a.size>0||i.size>0||l.size>0||c.size>0)&&Ue(this.ydoc,()=>{for(let f of a.values())this.ynodes.set(f.id,f);for(let f of i)this.ynodes.delete(f);for(let f of l.values())this.yedges.set(f.id,f);for(let f of c)this.yedges.delete(f)},this)}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get mimetype(){return Io(this.path)}get json(){let t=Je.exportCanvasData(this.ydoc);return JSON.stringify(t)}async cleanup(){}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.json.length}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}};var Sf=class extends Lo{constructor(){super(...arguments);this.notifyListeners=(0,Oe.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){let n=this.find(s=>s.guid===t.guid);return n&&n!==t&&(this.error("duplicate guid",n,t),this._set.delete(n)),this._set.add(t),r&&this.notifyListeners(),this}},mi=class extends ro{constructor(t,r,n,s,a,i,l,c,f,u,d,m,p=!0){var y;let x=m?new Yr(m,r):new sr(r);super(r,x,l,s);this.appId=t;this.hashStore=f;this.backgroundSync=u;this._settings=d;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getSyncFiles(),r=[],n=this.placeHold(t);t.forEach(s=>{let a=this.getVirtualPath(s.path),i=n.contains(a);if(s instanceof Oe.TFolder){let l=this.getSyncFolder(a,!1);r.push(l)}else if(ot.checkExtension(a))if(i){let l=this.uploadDoc(a,!1);r.push(l)}else{let l=this.getDoc(a,!1);r.push(l)}else if(Je.checkExtension(a))if(i){let l=this.uploadCanvas(a,!1);r.push(l)}else{let l=this.getCanvas(a,!1);r.push(l)}else if(this.syncStore.canSync(a))if(i){let l=this.uploadSyncFile(a,!1);r.push(l)}else{let l=this.syncFile(a,!1);r.push(l)}}),r.length>0&&this.fset.update()};this.path=n,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=i,this.vault=a,this.files=new Map,this.fset=new Sf,this.pendingUpload=new no(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.pendingUpload.forEach((g,I)=>{this.existsSync(I)||(this.warn("deleting pending upload record because file is missing",I,g),this.pendingUpload.delete(I))}),this.relayManager=c,this.relayId=m,this.diskBufferStore=new ri,this._shouldConnect=(y=this.settings.connect)!=null?y:!0,this.authoritative=!p,this.syncSettingsManager=this._settings.getChild("sync",(g,I)=>new Fo(g,I)),this.syncStore=new ii(this.ydoc,this.path,this.pendingUpload,this.syncSettingsManager),this.syncStore.on(async()=>{await this.syncFileTree(this.syncStore)}),this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(g=>{this.remote=g.find(I=>I.guid==this.guid)})),this.unsubscribes.push(this.relayManager.storageQuotas.subscribe(async g=>{let I=g.find(T=>{var P;return T.id===((P=this._remote)==null?void 0:P.relay.storageQuotaId)});I!==void 0&&this.storageQuota!==I.quota&&(this.storageQuota!==void 0&&I.quota!==void 0&&I.quota>this.storageQuota&&(this.debug("storage quota increase",this.storageQuota,I.quota),await this.netSync()),this.debug("storage quota update",this.storageQuota,I.quota),this.storageQuota=I.quota)})),this.proxy=qh(this,this.path,g=>this.getVirtualPath(g));try{this._persistence=new Co(this.guid,this.ydoc)}catch(g){throw this.warn("Unable to open persistence.",this.guid),console.error(g),g}s.loggedIn&&this.connect(),this.cas=new ui(this),this.whenReady().then(()=>{this.destroyed||(this.addLocalDocs(),this.syncFileTree(this.syncStore))}),this.whenSynced().then(async()=>{this.syncStore.start();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",je.encode(this.s3rn))}catch(g){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),ht.set(this,this.path)}get server(){return this._server}set server(t){if(t===this._server)return;this.warn("server changed -- reinitializing all connections");let r=this.shouldConnect;this.reset();let n=[];this.fset.forEach(s=>{s instanceof ro&&(s.connected&&n.push(s),s.reset())}),this.tokenStore.clear(s=>{var a;return!!(this.relayId&&((a=s.token)!=null&&a.docId.startsWith(this.relayId)))}),r&&(this.connect(),n.forEach(s=>{s.connect()})),this._server=t}get tfolder(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof Oe.TFolder))throw new Error("tfolder is not a folder");return t}isSyncableTFile(t){let r=this.checkPath(t.path),n=this.getVirtualPath(t.path),s=this.syncStore.canSync(n),a=this.syncSettingsManager.isExtensionEnabled(n);return r&&s&&a}getSyncFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof Oe.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return Oe.Vault.recurseChildren(t,n=>{n!==t&&r.push(n)}),r.filter(n=>this.isSyncableTFile(n))}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.syncStore),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}async sync(){await this.syncFileTree(this.syncStore)}connect(){return this.s3rn instanceof Yr&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new Yr(this.relayId,this.guid):new sr(this.guid),this._settings.update(n=>({...n,relay:this.relayId})),t&&(this._server=t.relay.providerId,this.unsubscribes.push(t.relay.subscribe(n=>{n.guid===this.relayId&&(this.server=n.providerId)}))),this.server=t==null?void 0:t.relay.providerId,this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._serverSynced||this.synced)}async count(){if(this._persistence.db===null)throw new Error("unexpected missing database");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=rr(this._persistence.db,["updates"],"readonly"),r=await Xr(t);return this._dbsize=r,this._dbsize}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}hasLocalDB(){return this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new yr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>{if(this._persistence.synced){await this.count(),this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new yr(t,()=>(this._persistence.synced&&this._dbsize&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,n,s){if(s==null||s.push(`${n.path} was renamed to ${this.getPath(r)}`),n instanceof Oe.TFile){let a=(0,Gt.dirname)(r);this.existsSync(a)||(await this.mkdir(a),s==null||s.push(`creating directory ${a}`))}await this.fileManager.renameFile(n,(0,Oe.normalizePath)(this.getPath(r))).then(()=>{t.move(r)})}async _handleServerCreate(t,r,n){let s=(0,Gt.dirname)(t);if(this.existsSync(s)||(await this.mkdir(s),n==null||n.push(`creating directory ${s}`)),r.type==="markdown")return n==null||n.push(`created local .md file for remotely added doc ${t}`),await this.downloadDoc(t,!1);if(r.type==="canvas")return n==null||n.push(`created local .canvas file for remotely added canvas ${t}`),await this.downloadCanvas(t,!1);if(r.type==="folder")return n==null||n.push(`created local folder for remotely added folder ${t}`),this.getSyncFolder(t,!1);if(this.syncStore.canSync(t))return n==null||n.push(`created local file for remotely added file ${t}`),this.downloadSyncFile(t,!1);throw new Error(`${t}: Unexpected file type ${r.type} ${r.mimetype}`)}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.syncStore.delete(t);return}}applyRemoteState(t,r,n,s){let a=this.files.get(t),i=this.syncStore.getMeta(r);if(!i)return this.warn("unknown sync type",r),{op:"noop",path:r,promise:Promise.resolve()};if(this.existsSync(r))return a&&ir(a)&&a.shouldPull(i)?{op:"update",path:r,promise:a.pull()}:{op:"noop",path:r,promise:Promise.resolve()};if(n.has(t)&&a){let c=this.getPath(a.path),f=this.vault.getAbstractFileByPath(c);if(f){let u=this._handleServerRename(a,r,f,s);return{op:"rename",path:r,from:c,to:r,promise:u}}}let l=this._handleServerCreate(r,i,s);return{op:"create",path:r,promise:l}}cleanupExtraLocalFiles(t,r){let n=this.getSyncFiles(),s=[],a=n.filter(c=>c instanceof Oe.TFolder),i=n.filter(c=>c instanceof Oe.TFile),l=c=>{var y,g;let f=this.isSyncableTFile(c),u=this.checkPath(c.path),d=t.contains(c.path.slice(this.path.length)),m=this.pendingUpload.has(this.getVirtualPath(c.path)),p=this.getVirtualPath(c.path),x=((y=this._provider)==null?void 0:y.synced)&&((g=this._persistence)==null?void 0:g.synced);if(u&&f&&!d&&!m&&x){r.push(`deleted local file ${p} for remotely deleted doc`);let I=this.vault.adapter.trashLocal(c.path);s.push({op:"delete",path:p,promise:I})}};return i.forEach(l),a.forEach(l),s}syncByType(t,r,n,s){t.forEach((a,i)=>{this._assertNamespacing(i),s.contains(a.type)&&(this._assertNamespacing(i),n.push(this.applyRemoteState(a.id,i,t.remoteIds,r)))})}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let n=this.syncFileTreePromise.getPromise();return n.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),n}let r=async()=>{try{let n=[],s=[];this.ydoc.transact(async()=>{this.syncStore.migrateUp(),this.syncByType(t,s,n,["folder"])},this),await Promise.all(n.map(f=>f.promise)),this.ydoc.transact(async()=>{this.syncByType(t,s,n,this.syncStore.typeRegistry.getEnabledFileSyncTypes()),this.syncStore.commit()},this);let a=n.filter(f=>f.op==="create"),i=n.filter(f=>f.op==="rename"),l=n.map(f=>f.path);await Promise.all([...a,...i].map(f=>Uh(f.promise,f)));let c=this.cleanupExtraLocalFiles(l,s);[...n,...c].every(f=>f.op==="noop")?this.debug("sync: noop"):(this.log("remote paths",l),this.log("operations",[...n,...c])),(i.length>0||a.length>0||c.length>0)&&this.fset.update(),s.length>0&&this.log(`syncFileTree diff:
`+s.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new oi(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,Gt.join)(this.path,t.path);return this.vault.adapter.read((0,Oe.normalizePath)(r))}existsSync(t){let r=(0,Oe.normalizePath)((0,Gt.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,Gt.join)(this.path,t.path);return this.vault.adapter.exists((0,Oe.normalizePath)(r))}flush(t,r){let n=(0,Gt.join)(this.path,t.path);return this.log("writing to ",(0,Oe.normalizePath)(n)),this.vault.adapter.write((0,Oe.normalizePath)(n),r)}getPath(t){return(0,Gt.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,Gt.join)(this.path,t);return this.vault.adapter.mkdir((0,Oe.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+Gt.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof Oe.TFile?r:null}getDoc(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t),!xr(s))throw new Error("unexpected ifile type");return s}else return this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r)}else{this.warn("[getDoc]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof Oe.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadDoc(t):this.createDoc(t,r)}}getCanvas(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t),!Kt(s))throw new Error("unexpected ifile type");return s}else return this.log("[getCanvas]: creating canvas for shared ID"),this.createCanvas(t,r)}else{this.warn("[getCanvas]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof Oe.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadCanvas(t):this.createCanvas(t,r)}}async markUploaded(t){let r=(n,s)=>{this.syncStore&&this.syncStore.willSet(n.path,s)&&(this.log("new meta",n.path,s),this.ydoc.transact(()=>{this.syncStore.markUploaded(n.path,s)},this))};if(xr(t)){let n=qs(t.guid);r(t,n);return}if(Kt(t)){let n=Nh(t.guid);r(t,n);return}if(af(t)){let n=ai(t.guid);r(t,n);return}if(ir(t)){let n=this.syncStore.typeRegistry.getTypeForPath(t.path);if(!n)throw new Error("unexpected sync type");let s=await t.caf.hash();if(!s)throw new Error("file hash not yet computed");let a=Hh(n,t.guid,t.mimetype,s,t.stat.mtime);r(t,a);return}}getFile(t,r=!0){let n=this.getVirtualPath(t.path),s=this.syncStore.get(n);if(s){let a=this.files.get(s);if(a)return a}if(t instanceof Oe.TFolder)return this.getSyncFolder(n,r);if(t instanceof Oe.TFile){if(ot.checkExtension(n))return this.getDoc(n);if(Je.checkExtension(n))return this.getCanvas(n);if(this.syncStore.canSync(n))return this.getSyncFile(n,r)}return null}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(n=>{let s=this.getVirtualPath(n.path);this.syncStore.has(s)||(this.log("place hold new",s),this.syncStore.new(s),r.push(s))})},this),r}getOrCreateCanvas(t,r){let n=this.files.get(t)||new Je(r,t,this.loginManager,this);if(!Kt(n))throw new Error("unexpected ifile type");return n.move(r),n}async downloadCanvas(t,r=!0){if(!Je.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateCanvas(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueCanvasDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadCanvas(t,r=!0){if(!Je.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t),a=s.getOrigin(),i=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,f,u]=await Promise.all([this.read(s),a,i]);!u&&f===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{try{s.applyJSON(c)}catch(d){throw console.warn(c),d}},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createCanvas(t,r){if(!Je.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t);return(async()=>this.whenReady().then(async()=>{let a=await s.getServerSynced();s.stat.size===0&&!a?this.backgroundSync.enqueueCanvasDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}viewDoc(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!xr(n))throw new Error("unexpected ifile type");return n}viewSyncFile(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!ir(n))throw new Error("unexpected ifile type");return n}getOrCreateDoc(t,r){let n=this.files.get(t)||new ot(r,t,this.loginManager,this);if(!xr(n))throw new Error("unexpected ifile type");return n.move(r),n}async downloadDoc(t,r=!0){if(!ot.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateDoc(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadDoc(t,r=!0){if(!ot.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.getOrCreateDoc(n,t),a=s.getOrigin(),i=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,f,u]=await Promise.all([this.read(s),a,i]),d=s.ydoc.getText("contents");!u&&f===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{d.insert(0,c)},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createDoc(t,r=!0){if(!ot.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateDoc(n,t);return(async()=>this.whenReady().then(async()=>{var i;let a=await s.getServerSynced();((i=s.tfile)==null?void 0:i.stat.size)===0&&!a?this.backgroundSync.enqueueDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFolder(t,r){let n=this.files.get(t)||new To(r,t,this);if(!af(n))throw new Error("unexpected ifile type");return n.move(r),n}getSyncFolder(t,r){if(this.log("[getSyncFolder]","getting syncfolder"),!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateSyncFolder(n,t);return this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFile(t,r,n){let s=this.files.get(t)||new Ao(r,t,this.hashStore,this);if(!ir(s))throw new Error("unexpected ifile type");return s.move(r),this.files.set(t,s),s}syncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called sync on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let a=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueSync(a),this.files.set(n,a),this.fset.add(a,r),a}downloadSyncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let a=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueDownload(a),this.files.set(n,a),this.fset.add(a,r),a}uploadSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof Oe.TFile))throw new Error(`Upload failed, expected file at ${t}`);let a=this.getOrCreateSyncFile(n,t,s);return this.backgroundSync.enqueueSync(a),this.fset.add(a,r),a}getSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof Oe.TFile))throw new Error(`Upload failed, expected file at ${t}`);let a=this.getOrCreateSyncFile(n,t,s);return this.syncStore.getMeta(t)?a.pull():(this.log("get syncfile missing meta"),a.push()),this.files.set(n,a),this.fset.add(a,r),a}uploadFile(t,r=!0){let n=this.getVirtualPath(t.path);if(t instanceof Oe.TFolder)return this.getSyncFolder(n,r);if(t instanceof Oe.TFile){if(ot.checkExtension(n))return this.uploadDoc(n,r);if(Je.checkExtension(n))return this.uploadCanvas(n,r);if(this.syncStore.canSync(n))return this.uploadSyncFile(n,r)}throw new Error("unexpectedly unable to upload")}deleteFile(t){let r=this.syncStore.get(t);r&&this.ydoc.transact(()=>{this.syncStore.delete(t);let n=this.files.get(r);n&&(n.cleanup(),this.fset.delete(n)),this.files.delete(r)},this)}renameFile(t,r){let n=t.path,s="",a="";try{s=this.getVirtualPath(n)}catch(i){this.log("Moving out of shared folder")}try{a=this.getVirtualPath(r)}catch(i){this.log("Moving in from outside of shared folder")}if(!(!s&&!a))if(a){let i=this.syncStore.get(a);if(!i)return;let l=this.files.get(i);if(!s)this.ydoc.transact(()=>{this.syncStore.delete(a)},this),l&&(l.cleanup(),l.destroy(),this.fset.delete(l)),this.files.delete(i);else{if(!this.syncStore.get(a))return;let f=[];l instanceof To&&this.syncStore.forEach((u,d)=>{if(d.startsWith(a+Gt.sep)){let m=d.replace(a,s);f.push([u.id,d,m])}}),this.ydoc.transact(()=>{this.syncStore.move(a,s),l&&l.move(s),f.forEach(u=>{let[d,m,p]=u;this.syncStore.move(m,p);let x=this.files.get(d);x&&x.move(p)})},this),this.syncStore.resolveMove(a)}}else{if(this.assertPath(n),!this.syncStore.canSync(s))return;this.placeHold([t]),this.uploadFile(t)}}destroy(){var t,r,n;this.destroyed=!0,this.unsubscribes.forEach(s=>{s()}),this.files.forEach(s=>{s.destroy(),this.files.delete(s.guid)}),this.syncStore.destroy(),this.syncSettingsManager.destroy(),super.destroy(),this.ydoc.destroy(),this.fset.clear(),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.syncStore=null,this.syncSettingsManager=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(n=this.syncFileTreePromise)==null||n.destroy(),this.syncFileTreePromise=null}},hi=class extends Lo{constructor(t,r,n,s){super();this.relayManager=t;this.vault=r;this.settings=s;this.update=(0,Oe.debounce)(this.notifyListeners,100);this.folderBuilder=n,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(a=>{let i=!1;this.items().forEach(l=>{let c=a.find(f=>f.guid==l.guid);l.remote!=c&&(i=!0),l.remote=c}),i&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(n=>n.filter(s=>s.guid!==t.guid)),r}lookup(t){let r=this.find(n=>n.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(n=>{if(!this.vault.getFolderByPath(n.path)){this.warn(`Invalid settings, ${n.path} does not exist`);return}this._new(n.path,n.guid,n==null?void 0:n.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,n,s){let a=this.find(f=>f.path==t&&f.guid==r);if(a)return a;let i=this.find(f=>f.guid==r);if(i)throw new Error(`This folder is already mounted at ${i.path}.`);if(this.find(f=>f.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let c=this.folderBuilder(t,r,n,s);return this._set.add(c),c}new(t,r,n,s){let a=this._new(t,r,n,s);return this.notifyListeners(),a}};var $i=require("@codemirror/state"),ns=require("obsidian");function q(){}function ee(o,e){for(let t in e)o[t]=e[t];return o}function og(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function kf(o){return o()}function yi(){return Object.create(null)}function me(o){o.forEach(kf)}function Be(o){return typeof o=="function"}function z(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var gi;function Cf(o,e){return o===e?!0:(gi||(gi=document.createElement("a")),gi.href=e,o===gi.href)}function ng(o){return Object.keys(o).length===0}function Pt(o,...e){if(o==null){for(let r of e)r(void 0);return q}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function ie(o,e,t){o.$$.on_destroy.push(Pt(e,t))}function le(o,e,t,r){if(o){let n=sg(o,e,t,r);return o[0](n)}}function sg(o,e,t,r){return o[1]&&r?ee(t.ctx.slice(),o[1](r(e))):t.ctx}function ce(o,e,t,r){if(o[2]&&r){let n=o[2](r(t));if(e.dirty===void 0)return n;if(typeof n=="object"){let s=[],a=Math.max(e.dirty.length,n.length);for(let i=0;i<a;i+=1)s[i]=e.dirty[i]|n[i];return s}return e.dirty|n}return e.dirty}function fe(o,e,t,r,n,s){if(n){let a=sg(e,t,r,s);o.p(a,n)}}function ue(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function pe(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function If(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function Eo(o){return o==null?"":o}function ag(o,e,t){return o.set(t),e}function xi(o){return o&&Be(o.destroy)?o.destroy:q}var on=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var Qn=class{constructor(e){Xe(this,"_listeners","WeakMap"in on?new WeakMap:void 0);Xe(this,"_observer");Xe(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let n of t)Qn.entries.set(n.target,n),(r=this._listeners.get(n.target))==null||r(n)})}};Qn.entries="WeakMap"in on?new WeakMap:void 0;var ig=!1;function lg(){ig=!0}function cg(){ig=!1}function w(o,e){o.appendChild(e)}function ye(o,e,t){let r=fg(o);if(!r.getElementById(e)){let n=C("style");n.id=e,n.textContent=t,l1(r,n)}}function fg(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function l1(o,e){return w(o.head||o,e),e.sheet}function _(o,e,t){o.insertBefore(e,t||null)}function v(o){o.parentNode&&o.parentNode.removeChild(o)}function He(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function C(o){return document.createElement(o)}function br(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function B(o){return document.createTextNode(o)}function E(){return B(" ")}function he(){return B("")}function K(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function ug(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function h(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function Gs(o,e){for(let t in e)h(o,t,e[t])}function dg(o){return Array.from(o.childNodes)}function X(o,e){e=""+e,o.data!==e&&(o.data=e)}function lr(o,e){o.value=e==null?"":e}function ne(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function Ae(o,e,t){o.classList.toggle(e,!!t)}function bi(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var Do=class{constructor(e=!1){Xe(this,"is_svg",!1);Xe(this,"e");Xe(this,"n");Xe(this,"t");Xe(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=br(t.nodeName):this.e=C(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)_(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(v)}};function pg(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function Xn(o,e){return new o(e)}var Mo;function jt(o){Mo=o}function js(){if(!Mo)throw new Error("Function called outside component initialization");return Mo}function Ft(o){js().$$.on_mount.push(o)}function Lf(o){js().$$.on_destroy.push(o)}function ft(){let o=js();return(e,t,{cancelable:r=!1}={})=>{let n=o.$$.callbacks[e];if(n){let s=bi(e,t,{cancelable:r});return n.slice().forEach(a=>{a.call(o,s)}),!s.defaultPrevented}return!0}}function vr(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var nn=[];var Ot=[],Zn=[],Pf=[],m1=Promise.resolve(),Ff=!1;function mg(){Ff||(Ff=!0,m1.then(Qs))}function Js(o){Zn.push(o)}function hg(o){Pf.push(o)}var Tf=new Set,Yn=0;function Qs(){if(Yn!==0)return;let o=Mo;do{try{for(;Yn<nn.length;){let e=nn[Yn];Yn++,jt(e),h1(e.$$)}}catch(e){throw nn.length=0,Yn=0,e}for(jt(null),nn.length=0,Yn=0;Ot.length;)Ot.pop()();for(let e=0;e<Zn.length;e+=1){let t=Zn[e];Tf.has(t)||(Tf.add(t),t())}Zn.length=0}while(nn.length);for(;Pf.length;)Pf.pop()();Ff=!1,Tf.clear(),jt(o)}function h1(o){if(o.fragment!==null){o.update(),me(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(Js)}}function gg(o){let e=[],t=[];Zn.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),Zn=e}var vi=new Set,sn;function se(){sn={r:0,c:[],p:sn}}function ae(){sn.r||me(sn.c),sn=sn.p}function b(o,e){o&&o.i&&(vi.delete(o),o.i(e))}function k(o,e,t,r){if(o&&o.o){if(vi.has(o))return;vi.add(o),sn.c.push(()=>{vi.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}function ao(o,e){let t=e.token={};function r(n,s,a,i){if(e.token!==t)return;e.resolved=i;let l=e.ctx;a!==void 0&&(l=l.slice(),l[a]=i);let c=n&&(e.current=n)(l),f=!1;e.block&&(e.blocks?e.blocks.forEach((u,d)=>{d!==s&&u&&(se(),k(u,1,1,()=>{e.blocks[d]===u&&(e.blocks[d]=null)}),ae())}):e.block.d(1),c.c(),b(c,1),c.m(e.mount(),e.anchor),f=!0),e.block=c,e.blocks&&(e.blocks[s]=c),f&&Qs()}if(og(o)){let n=js();if(o.then(s=>{jt(n),r(e.then,1,e.value,s),jt(null)},s=>{if(jt(n),r(e.catch,2,e.error,s),jt(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function es(o,e,t){let r=e.slice(),{resolved:n}=o;o.current===o.then&&(r[o.value]=n),o.current===o.catch&&(r[o.error]=n),o.block.p(r,t)}function we(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function yg(o,e){k(o,1,1,()=>{e.delete(o.key)})}function xg(o,e,t,r,n,s,a,i,l,c,f,u){let d=o.length,m=s.length,p=d,x={};for(;p--;)x[o[p].key]=p;let y=[],g=new Map,I=new Map,T=[];for(p=m;p--;){let S=u(n,s,p),L=t(S),$=a.get(L);$?r&&T.push(()=>$.p(S,e)):($=c(L,S),$.c()),g.set(L,y[p]=$),L in x&&I.set(L,Math.abs(p-x[L]))}let P=new Set,A=new Set;function F(S){b(S,1),S.m(i,f),a.set(S.key,S),f=S.first,m--}for(;d&&m;){let S=y[m-1],L=o[d-1],$=S.key,O=L.key;S===L?(f=S.first,d--,m--):g.has(O)?!a.has($)||P.has($)?F(S):A.has(O)?d--:I.get($)>I.get(O)?(A.add($),F(S)):(P.add(O),d--):(l(L,a),d--)}for(;d--;){let S=o[d];g.has(S.key)||l(S,a)}for(;m;)F(y[m-1]);return me(T),y}function Ce(o,e){let t={},r={},n={$$scope:1},s=o.length;for(;s--;){let a=o[s],i=e[s];if(i){for(let l in a)l in i||(r[l]=1);for(let l in i)n[l]||(t[l]=i[l],n[l]=1);o[s]=i}else for(let l in a)n[l]=1}for(let a in r)a in t||(t[a]=void 0);return t}function Pe(o){return typeof o=="object"&&o!==null?o:{}}var g1=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],y1=new Set([...g1]);function bg(o,e,t){let r=o.$$.props[e];r!==void 0&&(o.$$.bound[r]=t,t(o.$$.ctx[r]))}function R(o){o&&o.c()}function D(o,e,t){let{fragment:r,after_update:n}=o.$$;r&&r.m(e,t),Js(()=>{let s=o.$$.on_mount.map(kf).filter(Be);o.$$.on_destroy?o.$$.on_destroy.push(...s):me(s),o.$$.on_mount=[]}),n.forEach(Js)}function M(o,e){let t=o.$$;t.fragment!==null&&(gg(t.after_update),me(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function b1(o,e){o.$$.dirty[0]===-1&&(nn.push(o),mg(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function G(o,e,t,r,n,s,a=null,i=[-1]){let l=Mo;jt(o);let c=o.$$={fragment:null,ctx:[],props:s,update:q,not_equal:n,bound:yi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:yi(),dirty:i,skip_bound:!1,root:e.target||l.$$.root};a&&a(c.root);let f=!1;if(c.ctx=t?t(o,e.props||{},(u,d,...m)=>{let p=m.length?m[0]:d;return c.ctx&&n(c.ctx[u],c.ctx[u]=p)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](p),f&&b1(o,u)),d}):[],c.update(),f=!0,me(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){lg();let u=dg(e.target);c.fragment&&c.fragment.l(u),u.forEach(v)}else c.fragment&&c.fragment.c();e.intro&&b(o.$$.fragment),D(o,e.target,e.anchor),cg(),Qs()}jt(l)}var v1;typeof HTMLElement=="function"&&(v1=class extends HTMLElement{constructor(e,t,r){super();Xe(this,"$$ctor");Xe(this,"$$s");Xe(this,"$$c");Xe(this,"$$cn",!1);Xe(this,"$$d",{});Xe(this,"$$r",!1);Xe(this,"$$p_d",{});Xe(this,"$$l",{});Xe(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let n=this.$$l_u.get(t);n&&(n(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(s){return()=>{let a;return{c:function(){a=C("slot"),s!=="default"&&h(a,"name",s)},m:function(c,f){_(c,a,f)},d:function(c){c&&v(a)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=pg(this);for(let s of this.$$s)s in r&&(t[s]=[e(s)]);for(let s of this.attributes){let a=this.$$g_p(s.name);a in this.$$d||(this.$$d[a]=Af(a,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let n=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let a=Af(s,this.$$d[s],this.$$p_d,"toAttribute");a==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,a)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(let s in this.$$l)for(let a of this.$$l[s]){let i=this.$$c.$on(s,a);this.$$l_u.set(a,i)}this.$$l={}}}attributeChangedCallback(e,t,r){var n;this.$$r||(e=this.$$g_p(e),this.$$d[e]=Af(e,r,this.$$p_d,"toProp"),(n=this.$$c)==null||n.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function Af(o,e,t,r){var s;let n=(s=t[o])==null?void 0:s.type;if(e=n==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(n){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(n){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var W=class{constructor(){Xe(this,"$$");Xe(this,"$$set")}$destroy(){M(this,1),this.$destroy=q}$on(e,t){if(!Be(t))return q;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let n=r.indexOf(t);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!ng(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var vg="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(vg);var w1={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Ef=w1;function wg(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function Df(o){let e,t=[o[12]],r={};for(let n=0;n<t.length;n+=1)r=ee(r,t[n]);return{c(){e=br(o[11]),Gs(e,r)},m(n,s){_(n,e,s)},p(n,s){Gs(e,r=Ce(t,[s&32&&n[12]]))},d(n){n&&v(e)}}}function _g(o){let e=o[11],t,r=o[11]&&Df(o);return{c(){r&&r.c(),t=he()},m(n,s){r&&r.m(n,s),_(n,t,s)},p(n,s){n[11]?e?z(e,n[11])?(r.d(1),r=Df(n),e=n[11],r.c(),r.m(t.parentNode,t)):r.p(n,s):(r=Df(n),e=n[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=n[11])},d(n){n&&v(t),r&&r.d(n)}}}function _1(o){let e,t,r,n,s,a=we(o[5]),i=[];for(let d=0;d<a.length;d+=1)i[d]=_g(wg(o,a,d));let l=o[10].default,c=le(l,o,o[9],null),f=[Ef,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:n=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],u={};for(let d=0;d<f.length;d+=1)u=ee(u,f[d]);return{c(){e=br("svg");for(let d=0;d<i.length;d+=1)i[d].c();t=he(),c&&c.c(),Gs(e,u)},m(d,m){_(d,e,m);for(let p=0;p<i.length;p+=1)i[p]&&i[p].m(e,null);w(e,t),c&&c.m(e,null),s=!0},p(d,[m]){if(m&32){a=we(d[5]);let p;for(p=0;p<a.length;p+=1){let x=wg(d,a,p);i[p]?i[p].p(x,m):(i[p]=_g(x),i[p].c(),i[p].m(e,t))}for(;p<i.length;p+=1)i[p].d(1);i.length=a.length}c&&c.p&&(!s||m&512)&&fe(c,l,d,d[9],s?ce(l,d[9],m,null):ue(d[9]),null),Gs(e,u=Ce(f,[Ef,m&128&&d[7],(!s||m&4)&&{width:d[2]},(!s||m&4)&&{height:d[2]},(!s||m&2)&&{stroke:d[1]},(!s||m&28&&r!==(r=d[4]?Number(d[3])*24/Number(d[2]):d[3]))&&{"stroke-width":r},(!s||m&257&&n!==(n=d[6]("lucide-icon","lucide",d[0]?`lucide-${d[0]}`:"",d[8].class)))&&{class:n}]))},i(d){s||(b(c,d),s=!0)},o(d){k(c,d),s=!1},d(d){d&&v(e),He(i,d),c&&c.d(d)}}}function S1(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],n=If(e,r),{$$slots:s={},$$scope:a}=e,{name:i=void 0}=e,{color:l="currentColor"}=e,{size:c=24}=e,{strokeWidth:f=2}=e,{absoluteStrokeWidth:u=!1}=e,{iconNode:d}=e,m=(...p)=>p.filter((x,y,g)=>Boolean(x)&&g.indexOf(x)===y).join(" ");return o.$$set=p=>{t(8,e=ee(ee({},e),pe(p))),t(7,n=If(e,r)),"name"in p&&t(0,i=p.name),"color"in p&&t(1,l=p.color),"size"in p&&t(2,c=p.size),"strokeWidth"in p&&t(3,f=p.strokeWidth),"absoluteStrokeWidth"in p&&t(4,u=p.absoluteStrokeWidth),"iconNode"in p&&t(5,d=p.iconNode),"$$scope"in p&&t(9,a=p.$$scope)},e=pe(e),[i,l,c,f,u,d,m,n,e,a,s]}var Mf=class extends W{constructor(e){super(),G(this,e,S1,_1,z,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},Fe=Mf;function k1(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function C1(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[k1]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function I1(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var Rf=class extends W{constructor(e){super(),G(this,e,I1,C1,z,{})}},$f=Rf;function L1(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function T1(o){let e,t,r=[{name:"arrow-up-down"},o[1],{iconNode:o[0]}],n={$$slots:{default:[L1]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function P1(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var Uf=class extends W{constructor(e){super(),G(this,e,P1,T1,z,{})}},Of=Uf;function F1(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function A1(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[F1]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function E1(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var Bf=class extends W{constructor(e){super(),G(this,e,E1,A1,z,{})}},Nf=Bf;function D1(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function M1(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[D1]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function R1(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var Hf=class extends W{constructor(e){super(),G(this,e,R1,M1,z,{})}},qf=Hf;function $1(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function U1(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],n={$$slots:{default:[$1]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function O1(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var Vf=class extends W{constructor(e){super(),G(this,e,O1,U1,z,{})}},zf=Vf;function B1(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function N1(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],n={$$slots:{default:[B1]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function H1(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var Wf=class extends W{constructor(e){super(),G(this,e,H1,N1,z,{})}},Xs=Wf;function q1(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function V1(o){let e,t,r=[{name:"clock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[q1]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function z1(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var Kf=class extends W{constructor(e){super(),G(this,e,z1,V1,z,{})}},Ys=Kf;function W1(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function K1(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],n={$$slots:{default:[W1]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function G1(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var Gf=class extends W{constructor(e){super(),G(this,e,G1,K1,z,{})}},jf=Gf;function j1(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function J1(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],n={$$slots:{default:[j1]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function Q1(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var Jf=class extends W{constructor(e){super(),G(this,e,Q1,J1,z,{})}},Qf=Jf;function X1(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function Y1(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],n={$$slots:{default:[X1]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function Z1(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var Xf=class extends W{constructor(e){super(),G(this,e,Z1,Y1,z,{})}},Yf=Xf;function e0(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function t0(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],n={$$slots:{default:[e0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function r0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var Zf=class extends W{constructor(e){super(),G(this,e,r0,t0,z,{})}},io=Zf;function o0(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function n0(o){let e,t,r=[{name:"lock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[o0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function s0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var eu=class extends W{constructor(e){super(),G(this,e,s0,n0,z,{})}},tu=eu;function a0(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function i0(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],n={$$slots:{default:[a0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function l0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var ru=class extends W{constructor(e){super(),G(this,e,l0,i0,z,{})}},ou=ru;function c0(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function f0(o){let e,t,r=[{name:"pause"},o[1],{iconNode:o[0]}],n={$$slots:{default:[c0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function u0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var nu=class extends W{constructor(e){super(),G(this,e,u0,f0,z,{})}},su=nu;function d0(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function p0(o){let e,t,r=[{name:"play"},o[1],{iconNode:o[0]}],n={$$slots:{default:[d0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function m0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var au=class extends W{constructor(e){super(),G(this,e,m0,p0,z,{})}},iu=au;function h0(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function g0(o){let e,t,r=[{name:"refresh-cw"},o[1],{iconNode:o[0]}],n={$$slots:{default:[h0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function y0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var lu=class extends W{constructor(e){super(),G(this,e,y0,g0,z,{})}},cu=lu;function x0(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function b0(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],n={$$slots:{default:[x0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function v0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var fu=class extends W{constructor(e){super(),G(this,e,v0,b0,z,{})}},an=fu;function w0(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function _0(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],n={$$slots:{default:[w0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function S0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var uu=class extends W{constructor(e){super(),G(this,e,S0,_0,z,{})}},du=uu;function k0(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function C0(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[k0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function I0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var pu=class extends W{constructor(e){super(),G(this,e,I0,C0,z,{})}},Zs=pu;function L0(o){let e,t=o[2].default,r=le(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&fe(r,t,n,n[3],e?ce(t,n[3],s,null):ue(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function T0(o){let e,t,r=[{name:"upload"},o[1],{iconNode:o[0]}],n={$$slots:{default:[L0]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ee(n,r[s]);return e=new Fe({props:n}),{c(){R(e.$$.fragment)},m(s,a){D(e,s,a),t=!0},p(s,[a]){let i=a&3?Ce(r,[r[0],a&2&&Pe(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){M(e,s)}}}function P0(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"17 8 12 3 7 8"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15"}]];return o.$$set=a=>{t(1,e=ee(ee({},e),pe(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=pe(e),[s,e,r,n]}var mu=class extends W{constructor(e){super(),G(this,e,P0,T0,z,{})}},hu=mu;function F0(o){ye(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function A0(o){let e,t,r,n,s,a;return t=new io({props:{class:"svg-icon inline-icon"}}),{c(){var i;e=C("button"),R(t.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(i=o[0].view.file)==null?void 0:i.name)},m(i,l){_(i,e,l),D(t,e,null),a=!0},p(i,l){var c;(!a||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(i[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&h(e,"class",r),(!a||l&1&&n!==(n=i[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!a||l&1&&s!==(s=(c=i[0].view.file)==null?void 0:c.name))&&h(e,"data-filename",s)},i(i){a||(b(t.$$.fragment,i),a=!0)},o(i){k(t.$$.fragment,i),a=!1},d(i){i&&v(e),M(t)}}}function E0(o){let e,t,r,n,s,a,i,l,c,f,u,d,m;return t=new io({props:{class:"svg-icon inline-icon"}}),l=new an({props:{class:"svg-icon inline-icon"}}),{c(){var p;e=C("button"),R(t.$$.fragment),a=E(),i=C("button"),R(l.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(p=o[0].view.file)==null?void 0:p.name),h(i,"class",c="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),h(i,"aria-label",f=`${o[2].relay.name} (${o[1].status})`),h(i,"tabindex","0")},m(p,x){_(p,e,x),D(t,e,null),_(p,a,x),_(p,i,x),D(l,i,null),u=!0,d||(m=[K(i,"click",o[3]),K(i,"keypress",o[4])],d=!0)},p(p,x){var y;(!u||x&1&&r!==(r="clickable-icon view-action system3-view-action "+(p[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&h(e,"class",r),(!u||x&1&&n!==(n=p[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!u||x&1&&s!==(s=(y=p[0].view.file)==null?void 0:y.name))&&h(e,"data-filename",s),(!u||x&2&&c!==(c="system3-"+p[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&h(i,"class",c),(!u||x&6&&f!==(f=`${p[2].relay.name} (${p[1].status})`))&&h(i,"aria-label",f)},i(p){u||(b(t.$$.fragment,p),b(l.$$.fragment,p),u=!0)},o(p){k(t.$$.fragment,p),k(l.$$.fragment,p),u=!1},d(p){p&&(v(e),v(a),v(i)),M(t),M(l),d=!1,me(m)}}}function D0(o){let e,t,r,n,s=[E0,A0],a=[];function i(l,c){return l[2]?0:1}return e=i(o,-1),t=a[e]=s[e](o),{c(){t.c(),r=he()},m(l,c){a[e].m(l,c),_(l,r,c),n=!0},p(l,[c]){let f=e;e=i(l,c),e===f?a[e].p(l,c):(se(),k(a[f],1,1,()=>{a[f]=null}),ae(),t=a[e],t?t.p(l,c):(t=a[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){k(t),n=!1},d(l){l&&v(r),a[e].d(l)}}}function M0(o,e,t){let{view:r}=e,{state:n}=e,{remote:s}=e,a={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},i=()=>{r.toggleConnection()},l=c=>{c.key==="Enter"&&i()};return o.$$set=c=>{"view"in c&&t(0,r=c.view),"state"in c&&t(1,n=c.state),"remote"in c&&t(2,s=c.remote)},[r,n,s,i,l]}var gu=class extends W{constructor(e){super(),G(this,e,M0,D0,z,{view:0,state:1,remote:2},F0)}},yu=gu;var ln=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){if(!this.view)return!0;let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let n=e.querySelector(".system3-banner");if(!n){n=document.createElement("div"),n.classList.add("system3-banner");let s=n.createSpan();s.setText(this.text),n.appendChild(s),r.appendChild(n);let a=async()=>{await this.onClick()&&this.destroy()};n.addEventListener("click",a)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),!0}};var wi=require("@codemirror/state"),Sg=require("@codemirror/view");function cn(o,e){let t=Object.keys(e).map(r=>R0(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function R0(o,e,t){let r=o[e],n=o.hasOwnProperty(e),s=n?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},a=t(s);return r&&Object.setPrototypeOf(a,r),Object.setPrototypeOf(i,a),o[e]=i,l;function i(...c){return a===s&&o[e]===i&&l(),a.apply(this,c)}function l(){o[e]===i&&(n?o[e]=s:delete o[e]),a!==s&&(a=s,Object.setPrototypeOf(i,r||Function))}}var kg=mn(xu());var $0=25,_3=wi.Facet.define({combine(o){return o[o.length-1]}}),bu=wi.Annotation.define(),vu=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};var r,n,s,a;if(this.editor=e,this.connectionManager=this.editor.state.field(Ur),this.view=(r=this.connectionManager)==null?void 0:r.findView(e),!this.view||(this.log=be(`[LiveCMPluginValue][${(n=this.view.view.file)==null?void 0:n.path}]`,"log"),this.warn=be(`[LiveCMPluginValue][${(s=this.view.view.file)==null?void 0:s.path}]`,"warn"),this.debug=be(`[LiveCMPluginValue][${(a=this.view.view.file)==null?void 0:a.path}]`,"debug"),this.debug("created"),!this.view.document))return;let t=this;this.uninstallMonkeyPatch=cn(this.view.view,{setViewData(i){return function(l,c){return c&&($r(t.view)&&t.view.document.text===l&&(t.view.tracking=!0),t.resync()),i.call(this,l,c)}}}),this.view.document.connected?this.resync():this.view.document.onceConnected().then(()=>{this.resync()}),this._observer=async(i,l)=>{if(!$r(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(l.origin!==this){let c=i.delta,f=[],u=0;for(let d=0;d<c.length;d++){let m=c[d];m.insert!=null?f.push({from:u,to:u,insert:m.insert}):m.delete!=null?(f.push({from:u,to:u+m.delete,insert:""}),u+=m.delete):m.retain!=null&&(u+=m.retain)}!this.view.tracking||Re().enableEditorTweens&&this.keyFrameCounter>$0?(this.keyFrameCounter=0,f=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),$r(this.view)&&(e.dispatch({changes:f,annotations:[bu.of(this.editor)]}),this.view.tracking=!0)}},this.observer=(i,l)=>{var c;try{(c=this._observer)==null||c.call(this,i,l)}catch(f){f instanceof RangeError&&$r(this.view)&&(this.view.tracking=!1)}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new kg.default,n=r.diff_main(t,e);r.diff_cleanupSemantic(n);let s=[],a=0;for(let[i,l]of n)switch(i){case 0:a+=l.length;break;case 1:s.push({from:a,to:a,insert:l}),a+=l.length;break;case-1:s.push({from:a,to:a+l.length,insert:""});break}return s}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if($r(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();$r(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[bu.of(this.editor)]})}}async getKeyFrame(e=!1){return!$r(this.view)||this.destroyed?[]:this.view.document.text===this.view.view.getViewData()?(this.view.tracking=!0,[]):(this.warn(`|${this.view.document.text}|
|${this.view.view.getViewData()}|`),this.warn("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(this.view.tracking||this.view.checkStale(),$r(this.view)&&!this.destroyed?[this.getBufferChange(this.view.document.text,e)]:[]))}update(e){var n,s,a,i;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(bu)===this.editor)return;let t=e.view;this.view=(n=this.connectionManager)==null?void 0:n.findView(t);let r=(a=(s=this.view)==null?void 0:s.document)==null?void 0:a.ytext;r&&((i=r.doc)==null||i.transact(()=>{let l=0;e.changes.iterChanges((c,f,u,d,m)=>{let p=m.sliceString(0,m.length,`
`);c!==f&&r.delete(c+l,f-c),p.length>0&&r.insert(c+l,p),l+=p.length-(f-c)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.uninstallMonkeyPatch&&(this.uninstallMonkeyPatch(),this.uninstallMonkeyPatch=void 0),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Cg=Sg.ViewPlugin.fromClass(vu);var _i=require("@codemirror/state"),Bt=require("@codemirror/view");var Ig=Bt.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),U0=_i.Annotation.define(),wu=class extends Bt.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return ks("span",[St("class","cm-ySelectionCaret"),St("style",`background-color: ${this.color}; border-color: ${this.color}`)],[Fn("\u2060"),ks("div",[St("class","cm-ySelectionCaretDot")]),Fn("\u2060"),ks("div",[St("class","cm-ySelectionInfo")],[Fn(this.name)]),Fn("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},_u=class{constructor(e){var r,n;this.editor=e,this.decorations=_i.RangeSet.of([]),this.connectionManager=this.editor.state.field(Ur);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof Ro){this.view=t;let s=(n=this.view.document)==null?void 0:n._provider;this._listener=({added:a,updated:i,removed:l},c,f)=>{a.concat(i).concat(l).findIndex(d=>{var m;return d!==((m=this._awareness)==null?void 0:m.doc.clientID)})>=0&&e.dispatch({annotations:[U0.of([])]})},s&&(this._awareness=s.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var c,f,u,d;let t=e.view;this.view=(c=this.connectionManager)==null?void 0:c.findView(t);let r=(u=(f=this.view)==null?void 0:f.document)==null?void 0:u.ytext;if(!(this.view&&r&&r.doc))return;let n=(d=this.view.document)==null?void 0:d._provider;if(!n)return;this._awareness=n.awareness;let s=this._awareness,a=r.doc,i=[],l=this._awareness.getLocalState();if(l!=null){let m=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),p=m?e.state.selection.main:null,x=l.cursor==null?null:Dc(l.cursor.anchor),y=l.cursor==null?null:Dc(l.cursor.head);if(p!=null){let g=Mc(r,p.anchor),I=Mc(r,p.head);(l.cursor==null||!$c(x,g)||!$c(y,I))&&s.setLocalStateField("cursor",{anchor:g,head:I})}else l.cursor!=null&&m&&s.setLocalStateField("cursor",null)}s.getStates().forEach((m,p)=>{if(p===s.doc.clientID)return;let x=m.cursor;if(x==null||x.anchor==null||x.head==null)return;let y=Rc(x.anchor,a),g=Rc(x.head,a);if(y==null||g==null||y.type!==r||g.type!==r)return;if(y.index>e.state.doc.length||g.index>e.state.doc.length){be("[RemoteSelections]","warn")(`cursor positions (${y.index}, ${g.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=Bt.Decoration.none;return}let{color:I="#30bced",name:T="Anonymous"}=m.user||{},P=m.user&&m.user.colorLight||I+"33",A=xn(y.index,g.index),F=ur(y.index,g.index),S=e.view.state.doc.lineAt(A),L=e.view.state.doc.lineAt(F);if(S.number===L.number)i.push({from:A,to:F,value:Bt.Decoration.mark({attributes:{style:`background-color: ${P}`},class:"cm-ySelection"})});else{i.push({from:A,to:S.from+S.length,value:Bt.Decoration.mark({attributes:{style:`background-color: ${P}`},class:"cm-ySelection"})}),i.push({from:L.from,to:F,value:Bt.Decoration.mark({attributes:{style:`background-color: ${P}`},class:"cm-ySelection"})});for(let $=S.number+1;$<L.number;$++){let O=e.view.state.doc.line($).from;i.push({from:O,to:O,value:Bt.Decoration.line({attributes:{style:`background-color: ${P}`,class:"cm-yLineSelection"}})})}}i.push({from:g.index,to:g.index,value:Bt.Decoration.widget({side:g.index-y.index>0?-1:1,block:!1,widget:new wu(I,T)})})}),this.decorations=Bt.Decoration.set(i,!0)}},Lg=Bt.ViewPlugin.fromClass(_u,{decorations:o=>o.decorations});var Si=require("@codemirror/state"),lo=require("@codemirror/view"),Tg=require("@codemirror/view");var $3=Si.Annotation.define(),ku=class extends Tg.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},Su=Si.StateEffect.define(),Cu=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(Ur),this.decorations=lo.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,n)=>{this.updateFromMetadata(n),this.editor.dispatch({effects:Su.of(null)})},!this.connectionManager){be("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=be(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var r,n;if(this.connectionManager&&this.app&&((n=(r=this.view)==null?void 0:r.document)!=null&&n.tfile)){this.connectionManager.onMeta(this.view.document.tfile,this.cb);let s=this.app.metadataCache.getFileCache(this.view.document.tfile);s&&(this.updateFromMetadata(s),this.editor.dispatch({effects:Su.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(lo.EditorView.decorations).forEach(n=>{(typeof n=="function"?n(e):n).between(0,e.state.doc.length,(a,i,l)=>{var u;(((u=l.spec)==null?void 0:u.class)||"").contains("cm-formatting-link-end")&&t.push({from:a,to:i})})}),t}updateFromMetadata(e){var r,n,s,a;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((n=(r=this.view)==null?void 0:r.document)!=null&&n.sharedFolder)||!((a=(s=this.view)==null?void 0:s.document)!=null&&a.tfile))return;let t=new Map;for(let i of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}for(let i of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(n){this.metadata.delete(t)}}updateFromEditor(e){var s,a,i,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((a=(s=this.view)==null?void 0:s.document)!=null&&a.sharedFolder)||!((l=(i=this.view)==null?void 0:i.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),n=this.findInternalLinks(this.editor);for(let c of n){let f=null;for(let[m,p]of r)if(c.from<=p.to&&c.to>=p.from){f=p,r.delete(m);break}if(!f)continue;let u=this.app.metadataCache.getFirstLinkpathDest(f.link,this.view.document.path);u&&!this.view.document.sharedFolder.checkPath(u.path)&&t.push(c.from)}t.filter(c=>c<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>lo.Decoration.widget({widget:new ku,side:1}).range(t));e.length>0?this.decorations=lo.Decoration.set(e,!0):this.decorations=lo.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(n=>n.is(Su))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},Pg=lo.ViewPlugin.fromClass(Cu,{decorations:o=>o.decorations});function co(){}co.prototype={diff:function(e,t){var r,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=n.callback;typeof n=="function"&&(s=n,n={}),this.options=n;var a=this;function i(P){return s?(setTimeout(function(){s(void 0,P)},0),!0):P}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,c=e.length,f=1,u=l+c;n.maxEditLength&&(u=Math.min(u,n.maxEditLength));var d=(r=n.timeout)!==null&&r!==void 0?r:1/0,m=Date.now()+d,p=[{oldPos:-1,lastComponent:void 0}],x=this.extractCommon(p[0],t,e,0);if(p[0].oldPos+1>=c&&x+1>=l)return i([{value:this.join(t),count:t.length}]);var y=-1/0,g=1/0;function I(){for(var P=Math.max(y,-f);P<=Math.min(g,f);P+=2){var A=void 0,F=p[P-1],S=p[P+1];F&&(p[P-1]=void 0);var L=!1;if(S){var $=S.oldPos-P;L=S&&0<=$&&$<l}var O=F&&F.oldPos+1<c;if(!L&&!O){p[P]=void 0;continue}if(!O||L&&F.oldPos+1<S.oldPos?A=a.addToPath(S,!0,void 0,0):A=a.addToPath(F,void 0,!0,1),x=a.extractCommon(A,t,e,P),A.oldPos+1>=c&&x+1>=l)return i(O0(a,A.lastComponent,t,e,a.useLongestToken));p[P]=A,A.oldPos+1>=c&&(g=Math.min(g,P-1)),x+1>=l&&(y=Math.max(y,P+1))}f++}if(s)(function P(){setTimeout(function(){if(f>u||Date.now()>m)return s();I()||P()},0)})();else for(;f<=u&&Date.now()<=m;){var T=I();if(T)return T}},addToPath:function(e,t,r,n){var s=e.lastComponent;return s&&s.added===t&&s.removed===r?{oldPos:e.oldPos+n,lastComponent:{count:s.count+1,added:t,removed:r,previousComponent:s.previousComponent}}:{oldPos:e.oldPos+n,lastComponent:{count:1,added:t,removed:r,previousComponent:s}}},extractCommon:function(e,t,r,n){for(var s=t.length,a=r.length,i=e.oldPos,l=i-n,c=0;l+1<s&&i+1<a&&this.equals(t[l+1],r[i+1]);)l++,i++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=i,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function O0(o,e,t,r,n){for(var s=[],a;e;)s.push(e),a=e.previousComponent,delete e.previousComponent,e=a;s.reverse();for(var i=0,l=s.length,c=0,f=0;i<l;i++){var u=s[i];if(u.removed){if(u.value=o.join(r.slice(f,f+u.count)),f+=u.count,i&&s[i-1].added){var m=s[i-1];s[i-1]=s[i],s[i]=m}}else{if(!u.added&&n){var d=t.slice(c,c+u.count);d=d.map(function(x,y){var g=r[f+y];return g.length>x.length?g:x}),u.value=o.join(d)}else u.value=o.join(t.slice(c,c+u.count));c+=u.count,u.added||(f+=u.count)}}var p=s[l-1];return l>1&&typeof p.value=="string"&&(p.added||p.removed)&&o.equals("",p.value)&&(s[l-2].value+=p.value,s.pop()),s}var O3=new co;function B0(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var Fg=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Ag=/\S/,Fu=new co;Fu.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!Ag.test(o)&&!Ag.test(e)};Fu.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Fg.test(e[t])&&Fg.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Eg(o,e,t){return t=B0(t,{ignoreWhitespace:!0}),Fu.diff(o,e,t)}var Au=new co;Au.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var n=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=n:(this.options.ignoreWhitespace&&(n=n.trim()),e.push(n))}return e};function N0(o,e,t){return Au.diff(o,e,t)}var H0=new co;H0.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var q0=new co;q0.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function ki(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ki=function(e){return typeof e}:ki=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ki(o)}function Iu(o){return V0(o)||z0(o)||W0(o)||K0()}function V0(o){if(Array.isArray(o))return Lu(o)}function z0(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function W0(o,e){if(o){if(typeof o=="string")return Lu(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Lu(o,e)}}function Lu(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function K0(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var G0=Object.prototype.toString,ea=new co;ea.useLongestToken=!0;ea.tokenize=Au.tokenize;ea.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,n=r===void 0?function(s,a){return typeof a=="undefined"?t:a}:r;return typeof o=="string"?o:JSON.stringify(Tu(o,null,null,n),n,"  ")};ea.equals=function(o,e){return co.prototype.equals.call(ea,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function Tu(o,e,t,r,n){e=e||[],t=t||[],r&&(o=r(n,o));var s;for(s=0;s<e.length;s+=1)if(e[s]===o)return t[s];var a;if(G0.call(o)==="[object Array]"){for(e.push(o),a=new Array(o.length),t.push(a),s=0;s<o.length;s+=1)a[s]=Tu(o[s],e,t,r,n);return e.pop(),t.pop(),a}if(o&&o.toJSON&&(o=o.toJSON()),ki(o)==="object"&&o!==null){e.push(o),a={},t.push(a);var i=[],l;for(l in o)o.hasOwnProperty(l)&&i.push(l);for(i.sort(),s=0;s<i.length;s+=1)l=i[s],a[l]=Tu(o[l],e,t,r,l);e.pop(),t.pop()}else a=o;return a}var Pu=new co;Pu.tokenize=function(o){return o.slice()};Pu.join=Pu.removeEmpty=function(o){return o};function Dg(o,e,t,r,n,s,a){a||(a={}),typeof a.context=="undefined"&&(a.context=4);var i=N0(t,r,a);if(!i)return;i.push({value:"",lines:[]});function l(g){return g.map(function(I){return" "+I})}for(var c=[],f=0,u=0,d=[],m=1,p=1,x=function(I){var T=i[I],P=T.lines||T.value.replace(/\n$/,"").split(`
`);if(T.lines=P,T.added||T.removed){var A;if(!f){var F=i[I-1];f=m,u=p,F&&(d=a.context>0?l(F.lines.slice(-a.context)):[],f-=d.length,u-=d.length)}(A=d).push.apply(A,Iu(P.map(function(oe){return(T.added?"+":"-")+oe}))),T.added?p+=P.length:m+=P.length}else{if(f)if(P.length<=a.context*2&&I<i.length-2){var S;(S=d).push.apply(S,Iu(l(P)))}else{var L,$=Math.min(P.length,a.context);(L=d).push.apply(L,Iu(l(P.slice(0,$))));var O={oldStart:f,oldLines:m-f+$,newStart:u,newLines:p-u+$,lines:d};if(I>=i.length-2&&P.length<=a.context){var Q=/\n$/.test(t),U=/\n$/.test(r),V=P.length==0&&d.length>O.oldLines;!Q&&V&&t.length>0&&d.splice(O.oldLines,0,"\\ No newline at end of file"),(!Q&&!V||!U)&&d.push("\\ No newline at end of file")}c.push(O),f=0,u=0,d=[]}m+=P.length,p+=P.length}},y=0;y<i.length;y++)x(y);return{oldFileName:o,newFileName:e,oldHeader:n,newHeader:s,hunks:c}}var $g=require("obsidian");var Du=require("obsidian");var Mg=mn(xu());var At=class extends Ve{constructor(t){super();this.observableName=t;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,n]of this._map)if(t(n,r))return n}some(t){for(let[r,n]of this._map)if(t(n,r))return!0;return!1}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let n=new Eu(this,t);return this._derivedMaps.set(t,n),n}},Eu=class extends At{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.sub(),this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(()=>{let t=new Map;this.parentMap.forEach((r,n)=>{this.predicate(r,n)&&t.set(n,r)}),this._map=t,this.notifyListeners()}))}subscribe(t){return this.sub(),super.subscribe(t),()=>{this.unsubscribe(t)}}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){this.unsub&&this.unsub()}};function $o(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let n=Math.min(t.length,r.length);for(let s=0;s<n;s++)if(t[s]!==r[s]){if(s===t.length-1){let a=t[s].match(/\d+/g),i=r[s].match(/\d+/g);if(a&&i){let l=parseInt(a[0]),c=parseInt(i[0]);if(l!==c)return l-c}}return t[s].localeCompare(r[s])}return t.length-r.length}function Ii(o,e){let t=o.getText("contents"),r=t.toString(),n=new Mg.diff_match_patch,s=n.diff_main(r,e);n.diff_cleanupSemantic(s);let a=0,i=be("[updateYDocFromDiskBuffer]","debug");i("Updating YDoc:"),i("Current content length:",r.length),i("Disk buffer length:",e.length),s.length!=0&&(o.transact(()=>{for(let[l,c]of s)switch(l){case 1:i(`Inserting "${c}" at position ${a}`),t.insert(a,c),a+=c.length;break;case 0:i(`Keeping "${c}" (length: ${c.length})`),a+=c.length;break;case-1:i(`Deleting "${c}" at position ${a}`),t.delete(a,c.length);break}}),i("Update complete. New content length:",t.toString().length))}var Ci=class extends it{constructor(t,r,n,s=3){super();this.loginManager=t;this.timeProvider=r;this.sharedFolders=n;this.concurrency=s;this.activeSync=new Lo;this.activeDownloads=new Lo;this.syncGroups=new At;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.subscriptions=[];this.start=this.resume;ht.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let t=0,r=0,n=0,s=0,a=0,i=0;this.syncGroups.forEach(u=>{t+=u.total,r+=u.completed,n+=u.syncs,s+=u.completedSyncs,a+=u.downloads,i+=u.completedDownloads});let l=t>0?r/t*100:0,c=n>0?s/n*100:0,f=a>0?i/a*100:0;return{totalPercent:Math.round(l),syncPercent:Math.round(c),downloadPercent:Math.round(f),totalItems:t,completedItems:r,syncItems:n,completedSyncs:s,downloadItems:a,completedDownloads:i}}getGroupProgress(t){let r=this.syncGroups.get(t);if(!r)return null;let n=r.total>0?r.completed/r.total*100:0,s=r.syncs>0?r.completedSyncs/r.syncs*100:0,a=r.downloads>0?r.completedDownloads/r.downloads*100:0;return{percent:Math.round(n),syncPercent:Math.round(s),downloadPercent:Math.round(a),sharedFolder:t,status:r.status}}getAllGroupsProgress(){let t=[];return this.syncGroups.forEach((r,n)=>{let s=this.getGroupProgress(n);s&&t.push(s)}),t}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let t=this.syncQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeSync.size<this.concurrency;){let r=t.shift();if(!r)break;this.syncQueue=this.syncQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeSync.add(r);try{let n=r.doc;n instanceof Ao?await this.syncFile(n):await this.syncDocument(n),r.status="completed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.resolve(),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.debug(`[Sync Progress] Before: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completedSyncs++,a.completed++,this.debug(`[Sync Progress] After: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completed===a.total&&(a.status="completed",this.debug("[Sync Progress] Group completed!")),this.syncGroups.set(r.sharedFolder,a))}catch(n){r.status="failed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.error("[Sync Failed]",n),a.status="failed",this.syncGroups.set(r.sharedFolder,a))}finally{this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid)}}this.isProcessingSync=!1,this.syncQueue.length>0&&!this.isPaused&&this.syncQueue.some(n=>n.sharedFolder.connected)&&this.processSyncQueue()}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let t=this.downloadQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeDownloads.size<this.concurrency;){let r=t.shift();if(!r)break;this.downloadQueue=this.downloadQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeDownloads.add(r);try{r.doc instanceof Je?await this.getCanvas(r.doc):r.doc instanceof Ao?await this.getSyncFile(r.doc):await this.getDocument(r.doc),r.status="completed";let n=this.downloadCompletionCallbacks.get(r.guid);n&&(n.resolve(),this.downloadCompletionCallbacks.delete(r.guid));let s=this.syncGroups.get(r.sharedFolder);s&&(s.completedDownloads++,s.completed++,s.completed===s.total&&(s.status="completed"),this.syncGroups.set(r.sharedFolder,s))}catch(n){r.status="failed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.downloadCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(a.status="failed",this.syncGroups.set(r.sharedFolder,a)),this.error("[processDownloadQueue]",n)}finally{this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid)}}this.isProcessingDownloads=!1,this.downloadQueue.length>0&&!this.isPaused&&this.downloadQueue.some(n=>n.sharedFolder.connected)&&this.processDownloadQueue()}async enqueueSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?new Promise((l,c)=>{i.resolve=l,i.reject=c}):(this.processSyncQueue(),Promise.resolve())}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r},s=this.syncGroups.get(r);s||(s={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),s.total++,s.syncs++,this.syncGroups.set(r,s),this.inProgressSyncs.add(t.guid);let a=new Promise((i,l)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:l})});return this.syncQueue.push(n),this.syncQueue.sort($o),this.processSyncQueue(),a}enqueueDownload(t){if(this.inProgressDownloads.has(t.guid)){this.debug(`[enqueueDownload] Item ${t.guid} already in progress, skipping`);let i=this.downloadCompletionCallbacks.get(t.guid);return i?(this.processDownloadQueue(),new Promise((l,c)=>{i.resolve=l,i.reject=c})):(this.processDownloadQueue(),Promise.resolve())}let r=t.sharedFolder,n=this.syncGroups.get(r);n||(n={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),n.downloads++,n.total++,this.syncGroups.set(r,n);let s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressDownloads.add(t.guid);let a=new Promise((i,l)=>{this.downloadCompletionCallbacks.set(t.guid,{resolve:i,reject:l})});return this.downloadQueue.push(s),this.downloadQueue.sort($o),this.processDownloadQueue(),a}enqueueSharedFolderSync(t){let r=[...t.files.values()].filter(xr),n=[...t.files.values()].filter(Kt),s=[...t.files.values()].filter(ir),a=[...r,...n,...s],i={sharedFolder:t,total:a.length,completed:0,status:"pending",downloads:0,syncs:a.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(t,i);let l=[...r].sort($o),c=[...n].sort($o),f=[...s].sort($o);for(let u of l)this.enqueueDocumentForGroupSync(u);for(let u of c)this.enqueueCanvasForGroupSync(u,t);for(let u of f)this.enqueueSyncFileForGroupSync(u);i.status="running",this.syncGroups.set(t,i)}async enqueueDocumentForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueDocumentForGroupSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?(this.processSyncQueue(),new Promise((i,l)=>{a.resolve=i,a.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((a,i)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:i})});return this.syncQueue.push(n),this.syncQueue.sort($o),this.processSyncQueue(),s}async enqueueSyncFileForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSyncFileForGroupSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?(this.processSyncQueue(),new Promise((i,l)=>{a.resolve=i,a.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((a,i)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:i})});return this.syncQueue.push(n),this.syncQueue.sort($o),this.processSyncQueue(),s}getAuthHeader(t){var r;return{Authorization:Re().enableDocumentServer?`Bearer ${t.token}`:`Bearer ${(r=this.loginManager.user)==null?void 0:r.token}`}}getBaseUrl(t,r){var i;let n=new URL(t.url);n.protocol="https:";let s=n.pathname.split("/");s.pop(),s.push(t.docId),n.pathname=s.join("/");let a=((i=t.baseUrl)==null?void 0:i.replace(/\/$/,""))||n.toString();if(Re().enableDocumentServer)return a;if(r instanceof nr)return`https://api.system3.md/relay/${r.relayId}/doc/${r.documentId}`;if(r instanceof Lt)return`https://api.system3.md/relay/${r.relayId}/doc/${r.canvasId}`;throw new Error("unexpected case")}async downloadItem(t){let r=f=>f instanceof Lt?f.canvasId:f.documentId,n=t.s3rn;if(this.log("[downloadItem]",t.path,`${je.encode(n)}`),!(n instanceof nr||n instanceof Lt))throw new Error(`Unable to decode S3RN: ${je.encode(n)}`);let s=await t.getProviderToken(),a=this.getAuthHeader(s),l=`${this.getBaseUrl(s,n)}/as-update`,c=await(0,Du.requestUrl)({url:l,method:"GET",headers:a,throw:!1});if(c.status===200)this.debug("[downloadItem]",r(n),c.status);else throw this.error("[downloadItem]",r(n),l,c.status,c.text),new Error(`Unable to download item: ${je.encode(n)}`);return c}async syncDocumentWebsocket(t){let r="",n="",s=null;Kt(t)?(s=Je.exportCanvasData(t.ydoc),n=JSON.stringify(s)):xr(t)&&(n=t.text);try{r=await t.sharedFolder.read(t)}catch(c){}let a=!1;if(Kt(t)&&s){let c=r?JSON.parse(r):{nodes:[],edges:[]};a=Rr(s,c)}else a=n===r;if(!a&&r)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let i=t.onceProviderSynced(),l=t.intent;return t.connect(),l==="disconnected"&&!t.userLock&&await i,l==="disconnected"&&!t.userLock&&(t.disconnect(),t.sharedFolder.tokenStore.removeFromRefreshQueue(je.encode(t.s3rn))),!0}async uploadItem(t){let r=t.s3rn;if(this.log("[uploadItem]",`${je.encode(r)}`),!(r instanceof nr)&&!(r instanceof Lt))throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let n=await t.getProviderToken(),s={"Content-Type":"application/octet-stream",...this.getAuthHeader(n)},a=Zo(t.ydoc),l=`${this.getBaseUrl(n,r)}/update`,c=await(0,Du.requestUrl)({url:l,method:"POST",headers:s,body:a.buffer,throw:!1});return c.status===200?this.debug("[uploadItem]",r instanceof Lt?r.canvasId:r.documentId,c.status,c.text):this.error("[uploadItem]",r instanceof Lt?r.canvasId:r.documentId,l,c.status,c.text),c}enqueueCanvasDownload(t){return this.enqueueDownload(t)}async enqueueCanvasForGroupSync(t,r){try{if(!r.syncStore.has(t.path)){this.debug("[enqueueCanvasForGroupSync] Skipping canvas, not in sync list",t.path);return}await this.enqueueDownload(t)}catch(n){this.error("[enqueueCanvasForGroupSync]",n)}}async getCanvas(t,r=3,n=3e3){try{let s=Je.exportCanvasData(t.ydoc),a={edges:[],nodes:[]};try{let d=await t.sharedFolder.read(t);a=JSON.parse(d)}catch(d){}let i=Rr(s.edges,a.edges)&&Rr(s.nodes,a.nodes),l=a.nodes.length>0,f=(await this.downloadItem(t)).arrayBuffer,u=new Uint8Array(f);if(this.log("[getCanvas] applying content from server"),Ar(t.ydoc,u),l&&!i){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.json),this.log("[getCanvas] flushed"))}catch(s){throw this.error(s),s}}async getDocument(t,r=3,n=3e3){try{let s=t.text,a="";try{a=await t.sharedFolder.read(t)}catch(x){}let i=s===a,l=a!=="",f=(await this.downloadItem(t)).arrayBuffer,u=new Uint8Array(f),d=new Vt;Ar(d,u);let m=d.getMap("users");if(d.getText("contents").toString()===""){if(m.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",m.size,r,n),r>0&&this.timeProvider.setTimeout(()=>{this.getDocument(t,r-1,n*2)},n);return}if(t.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(t);return}}if(this.log("[getDocument] applying content from server"),Ar(t.ydoc,u),l&&!i){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.text),this.log("[getDocument] flushed"))}catch(s){throw this.error(s),s}}async syncItem(t){let r="",n="",s=null;Kt(t)?(s=Je.exportCanvasData(t.ydoc),n=JSON.stringify(s)):xr(t)&&(n=t.text);try{r=await t.sharedFolder.read(t)}catch(m){}let a=!1;if(Kt(t)&&s){let m=r?JSON.parse(r):{nodes:[],edges:[]};a=Rr(s,m)}else a=n===r;if(!a)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let i=await this.downloadItem(t);if(i.status!==200)return this.log("server returned an error."),!1;let l=i.arrayBuffer,c=new Uint8Array(l),f=new Vt;Ar(f,c);let u=f.getMap("users"),d=!1;if(Kt(t)&&s){let m=Je.exportCanvasData(f);d=u.size>0&&Rr(m,s)}else{let m=f.getText("contents").toString();d=u.size>0&&m===n}return d||(Ar(t.ydoc,c),Kt(t)?t.sharedFolder.flush(t,t.json):xr(t)&&t.sharedFolder.flush(t,t.text),this.uploadItem(t)),!0}async syncFile(t){t.sync()}async getSyncFile(t){t.pull()}async syncDocument(t){var r;try{Re().enableHTTPSync&&((r=t.sharedFolder.remote)!=null&&r.relay.provider)?await this.syncItem(t):(this.debug("fallback to websocket sync"),xr(t)?await this.syncDocumentWebsocket(t):Kt(t)&&await this.syncDocumentWebsocket(t))}catch(n){console.error(n);return}}subscribeToSync(t){return this.activeSync.subscribe(t)}subscribeToDownloads(t){return this.activeDownloads.subscribe(t)}subscribeToSyncGroups(t){return this.syncGroups.subscribe(t)}subscribeToProgress(t){let r=()=>{t(this.getOverallProgress())},n=this.activeSync.subscribe(()=>r()),s=this.activeDownloads.subscribe(()=>r()),a=this.syncGroups.subscribe(()=>r());return()=>{n(),s(),a()}}subscribeToGroupProgress(t,r){return this.syncGroups.subscribe(()=>{r(this.getGroupProgress(t))})}pause(){this.isPaused=!0}resume(){this.debug("starting"),this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[t,r]of this.syncCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(t);for(let[t,r]of this.downloadCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(t);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.timeProvider=null,this.subscriptions.forEach(t=>t())}};var Li=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var Ti=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let n=0,s=0;for(let a=0;a<r.lines.length;a+=1){let i=r.lines[a];if(i.startsWith("+")||i.startsWith("-")){let l=a,c=l;for(;c<r.lines.length-1&&(r.lines[c+1].startsWith("+")||r.lines[c+1].startsWith("-"));)c+=1;let f=r.lines.slice(l,c+1).filter(d=>d.startsWith("-")).map(d=>d.slice(1)),u=r.lines.slice(l,c+1).filter(d=>d.startsWith("+")).map(d=>d.slice(1));t.push(new Li({file1Start:r.oldStart+l-s-1,file2Start:r.newStart+l-n-1,file1Lines:f,file2Lines:u})),n+=f.length,s+=u.length,a+=c-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function Mu(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function ta(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function ra(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function rs(o){return o!==""?o:"\u200E"}var Nt=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var Or=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var Pi=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof ot){Ii(e.ydoc,t);return}else if(e instanceof oo){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,n=this.difference.file2Lines.length>0;n&&r?(new Nt({text:"Accept Top (Editor)",onClick:s=>this.acceptTopClick(s,this.difference)}).build(t),Or.build(t),new Nt({text:"Accept Bottom (Local Disk)",onClick:s=>this.acceptBottomClick(s,this.difference)}).build(t),Or.build(t),new Nt({text:"Accept All",onClick:s=>this.acceptAllClick(s,this.difference)}).build(t),Or.build(t),new Nt({text:"Accept None",onClick:s=>this.acceptNoneClick(s,this.difference)}).build(t)):r?(new Nt({text:"Keep in Editor",onClick:s=>this.insertFile1Difference(s,this.difference)}).build(t),Or.build(t),new Nt({text:"Discard in Editor",onClick:s=>this.discardFile1Difference(s,this.difference)}).build(t)):n&&(new Nt({text:"Accept from Local Disk",onClick:s=>this.insertFile2Difference(s,this.difference)}).build(t),Or.build(t),new Nt({text:"Discard on Disk",onClick:s=>this.discardFile2Difference(s,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=ta({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=ta({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),n=ta({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n);let s=ta({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=ra({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let n=ra({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=Mu({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=Mu({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,n),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=ra({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=ra({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var os="system3-differences-view";async function Ug(o,e){o.detachLeavesOfType(os);let t=o.getLeaf(!0);t.setViewState({type:os,active:!0,state:e}),o.revealLeaf(t)}var Fi=class extends $g.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[]}async getContent(t){return t instanceof ot?t.text:t instanceof oo?t.contents:await this.app.vault.cachedRead(t)}getViewType(){return os}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,n;if(((r=this.state)==null?void 0:r.file1)==null||((n=this.state)==null?void 0:n.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(s=>s.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(s=>s.trimEnd());let t=Dg(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));this.fileDifferences=Ti.fromParsedDiff(t),this.fileDifferences.differences.length===0&&this.leaf.detach()}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new Nt({text:"Keep Editor Contents",onClick:async n=>{n.preventDefault(),await this.acceptAllFromLeft()}}).build(r),Or.build(r),new Nt({text:"Accept All from Local Disk",onClick:async n=>{n.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async modify(t,r){if(t instanceof ot){Ii(t.ydoc,r);return}else if(t instanceof oo){t.contents=r;return}await this.app.vault.modify(t,r)}async acceptAllFromLeft(){!this.state||!this.fileDifferences||(await this.modify(this.state.file2,this.file1Content||""),this.leaf.detach())}async acceptAllFromRight(){!this.state||!this.fileDifferences||(await this.modify(this.state.file1,this.file2Content||""),this.leaf.detach())}buildLines(t){var a,i,l;let r=0,n=0,s=Math.max(((a=this.file1Lines)==null?void 0:a.length)||0,((i=this.file2Lines)==null?void 0:i.length)||0);for(;r<=s||n<=s;){let c=(l=this.fileDifferences)==null?void 0:l.differences.find(f=>f.file1Start===r&&f.file2Start===n);if(c!=null){let f=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(f,c),r+=c.file1Lines.length,n+=c.file2Lines.length}else{let f=r<=n?this.file1Lines[r]:this.file2Lines[n];t.createDiv({text:rs(f),cls:"file-diff__line"}),r+=1,n+=1}}}buildDifferenceVisualizer(t,r){var n;(n=this.state)!=null&&n.showMergeOption&&new Pi(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let s=0;s<r.file1Lines.length;s+=1){let a=r.file1Lines[s],i=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),c=this.buildDiffLine(a,i,"file-diff_top-line__character");(s<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),s!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(c)}for(let s=0;s<r.file2Lines.length;s+=1){let a=r.file1Lines[s],i=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),c=this.buildDiffLine(i,a,"file-diff_bottom-line__character");(s==0&&r.file1Lines.length>0||s>0)&&l.classList.add("file-diff__no-top-border"),s<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(c)}}buildDiffLine(t,r,n){let s=document.createElement("div");if(t!=null&&t.length===0)s.textContent=rs(t);else if(t!=null&&r!=null){let a=Eg(r,t);for(let i of a){if(i.removed)continue;let l=document.createElement("span");l.textContent=rs(i.value),i.added&&l.classList.add(n),s.appendChild(l)}}else if(t!=null&&r==null){let a=document.createElement("span");a.textContent=rs(t),a.classList.add(n),s.appendChild(a)}else s.textContent=rs(t);return s}scrollToFirstDifference(){var n;if(((n=this.fileDifferences)==null?void 0:n.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var Ai=class extends it{constructor(t){super();this.view=t.view,this.canvas=t.view.canvas,this.relayCanvas=t.canvas,this.unsubscribes=[],this.relayCanvasView=t,this.observedTextNodes=new Set,this.install()}destroy(){this.canvas&&(this.unsubscribes.forEach(t=>t()),this.unsubscribes=[],console.log("uninstall successful")),this.relayCanvasView.tracking=!1,this.canvas=null,this.relayCanvas=null,this.relayCanvasView=null,this.unsubscribes.length=0}observeNode(t){if(!this.observedTextNodes.has(t.id)&&t.type==="text"){let r=this.relayCanvas.textNode(t),n=t.id,s=a=>{let i=this.canvas.nodes.get(n);i&&(i.setText(r.toString()),this.canvas.markDirty(i))};r.observe(s),this.unsubscribes.push(()=>{this.relayCanvas.textNode(t).unobserve(s),this.observedTextNodes.delete(n)})}}markDirty(t){let r=this.canvas.nodes.get(t.id);r&&this.canvas.markDirty(r)}install(){var i;if(!this.canvas)return;this.debug("connecting canvas view to canvas",(i=this.view.file)==null?void 0:i.path,this.relayCanvas.path);let t=this,r=Je.exportCanvasData(this.relayCanvas.ydoc);this.canvas.importData(r,!0),this.unsubscribes.push(cn(this.canvas,{requestSave(l){return function(){let c=l.call(this);try{t.relayCanvas.importFromView(t.view)}catch(f){console.error(f)}return c}},applyHistory(l){return function(c){let f=l.call(this,c);try{t.relayCanvas.importFromView(t.view)}catch(u){console.error(u)}return f}}}));let n=(l,c)=>{var d,m,p,x;let f="";if(f+=`Transaction origin: ${l.transaction.origin} ${(m=(d=l.transaction.origin)==null?void 0:d.constructor)==null?void 0:m.name}
`,this.relayCanvas||this.warn("relay canvas is already destroyed"),!this.canvas){this.warn("canvas is already destroyed");return}if(!((p=this.view.file)!=null&&p.path.endsWith(this.relayCanvas.path))){this.log("event is for another node");return}if(l.transaction.origin===this.relayCanvas)return;let u=Je.exportCanvasData(this.relayCanvas.ydoc);for(let[y,g]of l.changes.keys)f+=`key: ${y} action: ${g.action}

`;this.debug(f),this.debug("importing data",(x=this.view.file)==null?void 0:x.path,this.relayCanvas.path,u),this.canvas.importData(u,!0),this.canvas.requestSave();for(let y of l.keysChanged){let g=c.get(y);g&&(this.canvas.nodes.has(g.id)&&this.observeNode(g.getData()),this.canvas.markMoved(g),this.canvas.markDirty(g))}},s=l=>n(l,this.canvas.nodes);this.relayCanvas.ynodes.observe(s),this.unsubscribes.push(()=>{this.relayCanvas.ynodes.unobserve(s)});for(let[,l]of this.relayCanvas.ynodes)this.observeNode(l);let a=l=>n(l,this.canvas.edges);this.relayCanvas.yedges.observe(a),this.unsubscribes.push(()=>{this.relayCanvas.yedges.unobserve(a)}),this.relayCanvasView.tracking=!0}};var Ei=require("@codemirror/state"),Bg=require("@codemirror/view");var D$=Ei.Facet.define({combine(o){return o[o.length-1]}}),Og=Ei.Annotation.define(),Ru=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};this.embed=!1;var t,r,n,s;this.editor=e,this.connectionManager=this.editor.state.field(Ur),this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor),this.node=this.getNode(),this._ytext=this.getYText(),this._ytext&&this.view&&(this.log=be(`[LiveNodePluginValue][${this.view.canvas.path}#${(r=this.node)==null?void 0:r.id}]`,"log"),this.warn=be(`[LiveNodePluginValue][${this.view.canvas.path}#${(n=this.node)==null?void 0:n.id}]`,"warn"),this.debug=be(`[LiveNodePluginValue][${this.view.canvas.path}#${(s=this.node)==null?void 0:s.id}]`,"debug"),this.debug("created"),this._observer=async(a,i)=>{var l;if(this._ytext=this.getYText(),this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(i.origin!==this){let c=a.delta,f=[],u=0;for(let d=0;d<c.length;d++){let m=c[d];m.insert!=null?f.push({from:u,to:u,insert:m.insert}):m.delete!=null?(f.push({from:u,to:u+m.delete,insert:""}),u+=m.delete):m.retain!=null&&(u+=m.retain)}(l=this.view)!=null&&l.canvas&&e.dispatch({changes:f,annotations:[Og.of(this.editor)]})}},this.observer=(a,i)=>{var l;try{(l=this._observer)==null||l.call(this,a,i)}catch(c){c instanceof RangeError&&console.warn("range errors!")}},this._ytext.observe(this.observer))}getNode(){let e=this.editor.state.values.find(t=>{if(t&&t.node)return t.node});if(e)return this.node=e.node,this.node}getYText(){var t,r,n,s,a;this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor);let e=this.editor.state.values.find(i=>{if(i&&i.node)return i.node});if(!e){this.observer&&((r=this._ytext)==null||r.unobserve(this.observer));return}return e.node.id!==((n=this.node)==null?void 0:n.id)&&this.observer&&((s=this._ytext)==null||s.unobserve(this.observer)),this.node=e.node,(a=this.view)==null?void 0:a.canvas.textNode(e.node)}update(e){var r;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Og)===this.editor)return;let t=this.getYText();t&&((r=t.doc)==null||r.transact(()=>{let n=0;e.changes.iterChanges((s,a,i,l,c)=>{let f=c.sliceString(0,c.length,`
`);s!==a&&t.delete(s+n,a-s),f.length>0&&t.insert(s+n,f),n+=f.length-(a-s)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Ng=Bg.ViewPlugin.fromClass(Ru);var J0=3;function $u(o,e){o.iterateAllLeaves(t=>{t.view instanceof ns.MarkdownView&&e(t.view)})}function Uu(o,e){o.iterateAllLeaves(t=>{t.view.getViewType()==="canvas"&&Re().enableCanvasSync&&e(t.view)})}function Q0(o,e){var t,r,n,s;if(o.length!==e.length)return!1;for(let a=0;a<o.length;a++)if(((t=o[a].view.file)==null?void 0:t.path)!==((r=e[a].view.file)==null?void 0:r.path)||((n=o[a].document)==null?void 0:n.path)!==((s=e[a].document)==null?void 0:s.path))return!1;return!0}var Di=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new ln(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){this.release(),this.banner=void 0,this.view=null}};function $r(o){return o instanceof Ro&&o.document!==void 0&&o.document.text!==void 0}function X0(o){return o instanceof Mi&&o.document!==void 0}var Mi=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.canvas=r,this.document=r,this._tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.canvas.connect().then(e=>{e||(this.shouldConnect=!1)}):this.canvas.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}offlineBanner(){if(this.shouldConnect){let e=new ln(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new yu({target:e,anchor:e.firstChild,props:{view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.canvas.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.canvas.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}attach(){return this.canvas.userLock=!0,this.setConnectionDot(),this.plugin||(this.plugin=new Ai(this)),new Promise(e=>this.canvas.whenReady().then(t=>{this._parent.networkStatus.online&&this.canvas.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.canvas.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.canvas.connect()}release(){var e,t,r;(e=this.plugin)==null||e.destroy(),this.plugin=void 0,(t=this._viewActions)==null||t.$destroy(),this._viewActions=void 0,(r=this._banner)==null||r.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.canvas.disconnect(),this.canvas.userLock=!1}destroy(){var e;(e=this.plugin)==null||e.destroy(),this.plugin=null,this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.canvas=null}},Ro=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new ln(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new ln(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new yu({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.document.userLock=!0,this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect(),this.document.userLock=!1}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},Ri=class{constructor(e,t,r,n){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=n,this.refreshQueue=[],this._compartment=new $i.Compartment,this.log=be("[LiveViews]","log"),this.warn=be("[LiveViews]","warn"),this.metadataListeners=new Map;let s=(l,c,f)=>{let u=this.metadataListeners.get(l);u==null||u(c,f)},a=this.app.metadataCache.on("changed",s);this.offListeners.push(()=>{this.app.metadataCache.offref(a)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let i=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(c=>{this.views.forEach(f=>{var u;((u=f.document)==null?void 0:u.sharedFolder)===l&&f.offlineBanner()})}))(),l.fset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,c)=>{this.sharedFolders.has(c)||(l(),this.folderListeners.delete(c))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,i(l))})})),ht.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([Ur.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){Ug(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return $u(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),Uu(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if($u(this.workspace,r=>{var a;let n=(a=r.file)==null?void 0:a.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),Uu(this.workspace,r=>{var a;let n=(a=r.file)==null?void 0:a.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return $u(this.workspace,async t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let a=n.proxy.getDoc(r),i=new Ro(this,t,a);e.push(i)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let a=new Di(this,t,()=>this.loginManager.openLoginPage());e.push(a)}}),Uu(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let a=n.proxy.getCanvas(r),i=new Mi(this,t,a);e.push(i)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let a=new Di(this,t,()=>this.loginManager.openLoginPage());e.push(a)}}),e}findView(e){return this.views.filter($r).find(t=>t.view.editor.cm===e)}findCanvas(e){let t=e.state.values.find(r=>{if(r&&r.node)return r.node});if(t)return this.views.filter(X0).find(r=>r.view.canvas===t.node.canvas)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof Ro).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=J0){let r=this.workspace.getActiveViewOfType(ns.MarkdownView),n=0,s=e.sort((i,l)=>l.view.leaf.activeTime-i.view.leaf.activeTime),a=new Set;for(let i of s)i instanceof Ro&&(i.view===r||a.has(i.document)?(i.canConnect=!0,a.add(i.document)):n<t?(i.canConnect=!0,a.add(i.document),n++):i.canConnect=!1);return n>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${n-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(n=>{let s=e.find(a=>{if(n.document==a.document&&n.view==a.view)return!0});s?(r.push(n),e.remove(s)):t.push(n)}),e.forEach(n=>{r.push(n)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,n=be(r,"debug"),s=(u,d)=>{n(u,d.map(m=>{var p;return{type:m.constructor.name,file:(p=m.document)==null?void 0:p.path,canConnect:m.canConnect}}))};if(n("Refresh"),this.destroyed)return!1;await this.foldersReady();let a=[];try{a=await this.getViews()}catch(u){return this.warn("[System 3][Relay][Live Views] error getting views",u),!1}let i=this.findFolders();if(i.length===0&&a.length===0)return this.extensions.length!==0&&(n("Unexpected plugins loaded."),this.wipe()),s("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?i.forEach(u=>{u.connect()}):this.sharedFolders.forEach(u=>{u.disconnect()});let[l,c]=this.deduplicate(a);if(s("Releasing Views",c),this.releaseViews(c),c.length===0&&Q0(l,this.views)){let u=await this.viewsAttachedWithConnectionPool(this.views);s("Attached Views",u)}else{let u=await this.viewsReady(l);s("Ready Views",u);let d=await this.viewsAttachedWithConnectionPool(u);s("Attached Views",d),this.views=l}n("loading plugins"),this.load();let f=ns.moment.utc();return n(`refresh completed in ${f.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=be(e,"warn"),r=ns.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let n=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=n().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(Ur.init(()=>this)),Cg,Ng,Ig,Lg,Pg]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},Ur=$i.StateField.define({create(o){},update(o,e){return o}});var ss=require("obsidian");function Y0(o){ye(o,"svelte-1siabfk",".system3-folder-icons.svelte-1siabfk{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.system3-icon.svelte-1siabfk{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1siabfk{color:var(--color-accent)}span.system3-disconnected.svelte-1siabfk{color:var(--color-base-40)}span.notebook.svelte-1siabfk{color:var(--color-accent)}span.hidden.svelte-1siabfk{display:none}.system3-progress-text.svelte-1siabfk{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1siabfk{animation:svelte-1siabfk-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1siabfk{color:var(--color-red)}@keyframes svelte-1siabfk-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function Hg(o){let e,t,r,n;return{c(){e=C("span"),t=B(o[3]),r=B("%"),h(e,"class",n="system3-progress-text system3-"+o[4]+" svelte-1siabfk"),ne(e,"opacity","1")},m(s,a){_(s,e,a),w(e,t),w(e,r)},p(s,a){a&8&&X(t,s[3]),a&16&&n!==(n="system3-progress-text system3-"+s[4]+" svelte-1siabfk")&&h(e,"class",n)},d(s){s&&v(e)}}}function Z0(o){let e,t,r;return t=new io({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=C("span"),R(t.$$.fragment),h(e,"class","notebook system3-icon svelte-1siabfk"),h(e,"aria-label","Tracking Changes")},m(n,s){_(n,e,s),D(t,e,null),r=!0},p:q,i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){k(t.$$.fragment,n),r=!1},d(n){n&&v(e),M(t)}}}function ek(o){let e,t,r,n,s,a,i,l;return t=new io({props:{class:"inline-icon",style:"width: 0.8em"}}),s=new an({props:{class:"inline-icon"}}),{c(){var c;e=C("span"),R(t.$$.fragment),r=E(),n=C("span"),R(s.$$.fragment),h(e,"class","notebook system3-icon hidden svelte-1siabfk"),h(e,"aria-label","Tracking Changes"),h(n,"class",a="satellite system3-icon system3-"+o[0]+" svelte-1siabfk"),h(n,"aria-label",i=`${((c=o[2])==null?void 0:c.relay.name)||"Relay Server"} (${o[0]})`)},m(c,f){_(c,e,f),D(t,e,null),_(c,r,f),_(c,n,f),D(s,n,null),l=!0},p(c,f){var u;(!l||f&1&&a!==(a="satellite system3-icon system3-"+c[0]+" svelte-1siabfk"))&&h(n,"class",a),(!l||f&5&&i!==(i=`${((u=c[2])==null?void 0:u.relay.name)||"Relay Server"} (${c[0]})`))&&h(n,"aria-label",i)},i(c){l||(b(t.$$.fragment,c),b(s.$$.fragment,c),l=!0)},o(c){k(t.$$.fragment,c),k(s.$$.fragment,c),l=!1},d(c){c&&(v(e),v(r),v(n)),M(t),M(s)}}}function tk(o){let e,t,r,n,s,a=o[5]&&Hg(o),i=[ek,Z0],l=[];function c(f,u){return f[1]?0:1}return r=c(o,-1),n=l[r]=i[r](o),{c(){e=C("div"),a&&a.c(),t=E(),n.c(),h(e,"class","system3-folder-icons svelte-1siabfk")},m(f,u){_(f,e,u),a&&a.m(e,null),w(e,t),l[r].m(e,null),s=!0},p(f,[u]){f[5]?a?a.p(f,u):(a=Hg(f),a.c(),a.m(e,t)):a&&(a.d(1),a=null);let d=r;r=c(f,u),r===d?l[r].p(f,u):(se(),k(l[d],1,1,()=>{l[d]=null}),ae(),n=l[r],n?n.p(f,u):(n=l[r]=i[r](f),n.c()),b(n,1),n.m(e,null))},i(f){s||(b(n),s=!0)},o(f){k(n),s=!1},d(f){f&&v(e),a&&a.d(),l[r].d()}}}function rk(o,e,t){let r,{status:n="disconnected"}=e,{relayId:s}=e,{remote:a}=e,{progress:i=0}=e,{syncStatus:l="pending"}=e;return o.$$set=c=>{"status"in c&&t(0,n=c.status),"relayId"in c&&t(1,s=c.relayId),"remote"in c&&t(2,a=c.remote),"progress"in c&&t(3,i=c.progress),"syncStatus"in c&&t(4,l=c.syncStatus)},o.$$.update=()=>{if(o.$$.dirty&24){e:t(5,r=(l!=="completed"||i<100)&&i>0)}},[n,s,a,i,l,r]}var Ou=class extends W{constructor(e){super(),G(this,e,rk,tk,z,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},Y0)}},qg=Ou;function ok(o){ye(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function nk(o){let e,t,r;return{c(){e=C("div"),t=C("span"),r=B(o[0]),h(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),h(e,"aria-label",o[1])},m(n,s){_(n,e,s),w(e,t),w(t,r)},p(n,[s]){s&1&&X(r,n[0]),s&2&&h(e,"aria-label",n[1])},i:q,o:q,d(n){n&&v(e)}}}function sk(o,e,t){let{text:r}=e,{label:n}=e;return o.$$set=s=>{"text"in s&&t(0,r=s.text),"label"in s&&t(1,n=s.label)},[r,n]}var Bu=class extends W{constructor(e){super(),G(this,e,sk,nk,z,{text:0,label:1},ok)}},Nu=Bu;function ak(o){ye(o,"svelte-1ljf67u",".system3-uploadpill.svelte-1ljf67u{text-wrap:nowrap}")}function ik(o){let e,t,r,n;return{c(){e=C("div"),t=C("span"),r=B(o[0]),h(e,"class","nav-file-tag system3-uploadpill svelte-1ljf67u"),h(e,"aria-label",o[1]),h(e,"style",n=o[2]?`color:${o[2]}`:"")},m(s,a){_(s,e,a),w(e,t),w(t,r)},p(s,[a]){a&1&&X(r,s[0]),a&2&&h(e,"aria-label",s[1]),a&4&&n!==(n=s[2]?`color:${s[2]}`:"")&&h(e,"style",n)},i:q,o:q,d(s){s&&v(e)}}}function lk(o,e,t){let{text:r}=e,{label:n}=e,{color:s}=e;return o.$$set=a=>{"text"in a&&t(0,r=a.text),"label"in a&&t(1,n=a.label),"color"in a&&t(2,s=a.color)},[r,n,s]}var Hu=class extends W{constructor(e){super(),G(this,e,lk,ik,z,{text:0,label:1,color:2},ak)}},Vg=Hu;var qu=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,n)=>{for(let s of r)s.type==="childList"&&e.nextSibling&&(t(e),n.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},fo=class{visitFolder(e,t,r,n){return null}visitFile(e,t,r,n){return null}},Vu=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new qu(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},zu=class extends fo{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new Vu(t.selfEl,n):(r&&r.destroy(),null)}},Wu=class{constructor(e,t){this.sharedFolder=t;let r=e.querySelectorAll(".system3-folder-icons");r.length>1&&(r==null||r.forEach(s=>{s.remove()})),this.el=e,this.el.addClass("system3-pill"),this.pill=new qg({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let n=[];n.push(this.sharedFolder.subscribe(this.el,s=>{this.pill.$set({status:s.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),n.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,s=>{s&&this.pill.$set({progress:s.percent,syncStatus:s.status})})),this.unsubscribe=()=>n.forEach(s=>s())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},Ku=class extends fo{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new Wu(t.selfEl,n):(r&&r.destroy(),null)}},Gu=class{constructor(e,t,r,n){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=n;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},ju=class extends fo{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,n,s){return s&&s.ready&&s.checkPath(t.path)&&ot.checkExtension(t.path)?n||new Gu(r.el,t.path,this.activeSync,this.activeDownloads):(n&&n.destroy(),null)}},Ju=class{constructor(e,t){this.el=e;this.file=t;this.unsubscribes=[];this.el.querySelectorAll(".system3-uploadpill").forEach(r=>{r.remove()}),this.unsubscribes.push(this.file.subscribe(()=>{this.setText()}))}setText(){var e;if(this.file){if(this.file.inMeta){(e=this.pill)==null||e.$destroy();return}this.pill?this.pill.$set({text:this.file.tag}):this.pill=new Vg({target:this.el,props:{text:this.file.tag}})}}destroy(){var e;this.unsubscribes.forEach(t=>t()),this.el.querySelectorAll(".system3-uploadpill").forEach(t=>{t.remove()}),(e=this.pill)==null||e.$destroy(),this.file=null}},Qu=class extends fo{visitFile(e,t,r,n){if(n&&!ot.checkExtension(e.path)&&!Je.checkExtension(e.path)&&n.isSyncableTFile(e)&&n.ready&&n.connected){let s=n.proxy.viewSyncFile(e.path);if(s&&ir(s))return r&&r.file===s?r:new Ju(t.selfEl,s)}return r&&r.destroy(),null}},Xu=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new Nu({target:this.el,props:{text:"NOT SYNCED",label:"Syncing this file type is disabled"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},Yu=class extends fo{visitFile(e,t,r,n){return n&&n.checkPath(e.path)&&!n.isSyncableTFile(e)?r||new Xu(t.selfEl):(r&&r.destroy(),null)}},Zu=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,n=>{this.docStatus(n)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},ed=class extends fo{visitFile(e,t,r,n){if(n)try{let s=n.getVirtualPath(e.path),a=n.syncStore.get(s);if(!a)return null;let i=n.files.get(a);return!(i instanceof ot)||!i?null:r||new Zu(t.el,i,e)}catch(s){return null}return r&&r.destroy(),null}},td=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new Nu({target:this.el,props:{text:"DESYNC",label:"File content does not match document content"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},rd=class extends fo{visitFile(e,t,r,n){if(n&&ot.checkExtension(e.path)){let s=n.proxy.viewDoc(e.path);if(!s||!s.ready)return null;if(e.stat.size!==s.stat.size)return r||new td(t.selfEl)}return r&&r.destroy(),null}},Ui=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let n of this.visitors)this.storage.set(n,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(s=>s.path===e.path)||t,n=this.getFileExplorerItem(this.fileExplorer,e);n&&this.storage.forEach((s,a)=>{let i=s.get(n),l=a.visitFolder(e,n,i,r);i&&!l?s.delete(n):l&&s.set(n,l)}),e.children.forEach(s=>{if(s instanceof ss.TFolder)this.walk(s,r);else if(s instanceof ss.TFile){let a=this.getFileExplorerItem(this.fileExplorer,s);if(!a)return;this.storage.forEach((i,l)=>{let c=i.get(a),f=l.visitFile(s,a,c,r);c&&!f?i.delete(a):f&&i.set(a,f)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},Oi=class{constructor(e,t,r,n){this.layoutReady=!1;this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=n,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.unsubscribes=[],this.unsubscribes.push(n.activeSync.subscribe(()=>this.quickRefresh()),n.activeDownloads.subscribe(()=>this.quickRefresh()),n.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(s=>{Rh([Dr.enableDocumentStatus],()=>{this.offDocumentListeners.get(s)||this.offDocumentListeners.set(s,s.fset.on(()=>{this.refresh()}))}),s.whenReady().then(()=>{this.refresh()}),this.unsubscribes.push(s.syncSettingsManager.subscribe(a=>{this.quickRefresh()})),this.unsubscribes.push(s.subscribe(this,()=>{this.quickRefresh()})),this.unsubscribes.push(s.syncStore.subscribe(a=>{this.quickRefresh()}))}),this.refresh()}),this.offLayoutChange=(()=>{let s=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(s)}})()}makeVisitors(){let e=[];return e.push(new zu),e.push(new Ku),to(Dr.enableDocumentStatus,()=>{e.push(new ed),e.push(new ju(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),e.push(new Qu),to(Dr.enableDesyncPill,()=>{e.push(new rd)}),e.push(new Yu),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let n=this.treeState.get(r)||new Ui(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,n);for(let s of t){let a=this.vault.getAbstractFileByPath(s);a instanceof ss.TFolder&&n.walk(a)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new Ui(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let n=this.vault.getAbstractFileByPath("/");n instanceof ss.TFolder&&r.walk(n)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.unsubscribes.forEach(t=>t()),this.unsubscribes.length=0,this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var ax=require("obsidian");function De(o,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function i(f){try{c(r.next(f))}catch(u){a(u)}}function l(f){try{c(r.throw(f))}catch(u){a(u)}}function c(f){f.done?s(f.value):n(f.value).then(i,l)}c((r=r.apply(o,e||[])).next())})}var Uo=require("obsidian");function ck(o){let e,t,r;return{c(){e=br("svg"),t=br("g"),r=br("path"),h(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),h(r,"fill","#5865F2"),h(r,"fill-rule","nonzero"),h(e,"width",o[0]),h(e,"height",o[0]),h(e,"viewBox","0 -28.5 256 256"),h(e,"version","1.1"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),h(e,"preserveAspectRatio","xMidYMid")},m(n,s){_(n,e,s),w(e,t),w(t,r)},p(n,[s]){s&1&&h(e,"width",n[0]),s&1&&h(e,"height",n[0])},i:q,o:q,d(n){n&&v(e)}}}function fk(o,e,t){let{size:r="1em"}=e;return o.$$set=n=>{"size"in n&&t(0,r=n.size)},[r]}var od=class extends W{constructor(e){super(),G(this,e,fk,ck,z,{size:0})}},Bi=od;function uk(o){ye(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function zg(o){let e,t,r,n,s,a,i,l,c,f,u,d,m;return i=new Bi({props:{size:20}}),{c(){e=C("div"),t=C("div"),r=E(),n=C("div"),s=C("span"),a=C("a"),R(i.$$.fragment),l=E(),c=C("span"),c.textContent="Join the community",h(t,"class","arrow svelte-4t8k3t"),h(a,"href","https://discord.system3.md"),h(a,"target","_blank"),h(a,"rel","noopener noreferrer"),h(a,"class","menu-item svelte-4t8k3t"),ne(s,"text-align","center"),ne(s,"display","flex"),h(n,"class","menu-content svelte-4t8k3t"),h(e,"class","menu-dropdown svelte-4t8k3t")},m(p,x){_(p,e,x),w(e,t),w(e,r),w(e,n),w(n,s),w(s,a),D(i,a,null),w(a,l),w(a,c),u=!0,d||(m=xi(f=o[1].call(null,e)),d=!0)},i(p){u||(b(i.$$.fragment,p),u=!0)},o(p){k(i.$$.fragment,p),u=!1},d(p){p&&v(e),M(i),d=!1,m()}}}function dk(o){let e,t,r,n,s,a,i;r=new ou({props:{size:"20px"}});let l=o[0]&&zg(o);return{c(){e=C("div"),t=C("button"),R(r.$$.fragment),n=E(),l&&l.c(),h(t,"class","menu-button svelte-4t8k3t"),h(e,"class","menu-container svelte-4t8k3t")},m(c,f){_(c,e,f),w(e,t),D(r,t,null),w(e,n),l&&l.m(e,null),s=!0,a||(i=K(t,"click",ug(o[2])),a=!0)},p(c,[f]){c[0]?l?f&1&&b(l,1):(l=zg(c),l.c(),b(l,1),l.m(e,null)):l&&(se(),k(l,1,1,()=>{l=null}),ae())},i(c){s||(b(r.$$.fragment,c),b(l),s=!0)},o(c){k(r.$$.fragment,c),k(l),s=!1},d(c){c&&v(e),M(r),l&&l.d(),a=!1,i()}}}function pk(o,e,t){let r=!1;function n(a){let i=l=>{let c=document.querySelector(".menu-button");!a.contains(l.target)&&l.target!==c&&!(c!=null&&c.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",i)},0),{destroy(){document.removeEventListener("click",i)}}}function s(a){a.stopPropagation(),t(0,r=!r)}return[r,n,s]}var nd=class extends W{constructor(e){super(),G(this,e,pk,dk,z,{},uk)}},Wg=nd;function mk(o){ye(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function hk(o){let e,t;return{c(){e=br("svg"),t=br("path"),h(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),h(e,"class","relay-text svelte-ycfe1d"),h(e,"width",o[0]),h(e,"height",o[1]),h(e,"viewBox","0 0 154.24573 66.293579"),h(e,"xmlns","http://www.w3.org/2000/svg")},m(r,n){_(r,e,n),w(e,t)},p:q,i:q,o:q,d(r){r&&v(e)}}}function gk(o,e,t){let{size:r=64}=e,n=r,s=r/2;return o.$$set=a=>{"size"in a&&t(2,r=a.size)},[n,s,r]}var sd=class extends W{constructor(e){super(),G(this,e,gk,hk,z,{size:2},mk)}},Ni=sd;function yk(o){ye(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function xk(o){let e,t,r,n,s,a;return e=new Ni({props:{size:140}}),{c(){R(e.$$.fragment),t=E(),r=C("p"),r.textContent="Real-time collaboration in Obsidian",n=E(),s=C("p"),s.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,h(r,"class","subtitle svelte-120r7kg"),h(s,"class","description svelte-120r7kg")},m(i,l){D(e,i,l),_(i,t,l),_(i,r,l),_(i,n,l),_(i,s,l),a=!0},p:q,i(i){a||(b(e.$$.fragment,i),a=!0)},o(i){k(e.$$.fragment,i),a=!1},d(i){i&&(v(t),v(r),v(n),v(s)),M(e,i)}}}var ad=class extends W{constructor(e){super(),G(this,e,null,xk,z,{},yk)}},Kg=ad;var Hi=require("obsidian");function bk(o){ye(o,"svelte-1kvxms3",`.help-section.svelte-1kvxms3{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1kvxms3{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1kvxms3{position:relative;max-width:640px;margin:0 auto}.why-google.svelte-1kvxms3:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-google.svelte-1kvxms3{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-google.svelte-1kvxms3:hover{color:var(--text-normal)}.help-content.svelte-1kvxms3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1kvxms3{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1kvxms3{opacity:1;visibility:visible}.popover.svelte-1kvxms3:not(.visible){transition-delay:0s}.arrow.svelte-1kvxms3{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1kvxms3{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function vk(o){let e,t,r,n;return{c(){e=C("div"),t=C("div"),r=E(),n=C("p"),n.textContent=`${jg}`,h(t,"class","arrow svelte-1kvxms3"),h(e,"class","popover svelte-1kvxms3"),Ae(e,"visible",o[0])},m(s,a){_(s,e,a),w(e,t),w(e,r),w(e,n),o[9](e)},p(s,a){a&1&&Ae(e,"visible",s[0])},d(s){s&&v(e),o[9](null)}}}function wk(o){let e,t=o[0]&&Gg(o);return{c(){t&&t.c(),e=he()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[0]?t?t.p(r,n):(t=Gg(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&v(e),t&&t.d(r)}}}function Gg(o){let e,t;return{c(){e=C("div"),t=C("p"),t.textContent=`${jg}`,h(e,"class","help-content svelte-1kvxms3")},m(r,n){_(r,e,n),w(e,t)},p:q,d(r){r&&v(e)}}}function _k(o){let e,t,r,n,s,a,i,l,c,f,u,d;function m(y,g){return y[1]?wk:vk}let p=m(o,-1),x=p(o);return l=new Bi({}),{c(){e=C("div"),t=C("div"),r=C("button"),r.textContent="Why sign in with Google?",n=E(),x.c(),s=E(),a=C("div"),i=C("a"),R(l.$$.fragment),c=B(`
		Join the project on Discord`),h(r,"class","why-google svelte-1kvxms3"),Ae(r,"mobile",o[1]),h(t,"class","help-container svelte-1kvxms3"),h(e,"class","help-section svelte-1kvxms3"),h(i,"href","https://discord.system3.md"),h(i,"class","discord-link svelte-1kvxms3"),h(a,"class","footer svelte-1kvxms3")},m(y,g){_(y,e,g),w(e,t),w(t,r),o[8](r),w(t,n),x.m(t,null),_(y,s,g),_(y,a,g),w(a,i),D(l,i,null),w(i,c),f=!0,u||(d=[K(r,"mouseenter",o[4]),K(r,"mouseleave",o[5]),K(r,"click",o[6])],u=!0)},p(y,[g]){(!f||g&2)&&Ae(r,"mobile",y[1]),p===(p=m(y,g))&&x?x.p(y,g):(x.d(1),x=p(y),x&&(x.c(),x.m(t,null)))},i(y){f||(b(l.$$.fragment,y),f=!0)},o(y){k(l.$$.fragment,y),f=!1},d(y){y&&(v(e),v(s),v(a)),o[8](null),x.d(),M(l),u=!1,me(d)}}}var jg="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. An identity provider like Google helps to prevent spam accounts. We may add more sign-in options based on user feedback \u2014 let us know in Discord.";function Sk(o,e,t){var r;let n=!1,s=!1,a,i;function l(){s||t(0,n=!0)}function c(){s||t(0,n=!1)}function f(){s&&t(0,n=!n)}function u(m){Ot[m?"unshift":"push"](()=>{a=m,t(2,a)})}function d(m){Ot[m?"unshift":"push"](()=>{i=m,t(3,i)})}return o.$$.update=()=>{if(o.$$.dirty&128){e:t(1,s=t(7,r=Hi.Platform===null||Hi.Platform===void 0?void 0:Hi.Platform.isMobile)!==null&&r!==void 0?r:!1)}},[n,s,a,i,l,c,f,r,u,d]}var id=class extends W{constructor(e){super(),G(this,e,Sk,_k,z,{},bk)}},Jg=id;var Qg=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],qi=class{constructor(e,t,r,n,s){this.id=e;this.name=t;this.email=r;this.picture=n;this.token=s;this.color=Qg[vs()%Qg.length]}};function kk(o){ye(o,"svelte-18fffd7",".avatar.svelte-18fffd7.svelte-18fffd7{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.avatar.svelte-18fffd7>img.svelte-18fffd7{margin:0px}.initial.svelte-18fffd7.svelte-18fffd7{color:var(--text-on-accent)}img.svelte-18fffd7.svelte-18fffd7{width:100%;height:100%;object-fit:cover}")}function Ck(o){let e,t;return{c(){e=C("span"),t=B(o[5]),h(e,"class","initial svelte-18fffd7"),ne(e,"font-size",o[4])},m(r,n){_(r,e,n),w(e,t)},p(r,n){n&32&&X(t,r[5]),n&16&&ne(e,"font-size",r[4])},d(r){r&&v(e)}}}function Ik(o){let e,t,r,n;return{c(){e=C("img"),Cf(e.src,t=o[0].picture)||h(e,"src",t),h(e,"alt",o[1]),h(e,"referrerpolicy","no-referrer"),h(e,"class","svelte-18fffd7")},m(s,a){_(s,e,a),r||(n=K(e,"error",o[6]),r=!0)},p(s,a){a&1&&!Cf(e.src,t=s[0].picture)&&h(e,"src",t),a&2&&h(e,"alt",s[1])},d(s){s&&v(e),r=!1,n()}}}function Lk(o){let e;function t(s,a){return!s[3]&&s[0].picture?Ik:Ck}let r=t(o,-1),n=r(o);return{c(){e=C("div"),n.c(),h(e,"class","avatar svelte-18fffd7"),ne(e,"width",o[2]),ne(e,"height",o[2])},m(s,a){_(s,e,a),n.m(e,null)},p(s,[a]){r===(r=t(s,a))&&n?n.p(s,a):(n.d(1),n=r(s),n&&(n.c(),n.m(e,null))),a&4&&ne(e,"width",s[2]),a&4&&ne(e,"height",s[2])},i:q,o:q,d(s){s&&v(e),n.d()}}}function Tk(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function Pk(o,e,t){let r,n,s,{user:a}=e,{alt:i="Profile picture"}=e,{size:l="40px"}=e,c=!1;function f(){t(3,c=!0)}return o.$$set=u=>{"user"in u&&t(0,a=u.user),"alt"in u&&t(1,i=u.alt),"size"in u&&t(2,l=u.size)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(5,r=a.name?a.name.charAt(0).toUpperCase():"?")}if(o.$$.dirty&4){e:t(7,n=Tk(l))}if(o.$$.dirty&132){e:t(4,s=`${parseFloat(l)/2}${n}`)}},[a,i,l,c,s,r,f,n]}var ld=class extends W{constructor(e){super(),G(this,e,Pk,Lk,z,{user:0,alt:1,size:2},kk)}},Xg=ld;var iO=require("obsidian");function Fk(o){ye(o,"svelte-zlums1",".setting-item-control.svelte-zlums1{width:unset !important;margin-top:unset !important}.setting-item.svelte-zlums1{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-zlums1{min-width:0;margin-top:auto;margin-bottom:auto}")}function Ak(o){let e,t,r,n,s,a=(o[0].name||"")+"",i,l,c,f,u=(o[0].email||"")+"",d,m,p,x;t=new Xg({props:{size:"2.5em",user:o[0]}});let y=o[2].default,g=le(y,o,o[1],null);return{c(){e=C("div"),R(t.$$.fragment),r=E(),n=C("div"),s=C("div"),i=B(a),l=E(),c=C("br"),f=E(),d=B(u),m=E(),p=C("div"),g&&g.c(),h(s,"class","setting-item-description"),h(n,"class","setting-item-info svelte-zlums1"),ne(n,"display","grid"),h(p,"class","setting-item-control svelte-zlums1"),h(e,"class","setting-item svelte-zlums1")},m(I,T){_(I,e,T),D(t,e,null),w(e,r),w(e,n),w(n,s),w(s,i),w(s,l),w(s,c),w(s,f),w(s,d),w(e,m),w(e,p),g&&g.m(p,null),x=!0},p(I,[T]){let P={};T&1&&(P.user=I[0]),t.$set(P),(!x||T&1)&&a!==(a=(I[0].name||"")+"")&&X(i,a),(!x||T&1)&&u!==(u=(I[0].email||"")+"")&&X(d,u),g&&g.p&&(!x||T&2)&&fe(g,y,I,I[1],x?ce(y,I[1],T,null):ue(I[1]),null)},i(I){x||(b(t.$$.fragment,I),b(g,I),x=!0)},o(I){k(t.$$.fragment,I),k(g,I),x=!1},d(I){I&&v(e),M(t),g&&g.d(I)}}}function Ek(o,e,t){let{$$slots:r={},$$scope:n}=e,{user:s}=e;return o.$$set=a=>{"user"in a&&t(0,s=a.user),"$$scope"in a&&t(1,n=a.$$scope)},[s,n,r]}var cd=class extends W{constructor(e){super(),G(this,e,Ek,Ak,z,{user:0},Fk)}},Vi=cd;var zi=require("obsidian");function Dk(o){ye(o,"svelte-5zjjwa",".help-container.svelte-5zjjwa{position:relative;display:inline-block}button.svelte-5zjjwa{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-5zjjwa:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-5zjjwa:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.popover.svelte-5zjjwa{position:absolute;z-index:50;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.popover.left.svelte-5zjjwa{right:100%;margin-right:8px}.popover.right.svelte-5zjjwa{left:0}.arrow.svelte-5zjjwa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-5zjjwa{right:8px}.arrow.right.svelte-5zjjwa{left:8px}p.svelte-5zjjwa{margin:0;color:var(--text-normal)}")}function Yg(o){let e,t,r,n,s;return{c(){e=C("div"),t=C("div"),r=E(),n=C("p"),s=B(o[0]),h(t,"class","arrow svelte-5zjjwa"),Ae(t,"left",o[4]==="left"),Ae(t,"right",o[4]==="right"),h(n,"class","svelte-5zjjwa"),h(e,"class","popover svelte-5zjjwa"),Ae(e,"left",o[4]==="left"),Ae(e,"right",o[4]==="right")},m(a,i){_(a,e,i),w(e,t),w(e,r),w(e,n),w(n,s),o[9](e)},p(a,i){i&16&&Ae(t,"left",a[4]==="left"),i&16&&Ae(t,"right",a[4]==="right"),i&1&&X(s,a[0]),i&16&&Ae(e,"left",a[4]==="left"),i&16&&Ae(e,"right",a[4]==="right")},d(a){a&&v(e),o[9](null)}}}function Mk(o){let e,t,r,n,s,a,i;r=new Xs({props:{size:16}});let l=o[1]&&Yg(o);return{c(){e=C("div"),t=C("button"),R(r.$$.fragment),n=E(),l&&l.c(),h(t,"type","button"),h(t,"class","svelte-5zjjwa"),h(e,"class","help-container svelte-5zjjwa")},m(c,f){_(c,e,f),w(e,t),D(r,t,null),o[8](t),w(e,n),l&&l.m(e,null),s=!0,a||(i=[K(t,"mouseenter",o[5]),K(t,"mouseleave",o[6]),K(t,"click",o[7])],a=!0)},p(c,[f]){c[1]?l?l.p(c,f):(l=Yg(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(c){s||(b(r.$$.fragment,c),s=!0)},o(c){k(r.$$.fragment,c),s=!1},d(c){c&&v(e),M(r),o[8](null),l&&l.d(),a=!1,me(i)}}}function Rk(o,e,t){let{helpText:r}=e,n=!1,s="right",a,i;function l(){t(1,n=!0)}function c(){t(1,n=!1)}function f(){t(1,n=!n)}function u(m){Ot[m?"unshift":"push"](()=>{a=m,t(2,a)})}function d(m){Ot[m?"unshift":"push"](()=>{i=m,t(3,i)})}return o.$$set=m=>{"helpText"in m&&t(0,r=m.helpText)},o.$$.update=()=>{if(o.$$.dirty&14){e:if(n&&a&&i){let m=a.getBoundingClientRect(),p=i.getBoundingClientRect(),x=window.innerWidth;t(4,s=m.right+p.width>x-20?"left":"right")}}},[r,n,a,i,s,l,c,f,u,d]}var fd=class extends W{constructor(e){super(),G(this,e,Rk,Mk,z,{helpText:0},Dk)}},Zg=fd;function $k(o){ye(o,"svelte-1v3t6m3",".setting-item-name.svelte-1v3t6m3{display:flex;align-items:center;gap:8px}.help-button.svelte-1v3t6m3{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-1v3t6m3:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-1v3t6m3:active{color:var(--text-normal)}.help-content.svelte-1v3t6m3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-1v3t6m3{margin:0}")}var Uk=o=>({}),ey=o=>({}),Ok=o=>({}),ty=o=>({}),Bk=o=>({}),ry=o=>({});function Nk(o){let e;return{c(){e=B(o[0])},m(t,r){_(t,e,r)},p(t,r){r&1&&X(e,t[0])},d(t){t&&v(e)}}}function oy(o){let e,t,r,n,s=[qk,Hk],a=[];function i(l,c){return l[3]?0:1}return e=i(o,-1),t=a[e]=s[e](o),{c(){t.c(),r=he()},m(l,c){a[e].m(l,c),_(l,r,c),n=!0},p(l,c){let f=e;e=i(l,c),e===f?a[e].p(l,c):(se(),k(a[f],1,1,()=>{a[f]=null}),ae(),t=a[e],t?t.p(l,c):(t=a[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){k(t),n=!1},d(l){l&&v(r),a[e].d(l)}}}function Hk(o){let e,t;return e=new Zg({props:{helpText:o[1]}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&2&&(s.helpText=r[1]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function qk(o){let e,t,r,n,s;return t=new Xs({props:{size:16}}),{c(){e=C("button"),R(t.$$.fragment),h(e,"class","help-button svelte-1v3t6m3"),h(e,"aria-expanded",o[2])},m(a,i){_(a,e,i),D(t,e,null),r=!0,n||(s=K(e,"click",o[4]),n=!0)},p(a,i){(!r||i&4)&&h(e,"aria-expanded",a[2])},i(a){r||(b(t.$$.fragment,a),r=!0)},o(a){k(t.$$.fragment,a),r=!1},d(a){a&&v(e),M(t),n=!1,s()}}}function Vk(o){let e,t,r=o[7].description,n=le(r,o,o[6],ey);return{c(){e=C("div"),n&&n.c(),h(e,"class","setting-item-description")},m(s,a){_(s,e,a),n&&n.m(e,null),t=!0},p(s,a){n&&n.p&&(!t||a&64)&&fe(n,r,s,s[6],t?ce(r,s[6],a,Uk):ue(s[6]),ey)},i(s){t||(b(n,s),t=!0)},o(s){k(n,s),t=!1},d(s){s&&v(e),n&&n.d(s)}}}function ny(o){let e,t,r;return{c(){e=C("div"),t=C("p"),r=B(o[1]),h(t,"class","svelte-1v3t6m3"),h(e,"class","help-content svelte-1v3t6m3"),Ae(e,"expanded",o[2])},m(n,s){_(n,e,s),w(e,t),w(t,r)},p(n,s){s&2&&X(r,n[1]),s&4&&Ae(e,"expanded",n[2])},d(n){n&&v(e)}}}function zk(o){let e,t,r,n,s,a,i,l,c,f=o[7].name,u=le(f,o,o[6],ry),d=u||Nk(o),m=o[1]&&oy(o),p=o[7].description,x=le(p,o,o[6],ty),y=x||Vk(o),g=o[1]&&o[2]&&o[3]&&ny(o),I=o[7].default,T=le(I,o,o[6],null);return{c(){e=C("div"),t=C("div"),r=C("div"),d&&d.c(),n=E(),m&&m.c(),s=E(),y&&y.c(),a=E(),g&&g.c(),i=E(),l=C("div"),T&&T.c(),h(r,"class","setting-item-name svelte-1v3t6m3"),h(t,"class","setting-item-info"),h(l,"class","setting-item-control"),h(e,"class","setting-item setting-item-heading mod-list-item")},m(P,A){_(P,e,A),w(e,t),w(t,r),d&&d.m(r,null),w(r,n),m&&m.m(r,null),w(t,s),y&&y.m(t,null),w(t,a),g&&g.m(t,null),w(e,i),w(e,l),T&&T.m(l,null),c=!0},p(P,[A]){u?u.p&&(!c||A&64)&&fe(u,f,P,P[6],c?ce(f,P[6],A,Bk):ue(P[6]),ry):d&&d.p&&(!c||A&1)&&d.p(P,c?A:-1),P[1]?m?(m.p(P,A),A&2&&b(m,1)):(m=oy(P),m.c(),b(m,1),m.m(r,null)):m&&(se(),k(m,1,1,()=>{m=null}),ae()),x?x.p&&(!c||A&64)&&fe(x,p,P,P[6],c?ce(p,P[6],A,Ok):ue(P[6]),ty):y&&y.p&&(!c||A&64)&&y.p(P,c?A:-1),P[1]&&P[2]&&P[3]?g?g.p(P,A):(g=ny(P),g.c(),g.m(t,null)):g&&(g.d(1),g=null),T&&T.p&&(!c||A&64)&&fe(T,I,P,P[6],c?ce(I,P[6],A,null):ue(P[6]),null)},i(P){c||(b(d,P),b(m),b(y,P),b(T,P),c=!0)},o(P){k(d,P),k(m),k(y,P),k(T,P),c=!1},d(P){P&&v(e),d&&d.d(P),m&&m.d(),y&&y.d(P),g&&g.d(),T&&T.d(P)}}}function Wk(o,e,t){let{$$slots:r={},$$scope:n}=e;var s;let{name:a=""}=e,{helpText:i=void 0}=e,l=!1,c=!1;function f(){c&&t(2,l=!l)}return o.$$set=u=>{"name"in u&&t(0,a=u.name),"helpText"in u&&t(1,i=u.helpText),"$$scope"in u&&t(6,n=u.$$scope)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,c=t(5,s=zi.Platform===null||zi.Platform===void 0?void 0:zi.Platform.isMobile)!==null&&s!==void 0?s:!1)}},[a,i,l,c,f,s,n,r]}var ud=class extends W{constructor(e){super(),G(this,e,Wk,zk,z,{name:0,helpText:1},$k)}},Me=ud;var as=[];function Kk(o,e){return{subscribe:de(o,e).subscribe}}function de(o,e=q){let t,r=new Set;function n(i){if(z(o,i)&&(o=i,t)){let l=!as.length;for(let c of r)c[1](),as.push(c,o);if(l){for(let c=0;c<as.length;c+=2)as[c][0](as[c+1]);as.length=0}}}function s(i){n(i(o))}function a(i,l=q){let c=[i,l];return r.add(c),r.size===1&&(t=e(n,s)||q),i(o),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:n,update:s,subscribe:a}}function wr(o,e,t){let r=!Array.isArray(o),n=r?[o]:o;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let s=e.length<2;return Kk(t,(a,i)=>{let l=!1,c=[],f=0,u=q,d=()=>{if(f)return;u();let p=e(r?c[0]:c,a,i);s?a(p):u=Be(p)?p:q},m=n.map((p,x)=>Pt(p,y=>{c[x]=y,f&=~(1<<x),l&&d()},()=>{f|=1<<x}));return l=!0,d(),function(){me(m),u(),l=!1}})}function Gk(o){ye(o,"svelte-xcpzqp",`.continue.svelte-xcpzqp{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-xcpzqp{color:var(--text-muted)}.link.svelte-xcpzqp:hover{color:var(--text-normal)}.not-working.svelte-xcpzqp{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-xcpzqp{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-xcpzqp:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-xcpzqp{height:auto;padding:0;color:var(--text-faint)}.welcome.svelte-xcpzqp{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-xcpzqp{height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-xcpzqp:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-xcpzqp:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}`)}function jk(o){let e,t,r,n,s,a,i;t=new Kg({});function l(p,x){return p[3]?Xk:Qk}let c=l(o,[-1,-1]),f=c(o);function u(p,x){if(p[5])return Zk;if(p[4])return Yk}let d=u(o,[-1,-1]),m=d&&d(o);return a=new Jg({}),{c(){e=C("div"),R(t.$$.fragment),r=E(),f.c(),n=E(),m&&m.c(),s=E(),R(a.$$.fragment),h(e,"class","welcome svelte-xcpzqp")},m(p,x){_(p,e,x),D(t,e,null),w(e,r),f.m(e,null),w(e,n),m&&m.m(e,null),_(p,s,x),D(a,p,x),i=!0},p(p,x){c===(c=l(p,x))&&f?f.p(p,x):(f.d(1),f=c(p),f&&(f.c(),f.m(e,n))),d===(d=u(p,x))&&m?m.p(p,x):(m&&m.d(1),m=d&&d(p),m&&(m.c(),m.m(e,null)))},i(p){i||(b(t.$$.fragment,p),b(a.$$.fragment,p),i=!0)},o(p){k(t.$$.fragment,p),k(a.$$.fragment,p),i=!1},d(p){p&&(v(e),v(s)),M(t),f.d(),m&&m.d(),M(a,p)}}}function Jk(o){let e,t,r,n,s,a,i;e=new Me({props:{$$slots:{name:[tC],default:[eC]},$$scope:{ctx:o}}}),r=new Me({props:{name:"Account"}}),s=new Vi({props:{user:o[2].user,$$slots:{default:[rC]},$$scope:{ctx:o}}});let l=o[18].default,c=le(l,o,o[25],null);return{c(){R(e.$$.fragment),t=E(),R(r.$$.fragment),n=E(),R(s.$$.fragment),a=E(),c&&c.c()},m(f,u){D(e,f,u),_(f,t,u),D(r,f,u),_(f,n,u),D(s,f,u),_(f,a,u),c&&c.m(f,u),i=!0},p(f,u){let d={};u[0]&33554432&&(d.$$scope={dirty:u,ctx:f}),e.$set(d);let m={};u[0]&4&&(m.user=f[2].user),u[0]&33554432&&(m.$$scope={dirty:u,ctx:f}),s.$set(m),c&&c.p&&(!i||u[0]&33554432)&&fe(c,l,f,f[25],i?ce(l,f[25],u,null):ue(f[25]),null)},i(f){i||(b(e.$$.fragment,f),b(r.$$.fragment,f),b(s.$$.fragment,f),b(c,f),i=!0)},o(f){k(e.$$.fragment,f),k(r.$$.fragment,f),k(s.$$.fragment,f),k(c,f),i=!1},d(f){f&&(v(t),v(n),v(a)),M(e,f),M(r,f),M(s,f),c&&c.d(f)}}}function Qk(o){let e,t,r,n,s;return{c(){e=C("a"),t=C("button"),r=B("Sign in with Google"),h(t,"class","google-sign-in-button svelte-xcpzqp"),t.disabled=o[4],h(e,"href",o[1]),h(e,"target","_blank")},m(a,i){_(a,e,i),w(e,t),w(t,r),n||(s=K(t,"click",o[21]),n=!0)},p(a,i){i[0]&16&&(t.disabled=a[4]),i[0]&2&&h(e,"href",a[1])},d(a){a&&v(e),n=!1,s()}}}function Xk(o){let e,t,r,n;return{c(){e=C("button"),t=B("Sign in with Google"),h(e,"class","google-sign-in-button svelte-xcpzqp"),e.disabled=o[4]},m(s,a){_(s,e,a),w(e,t),r||(n=K(e,"click",(0,Uo.debounce)(o[20])),r=!0)},p(s,a){a[0]&16&&(e.disabled=s[4])},d(s){s&&v(e),r=!1,n()}}}function Yk(o){let e,t,r,n,s,a,i,l;return{c(){e=C("div"),t=C("p"),t.textContent="Continue in your browser...",r=E(),n=C("p"),s=B(`Not working?
					`),a=C("button"),a.textContent="(try again)",h(t,"class","continue svelte-xcpzqp"),h(a,"class","link link-button svelte-xcpzqp"),h(n,"class","not-working svelte-xcpzqp")},m(c,f){_(c,e,f),w(e,t),w(e,r),w(e,n),w(n,s),w(n,a),i||(l=K(a,"click",o[24]),i=!0)},p:q,d(c){c&&v(e),i=!1,l()}}}function Zk(o){let e,t,r,n,s,a,i,l,c,f,u,d=o[6]&&sy(o);return{c(){e=C("p"),t=B(o[5]),r=B("."),n=C("br"),s=E(),d&&d.c(),a=E(),i=C("p"),l=B(`Not working?
				`),c=C("button"),c.textContent="(try again)",h(c,"class","link link-button svelte-xcpzqp"),h(i,"class","not-working svelte-xcpzqp")},m(m,p){_(m,e,p),w(e,t),w(e,r),w(e,n),w(e,s),d&&d.m(e,null),_(m,a,p),_(m,i,p),w(i,l),w(i,c),f||(u=K(c,"click",o[23]),f=!0)},p(m,p){p[0]&32&&X(t,m[5]),m[6]?d?d.p(m,p):(d=sy(m),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},d(m){m&&(v(e),v(a),v(i)),d&&d.d(),f=!1,u()}}}function sy(o){let e,t,r,n;return{c(){e=B("Already logged in? "),t=C("button"),t.textContent="(click here)",h(t,"class","link link-button svelte-xcpzqp")},m(s,a){_(s,e,a),_(s,t,a),r||(n=K(t,"click",(0,Uo.debounce)(o[22])),r=!0)},p:q,d(s){s&&(v(e),v(t)),r=!1,n()}}}function eC(o){let e,t;return e=new Wg({}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function tC(o){let e,t;return e=new Ni({props:{slot:"name"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p:q,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function rC(o){let e,t,r;return{c(){e=C("button"),e.textContent="Logout"},m(n,s){_(n,e,s),t||(r=K(e,"click",(0,Uo.debounce)(o[19])),t=!0)},p:q,d(n){n&&v(e),t=!1,r()}}}function oC(o){let e,t,r,n,s=[Jk,jk],a=[];function i(l,c){return l[2].hasUser&&l[2].user?0:1}return e=i(o,[-1,-1]),t=a[e]=s[e](o),{c(){t.c(),r=he()},m(l,c){a[e].m(l,c),_(l,r,c),n=!0},p(l,c){let f=e;e=i(l,c),e===f?a[e].p(l,c):(se(),k(a[f],1,1,()=>{a[f]=null}),ae(),t=a[e],t?t.p(l,c):(t=a[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){k(t),n=!1},d(l){l&&v(r),a[e].d(l)}}}function nC(o,e,t){let r,n,s,a=q,i=()=>(a(),a=Pt(x,re=>t(2,s=re)),x),l,c,f,u;o.$$.on_destroy.push(()=>a());let{$$slots:d={},$$scope:m}=e,{plugin:p}=e,x,y=de(!Uo.Platform.isIosApp);ie(o,y,re=>t(3,l=re));let g=de(!1);ie(o,g,re=>t(4,c=re)),i(x=p.loginManager);let I=de(!1);ie(o,I,re=>t(6,u=re));let T=de(!1),P=de(!0);ie(o,P,re=>t(28,r=re));let A=de("please wait...");ie(o,A,re=>t(1,n=re));let F,S,L=de("");ie(o,L,re=>t(5,f=re));function $(){return De(this,void 0,void 0,function*(){p.loginManager.logout(),T.set(!1),I.set(!1)})}function O(){return De(this,void 0,void 0,function*(){try{yield p.loginManager.login()}catch(re){y.set(!1),T.set(!1),n&&n!=="please wait..."&&(window.open(n,"_blank"),oe())}})}let Q=de(p.loginManager.pb);function U(){Q.set(p.loginManager.pb)}function V(){try{let re=r?nt:fetch;F=void 0,A.set("please wait..."),x.initiateManualOAuth2CodeFlow(re).then(([Y,xe,$e])=>{F=xe,S=$e,A.set(Y)}).catch(Y=>{let xe=Y.message;throw xe=xe,L.set(xe),T.set(!1),Y})}catch(re){L.set(re.message)}}Ft(()=>{T.set(!1),V()});function oe(){return De(this,void 0,void 0,function*(){if(!(!F||!S))return yield p.loginManager.poll(F,S).then(re=>{T.set(!0),g.set(!1),L.set("")}).catch(re=>{I.set(!0),g.set(!1),T.set(!1),L.set(re.message)})})}function ve(re){let Y=re.target;Y.focus(),Y.select(),navigator.clipboard.writeText(Y.value).then(()=>new Uo.Notice("Invite link copied")).catch(xe=>{}),oe()}let N=()=>{$()},j=async()=>{g.set(!0),await O()},_e=()=>{g.set(!0),oe()},Ne=()=>{oe()},Ee=()=>{g.set(!1),y.set(!1),L.set(""),V()},te=()=>{g.set(!1),y.set(!1)};return o.$$set=re=>{"plugin"in re&&t(17,p=re.plugin),"$$scope"in re&&t(25,m=re.$$scope)},[x,n,s,l,c,f,u,y,g,I,P,A,L,$,O,V,oe,p,d,N,j,_e,Ne,Ee,te,m]}var dd=class extends W{constructor(e){super(),G(this,e,nC,oC,z,{plugin:17},Gk,[-1,-1])}},ay=dd;function iy(o,e,t){let r=o.slice();return r[5]=e[t],r}var sC=o=>({}),ly=o=>({}),aC=o=>({}),cy=o=>({});function iC(o){let e;return{c(){e=B(o[0])},m(t,r){_(t,e,r)},p(t,r){r&1&&X(e,t[0])},d(t){t&&v(e)}}}function lC(o){let e,t=we(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=fy(iy(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=he()},m(n,s){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(n,s);_(n,e,s)},p(n,s){if(s&2){t=we(n[1]);let a;for(a=0;a<t.length;a+=1){let i=iy(n,t,a);r[a]?r[a].p(i,s):(r[a]=fy(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&v(e),He(r,n)}}}function fy(o){let e;return{c(){e=C("div"),e.textContent=`${o[5]} `},m(t,r){_(t,e,r)},p:q,d(t){t&&v(e)}}}function cC(o){let e,t=o[1].length>0&&lC(o);return{c(){t&&t.c(),e=he()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[1].length>0&&t.p(r,n)},d(r){r&&v(e),t&&t.d(r)}}}function fC(o){let e,t,r,n,s,a,i,l,c=o[4].name,f=le(c,o,o[3],cy),u=f||iC(o),d=o[4].description,m=le(d,o,o[3],ly),p=m||cC(o),x=o[4].default,y=le(x,o,o[3],null);return{c(){e=C("div"),t=C("div"),r=C("div"),u&&u.c(),n=E(),s=C("div"),p&&p.c(),a=E(),i=C("div"),y&&y.c(),h(r,"class","setting-item-name"),ne(r,"display","grid"),ne(r,"align-items","center"),h(s,"class","setting-item-description"),h(t,"class","setting-item-info"),ne(t,"display","grid"),h(i,"class","setting-item-control"),h(e,"class","setting-item")},m(g,I){_(g,e,I),w(e,t),w(t,r),u&&u.m(r,null),w(t,n),w(t,s),p&&p.m(s,null),w(e,a),w(e,i),y&&y.m(i,null),l=!0},p(g,[I]){f?f.p&&(!l||I&8)&&fe(f,c,g,g[3],l?ce(c,g[3],I,aC):ue(g[3]),cy):u&&u.p&&(!l||I&1)&&u.p(g,l?I:-1),m&&m.p&&(!l||I&8)&&fe(m,d,g,g[3],l?ce(d,g[3],I,sC):ue(g[3]),ly),y&&y.p&&(!l||I&8)&&fe(y,x,g,g[3],l?ce(x,g[3],I,null):ue(g[3]),null)},i(g){l||(b(u,g),b(p,g),b(y,g),l=!0)},o(g){k(u,g),k(p,g),k(y,g),l=!1},d(g){g&&v(e),u&&u.d(g),p&&p.d(g),y&&y.d(g)}}}function uC(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:a}=e,i=a!==void 0?a.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,s=l.name),"description"in l&&t(2,a=l.description),"$$scope"in l&&t(3,n=l.$$scope)},[s,i,a,n,r]}var pd=class extends W{constructor(e){super(),G(this,e,uC,fC,z,{name:0,description:2})}},Ie=pd;function dC(o){ye(o,"svelte-11hpkul",".setting-item-control.svelte-11hpkul{width:unset !important;margin-top:unset !important}.setting-item.svelte-11hpkul{flex-direction:unset !important}.setting-item-info.svelte-11hpkul{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-11hpkul{min-width:0}.truncate.svelte-11hpkul *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var pC=o=>({}),uy=o=>({}),mC=o=>({}),dy=o=>({});function hC(o){let e;return{c(){e=B(o[0])},m(t,r){_(t,e,r)},p(t,r){r&1&&X(e,t[0])},d(t){t&&v(e)}}}function py(o){let e,t;return{c(){e=C("div"),t=B(o[1]),h(e,"class","setting-item-description")},m(r,n){_(r,e,n),w(e,t)},p(r,n){n&2&&X(t,r[1])},d(r){r&&v(e)}}}function gC(o){let e,t=o[1]&&py(o);return{c(){t&&t.c(),e=he()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[1]?t?t.p(r,n):(t=py(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&v(e),t&&t.d(r)}}}function yC(o){let e,t,r,n,s,a,i,l=o[3].name,c=le(l,o,o[2],dy),f=c||hC(o),u=o[3].description,d=le(u,o,o[2],uy),m=d||gC(o),p=o[3].default,x=le(p,o,o[2],null);return{c(){e=C("div"),t=C("div"),r=C("div"),f&&f.c(),n=E(),m&&m.c(),s=E(),a=C("div"),x&&x.c(),h(r,"class","setting-item-name truncate svelte-11hpkul"),h(t,"class","setting-item-info svelte-11hpkul"),h(a,"class","setting-item-control svelte-11hpkul"),h(e,"class","setting-item mod-list-item svelte-11hpkul")},m(y,g){_(y,e,g),w(e,t),w(t,r),f&&f.m(r,null),w(t,n),m&&m.m(t,null),w(e,s),w(e,a),x&&x.m(a,null),i=!0},p(y,[g]){c?c.p&&(!i||g&4)&&fe(c,l,y,y[2],i?ce(l,y[2],g,mC):ue(y[2]),dy):f&&f.p&&(!i||g&1)&&f.p(y,i?g:-1),d?d.p&&(!i||g&4)&&fe(d,u,y,y[2],i?ce(u,y[2],g,pC):ue(y[2]),uy):m&&m.p&&(!i||g&2)&&m.p(y,i?g:-1),x&&x.p&&(!i||g&4)&&fe(x,p,y,y[2],i?ce(p,y[2],g,null):ue(y[2]),null)},i(y){i||(b(f,y),b(m,y),b(x,y),i=!0)},o(y){k(f,y),k(m,y),k(x,y),i=!1},d(y){y&&v(e),f&&f.d(y),m&&m.d(y),x&&x.d(y)}}}function xC(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:a=""}=e;return o.$$set=i=>{"name"in i&&t(0,s=i.name),"description"in i&&t(1,a=i.description),"$$scope"in i&&t(2,n=i.$$scope)},[s,a,n,r]}var md=class extends W{constructor(e){super(),G(this,e,xC,yC,z,{name:0,description:1},dC)}},ut=md;function bC(o){ye(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function vC(o){let e,t,r,n,s;return t=new du({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){e=C("div"),R(t.$$.fragment),h(e,"class","clickable-icon extra-setting-button svelte-y529x8"),h(e,"aria-label","Options"),h(e,"role","button"),h(e,"tabindex","0")},m(a,i){_(a,e,i),D(t,e,null),r=!0,n||(s=[K(e,"click",o[0]),K(e,"keydown",o[0])],n=!0)},p:q,i(a){r||(b(t.$$.fragment,a),r=!0)},o(a){k(t.$$.fragment,a),r=!1},d(a){a&&v(e),M(t),n=!1,me(s)}}}function wC(o){let e=ft();function t(r){(r instanceof MouseEvent||r instanceof KeyboardEvent&&(r.key==="Enter"||r.key===" "))&&e("settings")}return[t]}var hd=class extends W{constructor(e){super(),G(this,e,wC,vC,z,{},bC)}},fn=hd;function _C(o){let e,t,r,n,s,a;t=new an({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let i=o[3].default,l=le(i,o,o[2],null);return{c(){e=C("span"),R(t.$$.fragment),r=E(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),ne(e,"display","flex"),ne(e,"align-items","center"),ne(e,"width","100%")},m(c,f){_(c,e,f),D(t,e,null),w(e,r),l&&l.m(e,null),n=!0,s||(a=[K(e,"keypress",o[0]),K(e,"click",o[0])],s=!0)},p(c,[f]){l&&l.p&&(!n||f&4)&&fe(l,i,c,c[2],n?ce(i,c[2],f,null):ue(c[2]),null)},i(c){n||(b(t.$$.fragment,c),b(l,c),n=!0)},o(c){k(t.$$.fragment,c),k(l,c),n=!1},d(c){c&&v(e),M(t),l&&l.d(c),s=!1,me(a)}}}function SC(o,e,t){let{$$slots:r={},$$scope:n}=e,{relay:s=void 0}=e,a=ft();function i(){s&&a("manageRelay",{relay:s})}return o.$$set=l=>{"relay"in l&&t(1,s=l.relay),"$$scope"in l&&t(2,n=l.$$scope)},[i,s,n,r]}var gd=class extends W{constructor(e){super(),G(this,e,SC,_C,z,{relay:1})}},Oo=gd;function kC(o){let e,t,r,n,s,a;t=new Qf({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let i=o[3].default,l=le(i,o,o[2],null);return{c(){e=C("span"),R(t.$$.fragment),r=E(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),ne(e,"display","inline-flex"),ne(e,"align-items","center"),ne(e,"width","100%")},m(c,f){_(c,e,f),D(t,e,null),w(e,r),l&&l.m(e,null),n=!0,s||(a=[K(e,"keypress",o[0]),K(e,"click",o[0])],s=!0)},p(c,[f]){l&&l.p&&(!n||f&4)&&fe(l,i,c,c[2],n?ce(i,c[2],f,null):ue(c[2]),null)},i(c){n||(b(t.$$.fragment,c),b(l,c),n=!0)},o(c){k(t.$$.fragment,c),k(l,c),n=!1},d(c){c&&v(e),M(t),l&&l.d(c),s=!1,me(a)}}}function CC(o,e,t){let{$$slots:r={},$$scope:n}=e,{folder:s=void 0}=e,a=ft();function i(){var l;s&&a("manageSharedFolder",{folder:s,relay:(l=s.remote)===null||l===void 0?void 0:l.relay})}return o.$$set=l=>{"folder"in l&&t(1,s=l.folder),"$$scope"in l&&t(2,n=l.$$scope)},[i,s,n,r]}var yd=class extends W{constructor(e){super(),G(this,e,CC,kC,z,{folder:1})}},Br=yd;function IC(o){let e,t=o[0].name+"",r;return{c(){e=C("span"),r=B(t),ne(e,"overflow","hidden"),ne(e,"text-overflow","ellipsis"),ne(e,"white-space","nowrap")},m(n,s){_(n,e,s),w(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&X(r,t)},d(n){n&&v(e)}}}function my(o){let e,t,r,n,s;return t=new $f({props:{size:16,class:"svg-icon"}}),n=new Oo({props:{relay:o[1],$$slots:{default:[LC]},$$scope:{ctx:o}}}),n.$on("manageRelay",o[3]),{c(){e=C("span"),R(t.$$.fragment),r=E(),R(n.$$.fragment),ne(e,"width","16px"),ne(e,"flex-shrink","0"),ne(e,"display","flex"),ne(e,"justify-content","center")},m(a,i){_(a,e,i),D(t,e,null),_(a,r,i),D(n,a,i),s=!0},p(a,i){let l={};i&2&&(l.relay=a[1]),i&17&&(l.$$scope={dirty:i,ctx:a}),n.$set(l)},i(a){s||(b(t.$$.fragment,a),b(n.$$.fragment,a),s=!0)},o(a){k(t.$$.fragment,a),k(n.$$.fragment,a),s=!1},d(a){a&&(v(e),v(r)),M(t),M(n,a)}}}function LC(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=C("span"),r=B(t),ne(e,"flex","1"),ne(e,"min-width","0"),ne(e,"text-overflow","ellipsis"),ne(e,"white-space","nowrap")},m(n,s){_(n,e,s),w(e,r)},p(n,s){s&1&&t!==(t=n[0].remote.relay.name+"")&&X(r,t)},d(n){n&&v(e)}}}function TC(o){let e,t,r,n,s;r=new Br({props:{folder:o[0],$$slots:{default:[IC]},$$scope:{ctx:o}}}),r.$on("manageSharedFolder",o[2]);let a=o[0].remote&&my(o);return{c(){e=C("span"),t=C("span"),R(r.$$.fragment),n=E(),a&&a.c(),ne(t,"display","inline-flex"),ne(t,"align-items","center"),ne(t,"width","200px"),ne(t,"min-width","200px"),ne(t,"flex-shrink","0"),ne(e,"display","inline-flex"),ne(e,"align-items","center"),ne(e,"width","100%"),ne(e,"gap","8px")},m(i,l){_(i,e,l),w(e,t),D(r,t,null),w(e,n),a&&a.m(e,null),s=!0},p(i,[l]){let c={};l&1&&(c.folder=i[0]),l&17&&(c.$$scope={dirty:l,ctx:i}),r.$set(c),i[0].remote?a?(a.p(i,l),l&1&&b(a,1)):(a=my(i),a.c(),b(a,1),a.m(e,null)):a&&(se(),k(a,1,1,()=>{a=null}),ae())},i(i){s||(b(r.$$.fragment,i),b(a),s=!0)},o(i){k(r.$$.fragment,i),k(a),s=!1},d(i){i&&v(e),M(r),a&&a.d()}}}function PC(o,e,t){let{folder:r}=e,{relay:n}=e;function s(i){vr.call(this,o,i)}function a(i){vr.call(this,o,i)}return o.$$set=i=>{"folder"in i&&t(0,r=i.folder),"relay"in i&&t(1,n=i.relay)},[r,n,s,a]}var xd=class extends W{constructor(e){super(),G(this,e,PC,TC,z,{folder:0,relay:1})}},hy=xd;var Hr=require("obsidian");var Nr=require("obsidian");function FC(o){ye(o,"svelte-1fe7ajn",".input-with-icon.svelte-1fe7ajn{position:relative;width:100%}.secret-text-toggle-icon.svelte-1fe7ajn{display:flex;align-items:center;justify-content:center;cursor:pointer;width:24px;height:24px;position:absolute;right:4px;top:50%;transform:translateY(-50%);border-radius:4px}.secret-text-toggle-icon.svelte-1fe7ajn:hover{background-color:var(--background-modifier-hover)}.system3-secret-text.svelte-1fe7ajn{padding-inline-end:28px !important;font-family:monospace !important}.system3-input-invalid.svelte-1fe7ajn{border:1px solid var(--color-red) !important}")}function AC(o){let e,t,r,n;return{c(){e=C("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","password"),e.readOnly=o[3],h(e,"class",t=Eo(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn"),e.disabled=o[1]},m(s,a){_(s,e,a),r||(n=[K(e,"click",function(){Be(o[4]?(0,Nr.debounce)(o[12]):null)&&(o[4]?(0,Nr.debounce)(o[12]):null).apply(this,arguments)}),K(e,"input",o[15]),K(e,"keydown",o[10])],r=!0)},p(s,a){o=s,a&1&&e.value!==o[0]&&(e.value=o[0]),a&4&&h(e,"placeholder",o[2]),a&8&&(e.readOnly=o[3]),a&32&&t!==(t=Eo(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn")&&h(e,"class",t),a&2&&(e.disabled=o[1])},d(s){s&&v(e),r=!1,me(n)}}}function EC(o){let e,t,r,n;return{c(){e=C("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","text"),e.readOnly=o[3],h(e,"class",t=Eo(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn"),e.disabled=o[1]},m(s,a){_(s,e,a),r||(n=[K(e,"click",function(){Be(o[4]?(0,Nr.debounce)(o[12]):null)&&(o[4]?(0,Nr.debounce)(o[12]):null).apply(this,arguments)}),K(e,"input",o[14]),K(e,"keydown",o[10])],r=!0)},p(s,a){o=s,a&1&&e.value!==o[0]&&(e.value=o[0]),a&4&&h(e,"placeholder",o[2]),a&8&&(e.readOnly=o[3]),a&32&&t!==(t=Eo(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn")&&h(e,"class",t),a&2&&(e.disabled=o[1])},d(s){s&&v(e),r=!1,me(n)}}}function DC(o){let e,t,r,n,s,a,i;function l(u,d){return u[6]?EC:AC}let c=l(o,-1),f=c(o);return{c(){e=C("div"),f.c(),t=E(),r=C("div"),h(r,"class","secret-text-toggle-icon svelte-1fe7ajn"),h(r,"role","button"),h(r,"tabindex","0"),h(r,"aria-label",n=o[6]?"Hide text":"Show text"),h(e,"class","input-with-icon svelte-1fe7ajn")},m(u,d){_(u,e,d),f.m(e,null),w(e,t),w(e,r),a||(i=[xi(s=o[11].call(null,r)),K(r,"click",o[16]),K(r,"keypress",o[17])],a=!0)},p(u,[d]){c===(c=l(u,d))&&f?f.p(u,d):(f.d(1),f=c(u),f&&(f.c(),f.m(e,t))),d&64&&n!==(n=u[6]?"Hide text":"Show text")&&h(r,"aria-label",n)},i:q,o:q,d(u){u&&v(e),f.d(),a=!1,me(i)}}}function MC(o,e,t){let r,n,s=ft(),{value:a}=e,{disabled:i=!1}=e,{placeholder:l="please wait..."}=e,{readonly:c=!0}=e,{copyOnClick:f=!0}=e,{successMessage:u="Copied to clipboard"}=e,{invalid:d=!1}=e,m=de(!1);ie(o,m,S=>t(6,r=S));let p=de(!1);ie(o,p,S=>t(19,n=S));let x;function y(S){S.key==="Enter"&&!i&&s("enter")}function g(S){x=S;let L=()=>{n?((0,Nr.setIcon)(S,"clipboard-check"),S.addClass("mod-success")):((0,Nr.setIcon)(S,r?"eye-off":"eye"),S.removeClass("mod-success"))},$=m.subscribe(()=>{L()}),O=p.subscribe(()=>{L()});return L(),{destroy(){$(),O()}}}function I(S){!f||!a||i||navigator.clipboard.writeText(a).then(()=>{new Nr.Notice(u),p.set(!0),setTimeout(()=>{p.set(!1)},800)}).catch(L=>{console.error("Failed to copy: ",L)})}let T=S=>{t(0,a=S.currentTarget.value),s("input",S)},P=S=>{t(0,a=S.currentTarget.value),s("input",S)},A=()=>m.update(S=>!S),F=()=>m.update(S=>!S);return o.$$set=S=>{"value"in S&&t(0,a=S.value),"disabled"in S&&t(1,i=S.disabled),"placeholder"in S&&t(2,l=S.placeholder),"readonly"in S&&t(3,c=S.readonly),"copyOnClick"in S&&t(4,f=S.copyOnClick),"successMessage"in S&&t(13,u=S.successMessage),"invalid"in S&&t(5,d=S.invalid)},[a,i,l,c,f,d,r,s,m,p,y,g,I,u,T,P,A,F]}var bd=class extends W{constructor(e){super(),G(this,e,MC,DC,z,{value:0,disabled:1,placeholder:2,readonly:3,copyOnClick:4,successMessage:13,invalid:5},FC)}},Wi=bd;function RC(o){ye(o,"svelte-gjjmqn","span.faint.svelte-gjjmqn{color:var(--text-faint)}")}function gy(o,e,t){let r=o.slice();return r[23]=e[t],r}function yy(o,e,t){let r=o.slice();return r[26]=e[t],r}function $C(o){let e,t,r,n,s,a,i,l;function c(u){o[13](u)}let f={disabled:o[3],placeholder:"Enter share key",readonly:!1,copyOnClick:!1,invalid:o[2]};return o[1]!==void 0&&(f.value=o[1]),e=new Wi({props:f}),Ot.push(()=>bg(e,"value",c)),e.$on("input",o[9]),e.$on("enter",function(){Be((0,Hr.debounce)(o[14]))&&(0,Hr.debounce)(o[14]).apply(this,arguments)}),{c(){R(e.$$.fragment),r=E(),n=C("button"),s=B("Join"),h(n,"class","mod-cta"),n.disabled=o[3]},m(u,d){D(e,u,d),_(u,r,d),_(u,n,d),w(n,s),a=!0,i||(l=K(n,"click",function(){Be((0,Hr.debounce)(o[15]))&&(0,Hr.debounce)(o[15]).apply(this,arguments)}),i=!0)},p(u,d){o=u;let m={};d&8&&(m.disabled=o[3]),d&4&&(m.invalid=o[2]),!t&&d&2&&(t=!0,m.value=o[1],hg(()=>t=!1)),e.$set(m),(!a||d&8)&&(n.disabled=o[3])},i(u){a||(b(e.$$.fragment,u),a=!0)},o(u){k(e.$$.fragment,u),a=!1},d(u){u&&(v(r),v(n)),M(e,u),i=!1,l()}}}function UC(o){let e;return{c(){e=C("span"),e.textContent="Relay Servers",h(e,"slot","name"),ne(e,"display","inline-flex"),ne(e,"align-items","center")},m(t,r){_(t,e,r)},p:q,d(t){t&&v(e)}}}function OC(o){let e,t;function r(){return o[17](o[26])}return e=new fn({}),e.$on("settings",r),{c(){R(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){o=n},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){M(e,n)}}}function BC(o){let e;return{c(){e=C("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-gjjmqn")},m(t,r){_(t,e,r)},p:q,d(t){t&&v(e)}}}function NC(o){let e=o[26].name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n&16&&e!==(e=r[26].name+"")&&X(t,e)},d(r){r&&v(t)}}}function HC(o){let e;function t(s,a){return s[26].name?NC:BC}let r=t(o,-1),n=r(o);return{c(){n.c(),e=he()},m(s,a){n.m(s,a),_(s,e,a)},p(s,a){r===(r=t(s,a))&&n?n.p(s,a):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&v(e),n.d(s)}}}function qC(o){let e,t;return e=new Oo({props:{slot:"name",relay:o[26],t:"name",$$slots:{default:[HC]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[16]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&16&&(s.relay=r[26]),n&536870928&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function xy(o){let e,t;return e=new ut({props:{$$slots:{name:[qC],default:[OC]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&536870928&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function VC(o){let e,t,r;return{c(){e=C("button"),e.textContent="Create",h(e,"class","mod-cta")},m(n,s){_(n,e,s),t||(r=K(e,"click",(0,Hr.debounce)(o[18])),t=!0)},p:q,d(n){n&&v(e),t=!1,r()}}}function by(o){let e,t;return e=new Ie({props:{description:"Go to a Relay Server's settings page above to share existing folders, or add Shared Folders to your vault."}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function zC(o){let e,t,r;function n(){return o[21](o[23])}return e=new fn({}),e.$on("settings",function(){Be((0,Hr.debounce)(n))&&(0,Hr.debounce)(n).apply(this,arguments)}),{c(){R(e.$$.fragment),t=E()},m(s,a){D(e,s,a),_(s,t,a),r=!0},p(s,a){o=s},i(s){r||(b(e.$$.fragment,s),r=!0)},o(s){k(e.$$.fragment,s),r=!1},d(s){s&&v(t),M(e,s)}}}function WC(o){var r;let e,t;return e=new hy({props:{folder:o[23],relay:(r=o[23].remote)==null?void 0:r.relay,slot:"name"}}),e.$on("manageRelay",o[19]),e.$on("manageSharedFolder",o[20]),{c(){R(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){var i;let a={};s&32&&(a.folder=n[23]),s&32&&(a.relay=(i=n[23].remote)==null?void 0:i.relay),e.$set(a)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){M(e,n)}}}function vy(o){let e,t;return e=new ut({props:{$$slots:{name:[WC],default:[zC]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&536870960&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function KC(o){let e,t,r,n,s,a,i,l,c,f,u,d=o[5].items().length===0,m,p,x;e=new Me({props:{name:"Join a Relay Server"}}),r=new Ie({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[$C]},$$scope:{ctx:o}}}),s=new Me({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[UC]},$$scope:{ctx:o}}});let y=we(o[4].values().sort(wy)),g=[];for(let S=0;S<y.length;S+=1)g[S]=xy(yy(o,y,S));let I=S=>k(g[S],1,1,()=>{g[S]=null});l=new Ie({props:{name:"",description:"",$$slots:{default:[VC]},$$scope:{ctx:o}}}),f=new Me({props:{name:"Shared Folders",helpText:"Shared Folders enhance local folders by tracking edits. You can see what Relay Server a Shared Folder is connected to below."}});let T=d&&by(o),P=we(o[5].items()),A=[];for(let S=0;S<P.length;S+=1)A[S]=vy(gy(o,P,S));let F=S=>k(A[S],1,1,()=>{A[S]=null});return{c(){R(e.$$.fragment),t=E(),R(r.$$.fragment),n=E(),R(s.$$.fragment),a=E();for(let S=0;S<g.length;S+=1)g[S].c();i=E(),R(l.$$.fragment),c=E(),R(f.$$.fragment),u=E(),T&&T.c(),m=E();for(let S=0;S<A.length;S+=1)A[S].c();p=he()},m(S,L){D(e,S,L),_(S,t,L),D(r,S,L),_(S,n,L),D(s,S,L),_(S,a,L);for(let $=0;$<g.length;$+=1)g[$]&&g[$].m(S,L);_(S,i,L),D(l,S,L),_(S,c,L),D(f,S,L),_(S,u,L),T&&T.m(S,L),_(S,m,L);for(let $=0;$<A.length;$+=1)A[$]&&A[$].m(S,L);_(S,p,L),x=!0},p(S,[L]){let $={};L&536870926&&($.$$scope={dirty:L,ctx:S}),r.$set($);let O={};if(L&536870912&&(O.$$scope={dirty:L,ctx:S}),s.$set(O),L&144){y=we(S[4].values().sort(wy));let U;for(U=0;U<y.length;U+=1){let V=yy(S,y,U);g[U]?(g[U].p(V,L),b(g[U],1)):(g[U]=xy(V),g[U].c(),b(g[U],1),g[U].m(i.parentNode,i))}for(se(),U=y.length;U<g.length;U+=1)I(U);ae()}let Q={};if(L&536870912&&(Q.$$scope={dirty:L,ctx:S}),l.$set(Q),L&32&&(d=S[5].items().length===0),d?T?L&32&&b(T,1):(T=by(S),T.c(),b(T,1),T.m(m.parentNode,m)):T&&(se(),k(T,1,1,()=>{T=null}),ae()),L&304){P=we(S[5].items());let U;for(U=0;U<P.length;U+=1){let V=gy(S,P,U);A[U]?(A[U].p(V,L),b(A[U],1)):(A[U]=vy(V),A[U].c(),b(A[U],1),A[U].m(p.parentNode,p))}for(se(),U=P.length;U<A.length;U+=1)F(U);ae()}},i(S){if(!x){b(e.$$.fragment,S),b(r.$$.fragment,S),b(s.$$.fragment,S);for(let L=0;L<y.length;L+=1)b(g[L]);b(l.$$.fragment,S),b(f.$$.fragment,S),b(T);for(let L=0;L<P.length;L+=1)b(A[L]);x=!0}},o(S){k(e.$$.fragment,S),k(r.$$.fragment,S),k(s.$$.fragment,S),g=g.filter(Boolean);for(let L=0;L<g.length;L+=1)k(g[L]);k(l.$$.fragment,S),k(f.$$.fragment,S),k(T),A=A.filter(Boolean);for(let L=0;L<A.length;L+=1)k(A[L]);x=!1},d(S){S&&(v(t),v(n),v(a),v(i),v(c),v(u),v(m),v(p)),M(e,S),M(r,S),M(s,S),He(g,S),M(l,S),M(f,S),T&&T.d(S),He(A,S)}}}function wy(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function GC(o,e,t){let r,n=q,s=()=>(n(),n=Pt(l,U=>t(4,r=U)),l),a;o.$$.on_destroy.push(()=>n());let{plugin:i}=e,{relays:l}=e;s();let c=i.sharedFolders;ie(o,c,U=>t(5,a=U));let f="",u=!1,d=!1,m=ft();function p(U){U&&m("manageRelay",{relay:U})}function x(U,V){U&&m("manageSharedFolder",{folder:U,relay:V})}function y(){t(2,u=!1)}function g(U){return De(this,void 0,void 0,function*(){try{t(3,d=!0);let V=yield i.relayManager.acceptInvitation(U).catch(oe=>{throw oe.status===429&&new Hr.Notice("Slow down"),oe});t(3,d=!1),m("joinRelay",{relay:V})}catch(V){t(2,u=!0),t(3,d=!1)}})}function I(){m("createRelay")}function T(U){f=U,t(1,f)}let P=()=>g(f),A=()=>g(f);function F(U){vr.call(this,o,U)}let S=U=>{p(U)},L=()=>I();function $(U){vr.call(this,o,U)}function O(U){vr.call(this,o,U)}let Q=U=>{let V=r.values().find(oe=>{var ve;return((ve=U.remote)==null?void 0:ve.relay.guid)===oe.guid});x(U,V)};return o.$$set=U=>{"plugin"in U&&t(12,i=U.plugin),"relays"in U&&s(t(0,l=U.relays))},[l,f,u,d,r,a,c,p,x,y,g,I,i,T,P,A,F,S,L,$,O,Q]}var vd=class extends W{constructor(e){super(),G(this,e,GC,KC,z,{plugin:12,relays:0},RC)}},qr=vd;var Qe=require("obsidian");var jy=mn(hs());function jC(o){ye(o,"svelte-15ov1wm",".lock-icon.svelte-15ov1wm{width:16px;height:16px;opacity:0.5;display:flex;align-items:center;justify-content:center}")}function JC(o){let e,t,r;return t=new tu({props:{class:"svg-icon"}}),{c(){e=C("span"),R(t.$$.fragment),h(e,"class","lock-icon svelte-15ov1wm")},m(n,s){_(n,e,s),D(t,e,null),r=!0},p:q,i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){k(t.$$.fragment,n),r=!1},d(n){n&&v(e),M(t)}}}var wd=class extends W{constructor(e){super(),G(this,e,null,JC,z,{},jC)}},Ki=wd;function QC(o){let e,t,r,n,s,a,i,l,c;n=new qf({props:{size:16}});let f=o[3].default,u=le(f,o,o[4],null);return{c(){e=C("span"),t=B(o[1]),r=E(),R(n.$$.fragment),s=E(),a=C("span"),u&&u.c(),h(e,"tabindex","0"),h(e,"role","button"),ne(a,"flex","1"),ne(a,"min-width","0"),ne(a,"text-overflow","ellipsis"),ne(a,"white-space","nowrap"),ne(a,"overflow","hidden")},m(d,m){_(d,e,m),w(e,t),_(d,r,m),D(n,d,m),_(d,s,m),_(d,a,m),u&&u.m(a,null),i=!0,l||(c=[K(e,"click",o[2]),K(e,"keypress",o[2])],l=!0)},p(d,m){(!i||m&2)&&X(t,d[1]),u&&u.p&&(!i||m&16)&&fe(u,f,d,d[4],i?ce(f,d[4],m,null):ue(d[4]),null)},i(d){i||(b(n.$$.fragment,d),b(u,d),i=!0)},o(d){k(n.$$.fragment,d),k(u,d),i=!1},d(d){d&&(v(e),v(r),v(s),v(a)),M(n,d),u&&u.d(d),l=!1,me(c)}}}function XC(o){let e,t,r;var n=o[0];function s(a,i){return{props:{$$slots:{default:[QC]},$$scope:{ctx:a}}}}return n&&(t=Xn(n,s(o))),{c(){e=C("h4"),t&&R(t.$$.fragment)},m(a,i){_(a,e,i),t&&D(t,e,null),r=!0},p(a,[i]){if(i&1&&n!==(n=a[0])){if(t){se();let l=t;k(l.$$.fragment,1,0,()=>{M(l,1)}),ae()}n?(t=Xn(n,s(a,i)),R(t.$$.fragment),b(t.$$.fragment,1),D(t,e,null)):t=null}else if(n){let l={};i&18&&(l.$$scope={dirty:i,ctx:a}),t.$set(l)}},i(a){r||(t&&b(t.$$.fragment,a),r=!0)},o(a){t&&k(t.$$.fragment,a),r=!1},d(a){a&&v(e),t&&M(t)}}}function YC(o,e,t){let{$$slots:r={},$$scope:n}=e,{category:s}=e,{categoryText:a}=e,i=ft();function l(){i("goBack")}return o.$$set=c=>{"category"in c&&t(0,s=c.category),"categoryText"in c&&t(1,a=c.categoryText),"$$scope"in c&&t(4,n=c.$$scope)},[s,a,l,r,n]}var _d=class extends W{constructor(e){super(),G(this,e,YC,XC,z,{category:0,categoryText:1})}},Gi=_d;function ZC(o){ye(o,"svelte-1ezpbya",'.system3-disk-usage-container.svelte-1ezpbya{width:100%;background-color:var(--interactive-normal);overflow:hidden}.system3-disk-usage-bar.svelte-1ezpbya{height:0.5rem;background-color:var(--color-accent);transition:width 0.6s ease}.system3-disk-usage-report.svelte-1ezpbya{text-align:center}.system3-disk-usage-bar[data-state="warning"].svelte-1ezpbya{height:0.3rem;background-color:var(--red);transition:width 0.6s ease}')}function eI(o){let e,t,r,n,s,a;return{c(){e=C("div"),t=C("div"),n=E(),s=C("div"),a=B(o[1]),h(t,"class","system3-disk-usage-bar svelte-1ezpbya"),ne(t,"width",o[0]+"%"),h(t,"data-state",r=o[0]>90?"warning":""),h(e,"class","system3-disk-usage-container svelte-1ezpbya"),h(s,"class","system3-disk-usage-report svelte-1ezpbya")},m(i,l){_(i,e,l),w(e,t),_(i,n,l),_(i,s,l),w(s,a)},p(i,[l]){l&1&&ne(t,"width",i[0]+"%"),l&1&&r!==(r=i[0]>90?"warning":"")&&h(t,"data-state",r),l&2&&X(a,i[1])},i:q,o:q,d(i){i&&(v(e),v(n),v(s))}}}function tI(o,e,t){let{diskUsagePercentage:r=0}=e,{text:n=""}=e;return r=Math.max(0,r),r=Math.min(100,r),o.$$set=s=>{"diskUsagePercentage"in s&&t(0,r=s.diskUsagePercentage),"text"in s&&t(1,n=s.text)},[r,n]}var Sd=class extends W{constructor(e){super(),G(this,e,tI,eI,z,{diskUsagePercentage:0,text:1},ZC)}},_y=Sd;var Ji=require("obsidian");function rI(o){let e,t,r=o[0].shared&&Sy(o);return{c(){e=C("div"),r&&r.c(),h(e,"class","suggestion-icon")},m(n,s){_(n,e,s),r&&r.m(e,null),t=!0},p(n,s){n[0].shared?r?s&1&&b(r,1):(r=Sy(n),r.c(),b(r,1),r.m(e,null)):r&&(se(),k(r,1,1,()=>{r=null}),ae())},i(n){t||(b(r),t=!0)},o(n){k(r),t=!1},d(n){n&&v(e),r&&r.d()}}}function oI(o){let e;return{c(){e=C("span"),e.textContent="Enter to create",h(e,"class","suggestion-action")},m(t,r){_(t,e,r)},p:q,i:q,o:q,d(t){t&&v(e)}}}function Sy(o){let e,t;return e=new io({props:{class:"svg-icon"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function nI(o){let e,t,r=o[0].folder+"",n,s,a,i,l,c,f=[oI,rI],u=[];function d(m,p){return m[0].exists?1:0}return i=d(o,-1),l=u[i]=f[i](o),{c(){e=C("div"),t=C("div"),n=B(r),s=E(),a=C("div"),l.c(),h(t,"class","suggestion-title"),h(e,"class","suggestion-content"),h(a,"class","suggestion-aux")},m(m,p){_(m,e,p),w(e,t),w(t,n),_(m,s,p),_(m,a,p),u[i].m(a,null),c=!0},p(m,[p]){(!c||p&1)&&r!==(r=m[0].folder+"")&&X(n,r);let x=i;i=d(m,p),i===x?u[i].p(m,p):(se(),k(u[x],1,1,()=>{u[x]=null}),ae(),l=u[i],l?l.p(m,p):(l=u[i]=f[i](m),l.c()),b(l,1),l.m(a,null))},i(m){c||(b(l),c=!0)},o(m){k(l),c=!1},d(m){m&&(v(e),v(s),v(a)),u[i].d()}}}function sI(o,e,t){let{suggestion:r}=e;return o.$$set=n=>{"suggestion"in n&&t(0,r=n.suggestion)},[r]}var kd=class extends W{constructor(e){super(),G(this,e,sI,nI,z,{suggestion:0})}},ky=kd;var ji=class extends Ji.SuggestModal{constructor(t,r,n){super(t);this.sharedFolders=r;this.onChoose=n;this.components=[];this.sharedPaths=new Set(this.sharedFolders.map(s=>s.path)),this.hasRemotes=new Set(this.sharedFolders.filter(s=>s.remote!==void 0).map(s=>s.path)),this.setInstructions([{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}])}sortFn(t,r){return t.exists&&!r.exists?1:!t.exists&&r.exists||t.shared&&!r.shared?-1:r.shared&&!t.shared?1:t.folder.localeCompare(r.folder)}onClose(){super.onClose(),this.components.forEach(t=>{t.$destroy()})}getSuggestions(t){this.components.forEach(i=>{i.$destroy()});let r=t.toLowerCase(),n=[],s=this.app.vault.getAbstractFileByPath(t)!==null;t.length>0&&!s&&n.push({folder:t,exists:!1,shared:!1});let a=i=>{let l=this.sharedPaths.has(i.path),c=this.hasRemotes.has(i.path);if(i.path.toLowerCase().contains(r)&&i.path.length>1&&!c&&n.push({folder:i.path,exists:!0,shared:l}),!l)for(let f of i.children)f instanceof Ji.TFolder&&a(f)};return a(this.app.vault.getRoot()),n.sort(this.sortFn)}renderSuggestion(t,r){r.addClass("mod-complex");let n=new ky({target:r,props:{suggestion:t}});this.components.push(n)}onChooseSuggestion(t,r){this.onChoose(t.folder)}};var Fy=require("obsidian");var Id=require("obsidian");var Cy=require("obsidian"),Iy=require("obsidian"),Qi=class extends Iy.AbstractInputSuggest{constructor(t,r,n){super(t,n);this.app=t;this.sharedFolders=r;this.inputEl=n;this.sharedPaths=new Set(this.sharedFolders.map(s=>s.path))}getSuggestions(t){let r=t.toLowerCase(),n=[],s=a=>{if(!this.sharedPaths.has(a.path)){a.path.toLowerCase().contains(r)&&n.push(a.path);for(let l of a.children)l instanceof Cy.TFolder&&s(l)}};return s(this.app.vault.getRoot()),n}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};function aI(o){let e,t,r,n;return{c(){e=C("div"),t=C("input"),h(t,"type","text"),h(t,"placeholder","/"),h(e,"class","folder-suggest-container")},m(s,a){_(s,e,a),w(e,t),o[5](t),lr(t,o[2]),r||(n=[K(t,"input",iI),K(t,"input",o[6])],r=!0)},p(s,[a]){a&4&&t.value!==s[2]&&lr(t,s[2])},i:q,o:q,d(s){s&&v(e),o[5](null),r=!1,me(n)}}}function iI(){}function lI(o,e,t){let r,n=q,s=()=>(n(),n=Pt(f,m=>t(2,r=m)),f);o.$$.on_destroy.push(()=>n());let{app:a}=e,i,l,{sharedFolders:c}=e,{selectedFolder:f=de()}=e;s(),Ft(()=>{l=new Qi(a,c,i);let m=p=>{s(t(0,f=p.detail.folder.path))};return i.addEventListener("folder-selected",m),()=>{i.removeEventListener("folder-selected",m)}}),Lf(()=>{l&&l.close()});function u(m){Ot[m?"unshift":"push"](()=>{i=m,t(1,i)})}function d(){r=this.value,f.set(r)}return o.$$set=m=>{"app"in m&&t(3,a=m.app),"sharedFolders"in m&&t(4,c=m.sharedFolders),"selectedFolder"in m&&s(t(0,f=m.selectedFolder))},[f,i,r,a,c,u,d]}var Cd=class extends W{constructor(e){super(),G(this,e,lI,aI,z,{app:3,sharedFolders:4,selectedFolder:0})}},Ly=Cd;function cI(o){ye(o,"svelte-hgd3zf","span.error.svelte-hgd3zf{flex:auto;align-content:center}")}function fI(o){let e,t,r;return{c(){e=C("input"),h(e,"type","text")},m(n,s){_(n,e,s),lr(e,o[4]),t||(r=K(e,"input",o[8]),t=!0)},p(n,s){s&16&&e.value!==n[4]&&lr(e,n[4])},d(n){n&&v(e),t=!1,r()}}}function uI(o){let e,t;return e=new Ly({props:{app:o[0],sharedFolders:o[2],selectedFolder:o[7]}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.app=r[0]),n&4&&(s.sharedFolders=r[2]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function Ty(o){let e,t;return{c(){e=C("span"),t=B(o[5]),h(e,"class","mod-warning error svelte-hgd3zf")},m(r,n){_(r,e,n),w(e,t)},p(r,n){n&32&&X(t,r[5])},d(r){r&&v(e)}}}function dI(o){let e,t,r,n,s,a,i,l,c,f,u,d,m;n=new Ie({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[fI]},$$scope:{ctx:o}}}),a=new Ie({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[uI]},$$scope:{ctx:o}}});let p=o[5]&&Ty(o);return{c(){e=C("div"),e.textContent="Add to vault",t=E(),r=C("div"),R(n.$$.fragment),s=E(),R(a.$$.fragment),i=E(),l=C("div"),p&&p.c(),c=E(),f=C("button"),f.textContent="Confirm",h(e,"class","modal-title"),h(f,"class","mod-cta"),h(l,"class","modal-button-container"),h(r,"class","modal-content")},m(x,y){_(x,e,y),_(x,t,y),_(x,r,y),D(n,r,null),w(r,s),D(a,r,null),w(r,i),w(r,l),p&&p.m(l,null),w(l,c),w(l,f),u=!0,d||(m=K(f,"click",function(){Be((0,Id.debounce)(o[9]))&&(0,Id.debounce)(o[9]).apply(this,arguments)}),d=!0)},p(x,[y]){o=x;let g={};y&1040&&(g.$$scope={dirty:y,ctx:o}),n.$set(g);let I={};y&1029&&(I.$$scope={dirty:y,ctx:o}),a.$set(I),o[5]?p?p.p(o,y):(p=Ty(o),p.c(),p.m(l,c)):p&&(p.d(1),p=null)},i(x){u||(b(n.$$.fragment,x),b(a.$$.fragment,x),u=!0)},o(x){k(n.$$.fragment,x),k(a.$$.fragment,x),u=!1},d(x){x&&(v(e),v(t),v(r)),M(n),M(a),p&&p.d(),d=!1,m()}}}function pI(o,e,t){let r,{app:n}=e,{remoteFolder:s}=e,{sharedFolders:a}=e,{onConfirm:i}=e,l=s.name,c=de();ie(o,c,m=>t(6,r=m));let f="";function u(){l=this.value,t(4,l)}let d=async()=>{i(s,l,r||"").catch(m=>{t(5,f=m.message)})};return o.$$set=m=>{"app"in m&&t(0,n=m.app),"remoteFolder"in m&&t(1,s=m.remoteFolder),"sharedFolders"in m&&t(2,a=m.sharedFolders),"onConfirm"in m&&t(3,i=m.onConfirm)},[n,s,a,i,l,f,r,c,u,d]}var Ld=class extends W{constructor(e){super(),G(this,e,pI,dI,z,{app:0,remoteFolder:1,sharedFolders:2,onConfirm:3},cI)}},Py=Ld;var Xi=class extends Fy.Modal{constructor(t,r,n,s){super(t);this.sharedFolders=r;this.remoteFolder=n;this.onConfirm=s;this.onConfirm=s}onOpen(){let{contentEl:t}=this;this.component=new Py({target:t,props:{remoteFolder:this.remoteFolder,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s)=>{await this.onConfirm(r,n,s),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Td=require("obsidian");function mI(o){let e=[],t="",r=0;for(;r<o.length;)o[r]==="*"&&r+1<o.length&&o[r+1]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"DOUBLE_STAR"}),r+=2):o[r]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"STAR"}),r++):(t+=o[r],r++);return t&&e.push({type:"TEXT",value:t}),e}function hI(o){let e="",t="NORMAL",r=0;for(;r<o.length;){let n=o[r];switch(t){case"NORMAL":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="EMPHASIS",e+="<u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="<strong>");break;case"EMPHASIS":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="NORMAL",e+="</u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="</u><strong>");break;case"BOLD":n.type==="TEXT"?e+=n.value:n.type==="STAR"?e+="*":n.type==="DOUBLE_STAR"&&(t="NORMAL",e+="</strong>");break}r++}return t==="EMPHASIS"?e+="</u>":t==="BOLD"&&(e+="</strong>"),e}function Bo(o){let e=mI(o);return hI(e)}function gI(o){ye(o,"svelte-m8d7xf",".faint.svelte-m8d7xf{color:var(--text-faint)}.share-key-container.svelte-m8d7xf{width:100%}.share-key-disabled-notice.svelte-m8d7xf{color:var(--text-error) !important;font-size:0.85em !important}.relay-host-check.svelte-m8d7xf{text-align:right}")}function Ay(o,e,t){let r=o.slice();return r[61]=e[t],r}function Ey(o,e,t){let r=o.slice();return r[64]=e[t],r}function yI(o){let e;return{c(){e=C("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-m8d7xf")},m(t,r){_(t,e,r)},p:q,d(t){t&&v(e)}}}function xI(o){let e=o[0].name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].name+"")&&X(t,e)},d(r){r&&v(t)}}}function bI(o){let e;function t(s,a){return s[0].name?xI:yI}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=he()},m(s,a){n.m(s,a),_(s,e,a)},p(s,a){r===(r=t(s,a))&&n?n.p(s,a):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&v(e),n.d(s)}}}function Dy(o){let e,t;return e=new Ie({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[vI]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&553|n[2]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function vI(o){let e,t,r,n;return{c(){e=C("input"),h(e,"type","text"),h(e,"spellcheck","false"),h(e,"placeholder","Example: Shared Notes"),h(e,"class",t=Eo((o[9]?"system3-updating":"")+(o[5]?"":" system3-input-invalid"))+" svelte-m8d7xf")},m(s,a){_(s,e,a),lr(e,o[0].name),o[41](e),r||(n=[K(e,"input",o[40]),K(e,"input",o[33])],r=!0)},p(s,a){a[0]&544&&t!==(t=Eo((s[9]?"system3-updating":"")+(s[5]?"":" system3-input-invalid"))+" svelte-m8d7xf")&&h(e,"class",t),a[0]&1&&e.value!==s[0].name&&lr(e,s[0].name)},d(s){s&&v(e),o[41](null),r=!1,me(n)}}}function wI(o){let e,t;return e=new ut({props:{$$slots:{name:[CI],default:[SI]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&1024|n[2]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function _I(o){let e,t;return e=new ut({props:{$$slots:{name:[TI],default:[II]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&3072|n[2]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function SI(o){let e,t,r;function n(){return o[45](o[64])}return{c(){e=C("button"),e.textContent="Add to Vault",h(e,"class","mod-cta"),h(e,"aria-label","Add shared folder to vault"),ne(e,"max-width","8em")},m(s,a){_(s,e,a),t||(r=K(e,"click",function(){Be((0,Qe.debounce)(n))&&(0,Qe.debounce)(n).apply(this,arguments)}),t=!0)},p(s,a){o=s},d(s){s&&v(e),t=!1,r()}}}function kI(o){let e=o[64].name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&1024&&e!==(e=r[64].name+"")&&X(t,e)},d(r){r&&v(t)}}}function CI(o){let e,t;return e=new Br({props:{slot:"name",$$slots:{default:[kI]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&1024|n[2]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function II(o){let e,t;function r(){return o[44](o[64])}return e=new fn({}),e.$on("settings",function(){Be((0,Qe.debounce)(r))&&(0,Qe.debounce)(r).apply(this,arguments)}),{c(){R(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){o=n},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){M(e,n)}}}function LI(o){let e=o[64].name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&1024&&e!==(e=r[64].name+"")&&X(t,e)},d(r){r&&v(t)}}}function TI(o){let e,t;function r(...n){return o[42](o[64],...n)}return e=new Br({props:{folder:o[11].find(r),slot:"name",$$slots:{default:[LI]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[43]),{c(){R(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){o=n;let a={};s[0]&3072&&(a.folder=o[11].find(r)),s[0]&1024|s[2]&32&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){M(e,n)}}}function My(o){let e,t,r,n,s;function a(...f){return o[39](o[64],...f)}let i=[_I,wI],l=[];function c(f,u){return u[0]&3072&&(e=null),e==null&&(e=!!f[11].find(a)),e?0:1}return t=c(o,[-1,-1,-1]),r=l[t]=i[t](o),{c(){r.c(),n=he()},m(f,u){l[t].m(f,u),_(f,n,u),s=!0},p(f,u){o=f;let d=t;t=c(o,u),t===d?l[t].p(o,u):(se(),k(l[d],1,1,()=>{l[d]=null}),ae(),r=l[t],r?r.p(o,u):(r=l[t]=i[t](o),r.c()),b(r,1),r.m(n.parentNode,n))},i(f){s||(b(r),s=!0)},o(f){k(r),s=!1},d(f){f&&v(n),l[t].d(f)}}}function PI(o){let e,t,r;return{c(){e=C("button"),e.textContent="Share a folder",h(e,"class","mod-cta"),h(e,"aria-label","Select a folder to share it with this Relay Server")},m(n,s){_(n,e,s),t||(r=K(e,"click",(0,Qe.debounce)(o[46])),t=!0)},p:q,d(n){n&&v(e),t=!1,r()}}}function FI(o){let e=o[12].values().length+"",t,r,n=o[7].userLimit+"",s;return{c(){t=B(e),r=B(" / "),s=B(n)},m(a,i){_(a,t,i),_(a,r,i),_(a,s,i)},p(a,i){i[0]&4096&&e!==(e=a[12].values().length+"")&&X(t,e),i[0]&128&&n!==(n=a[7].userLimit+"")&&X(s,n)},d(a){a&&(v(t),v(r),v(s))}}}function Ry(o){let e,t,r;function n(){return o[47](o[61])}return{c(){e=C("button"),e.textContent="Kick",h(e,"class","mod-destructive")},m(s,a){_(s,e,a),t||(r=K(e,"click",function(){Be((0,Qe.debounce)(n))&&(0,Qe.debounce)(n).apply(this,arguments)}),t=!0)},p(s,a){o=s},d(s){s&&v(e),t=!1,r()}}}function AI(o){let e,t=o[61].role==="Member"&&o[7].owner&&Ry(o);return{c(){t&&t.c(),e=E()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[61].role==="Member"&&r[7].owner?t?t.p(r,n):(t=Ry(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&v(e),t&&t.d(r)}}}function $y(o){let e,t;return e=new Vi({props:{user:o[61].user,$$slots:{default:[AI]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&4096&&(s.user=r[61].user),n[0]&4224|n[2]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function Uy(o){let e,t;return e=new Ki({}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function EI(o){let e,t,r,n,s,a,i,l,c,f,u,d=!o[0].owner&&Uy(o);return{c(){e=C("div"),d&&d.c(),t=E(),r=C("div"),n=C("input"),a=E(),i=C("div"),h(n,"type","checkbox"),n.checked=o[6],n.disabled=s=!o[0].owner,h(i,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",o[6]),h(r,"tabindex","0"),h(r,"class",l=o[0].owner?"checkbox-container":"checkbox-container checkbox-locked"),Ae(r,"is-enabled",o[6]),h(e,"class","setting-item-control")},m(m,p){_(m,e,p),d&&d.m(e,null),w(e,t),w(e,r),w(r,n),w(r,a),w(r,i),c=!0,f||(u=[K(n,"change",o[48]),K(r,"keypress",o[49]),K(r,"click",o[50])],f=!0)},p(m,p){m[0].owner?d&&(se(),k(d,1,1,()=>{d=null}),ae()):d?p[0]&1&&b(d,1):(d=Uy(m),d.c(),b(d,1),d.m(e,t)),(!c||p[0]&64)&&(n.checked=m[6]),(!c||p[0]&1&&s!==(s=!m[0].owner))&&(n.disabled=s),(!c||p[0]&64)&&h(r,"aria-checked",m[6]),(!c||p[0]&1&&l!==(l=m[0].owner?"checkbox-container":"checkbox-container checkbox-locked"))&&h(r,"class",l),(!c||p[0]&65)&&Ae(r,"is-enabled",m[6])},i(m){c||(b(d),c=!0)},o(m){k(d),c=!1},d(m){m&&v(e),d&&d.d(),f=!1,me(u)}}}function DI(o){let e;return{c(){e=C("div"),e.textContent="The owner of this Relay Server has disabled key sharing.",h(e,"class","setting-item-description mod-warning")},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function MI(o){let e;return{c(){e=C("div"),e.textContent="The owner of this Relay Server has enabled key sharing.",h(e,"class","setting-item-description")},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function RI(o){let e;return{c(){e=C("div"),e.textContent="Allow others to join this Relay Server with a Share Key.",h(e,"class","setting-item-description")},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function $I(o){let e;function t(s,a){return s[0].owner?RI:s[6]?MI:DI}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){e=C("fragment"),n.c(),h(e,"slot","description")},m(s,a){_(s,e,a),n.m(e,null)},p(s,a){r!==(r=t(s,a))&&(n.d(1),n=r(s),n&&(n.c(),n.m(e,null)))},d(s){s&&v(e),n.d()}}}function Oy(o){let e,t,r,n;e=new Ie({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[BI]},$$scope:{ctx:o}}});let s=o[0].owner&&By(o);return{c(){R(e.$$.fragment),t=E(),s&&s.c(),r=he()},m(a,i){D(e,a,i),_(a,t,i),s&&s.m(a,i),_(a,r,i),n=!0},p(a,i){let l={};i[0]&80|i[2]&32&&(l.$$scope={dirty:i,ctx:a}),e.$set(l),a[0].owner?s?(s.p(a,i),i[0]&1&&b(s,1)):(s=By(a),s.c(),b(s,1),s.m(r.parentNode,r)):s&&(se(),k(s,1,1,()=>{s=null}),ae())},i(a){n||(b(e.$$.fragment,a),b(s),n=!0)},o(a){k(e.$$.fragment,a),k(s),n=!1},d(a){a&&(v(t),v(r)),M(e,a),s&&s.d(a)}}}function UI(o){let e,t;return e=new Wi({props:{value:o[4]?o[4].key:"please wait...",disabled:!o[6],placeholder:"please wait...",readonly:!0,copyOnClick:!0,successMessage:"Invite link copied"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&16&&(s.value=r[4]?r[4].key:"please wait..."),n[0]&64&&(s.disabled=!r[6]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function OI(o){let e;return{c(){e=C("span"),e.textContent="Share key is currently disabled",h(e,"role","button"),h(e,"tabindex","0"),h(e,"class","input-like share-key-disabled-notice svelte-m8d7xf")},m(t,r){_(t,e,r)},p:q,i:q,o:q,d(t){t&&v(e)}}}function BI(o){let e,t,r,n,s=[OI,UI],a=[];function i(l,c){return l[6]?1:0}return t=i(o,[-1,-1,-1]),r=a[t]=s[t](o),{c(){e=C("div"),r.c(),h(e,"class","share-key-container svelte-m8d7xf")},m(l,c){_(l,e,c),a[t].m(e,null),n=!0},p(l,c){let f=t;t=i(l,c),t===f?a[t].p(l,c):(se(),k(a[f],1,1,()=>{a[f]=null}),ae(),r=a[t],r?r.p(l,c):(r=a[t]=s[t](l),r.c()),b(r,1),r.m(e,null))},i(l){n||(b(r),n=!0)},o(l){k(r),n=!1},d(l){l&&v(e),a[t].d()}}}function By(o){let e,t;return e=new Ie({props:{name:"Rotate key",description:"Create a new share key. The old key will no longer work.",$$slots:{default:[NI]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[2]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function NI(o){let e,t,r;return{c(){e=C("button"),e.textContent="Rotate key",h(e,"class","mod-destructive")},m(n,s){_(n,e,s),t||(r=K(e,"click",(0,Qe.debounce)(o[30])),t=!0)},p:q,d(n){n&&v(e),t=!1,r()}}}function HI(o){let e,t,r,n;return e=new Me({props:{name:"Membership"}}),r=new Ie({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[VI]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment),t=E(),R(r.$$.fragment)},m(s,a){D(e,s,a),_(s,t,a),D(r,s,a),n=!0},p(s,a){let i={};a[2]&32&&(i.$$scope={dirty:a,ctx:s}),r.$set(i)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&v(t),M(e,s),M(r,s)}}}function qI(o){let e,t,r,n,s,a,i,l,c,f,u;e=new Me({props:{name:"Plan"}});let d=[WI,zI],m=[];function p(g,I){return g[13]?0:1}r=p(o,[-1,-1,-1]),n=m[r]=d[r](o);let x=o[14]&&o[14].quota>0&&qy(o),y=o[0].provider&&Vy(o);return l=new Me({props:{name:"Danger zone"}}),f=new Ie({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[cL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment),t=E(),n.c(),s=E(),x&&x.c(),a=E(),y&&y.c(),i=E(),R(l.$$.fragment),c=E(),R(f.$$.fragment)},m(g,I){D(e,g,I),_(g,t,I),m[r].m(g,I),_(g,s,I),x&&x.m(g,I),_(g,a,I),y&&y.m(g,I),_(g,i,I),D(l,g,I),_(g,c,I),D(f,g,I),u=!0},p(g,I){let T=r;r=p(g,I),r===T?m[r].p(g,I):(se(),k(m[T],1,1,()=>{m[T]=null}),ae(),n=m[r],n?n.p(g,I):(n=m[r]=d[r](g),n.c()),b(n,1),n.m(s.parentNode,s)),g[14]&&g[14].quota>0?x?(x.p(g,I),I[0]&16384&&b(x,1)):(x=qy(g),x.c(),b(x,1),x.m(a.parentNode,a)):x&&(se(),k(x,1,1,()=>{x=null}),ae()),g[0].provider?y?(y.p(g,I),I[0]&1&&b(y,1)):(y=Vy(g),y.c(),b(y,1),y.m(i.parentNode,i)):y&&(se(),k(y,1,1,()=>{y=null}),ae());let P={};I[0]&256|I[2]&32&&(P.$$scope={dirty:I,ctx:g}),f.$set(P)},i(g){u||(b(e.$$.fragment,g),b(n),b(x),b(y),b(l.$$.fragment,g),b(f.$$.fragment,g),u=!0)},o(g){k(e.$$.fragment,g),k(n),k(x),k(y),k(l.$$.fragment,g),k(f.$$.fragment,g),u=!1},d(g){g&&(v(t),v(s),v(a),v(i),v(c)),M(e,g),m[r].d(g),x&&x.d(g),y&&y.d(g),M(l,g),M(f,g)}}}function VI(o){let e,t,r;return{c(){e=C("button"),e.textContent="Leave",h(e,"class","mod-warning")},m(n,s){_(n,e,s),t||(r=K(e,"click",(0,Qe.debounce)(o[54])),t=!0)},p:q,d(n){n&&v(e),t=!1,r()}}}function zI(o){let e,t;return e=new Ie({props:{name:`Plan: ${o[7].plan}`,description:o[7].cta||"Thanks for supporting Relay development",$$slots:{default:[KI]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.name=`Plan: ${r[7].plan}`),n[0]&128&&(s.description=r[7].cta||"Thanks for supporting Relay development"),n[0]&128|n[2]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function WI(o){let e,t,r=!o[8].values()[0].active||o[8].values()[0].cancelAt,n,s;e=new Ie({props:{name:`Plan: ${o[7].plan}`,description:"",$$slots:{description:[jI],default:[GI]},$$scope:{ctx:o}}});let a=r&&Hy(o);return{c(){R(e.$$.fragment),t=E(),a&&a.c(),n=he()},m(i,l){D(e,i,l),_(i,t,l),a&&a.m(i,l),_(i,n,l),s=!0},p(i,l){let c={};l[0]&128&&(c.name=`Plan: ${i[7].plan}`),l[0]&8576|l[2]&32&&(c.$$scope={dirty:l,ctx:i}),e.$set(c),l[0]&256&&(r=!i[8].values()[0].active||i[8].values()[0].cancelAt),r?a?(a.p(i,l),l[0]&256&&b(a,1)):(a=Hy(i),a.c(),b(a,1),a.m(n.parentNode,n)):a&&(se(),k(a,1,1,()=>{a=null}),ae())},i(i){s||(b(e.$$.fragment,i),b(a),s=!0)},o(i){k(e.$$.fragment,i),k(a),s=!1},d(i){i&&(v(t),v(n)),M(e,i),a&&a.d(i)}}}function KI(o){let e,t,r;return{c(){e=C("button"),e.textContent="Upgrade",h(e,"class","mod-cta")},m(n,s){_(n,e,s),t||(r=K(e,"click",function(){Be((0,Qe.debounce)(o[53]))&&(0,Qe.debounce)(o[53]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&v(e),t=!1,r()}}}function Ny(o){let e,t,r;return{c(){e=C("button"),e.textContent="Cancel",h(e,"class","mod-destructive")},m(n,s){_(n,e,s),t||(r=K(e,"click",function(){Be((0,Qe.debounce)(o[52]))&&(0,Qe.debounce)(o[52]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&v(e),t=!1,r()}}}function GI(o){let e,t,r=o[8].values()[0].active&&!o[8].values()[0].cancelAt,n,s,a,i=r&&Ny(o);return{c(){e=C("button"),e.textContent="Manage",t=E(),i&&i.c(),n=he()},m(l,c){_(l,e,c),_(l,t,c),i&&i.m(l,c),_(l,n,c),s||(a=K(e,"click",function(){Be((0,Qe.debounce)(o[51]))&&(0,Qe.debounce)(o[51]).apply(this,arguments)}),s=!0)},p(l,c){o=l,c[0]&256&&(r=o[8].values()[0].active&&!o[8].values()[0].cancelAt),r?i?i.p(o,c):(i=Ny(o),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(l){l&&(v(e),v(t),v(n)),i&&i.d(l),s=!1,a()}}}function jI(o){let e,t=o[7].cta+"",r;return{c(){e=C("fragment"),r=B(t),h(e,"slot","description")},m(n,s){_(n,e,s),w(e,r)},p(n,s){s[0]&128&&t!==(t=n[7].cta+"")&&X(r,t)},d(n){n&&v(e)}}}function Hy(o){let e,t;return e=new Ie({props:{description:"",$$slots:{name:[QI],default:[JI]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&256|n[2]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function JI(o){let e=o[17](o[8].values()[0].cancelAt)+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&256&&e!==(e=r[17](r[8].values()[0].cancelAt)+"")&&X(t,e)},d(r){r&&v(t)}}}function QI(o){let e;return{c(){e=C("span"),e.textContent="Status: Cancelled",h(e,"slot","name"),h(e,"class","mod-warning")},m(t,r){_(t,e,r)},p:q,d(t){t&&v(e)}}}function qy(o){let e,t,r,n,s,a,i,l,c,f;return e=new Me({props:{name:"Storage"}}),r=new _y({props:{diskUsagePercentage:Math.round(o[14].usage*100/o[14].quota)}}),s=new ut({props:{name:"Usage",description:"Storage for images, audio, video, etc",$$slots:{default:[XI]},$$scope:{ctx:o}}}),i=new ut({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[YI]},$$scope:{ctx:o}}}),c=new ut({props:{name:"File size limit",description:"Maximum supported file size.",$$slots:{default:[ZI]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment),t=E(),R(r.$$.fragment),n=E(),R(s.$$.fragment),a=E(),R(i.$$.fragment),l=E(),R(c.$$.fragment)},m(u,d){D(e,u,d),_(u,t,d),D(r,u,d),_(u,n,d),D(s,u,d),_(u,a,d),D(i,u,d),_(u,l,d),D(c,u,d),f=!0},p(u,d){let m={};d[0]&16384&&(m.diskUsagePercentage=Math.round(u[14].usage*100/u[14].quota)),r.$set(m);let p={};d[0]&16384|d[2]&32&&(p.$$scope={dirty:d,ctx:u}),s.$set(p);let x={};d[0]&16384|d[2]&32&&(x.$$scope={dirty:d,ctx:u}),i.$set(x);let y={};d[0]&16384|d[2]&32&&(y.$$scope={dirty:d,ctx:u}),c.$set(y)},i(u){f||(b(e.$$.fragment,u),b(r.$$.fragment,u),b(s.$$.fragment,u),b(i.$$.fragment,u),b(c.$$.fragment,u),f=!0)},o(u){k(e.$$.fragment,u),k(r.$$.fragment,u),k(s.$$.fragment,u),k(i.$$.fragment,u),k(c.$$.fragment,u),f=!1},d(u){u&&(v(t),v(n),v(a),v(l)),M(e,u),M(r,u),M(s,u),M(i,u),M(c,u)}}}function XI(o){let e=is(o[14].usage)+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&16384&&e!==(e=is(r[14].usage)+"")&&X(t,e)},d(r){r&&v(t)}}}function YI(o){let e=is(o[14].quota)+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&16384&&e!==(e=is(r[14].quota)+"")&&X(t,e)},d(r){r&&v(t)}}}function ZI(o){let e=is(o[14].maxFileSize)+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&16384&&e!==(e=is(r[14].maxFileSize)+"")&&X(t,e)},d(r){r&&v(t)}}}function Vy(o){let e,t,r,n,s,a,i,l,c,f=[tL,eL],u=[];function d(p,x){return p[0].provider.selfHosted?0:1}e=d(o,[-1,-1,-1]),t=u[e]=f[e](o),n=new Ie({props:{name:"Name",description:"",$$slots:{default:[rL]},$$scope:{ctx:o}}}),a=new Ie({props:{name:"Domain",description:"",$$slots:{default:[oL]},$$scope:{ctx:o}}});let m=o[0].provider.selfHosted&&zy(o);return{c(){t.c(),r=E(),R(n.$$.fragment),s=E(),R(a.$$.fragment),i=E(),m&&m.c(),l=he()},m(p,x){u[e].m(p,x),_(p,r,x),D(n,p,x),_(p,s,x),D(a,p,x),_(p,i,x),m&&m.m(p,x),_(p,l,x),c=!0},p(p,x){let y=e;e=d(p,x),e!==y&&(se(),k(u[y],1,1,()=>{u[y]=null}),ae(),t=u[e],t||(t=u[e]=f[e](p),t.c()),b(t,1),t.m(r.parentNode,r));let g={};x[0]&1|x[2]&32&&(g.$$scope={dirty:x,ctx:p}),n.$set(g);let I={};x[0]&1|x[2]&32&&(I.$$scope={dirty:x,ctx:p}),a.$set(I),p[0].provider.selfHosted?m?m.p(p,x):(m=zy(p),m.c(),m.m(l.parentNode,l)):m&&(m.d(1),m=null)},i(p){c||(b(t),b(n.$$.fragment,p),b(a.$$.fragment,p),c=!0)},o(p){k(t),k(n.$$.fragment,p),k(a.$$.fragment,p),c=!1},d(p){p&&(v(r),v(s),v(i),v(l)),u[e].d(p),M(n,p),M(a,p),m&&m.d(p)}}}function eL(o){let e,t;return e=new Me({props:{name:"Host"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function tL(o){let e,t;return e=new Me({props:{name:"Self hosting"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function rL(o){let e=o[0].provider.name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].provider.name+"")&&X(t,e)},d(r){r&&v(t)}}}function oL(o){let e=o[0].provider.url+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].provider.url+"")&&X(t,e)},d(r){r&&v(t)}}}function zy(o){let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:aL,then:sL,catch:nL,value:60};return ao(t=o[16](o[0]),r),{c(){e=he(),r.block.c()},m(n,s){_(n,e,s),r.block.m(n,r.anchor=s),r.mount=()=>e.parentNode,r.anchor=e},p(n,s){o=n,r.ctx=o,s[0]&1&&t!==(t=o[16](o[0]))&&ao(t,r)||es(r,o,s)},d(n){n&&v(e),r.block.d(n),r.token=null,r=null}}}function nL(o){return{c:q,m:q,p:q,d:q}}function sL(o){let e,t=o[60].level==="warning"&&Wy(o);return{c(){t&&t.c(),e=he()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[60].level==="warning"?t?t.p(r,n):(t=Wy(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&v(e),t&&t.d(r)}}}function Wy(o){let e,t,r=Bo(o[60].status)+"",n,s=o[60].link&&Ky(o);return{c(){e=C("p"),t=new Do(!1),n=E(),s&&s.c(),t.a=n,h(e,"class","mod-warning relay-host-check svelte-m8d7xf")},m(a,i){_(a,e,i),t.m(r,e),w(e,n),s&&s.m(e,null)},p(a,i){i[0]&1&&r!==(r=Bo(a[60].status)+"")&&t.p(r),a[60].link?s?s.p(a,i):(s=Ky(a),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(a){a&&v(e),s&&s.d()}}}function Ky(o){let e,t,r,n=Bo(o[60].link.text)+"",s;return{c(){e=C("br"),t=E(),r=C("a"),h(r,"href",s=o[60].link.url)},m(a,i){_(a,e,i),_(a,t,i),_(a,r,i),r.innerHTML=n},p(a,i){i[0]&1&&n!==(n=Bo(a[60].link.text)+"")&&(r.innerHTML=n),i[0]&1&&s!==(s=a[60].link.url)&&h(r,"href",s)},d(a){a&&(v(e),v(t),v(r))}}}function aL(o){return{c:q,m:q,p:q,d:q}}function iL(o){let e,t,r;return{c(){e=C("button"),e.textContent="Destroy",h(e,"class","mod-warning")},m(n,s){_(n,e,s),t||(r=K(e,"click",(0,Qe.debounce)(o[34])),t=!0)},p:q,d(n){n&&v(e),t=!1,r()}}}function lL(o){let e,t;return{c(){e=C("button"),e.textContent="Destroy",e.disabled=t=!0,h(e,"class","mod-warning"),h(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,n){_(r,e,n)},p:q,d(r){r&&v(e)}}}function cL(o){let e,t;function r(a,i){return i[0]&256&&(e=null),e==null&&(e=a[8].values().length>0&&!a[8].values()[0].cancelAt),e?lL:iL}let n=r(o,[-1,-1,-1]),s=n(o);return{c(){s.c(),t=he()},m(a,i){s.m(a,i),_(a,t,i)},p(a,i){n===(n=r(a,i))&&s?s.p(a,i):(s.d(1),s=n(a),s&&(s.c(),s.m(t.parentNode,t)))},d(a){a&&v(t),s.d(a)}}}function fL(o){let e,t,r,n,s,a,i,l,c,f,u,d,m,p,x,y,g,I,T,P;e=new Gi({props:{category:Oo,categoryText:"Relay Servers",$$slots:{default:[bI]},$$scope:{ctx:o}}}),e.$on("goBack",o[28]);let A=o[0].owner&&Dy(o);n=new Me({props:{name:"Folders on this Relay Server"}});let F=we(o[10].values()),S=[];for(let N=0;N<F.length;N+=1)S[N]=My(Ey(o,F,N));let L=N=>k(S[N],1,1,()=>{S[N]=null});i=new Ie({props:{description:"",name:"",$$slots:{default:[PI]},$$scope:{ctx:o}}}),c=new Me({props:{name:"Users",$$slots:{default:[FI]},$$scope:{ctx:o}}});let $=we(o[12].values().sort(Gy)),O=[];for(let N=0;N<$.length;N+=1)O[N]=$y(Ay(o,$,N));let Q=N=>k(O[N],1,1,()=>{O[N]=null});d=new Me({props:{name:"Sharing"}}),p=new ut({props:{name:o[0].owner?"Enable key sharing":"Key sharing",$$slots:{description:[$I],default:[EI]},$$scope:{ctx:o}}});let U=o[6]&&Oy(o),V=[qI,HI],oe=[];function ve(N,j){return N[7].owner?0:1}return g=ve(o,[-1,-1,-1]),I=oe[g]=V[g](o),{c(){R(e.$$.fragment),t=E(),A&&A.c(),r=E(),R(n.$$.fragment),s=E();for(let N=0;N<S.length;N+=1)S[N].c();a=E(),R(i.$$.fragment),l=E(),R(c.$$.fragment),f=E();for(let N=0;N<O.length;N+=1)O[N].c();u=E(),R(d.$$.fragment),m=E(),R(p.$$.fragment),x=E(),U&&U.c(),y=E(),I.c(),T=he()},m(N,j){D(e,N,j),_(N,t,j),A&&A.m(N,j),_(N,r,j),D(n,N,j),_(N,s,j);for(let _e=0;_e<S.length;_e+=1)S[_e]&&S[_e].m(N,j);_(N,a,j),D(i,N,j),_(N,l,j),D(c,N,j),_(N,f,j);for(let _e=0;_e<O.length;_e+=1)O[_e]&&O[_e].m(N,j);_(N,u,j),D(d,N,j),_(N,m,j),D(p,N,j),_(N,x,j),U&&U.m(N,j),_(N,y,j),oe[g].m(N,j),_(N,T,j),P=!0},p(N,j){let _e={};if(j[0]&1|j[2]&32&&(_e.$$scope={dirty:j,ctx:N}),e.$set(_e),N[0].owner?A?(A.p(N,j),j[0]&1&&b(A,1)):(A=Dy(N),A.c(),b(A,1),A.m(r.parentNode,r)):A&&(se(),k(A,1,1,()=>{A=null}),ae()),j[0]&3072|j[1]&34){F=we(N[10].values());let Y;for(Y=0;Y<F.length;Y+=1){let xe=Ey(N,F,Y);S[Y]?(S[Y].p(xe,j),b(S[Y],1)):(S[Y]=My(xe),S[Y].c(),b(S[Y],1),S[Y].m(a.parentNode,a))}for(se(),Y=F.length;Y<S.length;Y+=1)L(Y);ae()}let Ne={};j[2]&32&&(Ne.$$scope={dirty:j,ctx:N}),i.$set(Ne);let Ee={};if(j[0]&4224|j[2]&32&&(Ee.$$scope={dirty:j,ctx:N}),c.$set(Ee),j[0]&4224|j[1]&16){$=we(N[12].values().sort(Gy));let Y;for(Y=0;Y<$.length;Y+=1){let xe=Ay(N,$,Y);O[Y]?(O[Y].p(xe,j),b(O[Y],1)):(O[Y]=$y(xe),O[Y].c(),b(O[Y],1),O[Y].m(u.parentNode,u))}for(se(),Y=$.length;Y<O.length;Y+=1)Q(Y);ae()}let te={};j[0]&1&&(te.name=N[0].owner?"Enable key sharing":"Key sharing"),j[0]&65|j[2]&32&&(te.$$scope={dirty:j,ctx:N}),p.$set(te),N[6]?U?(U.p(N,j),j[0]&64&&b(U,1)):(U=Oy(N),U.c(),b(U,1),U.m(y.parentNode,y)):U&&(se(),k(U,1,1,()=>{U=null}),ae());let re=g;g=ve(N,j),g===re?oe[g].p(N,j):(se(),k(oe[re],1,1,()=>{oe[re]=null}),ae(),I=oe[g],I?I.p(N,j):(I=oe[g]=V[g](N),I.c()),b(I,1),I.m(T.parentNode,T))},i(N){if(!P){b(e.$$.fragment,N),b(A),b(n.$$.fragment,N);for(let j=0;j<F.length;j+=1)b(S[j]);b(i.$$.fragment,N),b(c.$$.fragment,N);for(let j=0;j<$.length;j+=1)b(O[j]);b(d.$$.fragment,N),b(p.$$.fragment,N),b(U),b(I),P=!0}},o(N){k(e.$$.fragment,N),k(A),k(n.$$.fragment,N),S=S.filter(Boolean);for(let j=0;j<S.length;j+=1)k(S[j]);k(i.$$.fragment,N),k(c.$$.fragment,N),O=O.filter(Boolean);for(let j=0;j<O.length;j+=1)k(O[j]);k(d.$$.fragment,N),k(p.$$.fragment,N),k(U),k(I),P=!1},d(N){N&&(v(t),v(r),v(s),v(a),v(l),v(f),v(u),v(m),v(x),v(y),v(T)),M(e,N),A&&A.d(N),M(n,N),He(S,N),M(i,N),M(c,N),He(O,N),M(d,N),M(p,N),U&&U.d(N),oe[g].d(N)}}}function is(o,e=2){if(o===0)return"0 MB";let t=1024,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(o)/Math.log(t));return(o/Math.pow(t,n)).toFixed(e)+" "+r[n]}function Gy(o,e){return o.role==="Owner"&&e.role!=="Owner"?-1:o.role!=="Owner"&&e.role==="Owner"||o.user.name>e.user.name?1:-1}function uL(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function dL(o,e,t){let r,n,s,a=q,i=()=>(a(),a=Pt(L,H=>t(55,s=H)),L),l,c=q,f=()=>(c(),c=Pt(P,H=>t(7,l=H)),P),u,d,m,p,x=q,y=()=>(x(),x=Pt(S,H=>t(11,p=H)),S),g,I,T;o.$$.on_destroy.push(()=>a()),o.$$.on_destroy.push(()=>c()),o.$$.on_destroy.push(()=>x());let{relay:P}=e;f();let A=P.folders;ie(o,A,H=>t(10,m=H));let{plugin:F}=e,{sharedFolders:S}=e;y();let{relayRoles:L}=e;i();function $(H){return De(this,void 0,void 0,function*(){let ge=yield F.loginManager.checkRelayHost(H.guid);if(ge.status===200)return ge.json})}function O(H){if(!H)return"Active";let ge=Td.moment.utc(),tt=Td.moment.utc(H).diff(ge,"days");return tt<=0?"Subscription has ended":tt===1?"Active for 1 more day":`Active for ${tt} more days`}let Q=l.subscriptions;ie(o,Q,H=>t(8,u=H));let U=wr(u,H=>{if(H.values().length===0)return;let ge=H.values()[0];return ge.token||F.relayManager.getSubscriptionToken(ge).then(We=>{ge.token=We}),ge});ie(o,U,H=>t(13,I=H));let V=l.storageQuota;ie(o,V,H=>t(14,T=H));let oe=s.filter(H=>H.relayId===P.id);ie(o,oe,H=>t(12,g=H));let ve=de(!0);ie(o,ve,H=>t(5,r=H));let N;Ft(()=>{N&&N.value===""&&N.focus()});let j=ft();function _e(H){return De(this,void 0,void 0,function*(){var ge;if(!(!((ge=F.loginManager)===null||ge===void 0)&&ge.user))return;let We={relay:H.id,quantity:10,user_email:F.loginManager.user.email},tt=btoa(JSON.stringify(We)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(F.buildApiUrl(`/subscribe/${tt}`),"_blank")})}function Ne(H){return De(this,void 0,void 0,function*(){let ge=H.token,We=H.id;window.open(F.buildApiUrl(`/subscriptions/${We}/manage?token=${ge}`),"_blank")})}function Ee(H){return De(this,void 0,void 0,function*(){let ge=H.token,We=H.id;window.open(F.buildApiUrl(`/subscriptions/${We}/cancel?token=${ge}`),"_blank")})}function te(H){P.owner&&($e.set(H),F.relayManager.toggleRelayInvitation(xe,n).then(ge=>{$e.set(ge.enabled)}))}function re(){return De(this,void 0,void 0,function*(){F.relayManager.leaveRelay(P),j("goBack",{clear:!0})})}function Y(){return De(this,void 0,void 0,function*(){j("goBack",{clear:!0})})}let xe,$e=de(!0);ie(o,$e,H=>t(6,n=H)),F.relayManager.getRelayInvitation(P).then(H=>{H&&(t(4,xe=H),$e.set(H.enabled))});function _t(){return De(this,void 0,void 0,function*(){xe&&t(4,xe=yield F.relayManager.rotateKey(xe).catch(H=>{throw H.status===429&&new Qe.Notice("Slow down"),H}))})}function Ke(H,ge,We){return De(this,void 0,void 0,function*(){let tt=(0,Qe.normalizePath)((0,jy.join)(We,ge));F.vault.getFolderByPath(tt)===null&&(yield F.vault.createFolder(tt));let ps=F.sharedFolders.new(tt,H.guid,P.guid,!0);return ps.remote=H,F.sharedFolders.notifyListeners(),ps})}let Sr=de(!1);ie(o,Sr,H=>t(9,d=H));let lt=F.timeProvider.debounce(()=>{F.relayManager.updateRelay(P).then(()=>{Sr.set(!1)})},500),et=H=>{new Xi(F.app,S,H,Ke).open()};function Ht(){ve.set(uL(N.value)),r&&N.value!==""&&(Sr.set(!0),lt())}function Cl(){F.relayManager.destroyRelay(P),j("goBack",{})}function fs(H){F.relayManager.kick(H)}function da(H,ge){H&&j("manageSharedFolder",{folder:H,relay:ge,mount:!1})}function us(H){let ge=H.target;ge.focus(),ge.select(),navigator.clipboard.writeText(ge.value).then(()=>new Qe.Notice("Invite link copied")).catch(We=>{})}let ho=new ji(F.app,S,H=>De(void 0,void 0,void 0,function*(){let ge=(0,Qe.normalizePath)(H),We=S.find(Bl=>Bl.path==H);if(We){let Bl=yield F.relayManager.createRemoteFolder(We,P);We.remote=Bl,We.connect(),F.sharedFolders.notifyListeners();return}F.vault.getFolderByPath(ge)===null&&(yield F.vault.createFolder(ge));let tt=Tn(),ps=F.sharedFolders.new((0,Qe.normalizePath)(H),tt,P.guid,!0),ev=yield F.relayManager.createRemoteFolder(ps,P);ps.remote=ev,F.sharedFolders.notifyListeners()})),Il=(H,ge)=>ge.remote===H;function ds(){P.name=this.value,f(t(0,P))}function pa(H){Ot[H?"unshift":"push"](()=>{N=H,t(3,N)})}let Ll=(H,ge)=>ge.remote===H;function Tl(H){vr.call(this,o,H)}let Pl=H=>{let ge=p.find(We=>We.remote===H);ge&&da(ge,H.relay)},Fl=H=>{et(H)},Al=()=>{ho.open()},El=H=>{fs(H)},Dl=H=>te(H.currentTarget.checked),Ml=()=>te(!n),Rl=()=>te(!n),$l=()=>{Ne(I)},Ul=()=>{Ee(I)},Ol=()=>{_e(l)},J=()=>{re()};return o.$$set=H=>{"relay"in H&&f(t(0,P=H.relay)),"plugin"in H&&t(38,F=H.plugin),"sharedFolders"in H&&y(t(1,S=H.sharedFolders)),"relayRoles"in H&&i(t(2,L=H.relayRoles))},[P,S,L,N,xe,r,n,l,u,d,m,p,g,I,T,A,$,O,Q,U,V,oe,ve,_e,Ne,Ee,te,re,Y,$e,_t,Sr,et,Ht,Cl,fs,da,ho,F,Il,ds,pa,Ll,Tl,Pl,Fl,Al,El,Dl,Ml,Rl,$l,Ul,Ol,J]}var Pd=class extends W{constructor(e){super(),G(this,e,dL,fL,z,{relay:0,plugin:38,sharedFolders:1,relayRoles:2},gI,[-1,-1,-1])}},ls=Pd;function pL(o){let e,t,r,n,s,a;return r=new Nf({}),{c(){e=C("div"),t=C("div"),R(r.$$.fragment),h(t,"class","clickable-icon"),h(t,"aria-label","Back"),h(t,"tabindex","0"),h(t,"role","button"),h(e,"class","modal-setting-nav-bar")},m(i,l){_(i,e,l),w(e,t),D(r,t,null),n=!0,s||(a=[K(t,"click",o[0]),K(t,"keypress",o[1])],s=!0)},p:q,i(i){n||(b(r.$$.fragment,i),n=!0)},o(i){k(r.$$.fragment,i),n=!1},d(i){i&&v(e),M(r),s=!1,me(a)}}}function mL(o){let e=ft();function t(){e("goBack",{})}function r(n){n.key==="Escape"&&(e("goBack",{}),n.stopPropagation())}return[t,r]}var Fd=class extends W{constructor(e){super(),G(this,e,mL,pL,z,{})}},Jy=Fd;var No=require("obsidian");function Qy(o,e,t){let r=o.slice();return r[32]=e[t][0],r[33]=e[t][1],r}function hL(o){let e=o[1].name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&2&&e!==(e=r[1].name+"")&&X(t,e)},d(r){r&&v(t)}}}function gL(o){let e,t;return e=new Ie({props:{description:"This folder is tracking edits, but is not connected to a Relay Server."}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p:q,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function yL(o){let e,t;return e=new ut({props:{$$slots:{name:[vL],default:[xL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&128|n[1]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function xL(o){let e,t;return e=new fn({}),e.$on("settings",function(){Be((0,No.debounce)(o[22]))&&(0,No.debounce)(o[22]).apply(this,arguments)}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){o=r},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function bL(o){let e=o[7].name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&128&&e!==(e=r[7].name+"")&&X(t,e)},d(r){r&&v(t)}}}function vL(o){let e,t;return e=new Oo({props:{slot:"name",relay:o[7],$$slots:{default:[bL]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[21]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.relay=r[7]),n[0]&128|n[1]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function Xy(o){let e,t,r,n,s;e=new Me({props:{name:"Sync settings",helpText:"You must have attachment storage available in order to sync attachments."}});let a=we(o[4]),i=[];for(let f=0;f<a.length;f+=1)i[f]=Zy(Qy(o,a,f));let l=f=>k(i[f],1,1,()=>{i[f]=null}),c=o[6]&&o[7]&&ex(o);return{c(){R(e.$$.fragment),t=E();for(let f=0;f<i.length;f+=1)i[f].c();r=E(),c&&c.c(),n=he()},m(f,u){D(e,f,u),_(f,t,u);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(f,u);_(f,r,u),c&&c.m(f,u),_(f,n,u),s=!0},p(f,u){if(u[0]&16728){a=we(f[4]);let d;for(d=0;d<a.length;d+=1){let m=Qy(f,a,d);i[d]?(i[d].p(m,u),b(i[d],1)):(i[d]=Zy(m),i[d].c(),b(i[d],1),i[d].m(r.parentNode,r))}for(se(),d=a.length;d<i.length;d+=1)l(d);ae()}f[6]&&f[7]?c?(c.p(f,u),u[0]&192&&b(c,1)):(c=ex(f),c.c(),b(c,1),c.m(n.parentNode,n)):c&&(se(),k(c,1,1,()=>{c=null}),ae())},i(f){if(!s){b(e.$$.fragment,f);for(let u=0;u<a.length;u+=1)b(i[u]);b(c),s=!0}},o(f){k(e.$$.fragment,f),i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)k(i[u]);k(c),s=!1},d(f){f&&(v(t),v(r),v(n)),M(e,f),He(i,f),c&&c.d(f)}}}function Yy(o){let e,t;return e=new Ki({}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function wL(o){let e,t,r,n,s,a,i,l,c,f,u,d=o[6]&&Yy(o);function m(...y){return o[23](o[32],...y)}function p(){return o[24](o[32])}function x(){return o[25](o[32])}return{c(){e=C("div"),d&&d.c(),t=E(),r=C("div"),n=C("input"),a=E(),i=C("div"),h(n,"type","checkbox"),n.checked=s=o[8][o[32]]&&!o[6],n.disabled=o[3],h(i,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",l=o[8][o[32]]&&!o[6]),h(r,"tabindex","0"),h(r,"class","checkbox-container"),Ae(r,"is-enabled",o[8][o[32]]&&!o[6]),h(e,"class","setting-item-control")},m(y,g){_(y,e,g),d&&d.m(e,null),w(e,t),w(e,r),w(r,n),w(r,a),w(r,i),c=!0,f||(u=[K(n,"change",m),K(r,"keypress",p),K(r,"click",x)],f=!0)},p(y,g){o=y,o[6]?d?g[0]&64&&b(d,1):(d=Yy(o),d.c(),b(d,1),d.m(e,t)):d&&(se(),k(d,1,1,()=>{d=null}),ae()),(!c||g[0]&336&&s!==(s=o[8][o[32]]&&!o[6]))&&(n.checked=s),(!c||g[0]&8)&&(n.disabled=o[3]),(!c||g[0]&336&&l!==(l=o[8][o[32]]&&!o[6]))&&h(r,"aria-checked",l),(!c||g[0]&336)&&Ae(r,"is-enabled",o[8][o[32]]&&!o[6])},i(y){c||(b(d),c=!0)},o(y){k(d),c=!1},d(y){y&&v(e),d&&d.d(),f=!1,me(u)}}}function Zy(o){let e,t;return e=new ut({props:{name:o[33].name,description:o[33].description,$$slots:{default:[wL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&16&&(s.name=r[33].name),n[0]&16&&(s.description=r[33].description),n[0]&344|n[1]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function ex(o){let e,t;return e=new ut({props:{name:"",$$slots:{default:[_L]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&128|n[1]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function _L(o){let e,t,r;return{c(){e=C("button"),e.textContent="Buy storage",h(e,"class","mod-cta")},m(n,s){_(n,e,s),t||(r=K(e,"click",function(){Be((0,No.debounce)(o[26]))&&(0,No.debounce)(o[26]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&v(e),t=!1,r()}}}function SL(o){let e,t,r;return{c(){e=C("button"),e.textContent="Delete local",h(e,"class","mod-warning")},m(n,s){_(n,e,s),t||(r=K(e,"click",(0,No.debounce)(o[27])),t=!0)},p:q,d(n){n&&v(e),t=!1,r()}}}function kL(o){let e,t,r,n,s,a,i;return{c(){e=C("button"),t=B("Delete metadata"),h(e,"class",r=o[7]?"mod-disabled":"mod-warning"),e.disabled=n=!!o[7],h(e,"aria-label",s=o[7]?"Metadata is required for sharing.":"")},m(l,c){_(l,e,c),w(e,t),a||(i=K(e,"click",(0,No.debounce)(o[28])),a=!0)},p(l,c){c[0]&128&&r!==(r=l[7]?"mod-disabled":"mod-warning")&&h(e,"class",r),c[0]&128&&n!==(n=!!l[7])&&(e.disabled=n),c[0]&128&&s!==(s=l[7]?"Metadata is required for sharing.":"")&&h(e,"aria-label",s)},d(l){l&&v(e),a=!1,i()}}}function tx(o){var n,s,a,i,l;let e,t,r=(((n=o[7])==null?void 0:n.owner)||((i=(a=(s=o[5])==null?void 0:s.remote)==null?void 0:a.creator)==null?void 0:i.id)===((l=o[0].relayManager.user)==null?void 0:l.id))&&rx(o);return{c(){r&&r.c(),e=he()},m(c,f){r&&r.m(c,f),_(c,e,f),t=!0},p(c,f){var u,d,m,p,x;(u=c[7])!=null&&u.owner||((p=(m=(d=c[5])==null?void 0:d.remote)==null?void 0:m.creator)==null?void 0:p.id)===((x=c[0].relayManager.user)==null?void 0:x.id)?r?(r.p(c,f),f[0]&161&&b(r,1)):(r=rx(c),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(se(),k(r,1,1,()=>{r=null}),ae())},i(c){t||(b(r),t=!0)},o(c){k(r),t=!1},d(c){c&&v(e),r&&r.d(c)}}}function rx(o){let e,t,r,n;return e=new Me({props:{name:"Remote Folder"}}),r=new Ie({props:{name:"Remove from relay",description:"Deletes the remote folder from the relay. Local files will be preserved.",$$slots:{default:[CL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment),t=E(),R(r.$$.fragment)},m(s,a){D(e,s,a),_(s,t,a),D(r,s,a),n=!0},p(s,a){let i={};a[1]&32&&(i.$$scope={dirty:a,ctx:s}),r.$set(i)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&v(t),M(e,s),M(r,s)}}}function CL(o){let e,t,r;return{c(){e=C("button"),e.textContent="Delete remote",h(e,"class","mod-destructive")},m(n,s){_(n,e,s),t||(r=K(e,"click",(0,No.debounce)(o[17])),t=!0)},p:q,d(n){n&&v(e),t=!1,r()}}}function IL(o){let e,t,r,n,s,a,i,l=o[7]&&Re().enableAttachmentSync,c,f,u,d,m,p,x,y,g;e=new Gi({props:{category:Br,categoryText:"Shared Folders",$$slots:{default:[hL]},$$scope:{ctx:o}}}),e.$on("goBack",o[15]),r=new Me({props:{name:"Relay Server"}});let I=[yL,gL],T=[];function P(S,L){return S[7]?0:1}s=P(o,[-1,-1]),a=T[s]=I[s](o);let A=l&&Xy(o);f=new Me({props:{name:"Local folder"}}),d=new Ie({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[SL]},$$scope:{ctx:o}}}),p=new Ie({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[kL]},$$scope:{ctx:o}}});let F=o[7]&&tx(o);return{c(){R(e.$$.fragment),t=E(),R(r.$$.fragment),n=E(),a.c(),i=E(),A&&A.c(),c=E(),R(f.$$.fragment),u=E(),R(d.$$.fragment),m=E(),R(p.$$.fragment),x=E(),F&&F.c(),y=he()},m(S,L){D(e,S,L),_(S,t,L),D(r,S,L),_(S,n,L),T[s].m(S,L),_(S,i,L),A&&A.m(S,L),_(S,c,L),D(f,S,L),_(S,u,L),D(d,S,L),_(S,m,L),D(p,S,L),_(S,x,L),F&&F.m(S,L),_(S,y,L),g=!0},p(S,L){let $={};L[0]&2|L[1]&32&&($.$$scope={dirty:L,ctx:S}),e.$set($);let O=s;s=P(S,L),s===O?T[s].p(S,L):(se(),k(T[O],1,1,()=>{T[O]=null}),ae(),a=T[s],a?a.p(S,L):(a=T[s]=I[s](S),a.c()),b(a,1),a.m(i.parentNode,i)),L[0]&128&&(l=S[7]&&Re().enableAttachmentSync),l?A?(A.p(S,L),L[0]&128&&b(A,1)):(A=Xy(S),A.c(),b(A,1),A.m(c.parentNode,c)):A&&(se(),k(A,1,1,()=>{A=null}),ae());let Q={};L[1]&32&&(Q.$$scope={dirty:L,ctx:S}),d.$set(Q);let U={};L[0]&128|L[1]&32&&(U.$$scope={dirty:L,ctx:S}),p.$set(U),S[7]?F?(F.p(S,L),L[0]&128&&b(F,1)):(F=tx(S),F.c(),b(F,1),F.m(y.parentNode,y)):F&&(se(),k(F,1,1,()=>{F=null}),ae())},i(S){g||(b(e.$$.fragment,S),b(r.$$.fragment,S),b(a),b(A),b(f.$$.fragment,S),b(d.$$.fragment,S),b(p.$$.fragment,S),b(F),g=!0)},o(S){k(e.$$.fragment,S),k(r.$$.fragment,S),k(a),k(A),k(f.$$.fragment,S),k(d.$$.fragment,S),k(p.$$.fragment,S),k(F),g=!1},d(S){S&&(v(t),v(n),v(i),v(c),v(u),v(m),v(x),v(y)),M(e,S),M(r,S),T[s].d(S),A&&A.d(S),M(f,S),M(d,S),M(p,S),F&&F.d(S)}}}function LL(o,e,t){let r,n,s,a,i=q,l=()=>(i(),i=Pt(m,te=>t(29,a=te)),m),c,f;o.$$.on_destroy.push(()=>i());let{plugin:u}=e,{sharedFolder:d}=e,{sharedFolders:m}=e;l();let{relayRoles:p}=e;function x(te){return De(this,void 0,void 0,function*(){var re;if(!(!((re=u.loginManager)===null||re===void 0)&&re.user))return;let Y={relay:te.id,quantity:10,user_email:u.loginManager.user.email},xe=btoa(JSON.stringify(Y)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(u.buildApiUrl(`/subscribe/${xe}?action="buy_storage"`),"_blank")})}let y=wr(a,te=>te.find(re=>re===d));ie(o,y,te=>t(5,n=te));let g=d.syncSettingsManager;ie(o,g,te=>t(8,f=te));let I=wr([y,p],([te,re])=>{var Y;return(Y=re.find(xe=>{var $e;return xe.relay===(($e=te==null?void 0:te.remote)===null||$e===void 0?void 0:$e.relay)}))===null||Y===void 0?void 0:Y.relay});ie(o,I,te=>t(7,c=te));let T=wr([y,p],([te,re])=>{var Y,xe,$e;return(($e=(xe=(Y=re.find(_t=>{var Ke;return _t.relay===((Ke=te==null?void 0:te.remote)===null||Ke===void 0?void 0:Ke.relay)}))===null||Y===void 0?void 0:Y.relay)===null||xe===void 0?void 0:xe.storageQuota)===null||$e===void 0?void 0:$e.quota)===0});ie(o,T,te=>t(6,s=te));let P=!1;function A(te,re){return De(this,void 0,void 0,function*(){if(!P&&!s){t(3,P=!0);try{yield g.toggleCategory(te,re),t(4,r=Object.entries(g.getCategories()))}catch(Y){}finally{t(3,P=!1)}}})}let F;Ft(()=>{!d&&F&&F.value===""&&F.focus()});let S=ft();function L(){return De(this,void 0,void 0,function*(){S("goBack",{clear:!0})})}function $(te){te&&S("manageRelay",{relay:te})}function O(){return De(this,void 0,void 0,function*(){yield u.relayManager.deleteRemote(d),u.sharedFolders.notifyListeners()})}function Q(){return De(this,void 0,void 0,function*(){n&&u.sharedFolders.delete(n),S("goBack",{clear:!0})})}function U(){let te=u.vault.getFolderByPath(d.path);te&&u.app.vault.trash(te,!1),S("goBack",{})}function V(te){vr.call(this,o,te)}let oe=()=>{$(c)},ve=(te,re)=>A(te,re.currentTarget.checked),N=te=>A(te,!f[te]),j=te=>A(te,!f[te]),_e=()=>{x(c)},Ne=()=>{U()},Ee=()=>{Q()};o.$$set=te=>{"plugin"in te&&t(0,u=te.plugin),"sharedFolder"in te&&t(1,d=te.sharedFolder),"sharedFolders"in te&&l(t(2,m=te.sharedFolders)),"relayRoles"in te&&t(20,p=te.relayRoles)};e:t(4,r=Object.entries(g.getCategories()));return[u,d,m,P,r,n,s,c,f,x,y,g,I,T,A,L,$,O,Q,U,p,V,oe,ve,N,j,_e,Ne,Ee]}var Ad=class extends W{constructor(e){super(),G(this,e,LL,IL,z,{plugin:0,sharedFolder:1,sharedFolders:2,relayRoles:20},null,[-1,-1])}},Ed=Ad;function TL(o){ye(o,"svelte-d22j3",".relay-version.svelte-d22j3{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-d22j3{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-d22j3{padding-left:48px !important}.system3-announcement.svelte-d22j3{color:var(--text-on-accent)}")}function PL(o){let e,t,r,n,s=o[0].networkStatus.status&&ox(o);return{c(){e=C("div"),t=C("span"),s&&s.c(),h(t,"class","system3-announcement svelte-d22j3"),ne(t,"color",o[0].networkStatus.status.color?o[0].networkStatus.status.color:"var(--text-on-accent)",1),h(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-d22j3"),h(e,"role","button"),h(e,"tabindex","0"),ne(e,"background-color",o[0].networkStatus.status.backgroundColor?o[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},m(a,i){_(a,e,i),w(e,t),s&&s.m(t,null),r||(n=[K(e,"click",o[17]),K(e,"keypress",o[18])],r=!0)},p(a,i){a[0].networkStatus.status?s?s.p(a,i):(s=ox(a),s.c(),s.m(t,null)):s&&(s.d(1),s=null),i&1&&ne(t,"color",a[0].networkStatus.status.color?a[0].networkStatus.status.color:"var(--text-on-accent)",1),i&1&&ne(e,"background-color",a[0].networkStatus.status.backgroundColor?a[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},i:q,o:q,d(a){a&&v(e),s&&s.d(),r=!1,me(n)}}}function FL(o){let e,t;return e=new Jy({}),e.$on("goBack",o[9]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p:q,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function ox(o){let e,t=Bo(o[0].networkStatus.status.status)+"",r;return{c(){e=new Do(!1),r=he(),e.a=r},m(n,s){e.m(t,n,s),_(n,r,s)},p(n,s){s&1&&t!==(t=Bo(n[0].networkStatus.status.status)+"")&&e.p(t)},d(n){n&&(v(r),e.d())}}}function AL(o){let e,t;return e=new ay({props:{plugin:o[0],$$slots:{default:[ML]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&8388609&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function EL(o){let e,t;return e=new ls({props:{plugin:o[0],relayRoles:o[3],relay:o[2],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageSharedFolder",o[7]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&4&&(s.relay=r[2]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function DL(o){let e,t;return e=new Ed({props:{plugin:o[0],relayRoles:o[3],sharedFolder:o[1],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageRelay",o[6]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&2&&(s.sharedFolder=r[1]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function ML(o){let e,t;return e=new qr({props:{relays:o[4],plugin:o[0]}}),e.$on("manageRelay",o[6]),e.$on("manageSharedFolder",o[7]),e.$on("createRelay",o[8]),e.$on("joinRelay",o[11]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function nx(o){let e,t=o[0].version+"",r;return{c(){e=C("span"),r=B(t),h(e,"class","relay-version svelte-d22j3")},m(n,s){_(n,e,s),w(e,r)},p(n,s){s&1&&t!==(t=n[0].version+"")&&X(r,t)},d(n){n&&v(e)}}}function RL(o){let e,t,r,n,s,a,i,l,c,f=[FL,PL],u=[];function d(g,I){return g[2]||g[1]?0:g[0].networkStatus.status?1:-1}~(e=d(o,-1))&&(t=u[e]=f[e](o));let m=[DL,EL,AL],p=[];function x(g,I){return g[1]?0:g[2]?1:2}s=x(o,-1),a=p[s]=m[s](o);let y=o[0].manifest.version!==o[0].version&&nx(o);return{c(){t&&t.c(),r=E(),n=C("div"),a.c(),i=E(),y&&y.c(),l=he(),h(n,"class","vertical-tab-content svelte-d22j3")},m(g,I){~e&&u[e].m(g,I),_(g,r,I),_(g,n,I),p[s].m(n,null),_(g,i,I),y&&y.m(g,I),_(g,l,I),c=!0},p(g,[I]){let T=e;e=d(g,I),e===T?~e&&u[e].p(g,I):(t&&(se(),k(u[T],1,1,()=>{u[T]=null}),ae()),~e?(t=u[e],t?t.p(g,I):(t=u[e]=f[e](g),t.c()),b(t,1),t.m(r.parentNode,r)):t=null);let P=s;s=x(g,I),s===P?p[s].p(g,I):(se(),k(p[P],1,1,()=>{p[P]=null}),ae(),a=p[s],a?a.p(g,I):(a=p[s]=m[s](g),a.c()),b(a,1),a.m(n,null)),g[0].manifest.version!==g[0].version?y?y.p(g,I):(y=nx(g),y.c(),y.m(l.parentNode,l)):y&&(y.d(1),y=null)},i(g){c||(b(t),b(a),c=!0)},o(g){k(t),k(a),c=!1},d(g){g&&(v(r),v(n),v(i),v(l)),~e&&u[e].d(g),p[s].d(),y&&y.d(g)}}}function $L(o,e,t){let r,{plugin:n}=e,{path:s=void 0}=e,a=n.app,i=n.relayManager,l=i.relayRoles,c=i.relays;ie(o,c,O=>t(16,r=O));let f=n.sharedFolders,u,d=qr,m,p=[{component:qr}],{close:x}=e;function y(O){if(t(2,m=void 0),t(1,u=void 0),O==="/"){t(15,d=qr);return}let Q=new URLSearchParams(O.split("?")[1]||""),U=Q.get("id");if(O.startsWith("/relays")){U?(t(2,m=i.relays.find(V=>V.guid===U)),t(15,d=ls)):t(15,d=qr);return}if(O.startsWith("/shared-folders")){if(U){t(1,u=f.find(oe=>oe.guid===U));let V=Q.get("relay");V&&t(2,m=i.relays.get(V)),t(15,d=Ed)}return}}function g(O){p.push({currentRelay:m,sharedFolder:u,component:d}),t(2,m=O.detail.relay),t(1,u=void 0),t(15,d=ls)}function I(O){p.push({currentRelay:m,sharedFolder:u,component:d}),t(1,u=O.detail.folder),t(2,m=O.detail.relay)}function T(O){return De(this,void 0,void 0,function*(){p.push({currentRelay:m,sharedFolder:u,component:d}),t(2,m=yield n.relayManager.createRelay("")),t(15,d=ls)})}function P(O){if(O.detail.clear){p.length=0,t(2,m=void 0),t(1,u=void 0),t(15,d=qr);return}let Q=p.pop();if(Q)for(;Q;){if(!Q.currentRelay&&!Q.sharedFolder)t(2,m=Q.currentRelay),t(1,u=Q.sharedFolder),t(15,d=Q.component);else if(Q.sharedFolder&&f.has(Q.sharedFolder)){t(2,m=Q.currentRelay),t(1,u=Q.sharedFolder),t(15,d=Q.component);break}else if(Q.currentRelay&&i.relays.get(Q.currentRelay.id)){t(2,m=Q.currentRelay),t(1,u=Q.sharedFolder),t(15,d=Q.component);break}Q=p.pop()}else t(2,m=void 0),t(1,u=void 0),t(15,d=qr)}function A(O){p.length=0,x()}function F(O){t(2,m=O.detail.relay),t(15,d=ls)}function S(){var O;!((O=n.networkStatus.status)===null||O===void 0)&&O.versions&&(n.releaseSettings.get().channel==="stable"?n.installVersion(n.networkStatus.status.versions.stable):n.releaseSettings.get().channel==="beta"&&n.installVersion(n.networkStatus.status.versions.beta))}let L=()=>{var O,Q;(O=n.networkStatus.status)!=null&&O.versions?S():(Q=n.networkStatus.status)!=null&&Q.link&&window.open(n.networkStatus.status.link)},$=()=>{var O,Q;(O=n.networkStatus.status)!=null&&O.versions?S():(Q=n.networkStatus.status)!=null&&Q.link&&window.open(n.networkStatus.status.link)};return o.$$set=O=>{"plugin"in O&&t(0,n=O.plugin),"path"in O&&t(13,s=O.path),"close"in O&&t(14,x=O.close)},o.$$.update=()=>{if(o.$$.dirty&8192){e:s&&y(s)}if(o.$$.dirty&65540){e:m&&!r.has(m.id)&&(t(2,m=void 0),t(15,d=qr))}if(o.$$.dirty&2){e:u&&!f.has(u)&&(t(1,u=void 0),t(15,d=qr))}if(o.$$.dirty&32774){e:(d||m||u)&&setTimeout(()=>{let O=document.querySelector(".vertical-tab-content");O&&(O.scrollTop=0)},0)}},[n,u,m,l,c,f,g,I,T,P,A,F,S,s,x,d,r,L,$]}var Dd=class extends W{constructor(e){super(),G(this,e,$L,RL,z,{plugin:0,path:13,close:14},TL)}},sx=Dd;var Yi=class extends ax.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new sx({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(t){var r;(r=this.component)==null||r.$set({path:t})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var el=require("obsidian");var Zi=class extends zs{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(n){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let n=r;typeof r!="string"&&(n=JSON.stringify(r)),window.localStorage.setItem(t,n)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var tl=class extends Ve{constructor(t,r,n,s){var i;super();this.beforeLogin=s;let a=be("[Pocketbase]","debug");this.authStore=new Zi(`pocketbase_auth_${t}`),this.pb=new Jn("https://auth.system3.md",this.authStore),this.pb.beforeSend=(l,c)=>(a(l,c),c.fetch=nt,c.headers=Object.assign({},c.headers,{"Relay-Version":"0.5.6"}),{url:l,options:c}),this.refreshToken(),n.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(i=this.pb.authStore.model)!=null&&i.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).then(()=>{this.getFlags()}).catch(l=>{l.status===404&&this.logout()}),ht.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,n]=r.split("."),s=JSON.parse(atob(n)),a=new Date(s.exp*1e3),i=new Date,l=Math.ceil((a.getTime()-i.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:a.toLocaleString(),expiresIn:`${l} days`,userId:s.id,email:s.email})}))}setup(t){var r,n;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(r=t==null?void 0:t.meta)==null?void 0:r.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(n=t.meta)==null?void 0:n.rawUser}).then(()=>{this.notifyListeners()}).catch(s=>{this.log(s)}),!0):(this.notifyListeners(),!1)}async checkRelayHost(t){let r={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.5.6"};return(0,el.requestUrl)({url:`https://api.system3.md/relay/${t}/check-host`,method:"GET",headers:r})}getFlags(){let t={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.5.6"};(0,el.requestUrl)({url:"https://api.system3.md/flags",method:"GET",headers:t}).then(r=>{if(r.status===200){let n=r.json;gt.getInstance().applyServerFlags(n)}}).catch(r=>{this.log(r)})}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,el.requestUrl)({url:"https://api.system3.md/whoami",method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}get hasUser(){return this.user!==void 0}makeUser(t,r){var n,s,a,i;return new qi((n=t.model)==null?void 0:n.id,((s=t.model)==null?void 0:s.name)||(r==null?void 0:r.name),(a=t.model)==null?void 0:a.email,((i=t.model)==null?void 0:i.picture)||(r==null?void 0:r.picture),t.token)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}webviewIntercept(){let t=this.pb.buildUrl("/api/oauth2-redirect"),r="https:\\/\\/accounts\\.google\\.com\\/o\\/oauth2\\/auth";return new RegExp(`^${r}.*?[?&]redirect_uri=(${t}|${encodeURIComponent(t)})`,"i")}async initiateManualOAuth2CodeFlow(t){this.beforeLogin();let n=(await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError})).authProviders[0],s=this.pb.buildUrl("/api/oauth2-redirect");return[n.authUrl+s,n,async a=>this.pb.collection("users").authWithOAuth2Code(n.name,a,n.codeVerifier,s,{fetch:t}).then(i=>(this.setup(i),i))]}async poll(t,r){let n=0,s=1e3;return new Promise((a,i)=>{let l=setInterval(()=>{if(n+=1,n>=30)return clearInterval(l),i(new Error(`Auth timeout: Timed out after ${n*s/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.state.slice(0,15)).then(c=>{if(c)return clearInterval(l),a(r(c.code))}).catch(c=>{})},s)})}async login(){this.beforeLogin();let t=await this.pb.collection("users").authWithOAuth2({provider:"google"});return this.setup(t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,n)=>{let s=()=>{this.loggedIn&&(this.off(s),r(!0)),r(!1)};this.on(s)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};var wt=crypto;var Vr=new TextEncoder,Jt=new TextDecoder,X6=2**32;var ix=o=>{let e=o;typeof e=="string"&&(e=Vr.encode(e));let t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))},_r=o=>ix(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),lx=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},un=o=>{let e=o;e instanceof Uint8Array&&(e=Jt.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return lx(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var Md={};Hl(Md,{JOSEAlgNotAllowed:()=>na,JOSEError:()=>yt,JOSENotSupported:()=>st,JWEDecryptionFailed:()=>sa,JWEInvalid:()=>Qt,JWKInvalid:()=>ol,JWKSInvalid:()=>nl,JWKSMultipleMatchingKeys:()=>sl,JWKSNoMatchingKey:()=>aa,JWKSTimeout:()=>al,JWSInvalid:()=>uo,JWSSignatureVerificationFailed:()=>ia,JWTClaimValidationFailed:()=>oa,JWTExpired:()=>rl,JWTInvalid:()=>Et});var yt=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},oa=class extends yt{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},rl=class extends yt{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},na=class extends yt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},st=class extends yt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},sa=class extends yt{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},Qt=class extends yt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},uo=class extends yt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},Et=class extends yt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},ol=class extends yt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},nl=class extends yt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},aa=class extends yt{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},sl=class extends yt{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},al=class extends yt{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},ia=class extends yt{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var il=wt.getRandomValues.bind(wt);function HL(o){return typeof o=="object"&&o!==null}function Dt(o){if(!HL(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var ZL=Symbol();var c2,fl,bx;(typeof navigator=="undefined"||!((bx=(fl=navigator.userAgent)==null?void 0:fl.startsWith)!=null&&bx.call(fl,"Mozilla/5.0 ")))&&(c2="jose/v5.3.0");var Ud={};Hl(Ud,{decode:()=>ul,encode:()=>f2});var f2=_r,ul=un;function Od(o){if(typeof o!="string")throw new Et("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new Et("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new Et("Invalid JWT");if(!e)throw new Et("JWTs must contain a payload");let r;try{r=ul(e)}catch(s){throw new Et("Failed to base64url decode the payload")}let n;try{n=JSON.parse(Jt.decode(r))}catch(s){throw new Et("Failed to parse the decoded payload as JSON")}if(!Dt(n))throw new Et("Invalid JWT Claims Set");return n}var dn=class extends Error{constructor(e){super(e),this.name="[System3] Relay Error"}};function vx(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function u2(o){let e=Od(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var dl=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=u2,this.maxConnections=t,this.refreshInterval=null,ht.set(this,"TokenStore")}onRefresh(e){return new Promise((r,n)=>{let s=i=>{r(i)},a=i=>{this.removeFromRefreshQueue(e),n(i)};this.refresh(e,s,a)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=n=>{this.onTokenRefreshed(e,n),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let n=this.tokenMap.get(e),s=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...n,token:t,expiryTime:r}),s(t),this.log(`Token refreshed for ${n.friendlyName} (${e})`)}}onRefreshFailure(e){let t=this.tokenMap.get(e),r=(t==null?void 0:t.attempts)||0+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){let n=this._activePromises.get(e);if(n)return n;this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:0}),this.callbacks.set(e,r);let s=this.onRefresh(e).then(a=>(this.onTokenRefreshed(e,a),this._activePromises.delete(e),a)).catch(a=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),a});return this._activePromises.set(e,s),s}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new dn("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let n=this.tokenMap.get(e);if(n.token&&this.isTokenValid(n))return this.callbacks.set(e,r),n.friendlyName=t,r(n.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(n.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),n=Array.from(this.tokenMap.entries()).sort((s,a)=>s[1].expiryTime-a[1].expiryTime);for(let[s,{friendlyName:a,expiryTime:i,attempts:l}]of n){if(!e(s))continue;let c=i-r,f="";c>0?f=`expires in ${vx(c-this.expiryMargin)}`:f="expired",t.push(`${s} (${a}): ${l} attempts, (${f})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${vx(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(e){e?this.tokenMap.forEach((t,r)=>{e(t)&&(this.tokenMap.delete(r),this.refreshQueue.delete(r))}):(this.tokenMap.clear(),this.refreshQueue.clear())}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};function d2(o){return o.expiryTime||0}function p2(o,e){return(...t)=>e(o,...t)}async function m2(o,e,t,r){var c;let n=be("[TokenStore][Refresh]","debug"),s=be("[TokenStore][Refresh]","error");n(`${e}`);let a=je.decode(e),i;if(a instanceof nr)i=JSON.stringify({docId:a.documentId,relay:a.relayId,folder:a.folderId});else if(a instanceof Lt)i=JSON.stringify({docId:a.canvasId,relay:a.relayId,folder:a.folderId});else if(a instanceof Yr)i=JSON.stringify({docId:a.folderId,relay:a.relayId,folder:a.folderId});else if(a instanceof Zr)i=JSON.stringify({docId:a.fileId,relay:a.relayId,folder:a.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(c=o.user)==null?void 0:c.token}`,"Relay-Version":"0.5.6"};try{let f=await nt("https://api.system3.md/token",{method:"POST",headers:l,body:i});if(!f.ok){n(f.status,await f.text()),r(Error(`Received status code ${f.status} from an API.`));return}let u=await f.json();t(u)}catch(f){s(f,i),r(f)}}var pl=class extends dl{constructor(t,r,n,s=5){super({log:be("[LiveTokenStore]","debug"),refresh:p2(t,m2),getJwtExpiry:d2,getStorage:function(){return new no("TokenStore/"+n)},getTimeProvider:()=>r},s);this.loginManager=t}async getFileTokenFromNetwork(t,r,n,s){let a=`${t}${r}`,i=this._activePromises.get(a);if(i)return i;this.tokenMap.set(t,{token:null,expiryTime:0,attempts:0});let l=this.fetchFileToken(t,r,n,s).then(c=>{let f=this.getJwtExpiry(c),u=this.tokenMap.get(a);return this.tokenMap.set(r,{...u,token:c,expiryTime:f}),this._activePromises.delete(a),c}).catch(c=>{throw this._activePromises.delete(a),c});return this._activePromises.set(a,l),l}async fetchFileToken(t,r,n,s){var d;let a=be("[TokenStore][Fetch]","debug");a(`${t}`);let i=je.decode(t),l;if(i instanceof Zr)l=JSON.stringify({docId:i.fileId,relay:i.relayId,folder:i.folderId,hash:r,contentType:n,contentLength:s});else throw new Error(`No remote to connect to for ${t}`);if(!this.loginManager.loggedIn)throw new Error("Not logged in");let c={Authorization:`Bearer ${(d=this.loginManager.user)==null?void 0:d.token}`,"Relay-Version":"0.5.6"},f=await nt("https://api.system3.md/file-token",{method:"POST",headers:c,body:l});if(!f.ok){a(f.status,await f.text());let m=await f.json();throw new Error(m.error)}return await f.json()}async getFileToken(t,r,n,s){let a=`${t}${r}`,i=this.tokenMap.get(a);return i&&i.token&&this.isTokenValid(i)?(this.log("token was valid, cache hit!"),this._activePromises.delete(a),Promise.resolve(i.token)):this.getFileTokenFromNetwork(t,r,n,s)}};var wx=require("obsidian");var Bd=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=be("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,wx.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"0.5.6"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,this.onOffline.forEach(t=>t(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},_x=Bd;function Nd(o){return typeof o.id=="string"}function h2(o){return typeof o.name=="string"}var Hd=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function Sx(o){return typeof o.aggregate_root=="object"}function kx(o){return typeof o.acl=="object"}var ca=class{get aggregate_root(){}get acl(){}},qd=class extends Ve{constructor(t,r){super();this.storageQuota=t;this.relays=r}update(t){return this.storageQuota=t,this}get id(){return this.storageQuota.id}get quota(){return this.storageQuota.quota}get pending(){return this.storageQuota.pending}get usage(){return this.storageQuota.usage}get maxFileSize(){return this.storageQuota.max_file_size}get updated(){return this.storageQuota.updated}get created(){return this.storageQuota.created}},Vd=class{constructor(e,t,r){this.subscribeRecord=e;this.storageQuota=t;this.relays=r;this.collectionName="storage_quotas"}items(){return this.storageQuota.values()}clear(){this.storageQuota.clear()}get(e){return this.storageQuota.get(e)}ingest(e){let t=this.storageQuota.get(e.id);if(t)return t.update(e),this.storageQuota.notifyListeners(),t;let r=new qd(e,this.relays);return this.subscribeRecord(this.collectionName,e.id,[]).then(n=>{r.offRecordSubscription=n}),this.storageQuota.set(e.id,r),r}delete(e){var r;let t=this.storageQuota.get(e);(r=t==null?void 0:t.offRecordSubscription)==null||r.call(t),this.storageQuota.delete(e)}},ml=class extends ca{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}get email(){return this.user.email}get picture(){return this.user.picture}update(t){return this.user=t,this}},zd=class extends Ve{constructor(t){super();this.provider=t}get id(){return this.provider.id}get name(){return this.provider.name}get url(){return this.provider.url}get selfHosted(){return this.provider.self_hosted}update(t){return this.provider=t,this}},Wd=class{constructor(e){this.providers=e;this.collectionName="providers"}items(){return this.providers.values()}clear(){this.providers.clear()}get(e){return this.providers.get(e)}ingest(e){let t=this.providers.get(e.id);if(t)return t.update(e),this.providers.notifyListeners(),t;let r=new zd(e);return this.providers.set(e.id,r),r}delete(e){this.providers.delete(e)}},Kd=class extends ca{constructor(t,r,n){super();this.remoteFolder=t;this.relays=r;this.users=n}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get aggregate_root(){return["relays",this.remoteFolder.relay]}get acl(){return["relays",this.remoteFolder.relay]}},Gd=class{constructor(e,t,r){this.remoteFolders=e;this.relays=t;this.users=r;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new Kd(e,this.relays,this.users);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},jd=class{constructor(e,t,r,n,s,a,i,l,c){this.relays=e;this.roles=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this.subscriptions=a;this.storageQuotas=i;this.providers=l;this.user=c;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new hl(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},Jd=class{constructor(e,t,r,n){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=n}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new ep(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},Qd=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new tp(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},Xd=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new ml(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},Yd=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new rp(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},Zd=class extends it{constructor(t){super();this.collections=new Map,this.relationships=new Map;for(let r of t)this.collections.set(r.collectionName,r);ht.set(this,"Store")}getCollection(t){let r=this.collections.get(t);if(!r)throw this.error("No collection found for",t),new Error("No collection found for "+t);return r}clear(){let t=ar.getInstance();t.beginTransaction(),this.collections.forEach(r=>{r.clear()}),this.collections.clear(),this.relationships.clear(),t.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(t){return this.ingestBatch(t==null?void 0:t.items)}ingestBatch(t){if(t)return t.map(r=>this.ingest(r))}ingest(t){let r=ar.getInstance();r.beginTransaction();let n=this._ingest(t);return r.commitTransaction(),n}_ingest(t){if(!t)return;let r,n=this.collections.get(t.collectionName);if(n?r=n.ingest(t):this.error("No collection found for record",t),Sx(r)){let s=r.aggregate_root;if(s){let a=t.id,i=this.relationships.get(s.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(s.join(":"),i)}}if(kx(r)){let s=r.acl;if(s){let a=t.id,i=this.relationships.get(s.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(s.join(":"),i)}}if(t.expand)for(let[,s]of Object.entries(t.expand))Array.isArray(s)?this.ingestBatch(s):this.ingest(s);return r}delete(t){this.cascade(t.collectionName,t.id)}graphviz(){let t=`digraph G {
`;for(let[r,n]of this.collections)for(let s of n.items()){if(!Nd(s)){this.warn("record has no id",s);continue}let a=r+"_"+s.id;if(h2(s)&&(a=r+"_"+s.name),t+=`  ${r}_${s.id} [label="${a}"];
`,Nd(s)&&Sx(s)&&s.aggregate_root){let[i,l]=s.aggregate_root;t+=`  ${r}_${s.id} -> ${i}_${l};
`}if(Nd(s)&&kx(s)&&s.acl){let[i,l]=s.acl;t+=`  ${r}_${s.id} -> ${i}_${l} [style=dotted];
`}}return t+="}",t}cascade(t,r){let n=this.collections.get(t),s=this.relationships.get([t,r].join(":")),a=ar.getInstance();a.beginTransaction(),n&&(this.warn("cascade delete parent",t,r),n.delete(r)),this.relationships.delete([t,r].join(":"));for(let i of s||[]){let[l,c]=i.split(":");this.warn("cascade delete child",l,c),this.getCollection(l)&&this.cascade(l,c)}a.commitTransaction()}},ep=class extends ca{constructor(t,r,n,s){super();this.users=n,this.roles=s,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return t}get aggregate_root(){return["relays",this.relayRole.relay]}get acl(){return["users",this.relayRole.user]}},tp=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get enabled(){return this.relayInvitation.enabled}get aggregate_root(){return["relays",this.relayInvitation.relay]}},rp=class extends Ve{constructor(t,r,n){super();this.subscription=t;this.relays=r;this.users=n}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get acl(){return["users",this.subscription.user]}},hl=class extends Ve{constructor(t,r,n,s,a,i,l,c){super();this.relay=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this._subscriptions=a;this.storageQuotas=i;this.providers=l;this.user=c}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get userLimit(){return this.relay.user_limit}get role(){var n;let t=this.relay.creator===this.user.id,r=(n=this.relayRoles.find(s=>s.relayId===this.relay.id&&s.userId===this.user.id))==null?void 0:n.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get storageQuota(){return this.storageQuotas.find(t=>t.id===this.relay.storage_quota)}get storageQuotaId(){return this.relay.storage_quota}get folders(){return this.remoteFolders.filter(t=>t.relay.id===this.id)}get subscriptions(){return this._subscriptions.filter(t=>t.relay.id===this.id)}get acl(){var r;let t=(r=this.relayRoles.find(n=>n.relayId===this.id&&n.userId===this.user.id))==null?void 0:r.id;if(t)return["relay_roles",t]}get provider(){if(this.relay.provider)return this.providers.get(this.relay.provider)}get providerId(){return this.relay.provider}},gl=class extends it{constructor(t){super();this.loginManager=t;this.destroyed=!1;this._handleEvent=(t,r)=>{var n,s;this.debug(`[Event]: ${t}`,r.action,r.record),r.action==="delete"?(n=this.store)==null||n.delete(r.record):(s=this.store)==null||s.ingest(r.record)};this.pb=this.loginManager.pb,this.users=new At("users"),this.relays=new At("relays"),this.providers=new At("providers"),this.remoteFolders=new At("remote folders"),this.relayInvitations=new At("relay invitations"),this.relayRoles=new At("relay roles"),this.roles=new At("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new At("subscriptions"),this.storageQuotas=new At("storage quotas"),this._offLoginManager=this.loginManager.on(()=>{this.login()}),this.setUser(),this.user&&(ht.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user)return;if(!this.pb){console.warn("no pb!");return}if(this.store)return;let t=new Hd(this.roles),r=new Xd(this.users),n=new Wd(this.providers),s=new jd(this.relays,this.roles,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user),a=new Jd(this.relayRoles,this.relays,this.users,this.roles),i=new Qd(this.relayInvitations,this.relays,this.roles),l=new Gd(this.remoteFolders,this.relays,this.users),c=new Yd(this.subscriptions,this.relays,this.users),f=new Vd(this.subscribeRecord.bind(this),this.storageQuotas,this.relays);this.store=new Zd([t,r,s,a,i,l,c,f,n])}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new ml(this.authUser),this.users.set(this.user.id,this.user))}login(){this.setUser(),this.buildGraph(),this.subscribe(),this.update()}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async rotateKey(t){if(!this.pb)throw new Error("missing pocketbase");return this.pb.send("/api/rotate-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then(r=>{var s;let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("unable to rotate key");return n})}async toggleRelayInvitation(t,r){if(!this.pb)throw new Error("missing pocketbase");return this.pb.collection("relay_invitations").update(t.id,{enabled:r}).then(n=>{var a;let s=(a=this.store)==null?void 0:a.ingest(n);if(!s)throw new Error("unable to toggle invitation enable");return s})}async getRelayInvitation(t){if(!this.pb)return;let r=this.relayInvitations.find(n=>n.relay.id===t.id);return r||this.pb.collection("relay_invitations").getList(0,200).then(n=>{n.items.forEach(a=>{var i;(i=this.store)==null||i.ingest(a)});let s=this.relayInvitations.find(a=>a.relay.id===t.id);if(s)return s})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,n=await this.pb.send(r,{method:"POST"});if(n!==200)throw new Error("Token API failed");return n.json().token}async subscribe(){var r;if(!this.pb||!this.pb.authStore.isValid||((r=this.pb.authStore.model)==null?void 0:r.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","subscriptions_via_relay.relay.storage_quota","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"providers",expand:[]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"subscriptions",expand:["user","relay"]}];for(let n of t)this.pb.collection(n.name).subscribe("*",s=>this._handleEvent(n.name,s),{expand:n.expand.join(","),fetch:nt})}async subscribeRecord(t,r,n){var s;if(!this.pb||!this.pb.authStore.isValid||((s=this.pb.authStore.model)==null?void 0:s.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}return this.pb.collection(t).subscribe(r,a=>this._handleEvent(t,a),{expand:n.join(","),fetch:nt})}async update(){let t=(n,s={})=>{var a;return!this.pb||!this.pb.authStore.isValid||((a=this.pb.authStore.model)==null?void 0:a.id)===void 0?Promise.resolve([]):(typeof s=="function"&&(s=s(this.pb.authStore.model.id)),this.pb.collection(n).getFullList(s))};[t("users",n=>({filter:`id="${n}"`,expand:["relay_roles_via_user","relay_roles_via_user.relay","relay_roles_via_user.relay.storage_quota","relay_roles_via_user.role"].join(",")})),t("relay_roles",{expand:"user"}),t("providers"),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("subscriptions",{expand:"relay,user"})].forEach(async n=>{let s=await n;for(let a of s)!this.destroyed&&this.store&&this.store.ingest(a)})}async acceptInvitation(t){var s;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})}).catch(a=>{throw a});this.debug("[InviteAccept]",r);let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to accept invitation");return n}async createRelay(t){var a;let r=jn(),n=await((a=this.pb)==null?void 0:a.collection("relays").create({guid:r,name:t,path:null},{expand:"relay_roles_via_relay,relay_invitations_via_relay,storage_quota"}));if(!n)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let s=new hl(n,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user);return this.relays.set(s.id,s),s}async updateRelay(t){var s;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to update relay");return n}async deleteRemote(t){var n;t.remote=void 0;let r=this.remoteFolders.find(s=>s.guid===t.guid);return r?(await((n=this.pb)==null?void 0:n.collection("shared_folders").delete(r.id)),t.remote=void 0,!0):!1}async createRemoteFolder(t,r){var a,i;if(!this.pb)throw new Error("Failed to create folder");let n=await this.pb.collection("shared_folders").create({name:t.name,guid:t.guid,relay:r.id,creator:(a=this.user)==null?void 0:a.id,private:!1},{expand:"relay"}),s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("Failed to create folder");return s}async destroyRelay(t){var r,n;return(r=this.store)==null||r.cascade("relays",t.id),await((n=this.pb)==null?void 0:n.collection("relays").delete(t.id)),!0}async leaveRelay(t){var n,s;let r=this.relayRoles.find(a=>{var i;return a.userId===((i=this.user)==null?void 0:i.id)&&a.relayId===t.id});r?await((n=this.pb)==null?void 0:n.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(s=this.store)==null||s.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}destroy(){var t,r,n;this.destroyed=!0,(t=this._offLoginManager)==null||t.call(this),this._offLoginManager=null,(r=this.pb)==null||r.cancelAllRequests(),this.loginManager=null,(n=this.store)==null||n.destroy(),this.pb=null,this.authUser=null,this.store=null}};var Zb=require("obsidian");var Px=require("obsidian");var Lx=require("obsidian");function g2(o){ye(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function Cx(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function Ix(o){let e,t,r,n=o[8]+"",s,a,i,l,c=o[8]+"",f,u,d,m,p,x,y,g,I,T,P,A;function F(){return o[6](o[8])}function S(){return o[7](o[8])}return{c(){e=C("div"),t=C("div"),r=C("div"),s=B(n),a=E(),i=C("div"),l=B("Toggle "),f=B(c),u=B(" on or off"),d=E(),m=C("div"),p=C("div"),x=C("input"),g=E(),I=C("div"),h(r,"class","setting-item-name"),h(i,"class","setting-item-description"),h(t,"class","setting-item-info"),h(x,"type","checkbox"),h(x,"tabindex","-1"),x.checked=y=o[9],h(I,"class","checkbox-toggle"),h(p,"role","checkbox"),h(p,"aria-checked",T=o[9]),h(p,"tabindex","0"),h(p,"class","checkbox-container svelte-4kkvmr"),Ae(p,"is-enabled",o[9]),h(m,"class","setting-item-control"),h(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(L,$){_(L,e,$),w(e,t),w(t,r),w(r,s),w(t,a),w(t,i),w(i,l),w(i,f),w(i,u),w(e,d),w(e,m),w(m,p),w(p,x),w(p,g),w(p,I),P||(A=[K(p,"keypress",F),K(p,"click",S)],P=!0)},p(L,$){o=L,$&2&&n!==(n=o[8]+"")&&X(s,n),$&2&&c!==(c=o[8]+"")&&X(f,c),$&2&&y!==(y=o[9])&&(x.checked=y),$&2&&T!==(T=o[9])&&h(p,"aria-checked",T),$&2&&Ae(p,"is-enabled",o[9])},d(L){L&&v(e),P=!1,me(A)}}}function y2(o){let e,t,r,n,s,a,i,l,c,f=we(Object.entries(o[1])),u=[];for(let d=0;d<f.length;d+=1)u[d]=Ix(Cx(o,f,d));return{c(){e=C("div"),t=C("h2"),t.textContent="Feature Flags",r=E();for(let d=0;d<u.length;d+=1)u[d].c();n=E(),s=C("div"),a=C("div"),i=C("button"),i.textContent="Apply",h(i,"aria-label","apply flag settings"),h(i,"tabindex","0"),h(a,"class","setting-item-control"),h(s,"class","setting-item"),h(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(d,m){_(d,e,m),w(e,t),w(e,r);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(e,null);w(e,n),w(e,s),w(s,a),w(a,i),l||(c=[K(i,"click",function(){Be(o[0])&&o[0].apply(this,arguments)}),K(i,"keypress",function(){Be(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(d,[m]){if(o=d,m&26){f=we(Object.entries(o[1]));let p;for(p=0;p<f.length;p+=1){let x=Cx(o,f,p);u[p]?u[p].p(x,m):(u[p]=Ix(x),u[p].c(),u[p].m(e,n))}for(;p<u.length;p+=1)u[p].d(1);u.length=f.length}},i:q,o:q,d(d){d&&v(e),He(u,d),l=!1,me(c)}}}function x2(o,e,t){let r,n,{reload:s}=e,a=gt.getInstance();ie(o,a,u=>t(5,n=u));function i(u){let d=!r[u];t(1,r[u]=d,r),a.setFlag(u,r[u])}function l(u){return u in r}Ft(()=>{Object.keys(r).forEach(u=>{let d=document.getElementById(`toggle-${u}`);d&&(0,Lx.setIcon)(d,"check")})});let c=u=>{if(!l(u))throw new Error("Unexpected feature flag!");i(u)},f=u=>{if(!l(u))throw new Error("Unexpected feature flag!");i(u)};return o.$$set=u=>{"reload"in u&&t(0,s=u.reload)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(1,r=Object.assign({},n.flags))}},[s,r,a,i,l,n,c,f]}var op=class extends W{constructor(e){super(),G(this,e,x2,y2,z,{reload:0},g2)}},Tx=op;var yl=class extends Px.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new Tx({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Bx=require("obsidian");var Ux=require("obsidian");function Fx(o,e,t){let r=o.slice();return r[13]=e[t],r}function Ax(o,e,t){let r=o.slice();return r[16]=e[t],r}function b2(o){let e,t,r;return{c(){e=C("button"),e.textContent="Refresh"},m(n,s){_(n,e,s),t||(r=K(e,"click",(0,Ux.debounce)(o[12])),t=!0)},p:q,d(n){n&&v(e),t=!1,r()}}}function v2(o){let e=navigator.userAgent+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p:q,d(r){r&&v(t)}}}function w2(o){let e;return{c(){e=B(o[1])},m(t,r){_(t,e,r)},p(t,r){r&2&&X(e,t[1])},d(t){t&&v(e)}}}function _2(o){let e;return{c(){e=B(o[2])},m(t,r){_(t,e,r)},p(t,r){r&4&&X(e,t[2])},d(t){t&&v(e)}}}function S2(o){let e;return{c(){e=B(o[3])},m(t,r){_(t,e,r)},p(t,r){r&8&&X(e,t[3])},d(t){t&&v(e)}}}function k2(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&X(t,e)},d(r){r&&v(t)}}}function Ex(o){let e,t=`${o[16]}`,r,n;return{c(){e=C("div"),r=B(t),n=E()},m(s,a){_(s,e,a),w(e,r),w(e,n)},p(s,a){a&16&&t!==(t=`${s[16]}`)&&X(r,t)},d(s){s&&v(e)}}}function C2(o){let e,t=we(Object.keys(o[4].cancelControllers)),r=[];for(let n=0;n<t.length;n+=1)r[n]=Ex(Ax(o,t,n));return{c(){e=C("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){_(n,e,s);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(n,s){if(s&16){t=we(Object.keys(n[4].cancelControllers));let a;for(a=0;a<t.length;a+=1){let i=Ax(n,t,a);r[a]?r[a].p(i,s):(r[a]=Ex(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&v(e),He(r,n)}}}function Dx(o){let e,t=`${o[13]}`,r,n;return{c(){e=C("div"),r=B(t),n=E()},m(s,a){_(s,e,a),w(e,r),w(e,n)},p(s,a){a&32&&t!==(t=`${s[13]}`)&&X(r,t)},d(s){s&&v(e)}}}function I2(o){let e,t=we(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Dx(Fx(o,t,n));return{c(){e=C("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){_(n,e,s);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(n,s){if(s&32){t=we(n[5]);let a;for(a=0;a<t.length;a+=1){let i=Fx(n,t,a);r[a]?r[a].p(i,s):(r[a]=Dx(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&v(e),He(r,n)}}}function L2(o){let e,t,r,n,s,a,i,l,c,f,u,d,m,p,x,y,g,I,T,P,A,F,S;return n=new Me({props:{name:"Environment",$$slots:{default:[b2]},$$scope:{ctx:o}}}),a=new Ie({props:{name:"User Agent",description:"",$$slots:{default:[v2]},$$scope:{ctx:o}}}),l=new Ie({props:{name:"Fetch",description:"",$$slots:{default:[w2]},$$scope:{ctx:o}}}),f=new Ie({props:{name:"Response",description:"",$$slots:{default:[_2]},$$scope:{ctx:o}}}),d=new Ie({props:{name:"Blink Fetch",description:"",$$slots:{default:[S2]},$$scope:{ctx:o}}}),p=new Ie({props:{name:"Startup Time",description:"",$$slots:{default:[k2]},$$scope:{ctx:o}}}),y=new Me({props:{name:"Connections"}}),I=new Ie({props:{name:"",description:"",$$slots:{description:[C2]},$$scope:{ctx:o}}}),P=new Me({props:{name:"Log Files"}}),F=new Ie({props:{name:"",description:"",$$slots:{description:[I2]},$$scope:{ctx:o}}}),{c(){e=C("div"),e.textContent="Debug Info",t=E(),r=C("div"),R(n.$$.fragment),s=E(),R(a.$$.fragment),i=E(),R(l.$$.fragment),c=E(),R(f.$$.fragment),u=E(),R(d.$$.fragment),m=E(),R(p.$$.fragment),x=E(),R(y.$$.fragment),g=E(),R(I.$$.fragment),T=E(),R(P.$$.fragment),A=E(),R(F.$$.fragment),h(e,"class","modal-title"),h(r,"class","modal-content")},m(L,$){_(L,e,$),_(L,t,$),_(L,r,$),D(n,r,null),w(r,s),D(a,r,null),w(r,i),D(l,r,null),w(r,c),D(f,r,null),w(r,u),D(d,r,null),w(r,m),D(p,r,null),w(r,x),D(y,r,null),w(r,g),D(I,r,null),w(r,T),D(P,r,null),w(r,A),D(F,r,null),S=!0},p(L,[$]){let O={};$&524288&&(O.$$scope={dirty:$,ctx:L}),n.$set(O);let Q={};$&524288&&(Q.$$scope={dirty:$,ctx:L}),a.$set(Q);let U={};$&524290&&(U.$$scope={dirty:$,ctx:L}),l.$set(U);let V={};$&524292&&(V.$$scope={dirty:$,ctx:L}),f.$set(V);let oe={};$&524296&&(oe.$$scope={dirty:$,ctx:L}),d.$set(oe);let ve={};$&524289&&(ve.$$scope={dirty:$,ctx:L}),p.$set(ve);let N={};$&524304&&(N.$$scope={dirty:$,ctx:L}),I.$set(N);let j={};$&524320&&(j.$$scope={dirty:$,ctx:L}),F.$set(j)},i(L){S||(b(n.$$.fragment,L),b(a.$$.fragment,L),b(l.$$.fragment,L),b(f.$$.fragment,L),b(d.$$.fragment,L),b(p.$$.fragment,L),b(y.$$.fragment,L),b(I.$$.fragment,L),b(P.$$.fragment,L),b(F.$$.fragment,L),S=!0)},o(L){k(n.$$.fragment,L),k(a.$$.fragment,L),k(l.$$.fragment,L),k(f.$$.fragment,L),k(d.$$.fragment,L),k(p.$$.fragment,L),k(y.$$.fragment,L),k(I.$$.fragment,L),k(P.$$.fragment,L),k(F.$$.fragment,L),S=!1},d(L){L&&(v(e),v(t),v(r)),M(n),M(a),M(l),M(f),M(d),M(p),M(y),M(I),M(P),M(F)}}}function Mx(){try{return Response.toString()}catch(o){return"undefined"}}function Rx(){try{return fetch.toString()}catch(o){return"undefined"}}function $x(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function T2(o,e,t){let r,n,s,a,i,{plugin:l}=e,c=de(Mx());ie(o,c,y=>t(2,n=y));let f=de(Rx());ie(o,f,y=>t(1,r=y));let u=de($x());ie(o,u,y=>t(3,s=y));let d=de(l.loginManager.pb);ie(o,d,y=>t(4,a=y));let m=de([]);ie(o,m,y=>t(5,i=y)),ei().then(y=>{m.set(y)});function p(){c.set(Mx()),f.set(Rx()),u.set($x()),d.set(l.loginManager.pb)}let x=()=>{p()};return o.$$set=y=>{"plugin"in y&&t(0,l=y.plugin)},[l,r,n,s,a,i,c,f,u,d,m,p,x]}var np=class extends W{constructor(e){super(),G(this,e,T2,L2,z,{plugin:0})}},Ox=np;var xl=class extends Bx.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Ox({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Nx=require("obsidian"),bl=class{notify(e){new Nx.Notice(e)}},vl=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var Jx=require("obsidian");var Gx=require("obsidian");function P2(o){ye(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function Hx(o,e,t){let r=o.slice();return r[21]=e[t],r}function F2(o){let e,t,r,n,s,a,i,l,c,f,u,d,m;r=new Ie({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),i=new Ie({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[D2]},$$scope:{ctx:o}}});let p=o[4]&&qx(o);return f=new Ie({props:{name:"",description:"",$$slots:{default:[R2]},$$scope:{ctx:o}}}),{c(){e=C("div"),t=C("div"),R(r.$$.fragment),n=E(),s=C("textarea"),a=E(),R(i.$$.fragment),l=E(),p&&p.c(),c=E(),R(f.$$.fragment),h(s,"placeholder","Describe the issue here..."),h(s,"class","svelte-jmqfac"),h(t,"class","form-content svelte-jmqfac"),h(e,"class","report-container svelte-jmqfac")},m(x,y){_(x,e,y),w(e,t),D(r,t,null),w(t,n),w(t,s),lr(s,o[3]),w(t,a),D(i,t,null),w(t,l),p&&p.m(t,null),w(e,c),D(f,e,null),u=!0,d||(m=K(s,"input",o[13]),d=!0)},p(x,y){y&8&&lr(s,x[3]);let g={};y&16777232&&(g.$$scope={dirty:y,ctx:x}),i.$set(g),x[4]?p?(p.p(x,y),y&16&&b(p,1)):(p=qx(x),p.c(),b(p,1),p.m(t,null)):p&&(se(),k(p,1,1,()=>{p=null}),ae());let I={};y&16777293&&(I.$$scope={dirty:y,ctx:x}),f.$set(I)},i(x){u||(b(r.$$.fragment,x),b(i.$$.fragment,x),b(p),b(f.$$.fragment,x),u=!0)},o(x){k(r.$$.fragment,x),k(i.$$.fragment,x),k(p),k(f.$$.fragment,x),u=!1},d(x){x&&v(e),M(r),M(i),p&&p.d(),M(f),d=!1,m()}}}function A2(o){let e;return{c(){e=C("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',h(e,"class","centered-message svelte-jmqfac")},m(t,r){_(t,e,r)},p:q,i:q,o:q,d(t){t&&v(e)}}}function E2(o){let e,t,r;return t=new Ie({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=C("div"),R(t.$$.fragment),h(e,"class","centered-message svelte-jmqfac")},m(n,s){_(n,e,s),D(t,e,null),r=!0},p:q,i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){k(t.$$.fragment,n),r=!1},d(n){n&&v(e),M(t)}}}function D2(o){let e,t,r,n,s,a;return{c(){e=C("div"),t=C("input"),r=E(),n=C("div"),h(t,"type","checkbox"),h(t,"tabindex","-1"),t.checked=o[4],h(n,"class","checkbox-toggle"),h(e,"role","checkbox"),h(e,"aria-checked",o[4]),h(e,"tabindex","0"),h(e,"class","checkbox-container"),Ae(e,"is-enabled",o[4])},m(i,l){_(i,e,l),w(e,t),w(e,r),w(e,n),s||(a=[K(e,"keypress",U2),K(e,"click",o[14])],s=!0)},p(i,l){l&16&&(t.checked=i[4]),l&16&&h(e,"aria-checked",i[4]),l&16&&Ae(e,"is-enabled",i[4])},d(i){i&&v(e),s=!1,me(a)}}}function qx(o){let e,t;return e=new Ie({props:{name:"Logs",description:"",$$slots:{description:[M2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&16777248&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function Vx(o){let e,t=`${o[21]}
`,r,n;return{c(){e=C("div"),r=B(t),n=E()},m(s,a){_(s,e,a),w(e,r),w(e,n)},p(s,a){a&32&&t!==(t=`${s[21]}
`)&&X(r,t)},d(s){s&&v(e)}}}function M2(o){let e,t=we(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Vx(Hx(o,t,n));return{c(){e=C("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){_(n,e,s);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(n,s){if(s&32){t=we(n[5]);let a;for(a=0;a<t.length;a+=1){let i=Hx(n,t,a);r[a]?r[a].p(i,s):(r[a]=Vx(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&v(e),He(r,n)}}}function R2(o){let e,t,r,n;return{c(){e=C("button"),t=B("Send"),e.disabled=o[2]},m(s,a){_(s,e,a),w(e,t),r||(n=K(e,"click",o[15]),r=!0)},p(s,a){a&4&&(e.disabled=s[2])},d(s){s&&v(e),r=!1,n()}}}function $2(o){let e,t,r,n,s,a,i=[E2,A2,F2],l=[];function c(f,u){return f[1]?0:f[2]&&!f[1]?1:2}return n=c(o,-1),s=l[n]=i[n](o),{c(){e=C("div"),e.textContent="Send Bug Report",t=E(),r=C("div"),s.c(),h(e,"class","modal-title"),h(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(f,u){_(f,e,u),_(f,t,u),_(f,r,u),l[n].m(r,null),a=!0},p(f,[u]){let d=n;n=c(f,u),n===d?l[n].p(f,u):(se(),k(l[d],1,1,()=>{l[d]=null}),ae(),s=l[n],s?s.p(f,u):(s=l[n]=i[n](f),s.c()),b(s,1),s.m(r,null))},i(f){a||(b(s),a=!0)},o(f){k(s),a=!1},d(f){f&&(v(e),v(t),v(r)),l[n].d()}}}function zx(){try{return Response.toString()}catch(o){return"undefined"}}function Wx(){try{return fetch.toString()}catch(o){return"undefined"}}function Kx(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var U2=()=>{};function O2(o,e,t){let r,n,s,a,i,l,{plugin:c}=e,f=de(zx()),u=de(Wx()),d=de(Kx()),m=de("");ie(o,m,L=>t(3,s=L));let p=de(!1);ie(o,p,L=>t(4,a=L));let x=de(!1),y=de(!1);ie(o,y,L=>t(2,n=L));let g=de(!1);ie(o,g,L=>t(1,r=L));let I=de(c.loginManager.pb);ie(o,I,L=>t(6,l=L));let T=de([]);ie(o,T,L=>t(5,i=L)),ei().then(L=>{T.set(L)});function P(){f.set(zx()),u.set(Wx()),d.set(Kx()),I.set(c.loginManager.pb)}function A(){s=this.value,m.set(s)}let F=()=>{let L=!a;p.set(L)},S=async()=>{var $;let L=`Bug Report

`;if(L+=JSON.stringify({userAgent:navigator.userAgent,manifest:c.manifest,user:($=l==null?void 0:l.authStore.model)==null?void 0:$.id,loadTime:c.loadTime,description:s},null,2),L+=`

`,p){let O=await Ah();L+=O}(0,Gx.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:L,headers:{"Content-Type":"text/plain"}}).then(()=>{g.set(!0)}),y.set(!0)};return o.$$set=L=>{"plugin"in L&&t(0,c=L.plugin)},[c,r,n,s,a,i,l,m,p,y,g,I,T,A,F,S]}var sp=class extends W{constructor(e){super(),G(this,e,O2,$2,z,{plugin:0},P2)}},jx=sp;var wl=class extends Jx.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new jx({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var nb=require("obsidian");async function Qx(o){let{appId:e,filterByAppId:t,onProgress:r}=o,n=await window.indexedDB.databases(),s=n.length,a=[],i=0,l=0,c=0,f=0;for(let u of n)if(u.name){try{let d=await new Promise((m,p)=>{let x=indexedDB.open(u.name);x.onerror=()=>p(x.error),x.onsuccess=y=>m(y.target.result)});try{let m=Array.from(d.objectStoreNames);if(!m.includes("updates")||!m.includes("custom"))continue;let p=d.transaction(["updates","custom"],"readonly"),x=p.objectStore("updates"),y=p.objectStore("custom"),g=await new Promise(T=>{let P=y.get("appId");P.onsuccess=()=>T(P.result||"")});i++;let I=await new Promise((T,P)=>{let A=x.count();A.onsuccess=()=>T(A.result),A.onerror=()=>P(A.error)});if(l+=I,I>0){let T=0;if(await new Promise((P,A)=>{let F=x.openCursor();F.onsuccess=S=>{let L=S.target.result;if(L){let $=L.value instanceof Uint8Array?L.value.byteLength:JSON.stringify(L.value).length;T+=$,L.continue()}else P()},F.onerror=()=>A(F.error)}),c+=T,T>1024*1024&&(!t||g===e)){let P=await new Promise(S=>{let L=y.get("path");L.onsuccess=()=>S(L.result||"")}),A=await new Promise(S=>{let L=y.get("relay");L.onsuccess=()=>S(L.result||"")}),F=!u.name.startsWith(`${e}-relay`);a.push({slug:`${u.name}/${x.name}`,path:P,relay:A,appId:g||"unknown",count:I,estimatedSizeMB:Math.round(T/(1024*1024)*100)/100,isLegacy:F})}}}finally{d.close()}}catch(d){console.error(`Error processing database ${u.name}:`,d);continue}f++,r&&r(f/n.length*100)}return{totalStores:i,totalItems:l,totalSizeMB:Math.round(c/(1024*1024)*100)/100,databaseCount:s,largeStores:a.sort((u,d)=>d.estimatedSizeMB-u.estimatedSizeMB)}}async function Xx(o){let[e,t]=o.split("/"),r=await new Promise((n,s)=>{let a=indexedDB.open(e);a.onerror=()=>s(a.error),a.onsuccess=()=>n(a.result)});try{let s=r.transaction(t,"readwrite").objectStore(t);await new Promise((a,i)=>{let l=s.clear();l.onsuccess=()=>a(),l.onerror=()=>i(l.error)})}catch(n){console.error(`Error deleting store: ${o}`,n)}finally{r.close()}}var iz=require("obsidian");function B2(o){ye(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function Yx(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function Zx(o,e,t){let r=o.slice();return r[22]=e[t],r}function N2(o){let e,t,r,n,s,a=o[0].databaseCount.toLocaleString()+"",i,l,c,f,u,d,m,p,x=o[0].totalStores+"",y,g,I,T,P,A,F=o[0].totalItems.toLocaleString()+"",S,L,$,O,Q,U,V=o[0].totalSizeMB.toFixed(2)+"",oe,ve,N,j,_e;function Ne(Y,xe){if(Y[0].databaseCount>45e3)return z2;if(Y[0].databaseCount>4e4)return V2}let Ee=Ne(o,-1),te=Ee&&Ee(o),re=o[0].largeStores.length>0&&eb(o);return{c(){e=C("div"),t=C("div"),r=C("div"),r.textContent="Global Database Limit",n=E(),s=C("div"),i=B(a),l=B(" / 50,000"),c=E(),te&&te.c(),f=E(),u=C("div"),d=C("div"),d.textContent="Relay Databases",m=E(),p=C("div"),y=B(x),g=E(),I=C("div"),T=C("div"),T.textContent="Document Updates",P=E(),A=C("div"),S=B(F),L=E(),$=C("div"),O=C("div"),O.textContent="Total Size",Q=E(),U=C("div"),oe=B(V),ve=B(" MB"),N=E(),re&&re.c(),j=he(),h(r,"class","system3-stat-label svelte-1n3w4sk"),h(s,"class","system3-stat-value svelte-1n3w4sk"),Ae(s,"system3-warning",o[0].databaseCount>4e4),Ae(s,"system3-critical",o[0].databaseCount>45e3),h(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),h(d,"class","system3-stat-label svelte-1n3w4sk"),h(p,"class","system3-stat-value svelte-1n3w4sk"),h(u,"class","system3-stat-item svelte-1n3w4sk"),h(T,"class","system3-stat-label svelte-1n3w4sk"),h(A,"class","system3-stat-value svelte-1n3w4sk"),h(I,"class","system3-stat-item svelte-1n3w4sk"),h(O,"class","system3-stat-label svelte-1n3w4sk"),h(U,"class","system3-stat-value svelte-1n3w4sk"),h($,"class","system3-stat-item svelte-1n3w4sk"),h(e,"class","system3-summary-stats svelte-1n3w4sk")},m(Y,xe){_(Y,e,xe),w(e,t),w(t,r),w(t,n),w(t,s),w(s,i),w(s,l),w(t,c),te&&te.m(t,null),w(e,f),w(e,u),w(u,d),w(u,m),w(u,p),w(p,y),w(e,g),w(e,I),w(I,T),w(I,P),w(I,A),w(A,S),w(e,L),w(e,$),w($,O),w($,Q),w($,U),w(U,oe),w(U,ve),_(Y,N,xe),re&&re.m(Y,xe),_(Y,j,xe),_e=!0},p(Y,xe){(!_e||xe&1)&&a!==(a=Y[0].databaseCount.toLocaleString()+"")&&X(i,a),(!_e||xe&1)&&Ae(s,"system3-warning",Y[0].databaseCount>4e4),(!_e||xe&1)&&Ae(s,"system3-critical",Y[0].databaseCount>45e3),Ee!==(Ee=Ne(Y,xe))&&(te&&te.d(1),te=Ee&&Ee(Y),te&&(te.c(),te.m(t,null))),(!_e||xe&1)&&x!==(x=Y[0].totalStores+"")&&X(y,x),(!_e||xe&1)&&F!==(F=Y[0].totalItems.toLocaleString()+"")&&X(S,F),(!_e||xe&1)&&V!==(V=Y[0].totalSizeMB.toFixed(2)+"")&&X(oe,V),Y[0].largeStores.length>0?re?(re.p(Y,xe),xe&1&&b(re,1)):(re=eb(Y),re.c(),b(re,1),re.m(j.parentNode,j)):re&&(se(),k(re,1,1,()=>{re=null}),ae())},i(Y){_e||(b(re),_e=!0)},o(Y){k(re),_e=!1},d(Y){Y&&(v(e),v(N),v(j)),te&&te.d(),re&&re.d(Y)}}}function H2(o){let e,t;return{c(){e=C("div"),t=B(o[5]),h(e,"class","system3-error-message svelte-1n3w4sk")},m(r,n){_(r,e,n),w(e,t)},p(r,n){n&32&&X(t,r[5])},i:q,o:q,d(r){r&&v(e)}}}function q2(o){let e,t,r,n,s,a,i;return{c(){e=C("div"),t=C("div"),r=E(),n=C("div"),n.textContent="Analyzing Databases...",s=E(),a=C("div"),i=C("div"),h(t,"class","system3-loading-spinner svelte-1n3w4sk"),h(n,"class","loading-text"),h(i,"class","system3-progress-fill svelte-1n3w4sk"),ne(i,"width",o[4]+"%"),h(a,"class","system3-progress-bar svelte-1n3w4sk"),h(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,c){_(l,e,c),w(e,t),w(e,r),w(e,n),w(e,s),w(e,a),w(a,i)},p(l,c){c&16&&ne(i,"width",l[4]+"%")},i:q,o:q,d(l){l&&v(e)}}}function V2(o){let e;return{c(){e=C("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,h(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function z2(o){let e;return{c(){e=C("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,h(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function eb(o){let e,t,r,n;e=new Me({props:{name:"Large Stores (>1MB)"}});let s=we(o[2]),a=[];for(let l=0;l<s.length;l+=1)a[l]=rb(Yx(o,s,l));let i=l=>k(a[l],1,1,()=>{a[l]=null});return{c(){R(e.$$.fragment),t=E();for(let l=0;l<a.length;l+=1)a[l].c();r=he()},m(l,c){D(e,l,c),_(l,t,c);for(let f=0;f<a.length;f+=1)a[f]&&a[f].m(l,c);_(l,r,c),n=!0},p(l,c){if(c&2052){s=we(l[2]);let f;for(f=0;f<s.length;f+=1){let u=Yx(l,s,f);a[f]?(a[f].p(u,c),b(a[f],1)):(a[f]=rb(u),a[f].c(),b(a[f],1),a[f].m(r.parentNode,r))}for(se(),f=s.length;f<a.length;f+=1)i(f);ae()}},i(l){if(!n){b(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)b(a[c]);n=!0}},o(l){k(e.$$.fragment,l),a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)k(a[c]);n=!1},d(l){l&&(v(t),v(r)),M(e,l),He(a,l)}}}function W2(o){let e,t,r,n,s;function a(){return o[17](o[22])}return{c(){e=C("div"),t=C("button"),t.textContent="Delete",r=E(),h(t,"class","mod-warning"),h(t,"title","Delete all data in this store"),h(e,"class","system3-actions svelte-1n3w4sk")},m(i,l){_(i,e,l),w(e,t),_(i,r,l),n||(s=K(t,"click",a),n=!0)},p(i,l){o=i},d(i){i&&(v(e),v(r)),n=!1,s()}}}function tb(o){let e,t;return e=new Ie({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[W2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&4&&(s.name=r[22].path||r[22].slug),n&4&&(s.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),n&33554436&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function rb(o){let e,t,r,n;e=new Me({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let s=we(o[19]),a=[];for(let l=0;l<s.length;l+=1)a[l]=tb(Zx(o,s,l));let i=l=>k(a[l],1,1,()=>{a[l]=null});return{c(){R(e.$$.fragment),t=E();for(let l=0;l<a.length;l+=1)a[l].c();r=he()},m(l,c){D(e,l,c),_(l,t,c);for(let f=0;f<a.length;f+=1)a[f]&&a[f].m(l,c);_(l,r,c),n=!0},p(l,c){let f={};if(c&4&&(f.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(f),c&2052){s=we(l[19]);let u;for(u=0;u<s.length;u+=1){let d=Zx(l,s,u);a[u]?(a[u].p(d,c),b(a[u],1)):(a[u]=tb(d),a[u].c(),b(a[u],1),a[u].m(r.parentNode,r))}for(se(),u=s.length;u<a.length;u+=1)i(u);ae()}},i(l){if(!n){b(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)b(a[c]);n=!0}},o(l){k(e.$$.fragment,l),a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)k(a[c]);n=!1},d(l){l&&(v(t),v(r)),M(e,l),He(a,l)}}}function K2(o){let e,t,r,n,s,a,i,l,c,f,u,d,m,p,x,y,g,I=[q2,H2,N2],T=[];function P(A,F){return A[3]?0:A[5]?1:A[0]?2:-1}return~(m=P(o,-1))&&(p=T[m]=I[m](o)),{c(){e=C("div"),e.textContent="Relay database analysis",t=E(),r=C("div"),n=C("div"),s=C("div"),s.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,a=E(),i=C("div"),l=C("div"),c=C("input"),f=E(),u=C("div"),d=E(),p&&p.c(),h(e,"class","modal-title"),h(s,"class","setting-item-info"),h(c,"type","checkbox"),h(c,"tabindex","-1"),c.checked=o[1],h(u,"class","checkbox-toggle"),h(l,"role","checkbox"),h(l,"aria-checked",o[1]),h(l,"tabindex","0"),h(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),Ae(l,"is-enabled",o[1]),h(i,"class","setting-item-control"),h(n,"class","setting-item"),h(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(A,F){_(A,e,F),_(A,t,F),_(A,r,F),w(r,n),w(n,s),w(n,a),w(n,i),w(i,l),w(l,c),w(l,f),w(l,u),w(r,d),~m&&T[m].m(r,null),x=!0,y||(g=[K(l,"keypress",o[15]),K(l,"click",o[16])],y=!0)},p(A,[F]){(!x||F&2)&&(c.checked=A[1]),(!x||F&2)&&h(l,"aria-checked",A[1]),(!x||F&2)&&Ae(l,"is-enabled",A[1]);let S=m;m=P(A,F),m===S?~m&&T[m].p(A,F):(p&&(se(),k(T[S],1,1,()=>{T[S]=null}),ae()),~m?(p=T[m],p?p.p(A,F):(p=T[m]=I[m](A),p.c()),b(p,1),p.m(r,null)):p=null)},i(A){x||(b(p),x=!0)},o(A){k(p),x=!1},d(A){A&&(v(e),v(t),v(r)),~m&&T[m].d(),y=!1,me(g)}}}function G2(o,e,t){let r,n,s,a,i,l;var c;let{plugin:f}=e,u=de(!0);ie(o,u,A=>t(3,a=A));let d=de(0);ie(o,d,A=>t(4,i=A));let m=de(null);ie(o,m,A=>t(0,s=A));let p=de(null);ie(o,p,A=>t(5,l=A));let x=!1;function y(){return De(this,void 0,void 0,function*(){u.set(!0),p.set(null);try{let A=yield Qx({appId:f.appId,filterByAppId:!x,onProgress:F=>d.set(F)});m.set(A)}catch(A){p.set(`Analysis failed: ${A.message}`)}finally{u.set(!1)}})}function g(A){return De(this,void 0,void 0,function*(){try{yield Xx(A),s&&ag(m,s.largeStores=s.largeStores.filter(F=>F.slug!==A),s)}catch(F){p.set(`Failed to delete ${A}: ${F.message}`)}})}Ft(()=>{y()});let I=()=>{t(1,x=!x),y()},T=()=>{t(1,x=!x),y()},P=A=>g(A.slug);return o.$$set=A=>{"plugin"in A&&t(12,f=A.plugin)},o.$$.update=()=>{if(o.$$.dirty&8193){e:t(14,r=t(13,c=s==null?void 0:s.largeStores.reduce((A,F)=>{let S=F.relay||"local";return A[S]||(A[S]=[]),A[S].push(F),A},{}))!==null&&c!==void 0?c:{})}if(o.$$.dirty&16384){e:t(2,n=Object.entries(r).sort(([A],[F])=>A==="local"?-1:F==="local"?1:A.localeCompare(F)))}},[s,x,n,a,i,l,u,d,m,p,y,g,f,c,r,I,T,P]}var ap=class extends W{constructor(e){super(),G(this,e,G2,K2,z,{plugin:12},B2)}},ob=ap;var _l=class extends nb.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new ob({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Eb=require("obsidian");var{Boolean:gb}=on;function j2(o){ye(o,"svelte-18bqwhy",".file-name.svelte-18bqwhy{display:flex;align-items:center;gap:6px;font-size:0.9rem;flex:1;min-width:0}.details-container.svelte-18bqwhy{margin-left:auto;text-align:right;padding-left:8px;padding-right:8px}.details.svelte-18bqwhy{font-size:0.75rem;color:var(--text-muted)}.error-message.svelte-18bqwhy{color:var(--text-error);margin-top:2px;text-align:right}.more-files.svelte-18bqwhy{font-size:0.8rem;color:var(--text-muted);text-align:center}button.mod-warning.svelte-18bqwhy{display:flex;align-items:center;gap:4px;background-color:var(--background-modifier-error);color:var(--text-error)}.mod-primary{color:var(--interactive-accent)}.mod-success{color:var(--interactive-success)}.mod-warning{color:var(--text-warning)}.show-more-link.svelte-18bqwhy{color:var(--text-accent);cursor:pointer;font-size:0.8rem}.show-more-link.svelte-18bqwhy:hover{text-decoration:underline}")}function sb(o,e,t){let r=o.slice();return r[20]=e[t],r}function ab(o,e,t){let r=o.slice();return r[23]=e[t],r}function J2(o){return{c:q,m:q,p:q,i:q,o:q,d:q}}function Q2(o){let e,t,r=we(hb(o[19].documents)),n=[];for(let a=0;a<r.length;a+=1)n[a]=db(sb(o,r,a));let s=a=>k(n[a],1,1,()=>{n[a]=null});return{c(){for(let a=0;a<n.length;a+=1)n[a].c();e=he()},m(a,i){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(a,i);_(a,e,i),t=!0},p(a,i){if(i&8311){r=we(hb(a[19].documents));let l;for(l=0;l<r.length;l+=1){let c=sb(a,r,l);n[l]?(n[l].p(c,i),b(n[l],1)):(n[l]=db(c),n[l].c(),b(n[l],1),n[l].m(e.parentNode,e))}for(se(),l=r.length;l<n.length;l+=1)s(l);ae()}},i(a){if(!t){for(let i=0;i<r.length;i+=1)b(n[i]);t=!0}},o(a){n=n.filter(gb);for(let i=0;i<n.length;i+=1)k(n[i]);t=!1},d(a){a&&v(e),He(n,a)}}}function ib(o){let e,t=mb(o[23].queueState.timestamp)+"",r;return{c(){e=B("\u2022 "),r=B(t)},m(n,s){_(n,e,s),_(n,r,s)},p(n,s){s&3&&t!==(t=mb(n[23].queueState.timestamp)+"")&&X(r,t)},d(n){n&&(v(e),v(r))}}}function lb(o){let e,t=o[23].queueState.error+"",r;return{c(){e=C("div"),r=B(t),h(e,"class","error-message svelte-18bqwhy")},m(n,s){_(n,e,s),w(e,r)},p(n,s){s&3&&t!==(t=n[23].queueState.error+"")&&X(r,t)},d(n){n&&v(e)}}}function cb(o){let e,t,r,n,s,a;t=new cu({props:{size:14,class:"svg-icon lucide-refresh-cw"}});function i(){return o[10](o[23])}return{c(){e=C("button"),R(t.$$.fragment),r=B(`
							Retry`),h(e,"class","mod-warning svelte-18bqwhy")},m(l,c){_(l,e,c),D(t,e,null),w(e,r),n=!0,s||(a=K(e,"click",i),s=!0)},p(l,c){o=l},i(l){n||(b(t.$$.fragment,l),n=!0)},o(l){k(t.$$.fragment,l),n=!1},d(l){l&&v(e),M(t),s=!1,a()}}}function X2(o){var m,p,x;let e,t,r=o[5](o[23]).text+"",n,s,a,i,l,c,f=((m=o[23].queueState)==null?void 0:m.timestamp)&&ib(o),u=((p=o[23].queueState)==null?void 0:p.error)&&lb(o),d=((x=o[23].queueState)==null?void 0:x.status)==="failed"&&cb(o);return{c(){e=C("div"),t=C("span"),n=B(r),s=E(),f&&f.c(),a=E(),u&&u.c(),i=E(),d&&d.c(),l=he(),h(t,"class","details svelte-18bqwhy"),h(e,"class","details-container svelte-18bqwhy")},m(y,g){_(y,e,g),w(e,t),w(t,n),w(t,s),f&&f.m(t,null),w(t,a),u&&u.m(t,null),_(y,i,g),d&&d.m(y,g),_(y,l,g),c=!0},p(y,g){var I,T,P;(!c||g&3)&&r!==(r=y[5](y[23]).text+"")&&X(n,r),(I=y[23].queueState)!=null&&I.timestamp?f?f.p(y,g):(f=ib(y),f.c(),f.m(t,a)):f&&(f.d(1),f=null),(T=y[23].queueState)!=null&&T.error?u?u.p(y,g):(u=lb(y),u.c(),u.m(t,null)):u&&(u.d(1),u=null),((P=y[23].queueState)==null?void 0:P.status)==="failed"?d?(d.p(y,g),g&3&&b(d,1)):(d=cb(y),d.c(),b(d,1),d.m(l.parentNode,l)):d&&(se(),k(d,1,1,()=>{d=null}),ae())},i(y){c||(b(d),c=!0)},o(y){k(d),c=!1},d(y){y&&(v(e),v(i),v(l)),f&&f.d(),u&&u.d(),d&&d.d(y)}}}function Y2(o){let e,t=o[9].default,r=le(t,o,o[13],null),n=r||X2(o);return{c(){n&&n.c()},m(s,a){n&&n.m(s,a),e=!0},p(s,a){r?r.p&&(!e||a&8192)&&fe(r,t,s,s[13],e?ce(t,s[13],a,null):ue(s[13]),null):n&&n.p&&(!e||a&3)&&n.p(s,e?a:-1)},i(s){e||(b(n,s),e=!0)},o(s){k(n,s),e=!1},d(s){n&&n.d(s)}}}function Z2(o){let e,t,r,n,s=o[23].path.split("/").pop()+"",a,i;var l=o[5](o[23]).icon;function c(f,u){return{props:{size:16,class:"svg-icon "+f[5](f[23]).iconClass}}}return l&&(t=Xn(l,c(o))),{c(){e=C("span"),t&&R(t.$$.fragment),r=E(),n=C("span"),a=B(s),h(e,"slot","name"),h(e,"class","file-name svelte-18bqwhy")},m(f,u){_(f,e,u),t&&D(t,e,null),w(e,r),w(e,n),w(n,a),i=!0},p(f,u){if(u&3&&l!==(l=f[5](f[23]).icon)){if(t){se();let d=t;k(d.$$.fragment,1,0,()=>{M(d,1)}),ae()}l?(t=Xn(l,c(f,u)),R(t.$$.fragment),b(t.$$.fragment,1),D(t,e,r)):t=null}else if(l){let d={};u&3&&(d.class="svg-icon "+f[5](f[23]).iconClass),t.$set(d)}(!i||u&3)&&s!==(s=f[23].path.split("/").pop()+"")&&X(a,s)},i(f){i||(t&&b(t.$$.fragment,f),i=!0)},o(f){t&&k(t.$$.fragment,f),i=!1},d(f){f&&v(e),t&&M(t)}}}function fb(o){let e,t;return e=new ut({props:{$$slots:{name:[Z2],default:[Y2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function ub(o){let e,t;return e=new ut({props:{$$slots:{name:[eT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function eT(o){let e,t,r=pb(o[1](o[20]).remainingCount)+"",n,s,a=o[20].title.toLowerCase()+"",i,l,c,f,u,d,m,p;function x(){return o[11](o[20])}function y(...g){return o[12](o[20],...g)}return{c(){var g;e=C("span"),t=B("...and "),n=B(r),s=B(` more
					`),i=B(a),l=E(),c=C("span"),f=B("(show more)"),d=E(),h(c,"class","show-more-link svelte-18bqwhy"),h(c,"role","button"),h(c,"tabindex","0"),h(c,"aria-label",u=`Show ${((g=o[2][o[20].title])==null?void 0:g.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`),h(e,"slot","name"),h(e,"class","more-files svelte-18bqwhy")},m(g,I){_(g,e,I),w(e,t),w(e,n),w(e,s),w(e,i),w(e,l),w(e,c),w(c,f),w(e,d),m||(p=[K(c,"click",x),K(c,"keydown",y)],m=!0)},p(g,I){var T;o=g,I&3&&r!==(r=pb(o[1](o[20]).remainingCount)+"")&&X(n,r),I&1&&a!==(a=o[20].title.toLowerCase()+"")&&X(i,a),I&1&&u!==(u=`Show ${((T=o[2][o[20].title])==null?void 0:T.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`)&&h(c,"aria-label",u)},d(g){g&&v(e),m=!1,me(p)}}}function db(o){let e,t,r,n=o[1](o[20]).remainingCount>0,s,a;e=new Me({props:{name:o[20].title}});let i=we(o[1](o[20]).visibleDocs),l=[];for(let u=0;u<i.length;u+=1)l[u]=fb(ab(o,i,u));let c=u=>k(l[u],1,1,()=>{l[u]=null}),f=n&&ub(o);return{c(){R(e.$$.fragment),t=E();for(let u=0;u<l.length;u+=1)l[u].c();r=E(),f&&f.c(),s=he()},m(u,d){D(e,u,d),_(u,t,d);for(let m=0;m<l.length;m+=1)l[m]&&l[m].m(u,d);_(u,r,d),f&&f.m(u,d),_(u,s,d),a=!0},p(u,d){let m={};if(d&1&&(m.name=u[20].title),e.$set(m),d&8291){i=we(u[1](u[20]).visibleDocs);let p;for(p=0;p<i.length;p+=1){let x=ab(u,i,p);l[p]?(l[p].p(x,d),b(l[p],1)):(l[p]=fb(x),l[p].c(),b(l[p],1),l[p].m(r.parentNode,r))}for(se(),p=i.length;p<l.length;p+=1)c(p);ae()}d&3&&(n=u[1](u[20]).remainingCount>0),n?f?(f.p(u,d),d&3&&b(f,1)):(f=ub(u),f.c(),b(f,1),f.m(s.parentNode,s)):f&&(se(),k(f,1,1,()=>{f=null}),ae())},i(u){if(!a){b(e.$$.fragment,u);for(let d=0;d<i.length;d+=1)b(l[d]);b(f),a=!0}},o(u){k(e.$$.fragment,u),l=l.filter(gb);for(let d=0;d<l.length;d+=1)k(l[d]);k(f),a=!1},d(u){u&&(v(t),v(r),v(s)),M(e,u),He(l,u),f&&f.d(u)}}}function tT(o){let e;return{c(){e=C("div"),e.textContent="Loading...",h(e,"class","loading")},m(t,r){_(t,e,r)},p:q,i:q,o:q,d(t){t&&v(e)}}}function rT(o){let e,t,r,n={ctx:o,current:null,token:null,hasCatch:!1,pending:tT,then:Q2,catch:J2,value:19,blocks:[,,,]};return ao(t=o[0],n),{c(){e=he(),n.block.c()},m(s,a){_(s,e,a),n.block.m(s,n.anchor=a),n.mount=()=>e.parentNode,n.anchor=e,r=!0},p(s,[a]){o=s,n.ctx=o,a&1&&t!==(t=o[0])&&ao(t,n)||es(n,o,a)},i(s){r||(b(n.block),r=!0)},o(s){for(let a=0;a<3;a+=1){let i=n.blocks[a];k(i)}r=!1},d(s){s&&v(e),n.block.d(s),n.token=null,n=null}}}function pb(o){return new Intl.NumberFormat().format(o)}function mb(o){let e=new Date(o),r=new Date().getTime()-e.getTime(),n=Math.floor(r/(1e3*60));if(n<1)return"just now";if(n===1)return"1 minute ago";if(n<60)return`${n} minutes ago`;let s=Math.floor(n/60);if(s===1)return"1 hour ago";if(s<24)return`${s} hours ago`;let a=Math.floor(s/24);return a===1?"yesterday":`${a} days ago`}function hb(o){let e=o.filter(s=>{var a;return((a=s.queueState)===null||a===void 0?void 0:a.status)==="running"}),t=o.filter(s=>{var a;return((a=s.queueState)===null||a===void 0?void 0:a.status)==="failed"}),r=o.filter(s=>{var a;return((a=s.queueState)===null||a===void 0?void 0:a.status)==="pending"}),n=o.filter(s=>{var a;return((a=s.queueState)===null||a===void 0?void 0:a.status)==="completed"});return[e.length>0&&{title:"Active Files",documents:e},t.length>0&&{title:"Stuck Files",documents:t},r.length>0&&{title:"Queued Files",documents:r},n.length>0&&{title:"Completed Files",documents:n}].filter(Boolean)}function oT(o,e,t){let r,n,s,a,i,{$$slots:l={},$$scope:c}=e,{folder:f}=e,{backgroundSync:u}=e,d={"Active Files":{initialCount:1/0,incrementCount:100},"Stuck Files":{initialCount:1/0,incrementCount:100},"Queued Files":{initialCount:10,incrementCount:100},"Completed Files":{initialCount:5,incrementCount:100},default:{initialCount:1/0,incrementCount:100}},m=de({}),p=wr(m,F=>S=>{let L=d[S.title]||d.default,$=F[S.title]||L.initialCount,O=S.documents.slice(0,$),Q=S.documents.length-$;return{visibleCount:$,visibleDocs:O,remainingCount:Q}});ie(o,p,F=>t(1,i=F));function x(F){let S=d[F]||d.default;m.update(L=>Object.assign(Object.assign({},L),{[F]:(L[F]||S.initialCount)+S.incrementCount}))}function y(F){return De(this,void 0,void 0,function*(){var S;let L=[],$=Array.from(F.docs.values());for(let O of $){let Q=yield O.getOrigin(),U=yield O.getServerSynced(),V={guid:O.guid,path:F.getPath(O.path),doc:O,origin:Q||"unknown",serverSynced:U},oe=Array.from(r).find(j=>j.guid===O.guid),ve=Array.from(n).find(j=>j.guid===O.guid),N=s.find(j=>j.guid===O.guid);if(oe||ve||N){let j=oe||ve||N;V.queueState={status:j.status,type:"type"in j?j.type:"sync",error:"error"in j?j.error:void 0,timestamp:"timestamp"in j?j.timestamp:Date.now()}}else Q==="local"&&!U?V.queueState={status:"pending",type:"sync",timestamp:Date.now()}:U?V.queueState={status:"completed",type:"sync",timestamp:Date.now()}:V.queueState={status:"pending",type:"sync",timestamp:Date.now()};L.push(V)}return{folder:F,documents:L,progress:((S=u.getGroupProgress(F))===null||S===void 0?void 0:S.percent)||0}})}function g(F){let{origin:S,serverSynced:L,queueState:$}=F,O=($==null?void 0:$.status)||"completed",Q=($==null?void 0:$.type)||"sync";return S==="remote"&&!L&&O==="running"&&Q==="download"?{text:"Downloading",description:"Initial acquisition",icon:jf,iconClass:"mod-primary"}:S==="remote"&&!L&&O==="pending"&&Q==="download"?{text:"Queued for Download",description:"Waiting to download",icon:Ys,iconClass:""}:S==="remote"&&!L&&O==="failed"&&Q==="download"?{text:"Download stuck",description:"Needs retry",icon:Zs,iconClass:"mod-warning"}:S==="local"&&!L&&O==="running"&&Q==="sync"?{text:"Uploading",description:"First-time upload",icon:hu,iconClass:"mod-primary"}:S==="local"&&!L&&O==="pending"&&Q==="sync"?{text:"Queued for Upload",description:"Waiting to upload",icon:Ys,iconClass:""}:S==="local"&&!L&&O==="failed"&&Q==="sync"?{text:"Upload stuck",description:"Needs retry",icon:Zs,iconClass:"mod-warning"}:L&&O==="running"&&Q==="sync"?{text:"Syncing",description:"Collaborative update",icon:Of,iconClass:"mod-primary"}:L&&O==="pending"&&Q==="sync"?{text:"Queued for Sync",description:"Waiting to sync",icon:Ys,iconClass:""}:L&&O==="failed"&&Q==="sync"?{text:"Sync stuck",description:"Needs retry",icon:Zs,iconClass:"mod-warning"}:L&&O==="completed"?{text:"Complete",description:"Fully synchronized",icon:zf,iconClass:"mod-success"}:{text:"Unknown",description:"Status unknown",icon:Yf,iconClass:""}}function I(F){return De(this,void 0,void 0,function*(){var S,L;let $={id:F.guid,guid:F.guid,path:F.path,timestamp:((S=F.queueState)===null||S===void 0?void 0:S.timestamp)||Date.now(),type:((L=F.queueState)===null||L===void 0?void 0:L.type)||"sync",status:"failed",sharedFolderGuid:F.doc.sharedFolder.guid};yield u.retryLogItem($)})}let T=F=>I(F),P=F=>{x(F.title)},A=(F,S)=>S.key==="Enter"&&x(F.title);return o.$$set=F=>{"folder"in F&&t(7,f=F.folder),"backgroundSync"in F&&t(8,u=F.backgroundSync),"$$scope"in F&&t(13,c=F.$$scope)},o.$$.update=()=>{if(o.$$.dirty&256){e:r=new Set(u.activeSync.items())}if(o.$$.dirty&256){e:n=new Set(u.activeDownloads.items())}if(o.$$.dirty&256){e:s=u.getSyncLog()}if(o.$$.dirty&128){e:t(0,a=y(f))}},[a,i,d,p,x,g,I,f,u,l,T,P,A,c]}var ip=class extends W{constructor(e){super(),G(this,e,oT,rT,z,{folder:7,backgroundSync:8},j2)}},lp=ip;var{Map:nT}=on;function sT(o){ye(o,"svelte-ztgdsf",".folder-header.svelte-ztgdsf{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;width:100%;text-align:left;color:inherit;font:inherit}.arrow.svelte-ztgdsf{margin-right:8px;font-size:0.8em;transition:transform 0.15s ease}.arrow.is-expanded.svelte-ztgdsf{transform:rotate(90deg)}.sync-stats.svelte-ztgdsf{margin-left:8px;display:flex;gap:4px}.tag.svelte-ztgdsf{font-size:0.7em;padding:2px 6px;border-radius:4px;background-color:var(--background-modifier-border);color:var(--text-muted)}.tag.mod-success.svelte-ztgdsf{background-color:var(--interactive-success);color:var(--text-on-accent)}.tag.mod-warning.svelte-ztgdsf{background-color:var(--text-warning);color:var(--text-on-accent)}.progress-container.svelte-ztgdsf{display:flex;align-items:center;margin-top:4px;width:100%}.progress-bar.svelte-ztgdsf{flex:1;height:6px;background-color:var(--background-modifier-border);border-radius:3px;overflow:hidden;margin-right:8px}.progress-value.svelte-ztgdsf{height:100%;background-color:var(--interactive-accent);border-radius:3px}.progress-text.svelte-ztgdsf{font-size:0.75rem;color:var(--text-muted)}")}function yb(o,e,t){let r=o.slice();r[25]=e[t];let n=r[4].get(r[25].guid);return r[26]=n,r}function xb(o){let e,t;return e=new Me({props:{name:"Sync Status"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function bb(o){let e,t;return e=new Ie({props:{name:o[11]?"Sync in Progress":o[10]?"Queued Files":"Sync Complete",description:`${o[2]} active \u2022 ${o[7]} stuck \u2022 ${o[3]} queued \u2022 ${o[8]} complete`,$$slots:{default:[lT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&3072&&(s.name=r[11]?"Sync in Progress":r[10]?"Queued Files":"Sync Complete"),n&396&&(s.description=`${r[2]} active \u2022 ${r[7]} stuck \u2022 ${r[3]} queued \u2022 ${r[8]} complete`),n&536874496&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function vb(o){let e,t,r,n,s,a,i=[iT,aT],l=[];function c(f,u){return f[9]?0:1}return t=c(o,-1),r=l[t]=i[t](o),{c(){e=C("button"),r.c(),h(e,"class","mod-cta")},m(f,u){_(f,e,u),l[t].m(e,null),n=!0,s||(a=K(e,"click",o[16]),s=!0)},p(f,u){let d=t;t=c(f,u),t!==d&&(se(),k(l[d],1,1,()=>{l[d]=null}),ae(),r=l[t],r||(r=l[t]=i[t](f),r.c()),b(r,1),r.m(e,null))},i(f){n||(b(r),n=!0)},o(f){k(r),n=!1},d(f){f&&v(e),l[t].d(),s=!1,a()}}}function aT(o){let e,t,r;return e=new su({props:{size:16,class:"svg-icon lucide-pause",style:"margin-right: 8px;"}}),{c(){R(e.$$.fragment),t=B(`
						Pause`)},m(n,s){D(e,n,s),_(n,t,s),r=!0},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){k(e.$$.fragment,n),r=!1},d(n){n&&v(t),M(e,n)}}}function iT(o){let e,t,r;return e=new iu({props:{size:16,class:"svg-icon lucide-play",style:"margin-right: 8px;"}}),{c(){R(e.$$.fragment),t=B(`
						Resume`)},m(n,s){D(e,n,s),_(n,t,s),r=!0},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){k(e.$$.fragment,n),r=!1},d(n){n&&v(t),M(e,n)}}}function lT(o){let e,t,r=(o[11]||o[10])&&vb(o);return{c(){r&&r.c(),e=he()},m(n,s){r&&r.m(n,s),_(n,e,s),t=!0},p(n,s){n[11]||n[10]?r?(r.p(n,s),s&3072&&b(r,1)):(r=vb(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(se(),k(r,1,1,()=>{r=null}),ae())},i(n){t||(b(r),t=!0)},o(n){k(r),t=!1},d(n){n&&v(e),r&&r.d(n)}}}function cT(o){let e=[],t=new nT,r,n,s=we(o[6]),a=i=>i[25].guid;for(let i=0;i<s.length;i+=1){let l=yb(o,s,i),c=a(l);t.set(c,e[i]=Ib(c,l))}return{c(){for(let i=0;i<e.length;i+=1)e[i].c();r=he()},m(i,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(i,l);_(i,r,l),n=!0},p(i,l){l&32851&&(s=we(i[6]),se(),e=xg(e,l,a,1,i,s,t,r.parentNode,yg,Ib,r,yb),ae())},i(i){if(!n){for(let l=0;l<s.length;l+=1)b(e[l]);n=!0}},o(i){for(let l=0;l<e.length;l+=1)k(e[l]);n=!1},d(i){i&&v(r);for(let l=0;l<e.length;l+=1)e[l].d(i)}}}function fT(o){let e,t,r,n;return e=new Me({props:{$$slots:{name:[gT],default:[mT]},$$scope:{ctx:o}}}),r=new lp({props:{folder:o[5],backgroundSync:o[0]}}),{c(){R(e.$$.fragment),t=E(),R(r.$$.fragment)},m(s,a){D(e,s,a),_(s,t,a),D(r,s,a),n=!0},p(s,a){let i={};a&536875040&&(i.$$scope={dirty:a,ctx:s}),e.$set(i);let l={};a&32&&(l.folder=s[5]),a&1&&(l.backgroundSync=s[0]),r.$set(l)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&v(t),M(e,s),M(r,s)}}}function wb(o){let e,t,r,n,s,a=o[26].progress+"",i,l;return{c(){e=C("div"),t=C("div"),r=C("div"),n=E(),s=C("span"),i=B(a),l=B("%"),h(r,"class","progress-value svelte-ztgdsf"),ne(r,"width",o[26].progress+"%"),h(t,"class","progress-bar svelte-ztgdsf"),h(s,"class","progress-text svelte-ztgdsf"),h(e,"class","progress-container svelte-ztgdsf")},m(c,f){_(c,e,f),w(e,t),w(t,r),w(e,n),w(e,s),w(s,i),w(s,l)},p(c,f){f&80&&ne(r,"width",c[26].progress+"%"),f&80&&a!==(a=c[26].progress+"")&&X(i,a)},d(c){c&&v(e)}}}function uT(o){let e,t=o[26]&&(o[26].running>0||o[26].failed>0)&&wb(o);return{c(){t&&t.c(),e=he()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[26]&&(r[26].running>0||r[26].failed>0)?t?t.p(r,n):(t=wb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&v(e),t&&t.d(r)}}}function _b(o){let e,t=o[26].running+"",r,n;return{c(){e=C("span"),r=B(t),n=B(" active"),h(e,"class","tag mod-success svelte-ztgdsf")},m(s,a){_(s,e,a),w(e,r),w(e,n)},p(s,a){a&80&&t!==(t=s[26].running+"")&&X(r,t)},d(s){s&&v(e)}}}function Sb(o){let e,t=o[26].failed+"",r,n;return{c(){e=C("span"),r=B(t),n=B(" stuck"),h(e,"class","tag mod-warning svelte-ztgdsf")},m(s,a){_(s,e,a),w(e,r),w(e,n)},p(s,a){a&80&&t!==(t=s[26].failed+"")&&X(r,t)},d(s){s&&v(e)}}}function kb(o){let e,t=o[26].pending+"",r,n;return{c(){e=C("span"),r=B(t),n=B(" queued"),h(e,"class","tag svelte-ztgdsf")},m(s,a){_(s,e,a),w(e,r),w(e,n)},p(s,a){a&80&&t!==(t=s[26].pending+"")&&X(r,t)},d(s){s&&v(e)}}}function dT(o){var P,A,F;let e,t,r,n,s,a=o[25].name+"",i,l,c,f,u,d,m,p,x=((P=o[26])==null?void 0:P.running)>0&&_b(o),y=((A=o[26])==null?void 0:A.failed)>0&&Sb(o),g=((F=o[26])==null?void 0:F.pending)>0&&kb(o);function I(){return o[22](o[25])}function T(...S){return o[23](o[25],...S)}return{c(){e=C("div"),t=C("span"),r=B("\u25B6"),s=E(),i=B(a),l=E(),c=C("span"),x&&x.c(),f=E(),y&&y.c(),u=E(),g&&g.c(),h(t,"class",n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf"),h(c,"class","sync-stats svelte-ztgdsf"),h(e,"class","folder-header svelte-ztgdsf"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-expanded",d=!!o[1][o[25].guid])},m(S,L){_(S,e,L),w(e,t),w(t,r),w(e,s),w(e,i),w(e,l),w(e,c),x&&x.m(c,null),w(c,f),y&&y.m(c,null),w(c,u),g&&g.m(c,null),m||(p=[K(e,"click",I),K(e,"keydown",T)],m=!0)},p(S,L){var $,O,Q;o=S,L&66&&n!==(n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf")&&h(t,"class",n),L&64&&a!==(a=o[25].name+"")&&X(i,a),(($=o[26])==null?void 0:$.running)>0?x?x.p(o,L):(x=_b(o),x.c(),x.m(c,f)):x&&(x.d(1),x=null),((O=o[26])==null?void 0:O.failed)>0?y?y.p(o,L):(y=Sb(o),y.c(),y.m(c,u)):y&&(y.d(1),y=null),((Q=o[26])==null?void 0:Q.pending)>0?g?g.p(o,L):(g=kb(o),g.c(),g.m(c,null)):g&&(g.d(1),g=null),L&66&&d!==(d=!!o[1][o[25].guid])&&h(e,"aria-expanded",d)},d(S){S&&v(e),x&&x.d(),y&&y.d(),g&&g.d(),m=!1,me(p)}}}function pT(o){let e,t;return e=new Br({props:{folder:o[25],$$slots:{default:[dT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&536870994&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function Cb(o){let e,t;return e=new lp({props:{folder:o[25],backgroundSync:o[0]}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&1&&(s.backgroundSync=r[0]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function Ib(o,e){let t,r,n,s,a;r=new Me({props:{$$slots:{name:[pT],default:[uT]},$$scope:{ctx:e}}});let i=e[1][e[25].guid]&&Cb(e);return{key:o,first:null,c(){t=he(),R(r.$$.fragment),n=E(),i&&i.c(),s=he(),this.first=t},m(l,c){_(l,t,c),D(r,l,c),_(l,n,c),i&&i.m(l,c),_(l,s,c),a=!0},p(l,c){e=l;let f={};c&536870994&&(f.$$scope={dirty:c,ctx:e}),r.$set(f),e[1][e[25].guid]?i?(i.p(e,c),c&66&&b(i,1)):(i=Cb(e),i.c(),b(i,1),i.m(s.parentNode,s)):i&&(se(),k(i,1,1,()=>{i=null}),ae())},i(l){a||(b(r.$$.fragment,l),b(i),a=!0)},o(l){k(r.$$.fragment,l),k(i),a=!1},d(l){l&&(v(t),v(n),v(s)),M(r,l),i&&i.d(l)}}}function Lb(o){let e,t,r,n,s,a=o[12].progress+"",i,l;return{c(){e=C("div"),t=C("div"),r=C("div"),n=E(),s=C("span"),i=B(a),l=B("%"),h(r,"class","progress-value svelte-ztgdsf"),ne(r,"width",o[12].progress+"%"),h(t,"class","progress-bar svelte-ztgdsf"),h(s,"class","progress-text svelte-ztgdsf"),h(e,"class","progress-container svelte-ztgdsf")},m(c,f){_(c,e,f),w(e,t),w(t,r),w(e,n),w(e,s),w(s,i),w(s,l)},p(c,f){f&4096&&ne(r,"width",c[12].progress+"%"),f&4096&&a!==(a=c[12].progress+"")&&X(i,a)},d(c){c&&v(e)}}}function mT(o){let e,t=(o[12].running>0||o[12].failed>0)&&Lb(o);return{c(){t&&t.c(),e=he()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[12].running>0||r[12].failed>0?t?t.p(r,n):(t=Lb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&v(e),t&&t.d(r)}}}function Tb(o){let e,t=o[12].running+"",r,n;return{c(){e=C("span"),r=B(t),n=B(" active"),h(e,"class","tag mod-success svelte-ztgdsf")},m(s,a){_(s,e,a),w(e,r),w(e,n)},p(s,a){a&4096&&t!==(t=s[12].running+"")&&X(r,t)},d(s){s&&v(e)}}}function Pb(o){let e,t=o[12].failed+"",r,n;return{c(){e=C("span"),r=B(t),n=B(" stuck"),h(e,"class","tag mod-warning svelte-ztgdsf")},m(s,a){_(s,e,a),w(e,r),w(e,n)},p(s,a){a&4096&&t!==(t=s[12].failed+"")&&X(r,t)},d(s){s&&v(e)}}}function Fb(o){let e,t=o[12].pending+"",r,n;return{c(){e=C("span"),r=B(t),n=B(" queued"),h(e,"class","tag svelte-ztgdsf")},m(s,a){_(s,e,a),w(e,r),w(e,n)},p(s,a){a&4096&&t!==(t=s[12].pending+"")&&X(r,t)},d(s){s&&v(e)}}}function hT(o){let e,t=o[5].name+"",r,n,s,a,i,l=o[12].running>0&&Tb(o),c=o[12].failed>0&&Pb(o),f=o[12].pending>0&&Fb(o);return{c(){e=C("div"),r=B(t),n=E(),s=C("span"),l&&l.c(),a=E(),c&&c.c(),i=E(),f&&f.c(),h(s,"class","sync-stats svelte-ztgdsf"),h(e,"class","folder-header svelte-ztgdsf")},m(u,d){_(u,e,d),w(e,r),w(e,n),w(e,s),l&&l.m(s,null),w(s,a),c&&c.m(s,null),w(s,i),f&&f.m(s,null)},p(u,d){d&32&&t!==(t=u[5].name+"")&&X(r,t),u[12].running>0?l?l.p(u,d):(l=Tb(u),l.c(),l.m(s,a)):l&&(l.d(1),l=null),u[12].failed>0?c?c.p(u,d):(c=Pb(u),c.c(),c.m(s,i)):c&&(c.d(1),c=null),u[12].pending>0?f?f.p(u,d):(f=Fb(u),f.c(),f.m(s,null)):f&&(f.d(1),f=null)},d(u){u&&v(e),l&&l.d(),c&&c.d(),f&&f.d()}}}function gT(o){let e,t;return e=new Br({props:{folder:o[5],$$slots:{default:[hT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&32&&(s.folder=r[5]),n&536875040&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function yT(o){let e,t,r,n,s,a,i=!o[5]&&xb(o),l=!o[5]&&bb(o),c=[fT,cT],f=[];function u(d,m){return d[5]&&d[12]?0:1}return n=u(o,-1),s=f[n]=c[n](o),{c(){e=C("div"),i&&i.c(),t=E(),l&&l.c(),r=E(),s.c(),h(e,"class","setting-item-container")},m(d,m){_(d,e,m),i&&i.m(e,null),w(e,t),l&&l.m(e,null),w(e,r),f[n].m(e,null),a=!0},p(d,[m]){d[5]?i&&(se(),k(i,1,1,()=>{i=null}),ae()):i?m&32&&b(i,1):(i=xb(d),i.c(),b(i,1),i.m(e,t)),d[5]?l&&(se(),k(l,1,1,()=>{l=null}),ae()):l?(l.p(d,m),m&32&&b(l,1)):(l=bb(d),l.c(),b(l,1),l.m(e,r));let p=n;n=u(d,m),n===p?f[n].p(d,m):(se(),k(f[p],1,1,()=>{f[p]=null}),ae(),s=f[n],s?s.p(d,m):(s=f[n]=c[n](d),s.c()),b(s,1),s.m(e,null))},i(d){a||(b(i),b(l),b(s),a=!0)},o(d){k(i),k(l),k(s),a=!1},d(d){d&&v(e),i&&i.d(),l&&l.d(),f[n].d()}}}function xT(o,e,t){let r,n,s,a,i,l,c,f,u,d,m,{backgroundSync:p}=e,{sharedFolders:x}=e,{focusedFolderGuid:y}=e,g={},I=0,T=0,P=0,A=0,{activeSync:F,activeDownloads:S}=p;ie(o,F,U=>t(21,m=U)),ie(o,S,U=>t(20,d=U));function L(U){t(1,g[U]=!g[U],g),t(1,g),t(6,r),t(17,x)}function $(){l?p.resume():p.pause()}let O=U=>L(U.guid),Q=(U,V)=>V.key==="Enter"&&L(U.guid);return o.$$set=U=>{"backgroundSync"in U&&t(0,p=U.backgroundSync),"sharedFolders"in U&&t(17,x=U.sharedFolders),"focusedFolderGuid"in U&&t(18,y=U.focusedFolderGuid)},o.$$.update=()=>{if(o.$$.dirty&131072){e:t(6,r=x.items().sort((U,V)=>U.name.localeCompare(V.name)))}if(o.$$.dirty&66){e:r.forEach(U=>{U.guid in g||t(1,g[U.guid]=!0,g)}),t(1,g),t(6,r),t(17,x)}if(o.$$.dirty&393216){e:t(5,n=y?x.items().find(U=>U.guid===y):void 0)}if(o.$$.dirty&3145793){e:t(4,s=new Map(r.map(U=>{var V,oe;return[U.guid,{progress:((V=p.getGroupProgress(U))===null||V===void 0?void 0:V.percent)||0,running:[...m.items(),...d.items()].filter(ve=>ve.sharedFolder.guid===U.guid).length,failed:((oe=p.syncGroups.get(U))===null||oe===void 0?void 0:oe.status)==="failed"?1:0,pending:[...p.pendingSyncs,...p.pendingDownloads].filter(ve=>ve.sharedFolder.guid===U.guid).length,completed:(()=>{let ve=p.syncGroups.get(U);return((ve==null?void 0:ve.completedSyncs)||0)+((ve==null?void 0:ve.completedDownloads)||0)})(),sharedFolder:U}]})))}if(o.$$.dirty&48){e:t(12,a=n?s.get(n.guid):void 0)}if(o.$$.dirty&1){e:t(19,i=p.getQueueStatus())}if(o.$$.dirty&524288){e:t(9,l=i.isPaused)}if(o.$$.dirty&524288){e:c=i.syncsActive>0||i.downloadsActive>0}if(o.$$.dirty&16){e:{let U=0,V=0,oe=0,ve=0;for(let N of s.values())U+=N.running,V+=N.failed,oe+=N.pending,ve+=N.completed;t(2,I=U),t(7,T=V),t(3,P=oe),t(8,A=ve)}}if(o.$$.dirty&4){e:t(11,f=I>0)}if(o.$$.dirty&8){e:t(10,u=P>0)}},[p,g,I,P,s,n,r,T,A,l,u,f,a,F,S,L,$,x,y,i,d,m,O,Q]}var cp=class extends W{constructor(e){super(),G(this,e,xT,yT,z,{backgroundSync:0,sharedFolders:17,focusedFolderGuid:18},sT)}},Ab=cp;var fa=class extends Eb.Modal{constructor(t,r,n,s){super(t);this.backgroundSync=r;this.sharedFolders=n;this.focusedFolderGuid=s}onOpen(){let{contentEl:t}=this;t.empty(),this.component=new Ab({target:t,props:{backgroundSync:this.backgroundSync,sharedFolders:this.sharedFolders,focusedFolderGuid:this.focusedFolderGuid,closeModal:()=>this.close()}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function fp(o){return o.startsWith("v")?o.slice(1):o}function bT(o,e){return o.map((t,r)=>[t,e[r]])}function vT(o,e){try{let t=fp(o).split(".").map(parseInt),r=fp(e).split(".").map(parseInt);for(let[n,s]of bT(t,r))if(n>s)return!0}catch(t){}return!1}var Sl=class extends Ve{constructor(t,r,n){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.releaseSettings=n;this.updateCheckInterval=null;this.lastReleaseCheck=0;this.lastChannelCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.githubReleases=new no("system3-relay/releases"),this.releaseChannels=new no("system3-relay/releaseChannels")}get releases(){return[...this.githubReleases.values()].sort((t,r)=>r.tag_name.localeCompare(t.tag_name,void 0,{numeric:!0,sensitivity:"base"}))}get beta(){return this.releaseChannels.get("beta")}get stable(){return this.releaseChannels.get("stable")}async fetchReleases(){let r=await nt("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);let n=await r.json();return Re().enableNetworkLogging&&this.debug("GitHub releases fetched:",n),n}async fetchLatestRelease(){try{let n="https://api.github.com/repos/No-Instructions/Relay/releases/latest";this.debug(`Fetching latest release from: ${n}`);let s=await nt(n,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);return await s.json()}catch(t){return this.error("Failed to fetch latest release:",t),null}}async fetchLatestTagFromChannel(t){try{let r={beta:"manifest-beta.json",stable:"manifest.json"}[t],n=r?await this.fetchRepoManifest(r):null;return n?(this.debug("repo manifest",n),n.version):null}catch(r){this.error("Failed to check for updates:",r)}return null}async getReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<5*60*1e3&&this.githubReleases.size>0)return[...this.githubReleases.values()];this.lastReleaseCheck=t;let r=await this.fetchReleases(),n=new Set([...this.githubReleases.keys()]),s=new Set;r.forEach(i=>{this.githubReleases.set(i.tag_name,i),s.add(i.tag_name)}),n.forEach(i=>{s.has(i)||this.githubReleases.delete(i)});let a=await this.fetchLatestRelease();a&&(a.latest=!0,this.githubReleases.set(a.tag_name,a)),this.notifyListeners()}catch(t){this.error("Failed to fetch GitHub releases:",t)}return[...this.githubReleases.values()]}async getChannelRelease(){let t=Date.now(),r=this.releaseChannels.get(this.releaseSettings.get().channel);if(t-this.lastChannelCheck<5*60*1e3&&r)return r;this.lastReleaseCheck=t;let n=await this.getReleases();if(n.length===0)return this.debug("No releases found"),null;let s=this.releaseSettings.get().channel;if(!s)return null;let a=await this.fetchLatestTagFromChannel(s);if(!a)return null;let i=n.find(l=>fp(l.tag_name)===a);return i?(this.releaseChannels.set(s,i),this.notifyListeners(),i):null}async update(){await this.getReleases(),await this.getChannelRelease()}start(){this.update(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.update(),this.CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null)}async fetchRepoManifest(t,r="main"){try{let a=`https://raw.githubusercontent.com/No-Instructions/Relay/${r}/${t}`;this.debug(`Fetching ${a}`);let i=await nt(a);if(!i.ok)throw new Error("unable to fetch manifest");return await i.json()}catch(n){return this.error("Failed to fetch:",n),null}}async fetchReleaseManifest(t){try{let r=t.assets.find(a=>a.name==="manifest.json");if(!r)return this.debug("No manifest found in release assets"),null;this.debug("Fetching manifest from release asset:",r.browser_download_url);let n=await nt(r.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!n.ok)throw new Error(`Failed to fetch manifest asset: ${n.status}`);let s=await n.json();return Re().enableNetworkLogging&&this.debug("manifest fetched:",s),s}catch(r){return this.error("Failed to fetch manifest for release:",t,r),null}}getNewRelease(){let t=this.releaseChannels.get(this.releaseSettings.get().channel);if(t&&vT(t.tag_name,this.plugin.version))return t}async installUpdate(t){let r=await this.fetchReleaseManifest(t);try{this.debug(`Installing update from v${this.plugin.version} to v${r.version}...`,r),await this.plugin.app.plugins.installPlugin("No-Instructions/Relay",r.version,r),this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let n="system3-relay",s=this.plugin.app.plugins;return await s.disablePlugin(n),await s.enablePlugin(n),!0}catch(n){return this.error("Failed to install update:",n),!1}}destroy(){this.stop(),this.githubReleases=null,this.releaseChannels=null,super.destroy()}};var Qb=require("obsidian");var jb=require("obsidian");function wT(o){ye(o,"svelte-12doke6",'.modal-content.svelte-12doke6.svelte-12doke6{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-12doke6.svelte-12doke6{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-12doke6.svelte-12doke6{height:0.5rem}.checkbox-container.svelte-12doke6.svelte-12doke6{cursor:pointer}.loading-text.svelte-12doke6.svelte-12doke6,.no-releases-text.svelte-12doke6.svelte-12doke6{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-12doke6.svelte-12doke6{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-12doke6.svelte-12doke6{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-12doke6.svelte-12doke6:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-12doke6.svelte-12doke6{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.development-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.main-branch-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.beta-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.release-tag-item.stable-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.prerelease-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-12doke6.svelte-12doke6{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-12doke6.svelte-12doke6{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-12doke6.svelte-12doke6{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-12doke6 h3.svelte-12doke6{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-12doke6.svelte-12doke6{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-12doke6.svelte-12doke6{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-12doke6.svelte-12doke6{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-12doke6.svelte-12doke6{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-12doke6.svelte-12doke6{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-12doke6.svelte-12doke6{flex:1}.manifest-version-mismatch.svelte-12doke6.svelte-12doke6{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-12doke6.svelte-12doke6{font-size:1.2em}.release-changelog.svelte-12doke6.svelte-12doke6{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-content.svelte-12doke6.svelte-12doke6{overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-12doke6.svelte-12doke6{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-12doke6.svelte-12doke6{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-12doke6.svelte-12doke6{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-12doke6.svelte-12doke6{margin-bottom:12px}')}function Db(o,e,t){let r=o.slice();return r[66]=e[t],r}function Mb(o){let e,t;return e=new ut({props:{name:"Show all releases",$$slots:{default:[_T]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&64|n[2]&128&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function _T(o){let e,t,r,n,s,a;return{c(){e=C("div"),t=C("input"),r=E(),n=C("div"),h(t,"type","checkbox"),t.checked=o[6],h(n,"class","checkbox-toggle"),h(e,"class","checkbox-container svelte-12doke6"),h(e,"role","checkbox"),h(e,"aria-checked",o[6]),h(e,"tabindex","0"),Ae(e,"is-enabled",o[6])},m(i,l){_(i,e,l),w(e,t),w(e,r),w(e,n),s||(a=[K(e,"click",o[41]),K(e,"keydown",o[42])],s=!0)},p(i,l){l[0]&64&&(t.checked=i[6]),l[0]&64&&h(e,"aria-checked",i[6]),l[0]&64&&Ae(e,"is-enabled",i[6])},d(i){i&&v(e),s=!1,me(a)}}}function ST(o){let e,t,r=!o[1]&&Rb(o);function n(i,l){if(i[11])return TT;if(i[16])return LT}let s=n(o,[-1,-1,-1]),a=s&&s(o);return{c(){r&&r.c(),e=E(),a&&a.c(),t=he()},m(i,l){r&&r.m(i,l),_(i,e,l),a&&a.m(i,l),_(i,t,l)},p(i,l){i[1]?r&&(r.d(1),r=null):r?r.p(i,l):(r=Rb(i),r.c(),r.m(e.parentNode,e)),s===(s=n(i,l))&&a?a.p(i,l):(a&&a.d(1),a=s&&s(i),a&&(a.c(),a.m(t.parentNode,t)))},d(i){i&&(v(e),v(t)),r&&r.d(i),a&&a.d(i)}}}function kT(o){let e;return{c(){e=C("div"),e.textContent="No matching releases found with the current filter",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){_(t,e,r)},p:q,d(t){t&&v(e)}}}function CT(o){let e;return{c(){e=C("div"),e.textContent="No GitHub releases found",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){_(t,e,r)},p:q,d(t){t&&v(e)}}}function IT(o){let e;return{c(){e=C("div"),e.textContent="Loading GitHub releases...",h(e,"class","loading-text svelte-12doke6")},m(t,r){_(t,e,r)},p:q,d(t){t&&v(e)}}}function Rb(o){let e,t,r,n=!o[8].some(o[40]),s,a=o[5]&&$b(o),i=o[4]&&Ub(o),l=n&&Ob(o),c=!o[1]&&Bb(o);return{c(){e=C("div"),a&&a.c(),t=E(),i&&i.c(),r=E(),l&&l.c(),s=E(),c&&c.c(),h(e,"class","release-tags-container svelte-12doke6")},m(f,u){_(f,e,u),a&&a.m(e,null),w(e,t),i&&i.m(e,null),w(e,r),l&&l.m(e,null),w(e,s),c&&c.m(e,null)},p(f,u){f[5]?a?a.p(f,u):(a=$b(f),a.c(),a.m(e,t)):a&&(a.d(1),a=null),f[4]?i?i.p(f,u):(i=Ub(f),i.c(),i.m(e,r)):i&&(i.d(1),i=null),u[0]&256&&(n=!f[8].some(f[40])),n?l?l.p(f,u):(l=Ob(f),l.c(),l.m(e,s)):l&&(l.d(1),l=null),f[1]?c&&(c.d(1),c=null):c?c.p(f,u):(c=Bb(f),c.c(),c.m(e,null))},d(f){f&&v(e),a&&a.d(),i&&i.d(),l&&l.d(),c&&c.d()}}}function $b(o){let e,t,r,n,s;return{c(){e=C("div"),t=C("div"),t.textContent="Stable",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version stable-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="stable"),h(e,"tabindex","0")},m(a,i){_(a,e,i),w(e,t),n||(s=[K(e,"click",o[43]),K(e,"keydown",o[44])],n=!0)},p(a,i){i[0]&512&&r!==(r=a[9]==="stable")&&h(e,"aria-selected",r)},d(a){a&&v(e),n=!1,me(s)}}}function Ub(o){let e,t,r,n,s;return{c(){e=C("div"),t=C("div"),t.textContent="Beta",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version beta-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="beta"),h(e,"tabindex","0")},m(a,i){_(a,e,i),w(e,t),n||(s=[K(e,"click",o[45]),K(e,"keydown",o[46])],n=!0)},p(a,i){i[0]&512&&r!==(r=a[9]==="beta")&&h(e,"aria-selected",r)},d(a){a&&v(e),n=!1,me(s)}}}function Ob(o){let e,t,r,n,s;return{c(){e=C("div"),t=C("div"),t.textContent="Dev",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item development-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[10]===o[0].version),h(e,"tabindex","0")},m(a,i){_(a,e,i),w(e,t),n||(s=[K(e,"click",o[47]),K(e,"keydown",o[48])],n=!0)},p(a,i){i[0]&1025&&r!==(r=a[10]===a[0].version)&&h(e,"aria-selected",r)},d(a){a&&v(e),n=!1,me(s)}}}function Bb(o){let e,t=we(o[8]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Nb(Db(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=he()},m(n,s){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(n,s);_(n,e,s)},p(n,s){if(s[0]&268436736|s[1]&17){t=we(n[8]);let a;for(a=0;a<t.length;a+=1){let i=Db(n,t,a);r[a]?r[a].p(i,s):(r[a]=Nb(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&v(e),He(r,n)}}}function Nb(o){let e,t,r=o[66].tag_name+"",n,s,a,i,l,c;function f(){return o[49](o[66])}function u(...d){return o[50](o[66],...d)}return{c(){e=C("div"),t=C("div"),n=B(r),s=E(),h(t,"class","tag-name svelte-12doke6"),h(e,"class",a="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(Gb(o[66])?"pre-release":"")+" svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",i=o[10]===o[66].tag_name),h(e,"tabindex","0")},m(d,m){_(d,e,m),w(e,t),w(t,n),w(e,s),l||(c=[K(e,"click",f),K(e,"keydown",u)],l=!0)},p(d,m){o=d,m[0]&256&&r!==(r=o[66].tag_name+"")&&X(n,r),m[0]&256&&a!==(a="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(Gb(o[66])?"pre-release":"")+" svelte-12doke6")&&h(e,"class",a),m[0]&1280&&i!==(i=o[10]===o[66].tag_name)&&h(e,"aria-selected",i)},d(d){d&&v(e),l=!1,me(c)}}}function LT(o){let e,t,r,n,s,a,i;return{c(){e=C("div"),t=C("div"),r=B(o[16]),n=E(),s=C("button"),s.textContent="Close",h(t,"class","manifest-error-message svelte-12doke6"),h(s,"class","manifest-close-btn svelte-12doke6"),h(e,"class","manifest-error svelte-12doke6")},m(l,c){_(l,e,c),w(e,t),w(t,r),w(e,n),w(e,s),a||(i=K(s,"click",o[37]),a=!0)},p(l,c){c[0]&65536&&X(r,l[16])},d(l){l&&v(e),a=!1,i()}}}function TT(o){var U;let e,t,r,n,s,a,i=(U=o[38](o[10]))==null?void 0:U.prerelease,l,c,f,u,d,m,p,x,y,g,I=i&&Hb(o),T=o[12][o[10]]==="beta-alias"&&qb(o),P=o[12][o[10]]==="stable-alias"&&Vb(o);function A(V,oe){if(oe[0]&9216&&(d=null),oe[0]&1024&&(m=null),d==null&&(d=!!((V[38](V[10])||V[13][V[10]]==="stable-alias"||V[13][V[10]]==="beta-alias")&&!V[28](V[10]))),d)return FT;if(m==null&&(m=!!V[28](V[10])),m)return PT}let F=A(o,[-1,-1,-1]),S=F&&F(o);function L(V,oe){return V[13][V[10]]==="stable-alias"||V[13][V[10]]==="beta-alias"||V[9]==="development"?RT:V[10]?MT:DT}let $=L(o,[-1,-1,-1]),O=$(o),Q=o[15]&&zb(o);return{c(){e=C("div"),t=C("div"),r=C("h3"),n=B("Release Details: "),s=B(o[10]),a=E(),I&&I.c(),l=E(),T&&T.c(),c=E(),P&&P.c(),f=E(),u=C("div"),S&&S.c(),p=E(),x=C("div"),y=C("div"),O.c(),g=E(),Q&&Q.c(),h(r,"class","svelte-12doke6"),h(u,"class","manifest-header-actions svelte-12doke6"),h(t,"class","manifest-header svelte-12doke6"),h(y,"class","release-changelog-content svelte-12doke6"),h(x,"class","release-changelog svelte-12doke6"),h(e,"class","manifest-container svelte-12doke6")},m(V,oe){_(V,e,oe),w(e,t),w(t,r),w(r,n),w(r,s),w(r,a),I&&I.m(r,null),w(r,l),T&&T.m(r,null),w(r,c),P&&P.m(r,null),w(t,f),w(t,u),S&&S.m(u,null),w(e,p),w(e,x),w(x,y),O.m(y,null),w(e,g),Q&&Q.m(e,null)},p(V,oe){var ve;oe[0]&1024&&X(s,V[10]),oe[0]&1024&&(i=(ve=V[38](V[10]))==null?void 0:ve.prerelease),i?I||(I=Hb(V),I.c(),I.m(r,l)):I&&(I.d(1),I=null),V[12][V[10]]==="beta-alias"?T||(T=qb(V),T.c(),T.m(r,c)):T&&(T.d(1),T=null),V[12][V[10]]==="stable-alias"?P||(P=Vb(V),P.c(),P.m(r,null)):P&&(P.d(1),P=null),F===(F=A(V,oe))&&S?S.p(V,oe):(S&&S.d(1),S=F&&F(V),S&&(S.c(),S.m(u,null))),$===($=L(V,oe))&&O?O.p(V,oe):(O.d(1),O=$(V),O&&(O.c(),O.m(y,null))),V[15]?Q?Q.p(V,oe):(Q=zb(V),Q.c(),Q.m(e,null)):Q&&(Q.d(1),Q=null)},d(V){V&&v(e),I&&I.d(),T&&T.d(),P&&P.d(),S&&S.d(),O.d(),Q&&Q.d()}}}function Hb(o){let e;return{c(){e=C("span"),e.textContent="Pre-release",h(e,"class","prerelease-badge svelte-12doke6")},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function qb(o){let e;return{c(){e=C("span"),e.textContent="Beta",h(e,"class","channel-badge beta-badge svelte-12doke6")},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function Vb(o){let e;return{c(){e=C("span"),e.textContent="Stable",h(e,"class","channel-badge stable-badge svelte-12doke6")},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function PT(o){let e;return{c(){e=C("span"),e.textContent="Installed",h(e,"class","currently-installed svelte-12doke6")},m(t,r){_(t,e,r)},p:q,d(t){t&&v(e)}}}function FT(o){let e,t,r,n;function s(l,c){return l[14]===l[10]?ET:AT}let a=s(o,[-1,-1,-1]),i=a(o);return{c(){e=C("button"),i.c(),h(e,"class","install-version-btn mod-cta svelte-12doke6"),e.disabled=t=o[14]===o[10]||o[2]},m(l,c){_(l,e,c),i.m(e,null),r||(n=K(e,"click",o[51]),r=!0)},p(l,c){a!==(a=s(l,c))&&(i.d(1),i=a(l),i&&(i.c(),i.m(e,null))),c[0]&17412&&t!==(t=l[14]===l[10]||l[2])&&(e.disabled=t)},d(l){l&&v(e),i.d(),r=!1,n()}}}function AT(o){let e;return{c(){e=B("Install")},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function ET(o){let e;return{c(){e=B("Installing...")},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function DT(o){let e;return{c(){e=B('"No changelog available"')},m(t,r){_(t,e,r)},p:q,d(t){t&&v(e)}}}function MT(o){var n;let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:OT,then:UT,catch:$T,value:65};return ao(t=o[34](((n=o[38](o[10]))==null?void 0:n.body)||"No changelog available"),r),{c(){e=he(),r.block.c()},m(s,a){_(s,e,a),r.block.m(s,r.anchor=a),r.mount=()=>e.parentNode,r.anchor=e},p(s,a){var i;o=s,r.ctx=o,a[0]&1024&&t!==(t=o[34](((i=o[38](o[10]))==null?void 0:i.body)||"No changelog available"))&&ao(t,r)||es(r,o,a)},d(s){s&&v(e),r.block.d(s),r.token=null,r=null}}}function RT(o){let e;function t(s,a){if(s[13][s[10]]==="stable-alias")return HT;if(s[13][s[10]]==="beta-alias")return NT;if(s[10]===s[0].version)return BT}let r=t(o,[-1,-1,-1]),n=r&&r(o);return{c(){n&&n.c(),e=he()},m(s,a){n&&n.m(s,a),_(s,e,a)},p(s,a){r!==(r=t(s,a))&&(n&&n.d(1),n=r&&r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&v(e),n&&n.d(s)}}}function $T(o){return{c:q,m:q,p:q,d:q}}function UT(o){let e,t=o[65]+"",r;return{c(){e=new Do(!1),r=he(),e.a=r},m(n,s){e.m(t,n,s),_(n,r,s)},p(n,s){s[0]&1024&&t!==(t=n[65]+"")&&e.p(t)},d(n){n&&(v(r),e.d())}}}function OT(o){let e;return{c(){e=B('"loading..."')},m(t,r){_(t,e,r)},p:q,d(t){t&&v(e)}}}function BT(o){let e;return{c(){e=C("p"),e.textContent="Current development version"},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function NT(o){let e;return{c(){e=C("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function HT(o){let e;return{c(){e=C("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function zb(o){let e,t,r,n,s,a=o[11].version+"",i,l,c=o[10]!==o[11].version&&!o[10].startsWith("v"+o[11].version),f,u,d,m,p,x=o[11].name+"",y,g,I,T,P,A,F=o[11].author+"",S,L,$,O,Q,U,V=o[11].description+"",oe,ve,N,j,_e,Ne,Ee=o[11].isDesktopOnly?"Yes":"No",te,re,Y,xe,$e,_t,Ke=o[11].minAppVersion+"",Sr,lt=c&&Wb(o);return{c(){e=C("div"),t=C("div"),r=C("span"),r.textContent="Version:",n=E(),s=C("span"),i=B(a),l=E(),lt&&lt.c(),f=E(),u=C("div"),d=C("span"),d.textContent="Name:",m=E(),p=C("span"),y=B(x),g=E(),I=C("div"),T=C("span"),T.textContent="Author:",P=E(),A=C("span"),S=B(F),L=E(),$=C("div"),O=C("span"),O.textContent="Description:",Q=E(),U=C("span"),oe=B(V),ve=E(),N=C("div"),j=C("span"),j.textContent="isDesktopOnly:",_e=E(),Ne=C("span"),te=B(Ee),re=E(),Y=C("div"),xe=C("span"),xe.textContent="minAppVersion:",$e=E(),_t=C("span"),Sr=B(Ke),h(r,"class","manifest-label svelte-12doke6"),h(s,"class","manifest-value svelte-12doke6"),h(t,"class","manifest-field svelte-12doke6"),h(d,"class","manifest-label svelte-12doke6"),h(p,"class","manifest-value svelte-12doke6"),h(u,"class","manifest-field svelte-12doke6"),h(T,"class","manifest-label svelte-12doke6"),h(A,"class","manifest-value svelte-12doke6"),h(I,"class","manifest-field svelte-12doke6"),h(O,"class","manifest-label svelte-12doke6"),h(U,"class","manifest-value svelte-12doke6"),h($,"class","manifest-field svelte-12doke6"),h(j,"class","manifest-label svelte-12doke6"),h(Ne,"class","manifest-value svelte-12doke6"),h(N,"class","manifest-field svelte-12doke6"),h(xe,"class","manifest-label svelte-12doke6"),h(_t,"class","manifest-value svelte-12doke6"),h(Y,"class","manifest-field svelte-12doke6"),h(e,"class","manifest-content svelte-12doke6")},m(et,Ht){_(et,e,Ht),w(e,t),w(t,r),w(t,n),w(t,s),w(s,i),w(t,l),lt&&lt.m(t,null),w(e,f),w(e,u),w(u,d),w(u,m),w(u,p),w(p,y),w(e,g),w(e,I),w(I,T),w(I,P),w(I,A),w(A,S),w(e,L),w(e,$),w($,O),w($,Q),w($,U),w(U,oe),w(e,ve),w(e,N),w(N,j),w(N,_e),w(N,Ne),w(Ne,te),w(e,re),w(e,Y),w(Y,xe),w(Y,$e),w(Y,_t),w(_t,Sr)},p(et,Ht){Ht[0]&2048&&a!==(a=et[11].version+"")&&X(i,a),Ht[0]&3072&&(c=et[10]!==et[11].version&&!et[10].startsWith("v"+et[11].version)),c?lt||(lt=Wb(et),lt.c(),lt.m(t,null)):lt&&(lt.d(1),lt=null),Ht[0]&2048&&x!==(x=et[11].name+"")&&X(y,x),Ht[0]&2048&&F!==(F=et[11].author+"")&&X(S,F),Ht[0]&2048&&V!==(V=et[11].description+"")&&X(oe,V),Ht[0]&2048&&Ee!==(Ee=et[11].isDesktopOnly?"Yes":"No")&&X(te,Ee),Ht[0]&2048&&Ke!==(Ke=et[11].minAppVersion+"")&&X(Sr,Ke)},d(et){et&&v(e),lt&&lt.d()}}}function Wb(o){let e;return{c(){e=C("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-12doke6">\u26A0\uFE0F</span>
									Version mismatch`,h(e,"class","manifest-version-mismatch svelte-12doke6")},m(t,r){_(t,e,r)},d(t){t&&v(e)}}}function qT(o){let e,t=o[1]?"Relay installer":"Relay releases",r,n,s,a,i,l,c,f,u=!o[1]&&Mb(o);function d(x,y){return x[7]?IT:x[3].length===0?CT:x[8].length===0?kT:ST}let m=d(o,[-1,-1,-1]),p=m(o);return{c(){e=C("div"),r=B(t),n=E(),s=C("div"),a=C("div"),i=E(),l=C("div"),u&&u.c(),c=E(),p.c(),h(e,"class","modal-title"),h(a,"class","settings-spacer svelte-12doke6"),h(l,"class","settings-container svelte-12doke6"),h(s,"class","modal-content svelte-12doke6")},m(x,y){_(x,e,y),w(e,r),_(x,n,y),_(x,s,y),w(s,a),w(s,i),w(s,l),u&&u.m(l,null),w(s,c),p.m(s,null),f=!0},p(x,y){(!f||y[0]&2)&&t!==(t=x[1]?"Relay installer":"Relay releases")&&X(r,t),x[1]?u&&(se(),k(u,1,1,()=>{u=null}),ae()):u?(u.p(x,y),y[0]&2&&b(u,1)):(u=Mb(x),u.c(),b(u,1),u.m(l,null)),m===(m=d(x,y))&&p?p.p(x,y):(p.d(1),p=m(x),p&&(p.c(),p.m(s,null)))},i(x){f||(b(u),f=!0)},o(x){k(u),f=!1},d(x){x&&(v(e),v(n),v(s)),u&&u.d(),p.d()}}}var Kb="system3-relay";function pn(o){return o.startsWith("v")?o.substring(1):o}function Gb(o){return(o==null?void 0:o.prerelease)===!0}function VT(o,e,t){let r,n,s,a,i,l,c,f,u,d,m,p,x,y,g,I,{plugin:T}=e,{version:P}=e,A=de(T.manifest.version),F=de(!1),S=de(""),L=de(""),$=de(!1);ie(o,$,J=>t(7,c=J));let O=de(!1);ie(o,O,J=>t(6,l=J));let Q=de(null);ie(o,Q,J=>t(11,m=J));let U=de("");ie(o,U,J=>t(10,d=J));let V=de(null),oe=de(null);ie(o,oe,J=>t(16,I=J));let ve=de(!1);ie(o,ve,J=>t(15,g=J));let N=de(null);ie(o,N,J=>t(5,s=J));let j=de(null);ie(o,j,J=>t(4,n=J));let _e=de(null);ie(o,_e,J=>t(53,i=J));let Ne=de(null);ie(o,Ne,J=>t(52,a=J));let Ee=de(!1),te=!1,re=de(null);ie(o,re,J=>t(14,y=J));let Y=T.app;function xe(J){let H=pn(J),ge=pn(T.version);return H===ge}let $e=de({});ie(o,$e,J=>t(13,x=J));let _t=de({});ie(o,_t,J=>t(12,p=J));let Ke=de(T.releaseSettings.get().channel);ie(o,Ke,J=>t(9,u=J)),Ft(()=>{Ht(),Sr(),!P&&!r.some(J=>{J.tag_name,T.version})?Ke.set(null):Ke.set(T.releaseSettings.get().channel),Q.set({version:P||T.version,name:T.manifest.name,author:T.manifest.author,description:T.manifest.description,isDesktopOnly:T.manifest.isDesktopOnly,minAppVersion:T.manifest.minAppVersion}),U.set(P||T.version)});function Sr(){return De(this,void 0,void 0,function*(){Ee.set(!0);try{let J=yield T.updateManager.fetchRepoManifest("manifest.json");J&&(N.set(J),_e.set(J.version));let H=yield T.updateManager.fetchRepoManifest("manifest-beta.json");H&&(j.set(H),Ne.set(H.version))}catch(J){T.error("Error fetching main branch manifests:",J)}finally{Ee.set(!1)}})}let lt=wr(T.updateManager,()=>T.updateManager.releases);ie(o,lt,J=>t(3,r=J));let et=wr([lt,O],()=>r&&r.length>0?fs(l).sort():[]);ie(o,et,J=>t(8,f=J)),r.forEach(J=>De(void 0,void 0,void 0,function*(){try{let H=yield T.updateManager.fetchReleaseManifest(J);H&&$e.update(ge=>Object.assign(Object.assign({},ge),{[J.tag_name]:H.version}))}catch(H){}}));function Ht(){return De(this,void 0,void 0,function*(){$.set(!0);try{yield T.updateManager.getReleases(),fs(l)}catch(J){T.error("Error refreshing GitHub releases:",J)}finally{$.set(!1)}})}function Cl(J){return De(this,void 0,void 0,function*(){let H=document.createElement("div");return yield jb.MarkdownRenderer.render(T.app,J,H,"",T),H.innerHTML})}function fs(J){return J?r:P?r.filter(H=>P===pn(H.tag_name)):r.filter(H=>{let ge=H.tag_name;return da(H)})}function da(J){if(J.prerelease||J.draft)return!1;if(J.latest||pn(J.tag_name)===i||pn(J.tag_name)===a)return!0;let H=new Date(J.created_at),ge=new Date;return ge.setMonth(ge.getMonth()-3),H>ge}function us(J){return De(this,void 0,void 0,function*(){oe.set(null),V.set(J);try{let H=ds(J);if(!H){oe.set(`Could not find release for ${J}`);return}let ge=yield T.updateManager.fetchReleaseManifest(H);ge?(Q.set(ge),U.set(J),ve.set(!1),$e.update(We=>Object.assign(Object.assign({},We),{[J]:ge.version}))):oe.set(`Could not find manifest for ${J}`)}catch(H){T.error("Error fetching manifest:",H),oe.set(`Error fetching manifest: ${H.message||"Unknown error"}`)}finally{V.set(null)}})}function ho(J){let H=J==="stable"?s:n;if(H){let ge=H.version;Ke.set(J);let We=[...r.values()].find(tt=>pn(tt.tag_name)===pn(ge));We?(J==="stable"?_t.update(tt=>Object.assign(Object.assign({},tt),{[We.tag_name]:"stable-alias"})):_t.update(tt=>Object.assign(Object.assign({},tt),{[We.tag_name]:"beta-alias"})),us(We.tag_name)):(Q.set(H),U.set(ge),J==="stable"?_t.update(tt=>Object.assign(Object.assign({},tt),{[ge]:"stable-alias"})):_t.update(tt=>Object.assign(Object.assign({},tt),{[ge]:"beta-alias"})),ve.set(!1))}else oe.set(`Could not find ${J} manifest`)}function Il(){Q.set(null),U.set(""),oe.set(null)}function ds(J){return[...r.values()].find(H=>H.tag_name===J)}function pa(J){return De(this,void 0,void 0,function*(){try{re.set(J);let H=ds(J);if(!H)throw new Error(`Could not find release for ${J}`);let ge=yield T.updateManager.fetchReleaseManifest(H);if(!ge)throw new Error(`Could not find manifest for ${J}`);t(2,te=!0),yield Y.plugins.installPlugin(T.repo,J,ge),yield Y.plugins.disablePlugin(Kb),yield Y.plugins.enablePlugin(Kb)}catch(H){console.error(`Error installing version ${J}:`,H),T&&T.error(`Error installing version ${J}:`,H)}finally{T&&(t(2,te=!1),re.set(null))}})}let Ll=J=>xe(J.tag_name),Tl=()=>{O.update(J=>!J)},Pl=J=>{(J.key==="Enter"||J.key===" ")&&O.update(H=>!H)},Fl=()=>{T.releaseSettings.update(J=>({...J,channel:"stable"})),Ke.set("stable"),ho("stable")},Al=J=>{(J.key==="Enter"||J.key===" ")&&(T.releaseSettings.update(H=>({...H,channel:"stable"})),Ke.set("stable"),ho("stable"))},El=()=>{T.releaseSettings.update(J=>({...J,channel:"beta"})),Ke.set("beta"),ho("beta")},Dl=J=>{(J.key==="Enter"||J.key===" ")&&(T.releaseSettings.update(H=>({...H,channel:"beta"})),Ke.set("beta"),ho("beta"))},Ml=()=>{Ke.set(null),Q.set({version:T.manifest.version,name:T.manifest.name,author:T.manifest.author,description:T.manifest.description,isDesktopOnly:T.manifest.isDesktopOnly,minAppVersion:T.manifest.minAppVersion}),U.set(T.version),ve.set(!1)},Rl=J=>{(J.key==="Enter"||J.key===" ")&&(Ke.set(null),Q.set({version:T.manifest.version,name:T.manifest.name,author:T.manifest.author,description:T.manifest.description,isDesktopOnly:T.manifest.isDesktopOnly,minAppVersion:T.manifest.minAppVersion}),U.set(T.version),ve.set(!1))},$l=J=>{Ke.set(null),us(J.tag_name)},Ul=(J,H)=>{(H.key==="Enter"||H.key===" ")&&(Ke.set(null),us(J.tag_name))},Ol=async()=>{pa(d)};return o.$$set=J=>{"plugin"in J&&t(0,T=J.plugin),"version"in J&&t(1,P=J.version)},[T,P,te,r,n,s,l,c,f,u,d,m,p,x,y,g,I,$,O,Q,U,oe,ve,N,j,_e,Ne,re,xe,$e,_t,Ke,lt,et,Cl,us,ho,Il,ds,pa,Ll,Tl,Pl,Fl,Al,El,Dl,Ml,Rl,$l,Ul,Ol]}var up=class extends W{constructor(e){super(),G(this,e,VT,qT,z,{plugin:0,version:1},wT,[-1,-1,-1])}},Jb=up;var ua=class extends Qb.Modal{constructor(t,r,n){super(t);this.plugin=r;this.version=n}onOpen(){let{contentEl:t}=this;this.component=new Jb({target:t,props:{plugin:this.plugin,version:this.version}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var zT={debugging:!1},WT={release:{channel:"stable"},sharedFolders:[],...ti,...zT},kl=class extends Zb.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.5.6";this.repo="No-Instructions/Relay"}enableDebugging(t){Za(!0),console.warn("RelayInstances",ht),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){Za(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return Za(r),t&&this.debugSettings.update(n=>({...n,debugging:r})),r}buildApiUrl(t){return"https://api.system3.md"+t}async onload(){this.appId=this.app.appId;let t=Ze.moment.now();ht.set(this,"plugin"),this.timeProvider=new Gn,this.register(()=>{this.timeProvider.destroy()}),Ph(new vl(this.app.vault),this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new bl,this.toast=Eh(this.notifier),this.debug=be("[System 3][Relay]","debug"),this.log=be("[System 3][Relay]","log"),this.warn=be("[System 3][Relay]","warn"),this.error=be("[System 3][Relay]","error"),this.settings=new di(this,WT),await this.settings.load(),this.featureSettings=new Wt(this.settings,"(enable*)"),this.debugSettings=new Wt(this.settings,"(debugging)"),this.folderSettings=new Wt(this.settings,"sharedFolders"),this.releaseSettings=new Wt(this.settings,"release"),gt.getInstance().setSettings(this.featureSettings),this.settingsTab=new Yi(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new Sl(this,this.timeProvider,this.releaseSettings),this.debugSettings.subscribe(a=>{a.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Show feature flags",callback:()=>{let i=new yl(this.app,()=>{this.reload()});this.openModals.push(i),i.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let i=new wl(this.app,this);this.openModals.push(i),i.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let i=new xl(this.app,this);this.openModals.push(i),i.open()}}),this.addCommand({id:"show-release-manager",name:"Show releases",callback:()=>{let i=new ua(this.app,this);this.openModals.push(i),i.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze database",callback:()=>{let i=new _l(this.app,this);this.openModals.push(i),i.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}}),this.addCommand({id:"show-sync-status",name:"Sync status",callback:()=>{let i=new fa(this.app,this.backgroundSync,this.sharedFolders);this.openModals.push(i),i.open()}})):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-sync-status"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))});let n=`async function() {
			const app = window.app;
			await app.plugins.disablePlugin("system3-relay");
			await app.plugins.enablePlugin("system3-relay");
		}`;this.app.reloadRelay=new Function("return "+n),this.addCommand({id:"reload",name:"Reload Relay",callback:this.app.reloadRelay()}),this.updateManager.subscribe(()=>{let a=this.updateManager.getNewRelease();a?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.version} \u2192 ${a.tag_name})`,callback:async()=>{await this.updateManager.installUpdate(a)}}),this.log(`Update available: v${this.version} \u2192 ${a.tag_name}`)):this.removeCommand("update-plugin")}),this.vault=this.app.vault;let s=this.vault.getName();this.fileManager=this.app.fileManager,this.hashStore=new pi(this.appId),this.loginManager=new tl(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this)),this.relayManager=new gl(this.loginManager),this.sharedFolders=new hi(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new pl(this.loginManager,this.timeProvider,s,3),this.networkStatus=new _x(this.timeProvider,"https://api.system3.md/health?version=0.5.6"),this.backgroundSync=new Ci(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new Ze.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new Ri(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),Xb.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(a=>a.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(os,a=>new Fi(a)),this.registerEvent(this.app.workspace.on("file-menu",(a,i)=>{if(i instanceof Ze.TFolder){let l=this.sharedFolders.find(c=>c.path===i.path);if(!l)return;l.relayId&&(a.addItem(c=>{c.setTitle("Relay settings").setIcon("gear").onClick(()=>{this.openSettings(`/relays?id=${l.relayId}`)})}),a.addItem(c=>{c.setTitle("Folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${l.guid}&relay=${l.relayId}`)})}),a.addItem(c=>{c.setTitle(l.connected?"Disconnect":"Connect").setIcon("satellite").onClick(()=>{l.connected?(l.shouldConnect=!1,l.disconnect()):(l.shouldConnect=!0,l.connect()),this._liveViews.refresh("folder connection toggle")})})),l.relayId&&Re().enableSyncModal&&a.addItem(c=>{c.setTitle("Sync Status").setIcon("list-checks").onClick(()=>{let f=new fa(this.app,this.backgroundSync,this.sharedFolders,l.guid);this.openModals.push(f),f.open()})}),Re().enableSyncMenu&&l.relayId&&l.connected&&a.addItem(c=>{c.setTitle("Sync").setIcon("folder-sync").onClick(()=>{l.netSync()})})}else if(i instanceof Ze.TFile){let l=this.sharedFolders.lookup(i.path),c=l==null?void 0:l.getFile(i);c&&ir(c)&&(a.addItem(f=>{f.setTitle("Download").setIcon("cloud-download").onClick(async()=>{await c.pull(),new Ze.Notice(`Download complete: ${c.name}`)})}),this.debugSettings.get().debugging&&a.addItem(f=>{f.setTitle("Verify upload").setIcon("search-check").onClick(async()=>{let u=await c.verifyUpload();new Ze.Notice(`${c.name} ${u?"on server":"missing from server"}`)})}),a.addItem(f=>{f.setTitle("Upload").setIcon("cloud-upload").onClick(async()=>{await c.push(!0);let u=await c.verifyUpload();new Ze.Notice(`${u?"File uploaded:":"File upload failed:"} ${c.name}`)})}))}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=Ze.moment.now()-t})}async reload(){this.app.reloadRelay()()}_createSharedFolder(t,r,n,s){let a=new Wt(this.settings,`sharedFolders/[guid=${r}]`),i={guid:r,path:t};return n&&(i.relay=n),a.update(c=>({...c,path:t,guid:r,...n?{relay:n}:{},sync:c.sync?c.sync:Fo.defaultFlags}),!0),new mi(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.hashStore,this.backgroundSync,a,n,s)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,n,s;let t=this;try{if(this.webviewerPatched)return;let a=(n=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:n.webviewer;if(!((s=a==null?void 0:a.instance)!=null&&s.options)||!a.enabled){this.warn("Webviewer plugin not found or not initialized");return}let i=a.instance.options,l=Object.getOwnPropertyDescriptor(i,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(i,"openExternalURLs",{get(){var d;let u=window.event;if((u==null?void 0:u.type)==="open-url"&&((d=u==null?void 0:u.detail)!=null&&d.url)){let m=u.detail.url;for(let p of t.interceptedUrls)if(typeof p=="string"&&m.startsWith(p)||p instanceof RegExp&&p.test(m))return t.log("Intercepted webviewer, opening in default browser",u.detail.url),!1}return l.value},set(u){l.value=u},configurable:!0}),this.register(()=>{Object.defineProperty(i,"openExternalURLs",l)});let c=this.loginManager.webviewIntercept();this.debug("Intercepting Webviewer for URL pattern",c.source),this.interceptedUrls.push(c);let f=new RegExp("https://api.system3.md".replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",f.source),this.interceptedUrls.push(f),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(a){this.error("Failed to patch webviewer:",a)}}setup(){this.folderNavDecorations=new Oi(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=be("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",c=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=be("[System 3][Relay][Vault]","log"),n=c=>{let f=c.error;f&&f instanceof dn&&this.toast(f)};window.addEventListener("error",n,!0),this.register(()=>window.removeEventListener("error",n,!0));let s=c=>{c.reason instanceof dn&&this.toast(c.reason)},a=c=>s(c);window.addEventListener("unhandledrejection",a,!0),this.register(()=>window.removeEventListener("unhandledrejection",a,!0)),this.registerEvent(this.app.vault.on("create",c=>{let f=this.sharedFolders.lookup(c.path);f&&(f.placeHold([c]).length>0?f.uploadFile(c):f.whenReady().then(d=>{d.getFile(c)}))})),this.registerEvent(this.app.vault.on("delete",c=>{if(c instanceof Ze.TFolder){let u=this.sharedFolders.find(d=>d.path===c.path);if(u){this.sharedFolders.delete(u);return}}let f=this.sharedFolders.lookup(c.path);f&&(r("Delete",c.path),f.whenReady().then(u=>{u.proxy.deleteFile(c.path)}))})),this.registerEvent(this.app.vault.on("rename",(c,f)=>{if(c instanceof Ze.TFolder){let p=this.sharedFolders.find(x=>x.path==f);if(p){p.move(c.path),this.sharedFolders.update();return}}let u=this.sharedFolders.lookup(f),d=this.sharedFolders.lookup(c.path),m=u||d;u&&d?(r("Rename",c.path,f),u.renameFile(c,f),d.renameFile(c,f),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):m&&(r("Rename",c,f),m.renameFile(c,f),this._liveViews.refresh("rename"),this.folderNavDecorations.refresh())})),this.registerEvent(this.app.vault.on("modify",c=>{let f=this.sharedFolders.lookup(c.path);if(f){r("Modify",c.path),Re().enableDesyncPill&&this.folderNavDecorations.quickRefresh();let u=f.proxy.getFile(c);u&&ir(u)&&u.sync(),this.app.metadataCache.trigger("resolve",u)}}));let i=this,l=cn(Ze.MarkdownView.prototype,{onUnloadFile(c){return function(f){return i._liveViews.wipe(),c.call(this,f)}}});this.register(l),this.patchWebviewer(),to(Dr.enableNewLinkFormat,()=>{let c=cn(Ze.MetadataCache.prototype,{fileToLinktext(f){return function(u,d,m){if(i.sharedFolders.lookup(u.path)){m===void 0&&(m=!0);let x=u.extension==="md"&&m?u.basename:u.name,y=(0,Ze.normalizePath)(u.name),g=i.app.metadataCache.uniqueFileLookup.get(y.toLowerCase());if(g&&g.length===1&&g[0]===u)return x;{let I=u.extension==="md"&&m?u.path.slice(0,u.path.length-3):u.path,T=(0,Yb.relative)(d,I);return T==="../"+x?"./"+x:T}}return f.call(this,u,d,m)}}});this.register(c)}),this.registerObsidianProtocolHandler("relay/settings/relays",async c=>{let f=c,u=new URLSearchParams({...f}).toString(),d=`/${f.action.split("/").slice(-1)}?${u}`;this.openSettings(d)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async c=>{let f=c,u=new URLSearchParams({...f}).toString(),d=`/${f.action.split("/").slice(-1)}?${u}`;this.openSettings(d)}),this.registerObsidianProtocolHandler("relay/upgrade",async c=>{var d;let u=(d=c.version)==null?void 0:d.trim();this.installVersion(u)}),this.backgroundSync.start(),this.updateManager.start()}installVersion(t){let r=new ua(this.app,this,t);this.app.setting.close(),this.openModals.push(r),r.open()}removeCommand(t){if((0,Ze.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,n=r.commands,s=`system3-relay:${t}`;(n.commands.hasOwnProperty(s)||r.hotkeyManager.removeDefaultHotkeys(s))&&(delete n.commands[s],delete n.editorCommands[s])}}onunload(){var t,r,n,s,a,i,l,c,f,u,d,m,p,x;(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(os),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(n=this._liveViews)==null||n.destroy(),this._liveViews=null,(s=this.relayManager)==null||s.destroy(),this.relayManager=null,(a=this.tokenStore)==null||a.stop(),(i=this.tokenStore)==null||i.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(c=this.networkStatus)==null||c.stop(),(f=this.networkStatus)==null||f.destroy(),this.networkStatus=null,this.openModals.forEach(y=>{y.close()}),this.openModals.length=0,(u=this.sharedFolders)==null||u.destroy(),this.sharedFolders=null,(d=this.settingsTab)==null||d.destroy(),this.settingsTab=null,(m=this.loginManager)==null||m.destroy(),this.loginManager=null,(p=this.backgroundSync)==null||p.destroy(),this.backgroundSync=null,this.hashStore.destroy(),this.hashStore=null,(x=this.app)==null||x.workspace.updateOptions(),this.app.reloadRelay=void 0,this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,this.featureSettings.destroy(),this.featureSettings=null,this.releaseSettings.destroy(),this.releaseSettings=null,this.interceptedUrls.length=0,gt.destroy(),ar.destroy(),this.notifier=null,this.toast=null,Mh(),ef()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-up-down.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-check-big.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-help.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/clock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/download.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/info.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/lock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/message-square-heart.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/pause.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/play.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/refresh-cw.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/triangle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/upload.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */