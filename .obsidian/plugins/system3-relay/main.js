/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var X0=Object.create;var $a=Object.defineProperty;var Z0=Object.getOwnPropertyDescriptor;var ek=Object.getOwnPropertyNames;var tk=Object.getPrototypeOf,rk=Object.prototype.hasOwnProperty;var ok=(o,e,t)=>e in o?$a(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Qi=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),If=(o,e)=>{for(var t in e)$a(o,t,{get:e[t],enumerable:!0})},Ah=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ek(e))!rk.call(o,s)&&s!==t&&$a(o,s,{get:()=>e[s],enumerable:!(r=Z0(e,s))||r.enumerable});return o};var qs=(o,e,t)=>(t=o!=null?X0(tk(o)):{},Ah(e||!o||!o.__esModule?$a(t,"default",{value:o,enumerable:!0}):t,o)),sk=o=>Ah($a({},"__esModule",{value:!0}),o);var bt=(o,e,t)=>(ok(o,typeof e!="symbol"?e+"":e,t),t);var Ba=Qi((WE,Eh)=>{"use strict";function io(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function Mh(o,e){for(var t="",r=0,s=-1,n=0,a,i=0;i<=o.length;++i){if(i<o.length)a=o.charCodeAt(i);else{if(a===47)break;a=47}if(a===47){if(!(s===i-1||n===1))if(s!==i-1&&n===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),s=i,n=0;continue}}else if(t.length===2||t.length===1){t="",r=0,s=i,n=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(s+1,i):t=o.slice(s+1,i),r=i-s-1;s=i,n=0}else a===46&&n!==-1?++n:n=-1}return t}function nk(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var In={resolve:function(){for(var e="",t=!1,r,s=arguments.length-1;s>=-1&&!t;s--){var n;s>=0?n=arguments[s]:(r===void 0&&(r=process.cwd()),n=r),io(n),n.length!==0&&(e=n+"/"+e,t=n.charCodeAt(0)===47)}return e=Mh(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(io(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=Mh(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return io(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];io(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":In.normalize(e)},relative:function(e,t){if(io(e),io(t),e===t||(e=In.resolve(e),t=In.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var s=e.length,n=s-r,a=1;a<t.length&&t.charCodeAt(a)===47;++a);for(var i=t.length,l=i-a,c=n<l?n:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(t.charCodeAt(a+d)===47)return t.slice(a+d+1);if(d===0)return t.slice(a+d)}else n>c&&(e.charCodeAt(r+d)===47?u=d:d===0&&(u=0));break}var m=e.charCodeAt(r+d),g=t.charCodeAt(a+d);if(m!==g)break;m===47&&(u=d)}var h="";for(d=r+u+1;d<=s;++d)(d===s||e.charCodeAt(d)===47)&&(h.length===0?h+="..":h+="/..");return h.length>0?h+t.slice(a+u):(a+=u,t.charCodeAt(a)===47&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(io(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,s=-1,n=!0,a=e.length-1;a>=1;--a)if(t=e.charCodeAt(a),t===47){if(!n){s=a;break}}else n=!1;return s===-1?r?"/":".":r&&s===1?"//":e.slice(0,s)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');io(e);var r=0,s=-1,n=!0,a;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var i=t.length-1,l=-1;for(a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(c===47){if(!n){r=a+1;break}}else l===-1&&(n=!1,l=a+1),i>=0&&(c===t.charCodeAt(i)?--i===-1&&(s=a):(i=-1,s=l))}return r===s?s=l:s===-1&&(s=e.length),e.slice(r,s)}else{for(a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===47){if(!n){r=a+1;break}}else s===-1&&(n=!1,s=a+1);return s===-1?"":e.slice(r,s)}},extname:function(e){io(e);for(var t=-1,r=0,s=-1,n=!0,a=0,i=e.length-1;i>=0;--i){var l=e.charCodeAt(i);if(l===47){if(!n){r=i+1;break}continue}s===-1&&(n=!1,s=i+1),l===46?t===-1?t=i:a!==1&&(a=1):t!==-1&&(a=-1)}return t===-1||s===-1||a===0||a===1&&t===s-1&&t===r+1?"":e.slice(t,s)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return nk("/",e)},parse:function(e){io(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),s=r===47,n;s?(t.root="/",n=1):n=0;for(var a=-1,i=0,l=-1,c=!0,u=e.length-1,d=0;u>=n;--u){if(r=e.charCodeAt(u),r===47){if(!c){i=u+1;break}continue}l===-1&&(c=!1,l=u+1),r===46?a===-1?a=u:d!==1&&(d=1):a!==-1&&(d=-1)}return a===-1||l===-1||d===0||d===1&&a===l-1&&a===i+1?l!==-1&&(i===0&&s?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(i,l)):(i===0&&s?(t.name=e.slice(1,a),t.base=e.slice(1,l)):(t.name=e.slice(i,a),t.base=e.slice(i,l)),t.ext=e.slice(a,l)),i>0?t.dir=e.slice(0,i-1):s&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};In.posix=In;Eh.exports=In});var px=Qi((yO,dx)=>{var lx=require("url").parse,HL=require("events"),VL=require("https"),qL=require("http"),WL=require("util"),zL=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],ux=[239,187,191],KL=58,GL=32,cx=10,jL=13,fx=1024*256,YL=/^(cookie|authorization)$/i;function JL(o){return ux.every(function(e,t){return o[t]===e})}function _t(o,e){var t=_t.CONNECTING,r=e&&e.headers,s=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var n=this;n.reconnectInterval=1e3,n.connectionInProgress=!1;function a(w){t!==_t.CLOSED&&(t=_t.CONNECTING,h("error",new mi("error",{message:w})),m&&(o=m,m=null,s=!1),setTimeout(function(){t!==_t.CONNECTING||n.connectionInProgress||(n.connectionInProgress=!0,g())},n.reconnectInterval))}var i,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var c=!1,u="",d="",m=null;function g(){var w=lx(o),v=w.protocol==="https:";if(w.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(w.headers["Last-Event-ID"]=l),r){var A=s?XL(r):r;for(var O in A){var M=A[O];M&&(w.headers[O]=M)}}w.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(w.createConnection=e.createConnection);var E=e&&e.proxy;if(E){var R=lx(e.proxy);v=R.protocol==="https:",w.protocol=v?"https:":"http:",w.path=o,w.headers.Host=w.host,w.hostname=R.hostname,w.host=R.host,w.port=R.port}if(e&&e.https){for(var D in e.https)if(zL.indexOf(D)!==-1){var F=e.https[D];F!==void 0&&(w[D]=F)}}e&&e.withCredentials!==void 0&&(w.withCredentials=e.withCredentials),i=(v?VL:qL).request(w,function(V){if(n.connectionInProgress=!1,V.statusCode===500||V.statusCode===502||V.statusCode===503||V.statusCode===504){h("error",new mi("error",{status:V.statusCode,message:V.statusMessage})),a();return}if(V.statusCode===301||V.statusCode===302||V.statusCode===307){var q=V.headers.location;if(!q){h("error",new mi("error",{status:V.statusCode,message:V.statusMessage}));return}var j=new URL(o).origin,z=new URL(q).origin;s=j!==z,V.statusCode===307&&(m=o),o=q,process.nextTick(g);return}if(V.statusCode!==200)return h("error",new mi("error",{status:V.statusCode,message:V.statusMessage})),n.close();t=_t.OPEN,V.on("close",function(){V.removeAllListeners("close"),V.removeAllListeners("end"),a()}),V.on("end",function(){V.removeAllListeners("close"),V.removeAllListeners("end"),a()}),h("open",new mi("open"));var Y,he,Fe=0,G=-1,oe=0,Se=0;V.on("data",function(je){Y?(je.length>Y.length-Se&&(oe=Y.length*2+je.length,oe>fx&&(oe=Y.length+je.length+fx),he=Buffer.alloc(oe),Y.copy(he,0,0,Se),Y=he),je.copy(Y,Se),Se+=je.length):(Y=je,JL(Y)&&(Y=Y.slice(ux.length)),Se=Y.length);for(var Oe=0,ce=Se;Oe<ce;){c&&(Y[Oe]===cx&&++Oe,c=!1);for(var le=-1,W=G,Le,it=Fe;le<0&&it<ce;++it)Le=Y[it],Le===KL?W<0&&(W=it-Oe):Le===jL?(c=!0,le=it-Oe):Le===cx&&(le=it-Oe);if(le<0){Fe=ce-Oe,G=W;break}else Fe=0,G=-1;_(Y,Oe,W,le),Oe+=le+1}Oe===ce?(Y=void 0,Se=0):Oe>0&&(Y=Y.slice(Oe,Se),Se=Y.length)})}),i.on("error",function(V){n.connectionInProgress=!1,a(V.message)}),i.setNoDelay&&i.setNoDelay(!0),i.end()}g();function h(){n.listeners(arguments[0]).length>0&&n.emit.apply(n,arguments)}this._close=function(){t!==_t.CLOSED&&(t=_t.CLOSED,i.abort&&i.abort(),i.xhr&&i.xhr.abort&&i.xhr.abort())};function _(w,v,A,O){if(O===0){if(u.length>0){var M=d||"message";h(M,new QL(M,{data:u.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),u=""}d=void 0}else if(A>0){var E=A<0,R=0,D=w.slice(v,v+(E?O:A)).toString();E?R=O:w[v+A+1]!==GL?R=A+1:R=A+2,v+=R;var F=O-R,V=w.slice(v,v+F).toString();if(D==="data")u+=V+`
`;else if(D==="event")d=V;else if(D==="id")l=V;else if(D==="retry"){var q=parseInt(V,10);Number.isNaN(q)||(n.reconnectInterval=q)}}}}dx.exports=_t;WL.inherits(_t,HL.EventEmitter);_t.prototype.constructor=_t;["open","error","message"].forEach(function(o){Object.defineProperty(_t.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(_t,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(_t,"OPEN",{enumerable:!0,value:1});Object.defineProperty(_t,"CLOSED",{enumerable:!0,value:2});_t.prototype.CONNECTING=0;_t.prototype.OPEN=1;_t.prototype.CLOSED=2;_t.prototype.close=function(){this._close()};_t.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};_t.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};_t.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function mi(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function QL(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function XL(o){var e={};for(var t in o)YL.test(t)||(e[t]=o[t]);return e}});var tp=Qi((f6,pa)=>{var ae=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},at=-1,dt=1,He=0;ae.Diff=function(o,e){return[o,e]};ae.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var s=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new ae.Diff(He,o)]:[];typeof t=="undefined"&&(t=!0);var n=t,a=this.diff_commonPrefix(o,e),i=o.substring(0,a);o=o.substring(a),e=e.substring(a),a=this.diff_commonSuffix(o,e);var l=o.substring(o.length-a);o=o.substring(0,o.length-a),e=e.substring(0,e.length-a);var c=this.diff_compute_(o,e,n,s);return i&&c.unshift(new ae.Diff(He,i)),l&&c.push(new ae.Diff(He,l)),this.diff_cleanupMerge(c),c};ae.prototype.diff_compute_=function(o,e,t,r){var s;if(!o)return[new ae.Diff(dt,e)];if(!e)return[new ae.Diff(at,o)];var n=o.length>e.length?o:e,a=o.length>e.length?e:o,i=n.indexOf(a);if(i!=-1)return s=[new ae.Diff(dt,n.substring(0,i)),new ae.Diff(He,a),new ae.Diff(dt,n.substring(i+a.length))],o.length>e.length&&(s[0][0]=s[2][0]=at),s;if(a.length==1)return[new ae.Diff(at,o),new ae.Diff(dt,e)];var l=this.diff_halfMatch_(o,e);if(l){var c=l[0],u=l[1],d=l[2],m=l[3],g=l[4],h=this.diff_main(c,d,t,r),_=this.diff_main(u,m,t,r);return h.concat([new ae.Diff(He,g)],_)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};ae.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var s=r.lineArray,n=this.diff_main(o,e,!1,t);this.diff_charsToLines_(n,s),this.diff_cleanupSemantic(n),n.push(new ae.Diff(He,""));for(var a=0,i=0,l=0,c="",u="";a<n.length;){switch(n[a][0]){case dt:l++,u+=n[a][1];break;case at:i++,c+=n[a][1];break;case He:if(i>=1&&l>=1){n.splice(a-i-l,i+l),a=a-i-l;for(var d=this.diff_main(c,u,!1,t),m=d.length-1;m>=0;m--)n.splice(a,0,d[m]);a=a+d.length}l=0,i=0,c="",u="";break}a++}return n.pop(),n};ae.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,s=e.length,n=Math.ceil((r+s)/2),a=n,i=2*n,l=new Array(i),c=new Array(i),u=0;u<i;u++)l[u]=-1,c[u]=-1;l[a+1]=0,c[a+1]=0;for(var d=r-s,m=d%2!=0,g=0,h=0,_=0,w=0,v=0;v<n&&!(new Date().getTime()>t);v++){for(var A=-v+g;A<=v-h;A+=2){var O=a+A,M;A==-v||A!=v&&l[O-1]<l[O+1]?M=l[O+1]:M=l[O-1]+1;for(var E=M-A;M<r&&E<s&&o.charAt(M)==e.charAt(E);)M++,E++;if(l[O]=M,M>r)h+=2;else if(E>s)g+=2;else if(m){var R=a+d-A;if(R>=0&&R<i&&c[R]!=-1){var D=r-c[R];if(M>=D)return this.diff_bisectSplit_(o,e,M,E,t)}}}for(var F=-v+_;F<=v-w;F+=2){var R=a+F,D;F==-v||F!=v&&c[R-1]<c[R+1]?D=c[R+1]:D=c[R-1]+1;for(var V=D-F;D<r&&V<s&&o.charAt(r-D-1)==e.charAt(s-V-1);)D++,V++;if(c[R]=D,D>r)w+=2;else if(V>s)_+=2;else if(!m){var O=a+d-F;if(O>=0&&O<i&&l[O]!=-1){var M=l[O],E=a+M-O;if(D=r-D,M>=D)return this.diff_bisectSplit_(o,e,M,E,t)}}}}return[new ae.Diff(at,o),new ae.Diff(dt,e)]};ae.prototype.diff_bisectSplit_=function(o,e,t,r,s){var n=o.substring(0,t),a=e.substring(0,r),i=o.substring(t),l=e.substring(r),c=this.diff_main(n,a,!1,s),u=this.diff_main(i,l,!1,s);return c.concat(u)};ae.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function s(l){for(var c="",u=0,d=-1,m=t.length;d<l.length-1;){d=l.indexOf(`
`,u),d==-1&&(d=l.length-1);var g=l.substring(u,d+1);(r.hasOwnProperty?r.hasOwnProperty(g):r[g]!==void 0)?c+=String.fromCharCode(r[g]):(m==n&&(g=l.substring(u),d=l.length),c+=String.fromCharCode(m),r[g]=m,t[m++]=g),u=d+1}return c}var n=4e4,a=s(o);n=65535;var i=s(e);return{chars1:a,chars2:i,lineArray:t}};ae.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],s=[],n=0;n<r.length;n++)s[n]=e[r.charCodeAt(n)];o[t][1]=s.join("")}};ae.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),s=r,n=0;t<s;)o.substring(n,s)==e.substring(n,s)?(t=s,n=t):r=s,s=Math.floor((r-t)/2+t);return s};ae.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),s=r,n=0;t<s;)o.substring(o.length-s,o.length-n)==e.substring(e.length-s,e.length-n)?(t=s,n=t):r=s,s=Math.floor((r-t)/2+t);return s};ae.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var s=Math.min(t,r);if(o==e)return s;for(var n=0,a=1;;){var i=o.substring(s-a),l=e.indexOf(i);if(l==-1)return n;a+=l,(l==0||o.substring(s-a)==e.substring(0,a))&&(n=a,a++)}};ae.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var s=this;function n(h,_,w){for(var v=h.substring(w,w+Math.floor(h.length/4)),A=-1,O="",M,E,R,D;(A=_.indexOf(v,A+1))!=-1;){var F=s.diff_commonPrefix(h.substring(w),_.substring(A)),V=s.diff_commonSuffix(h.substring(0,w),_.substring(0,A));O.length<V+F&&(O=_.substring(A-V,A)+_.substring(A,A+F),M=h.substring(0,w-V),E=h.substring(w+F),R=_.substring(0,A-V),D=_.substring(A+F))}return O.length*2>=h.length?[M,E,R,D,O]:null}var a=n(t,r,Math.ceil(t.length/4)),i=n(t,r,Math.ceil(t.length/2)),l;if(!a&&!i)return null;i?a?l=a[4].length>i[4].length?a:i:l=i:l=a;var c,u,d,m;o.length>e.length?(c=l[0],u=l[1],d=l[2],m=l[3]):(d=l[0],m=l[1],c=l[2],u=l[3]);var g=l[4];return[c,u,d,m,g]};ae.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,s=null,n=0,a=0,i=0,l=0,c=0;n<o.length;)o[n][0]==He?(t[r++]=n,a=l,i=c,l=0,c=0,s=o[n][1]):(o[n][0]==dt?l+=o[n][1].length:c+=o[n][1].length,s&&s.length<=Math.max(a,i)&&s.length<=Math.max(l,c)&&(o.splice(t[r-1],0,new ae.Diff(at,s)),o[t[r-1]+1][0]=dt,r--,r--,n=r>0?t[r-1]:-1,a=0,i=0,l=0,c=0,s=null,e=!0)),n++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),n=1;n<o.length;){if(o[n-1][0]==at&&o[n][0]==dt){var u=o[n-1][1],d=o[n][1],m=this.diff_commonOverlap_(u,d),g=this.diff_commonOverlap_(d,u);m>=g?(m>=u.length/2||m>=d.length/2)&&(o.splice(n,0,new ae.Diff(He,d.substring(0,m))),o[n-1][1]=u.substring(0,u.length-m),o[n+1][1]=d.substring(m),n++):(g>=u.length/2||g>=d.length/2)&&(o.splice(n,0,new ae.Diff(He,u.substring(0,g))),o[n-1][0]=dt,o[n-1][1]=d.substring(0,d.length-g),o[n+1][0]=at,o[n+1][1]=u.substring(g),n++),n++}n++}};ae.prototype.diff_cleanupSemanticLossless=function(o){function e(g,h){if(!g||!h)return 6;var _=g.charAt(g.length-1),w=h.charAt(0),v=_.match(ae.nonAlphaNumericRegex_),A=w.match(ae.nonAlphaNumericRegex_),O=v&&_.match(ae.whitespaceRegex_),M=A&&w.match(ae.whitespaceRegex_),E=O&&_.match(ae.linebreakRegex_),R=M&&w.match(ae.linebreakRegex_),D=E&&g.match(ae.blanklineEndRegex_),F=R&&h.match(ae.blanklineStartRegex_);return D||F?5:E||R?4:v&&!O&&M?3:O||M?2:v||A?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==He&&o[t+1][0]==He){var r=o[t-1][1],s=o[t][1],n=o[t+1][1],a=this.diff_commonSuffix(r,s);if(a){var i=s.substring(s.length-a);r=r.substring(0,r.length-a),s=i+s.substring(0,s.length-a),n=i+n}for(var l=r,c=s,u=n,d=e(r,s)+e(s,n);s.charAt(0)===n.charAt(0);){r+=s.charAt(0),s=s.substring(1)+n.charAt(0),n=n.substring(1);var m=e(r,s)+e(s,n);m>=d&&(d=m,l=r,c=s,u=n)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=c,u?o[t+1][1]=u:(o.splice(t+1,1),t--))}t++}};ae.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;ae.whitespaceRegex_=/\s/;ae.linebreakRegex_=/[\r\n]/;ae.blanklineEndRegex_=/\n\r?\n$/;ae.blanklineStartRegex_=/^\r?\n\r?\n/;ae.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,s=null,n=0,a=!1,i=!1,l=!1,c=!1;n<o.length;)o[n][0]==He?(o[n][1].length<this.Diff_EditCost&&(l||c)?(t[r++]=n,a=l,i=c,s=o[n][1]):(r=0,s=null),l=c=!1):(o[n][0]==at?c=!0:l=!0,s&&(a&&i&&l&&c||s.length<this.Diff_EditCost/2&&a+i+l+c==3)&&(o.splice(t[r-1],0,new ae.Diff(at,s)),o[t[r-1]+1][0]=dt,r--,s=null,a&&i?(l=c=!0,r=0):(r--,n=r>0?t[r-1]:-1,l=c=!1),e=!0)),n++;e&&this.diff_cleanupMerge(o)};ae.prototype.diff_cleanupMerge=function(o){o.push(new ae.Diff(He,""));for(var e=0,t=0,r=0,s="",n="",a;e<o.length;)switch(o[e][0]){case dt:r++,n+=o[e][1],e++;break;case at:t++,s+=o[e][1],e++;break;case He:t+r>1?(t!==0&&r!==0&&(a=this.diff_commonPrefix(n,s),a!==0&&(e-t-r>0&&o[e-t-r-1][0]==He?o[e-t-r-1][1]+=n.substring(0,a):(o.splice(0,0,new ae.Diff(He,n.substring(0,a))),e++),n=n.substring(a),s=s.substring(a)),a=this.diff_commonSuffix(n,s),a!==0&&(o[e][1]=n.substring(n.length-a)+o[e][1],n=n.substring(0,n.length-a),s=s.substring(0,s.length-a))),e-=t+r,o.splice(e,t+r),s.length&&(o.splice(e,0,new ae.Diff(at,s)),e++),n.length&&(o.splice(e,0,new ae.Diff(dt,n)),e++),e++):e!==0&&o[e-1][0]==He?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,s="",n="";break}o[o.length-1][1]===""&&o.pop();var i=!1;for(e=1;e<o.length-1;)o[e-1][0]==He&&o[e+1][0]==He&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),i=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),i=!0)),e++;i&&this.diff_cleanupMerge(o)};ae.prototype.diff_xIndex=function(o,e){var t=0,r=0,s=0,n=0,a;for(a=0;a<o.length&&(o[a][0]!==dt&&(t+=o[a][1].length),o[a][0]!==at&&(r+=o[a][1].length),!(t>e));a++)s=t,n=r;return o.length!=a&&o[a][0]===at?n:n+(e-s)};ae.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,s=/>/g,n=/\n/g,a=0;a<o.length;a++){var i=o[a][0],l=o[a][1],c=l.replace(t,"&amp;").replace(r,"&lt;").replace(s,"&gt;").replace(n,"&para;<br>");switch(i){case dt:e[a]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case at:e[a]='<del style="background:#ffe6e6;">'+c+"</del>";break;case He:e[a]="<span>"+c+"</span>";break}}return e.join("")};ae.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==dt&&(e[t]=o[t][1]);return e.join("")};ae.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==at&&(e[t]=o[t][1]);return e.join("")};ae.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,s=0;s<o.length;s++){var n=o[s][0],a=o[s][1];switch(n){case dt:t+=a.length;break;case at:r+=a.length;break;case He:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};ae.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case dt:e[t]="+"+encodeURI(o[t][1]);break;case at:e[t]="-"+o[t][1].length;break;case He:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};ae.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,s=0,n=e.split(/\t/g),a=0;a<n.length;a++){var i=n[a].substring(1);switch(n[a].charAt(0)){case"+":try{t[r++]=new ae.Diff(dt,decodeURI(i))}catch(u){throw new Error("Illegal escape in diff_fromDelta: "+i)}break;case"-":case"=":var l=parseInt(i,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+i);var c=o.substring(s,s+=l);n[a].charAt(0)=="="?t[r++]=new ae.Diff(He,c):t[r++]=new ae.Diff(at,c);break;default:if(n[a])throw new Error("Invalid diff operation in diff_fromDelta: "+n[a])}}if(s!=o.length)throw new Error("Delta length ("+s+") does not equal source text length ("+o.length+").");return t};ae.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};ae.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),s=this;function n(M,E){var R=M/e.length,D=Math.abs(t-E);return s.Match_Distance?R+D/s.Match_Distance:D?1:R}var a=this.Match_Threshold,i=o.indexOf(e,t);i!=-1&&(a=Math.min(n(0,i),a),i=o.lastIndexOf(e,t+e.length),i!=-1&&(a=Math.min(n(0,i),a)));var l=1<<e.length-1;i=-1;for(var c,u,d=e.length+o.length,m,g=0;g<e.length;g++){for(c=0,u=d;c<u;)n(g,t+u)<=a?c=u:d=u,u=Math.floor((d-c)/2+c);d=u;var h=Math.max(1,t-u+1),_=Math.min(t+u,o.length)+e.length,w=Array(_+2);w[_+1]=(1<<g)-1;for(var v=_;v>=h;v--){var A=r[o.charAt(v-1)];if(g===0?w[v]=(w[v+1]<<1|1)&A:w[v]=(w[v+1]<<1|1)&A|((m[v+1]|m[v])<<1|1)|m[v+1],w[v]&l){var O=n(g,v-1);if(O<=a)if(a=O,i=v-1,i>t)h=Math.max(1,2*t-i);else break}}if(n(g+1,t)>a)break;m=w}return i};ae.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};ae.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var s=e.substring(o.start2-r,o.start2);s&&o.diffs.unshift(new ae.Diff(He,s));var n=e.substring(o.start2+o.length1,o.start2+o.length1+r);n&&o.diffs.push(new ae.Diff(He,n)),o.start1-=s.length,o.start2-=s.length,o.length1+=s.length+n.length,o.length2+=s.length+n.length}};ae.prototype.patch_make=function(o,e,t){var r,s;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,s=this.diff_main(r,e,!0),s.length>2&&(this.diff_cleanupSemantic(s),this.diff_cleanupEfficiency(s));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")s=o,r=this.diff_text1(s);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,s=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,s=t;else throw new Error("Unknown call format to patch_make.");if(s.length===0)return[];for(var n=[],a=new ae.patch_obj,i=0,l=0,c=0,u=r,d=r,m=0;m<s.length;m++){var g=s[m][0],h=s[m][1];switch(!i&&g!==He&&(a.start1=l,a.start2=c),g){case dt:a.diffs[i++]=s[m],a.length2+=h.length,d=d.substring(0,c)+h+d.substring(c);break;case at:a.length1+=h.length,a.diffs[i++]=s[m],d=d.substring(0,c)+d.substring(c+h.length);break;case He:h.length<=2*this.Patch_Margin&&i&&s.length!=m+1?(a.diffs[i++]=s[m],a.length1+=h.length,a.length2+=h.length):h.length>=2*this.Patch_Margin&&i&&(this.patch_addContext_(a,u),n.push(a),a=new ae.patch_obj,i=0,u=d,l=c);break}g!==dt&&(l+=h.length),g!==at&&(c+=h.length)}return i&&(this.patch_addContext_(a,u),n.push(a)),n};ae.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],s=new ae.patch_obj;s.diffs=[];for(var n=0;n<r.diffs.length;n++)s.diffs[n]=new ae.Diff(r.diffs[n][0],r.diffs[n][1]);s.start1=r.start1,s.start2=r.start2,s.length1=r.length1,s.length2=r.length2,e[t]=s}return e};ae.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,s=[],n=0;n<o.length;n++){var a=o[n].start2+r,i=this.diff_text1(o[n].diffs),l,c=-1;if(i.length>this.Match_MaxBits?(l=this.match_main(e,i.substring(0,this.Match_MaxBits),a),l!=-1&&(c=this.match_main(e,i.substring(i.length-this.Match_MaxBits),a+i.length-this.Match_MaxBits),(c==-1||l>=c)&&(l=-1))):l=this.match_main(e,i,a),l==-1)s[n]=!1,r-=o[n].length2-o[n].length1;else{s[n]=!0,r=l-a;var u;if(c==-1?u=e.substring(l,l+i.length):u=e.substring(l,c+this.Match_MaxBits),i==u)e=e.substring(0,l)+this.diff_text2(o[n].diffs)+e.substring(l+i.length);else{var d=this.diff_main(i,u,!1);if(i.length>this.Match_MaxBits&&this.diff_levenshtein(d)/i.length>this.Patch_DeleteThreshold)s[n]=!1;else{this.diff_cleanupSemanticLossless(d);for(var m=0,g,h=0;h<o[n].diffs.length;h++){var _=o[n].diffs[h];_[0]!==He&&(g=this.diff_xIndex(d,m)),_[0]===dt?e=e.substring(0,l+g)+_[1]+e.substring(l+g):_[0]===at&&(e=e.substring(0,l+g)+e.substring(l+this.diff_xIndex(d,m+_[1].length))),_[0]!==at&&(m+=_[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,s]};ae.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var s=o[0],n=s.diffs;if(n.length==0||n[0][0]!=He)n.unshift(new ae.Diff(He,t)),s.start1-=e,s.start2-=e,s.length1+=e,s.length2+=e;else if(e>n[0][1].length){var a=e-n[0][1].length;n[0][1]=t.substring(n[0][1].length)+n[0][1],s.start1-=a,s.start2-=a,s.length1+=a,s.length2+=a}if(s=o[o.length-1],n=s.diffs,n.length==0||n[n.length-1][0]!=He)n.push(new ae.Diff(He,t)),s.length1+=e,s.length2+=e;else if(e>n[n.length-1][1].length){var a=e-n[n.length-1][1].length;n[n.length-1][1]+=t.substring(0,a),s.length1+=a,s.length2+=a}return t};ae.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var s=r.start1,n=r.start2,a="";r.diffs.length!==0;){var i=new ae.patch_obj,l=!0;for(i.start1=s-a.length,i.start2=n-a.length,a!==""&&(i.length1=i.length2=a.length,i.diffs.push(new ae.Diff(He,a)));r.diffs.length!==0&&i.length1<e-this.Patch_Margin;){var c=r.diffs[0][0],u=r.diffs[0][1];c===dt?(i.length2+=u.length,n+=u.length,i.diffs.push(r.diffs.shift()),l=!1):c===at&&i.diffs.length==1&&i.diffs[0][0]==He&&u.length>2*e?(i.length1+=u.length,s+=u.length,l=!1,i.diffs.push(new ae.Diff(c,u)),r.diffs.shift()):(u=u.substring(0,e-i.length1-this.Patch_Margin),i.length1+=u.length,s+=u.length,c===He?(i.length2+=u.length,n+=u.length):l=!1,i.diffs.push(new ae.Diff(c,u)),u==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(u.length))}a=this.diff_text2(i.diffs),a=a.substring(a.length-this.Patch_Margin);var d=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);d!==""&&(i.length1+=d.length,i.length2+=d.length,i.diffs.length!==0&&i.diffs[i.diffs.length-1][0]===He?i.diffs[i.diffs.length-1][1]+=d:i.diffs.push(new ae.Diff(He,d))),l||o.splice(++t,0,i)}}};ae.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};ae.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,s=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var n=t[r].match(s);if(!n)throw new Error("Invalid patch string: "+t[r]);var a=new ae.patch_obj;for(e.push(a),a.start1=parseInt(n[1],10),n[2]===""?(a.start1--,a.length1=1):n[2]=="0"?a.length1=0:(a.start1--,a.length1=parseInt(n[2],10)),a.start2=parseInt(n[3],10),n[4]===""?(a.start2--,a.length2=1):n[4]=="0"?a.length2=0:(a.start2--,a.length2=parseInt(n[4],10)),r++;r<t.length;){var i=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(c){throw new Error("Illegal escape in patch_fromText: "+l)}if(i=="-")a.diffs.push(new ae.Diff(at,l));else if(i=="+")a.diffs.push(new ae.Diff(dt,l));else if(i==" ")a.diffs.push(new ae.Diff(He,l));else{if(i=="@")break;if(i!=="")throw new Error('Invalid patch mode "'+i+'" in: '+l)}r++}}return e};ae.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};ae.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,s=0;s<this.diffs.length;s++){switch(this.diffs[s][0]){case dt:r="+";break;case at:r="-";break;case He:r=" ";break}t[s+1]=r+encodeURI(this.diffs[s][1])+`
`}return t.join("").replace(/%20/g," ")};pa.exports=ae;pa.exports.diff_match_patch=ae;pa.exports.DIFF_DELETE=at;pa.exports.DIFF_INSERT=dt;pa.exports.DIFF_EQUAL=He});var Jb=Qi((fm,va)=>{(function(o,e){typeof fm=="object"&&typeof va!="undefined"?va.exports=e():typeof define=="function"&&define.amd?define(e):o.moment=e()})(fm,function(){"use strict";var o;function e(){return o.apply(null,arguments)}function t(f){o=f}function r(f){return f instanceof Array||Object.prototype.toString.call(f)==="[object Array]"}function s(f){return f!=null&&Object.prototype.toString.call(f)==="[object Object]"}function n(f,p){return Object.prototype.hasOwnProperty.call(f,p)}function a(f){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(f).length===0;var p;for(p in f)if(n(f,p))return!1;return!0}function i(f){return f===void 0}function l(f){return typeof f=="number"||Object.prototype.toString.call(f)==="[object Number]"}function c(f){return f instanceof Date||Object.prototype.toString.call(f)==="[object Date]"}function u(f,p){var y=[],b,L=f.length;for(b=0;b<L;++b)y.push(p(f[b],b));return y}function d(f,p){for(var y in p)n(p,y)&&(f[y]=p[y]);return n(p,"toString")&&(f.toString=p.toString),n(p,"valueOf")&&(f.valueOf=p.valueOf),f}function m(f,p,y,b){return fh(f,p,y,b,!0).utc()}function g(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function h(f){return f._pf==null&&(f._pf=g()),f._pf}var _;Array.prototype.some?_=Array.prototype.some:_=function(f){var p=Object(this),y=p.length>>>0,b;for(b=0;b<y;b++)if(b in p&&f.call(this,p[b],b,p))return!0;return!1};function w(f){if(f._isValid==null){var p=h(f),y=_.call(p.parsedDateParts,function(L){return L!=null}),b=!isNaN(f._d.getTime())&&p.overflow<0&&!p.empty&&!p.invalidEra&&!p.invalidMonth&&!p.invalidWeekday&&!p.weekdayMismatch&&!p.nullInput&&!p.invalidFormat&&!p.userInvalidated&&(!p.meridiem||p.meridiem&&y);if(f._strict&&(b=b&&p.charsLeftOver===0&&p.unusedTokens.length===0&&p.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(f))f._isValid=b;else return b}return f._isValid}function v(f){var p=m(NaN);return f!=null?d(h(p),f):h(p).userInvalidated=!0,p}var A=e.momentProperties=[],O=!1;function M(f,p){var y,b,L,$=A.length;if(i(p._isAMomentObject)||(f._isAMomentObject=p._isAMomentObject),i(p._i)||(f._i=p._i),i(p._f)||(f._f=p._f),i(p._l)||(f._l=p._l),i(p._strict)||(f._strict=p._strict),i(p._tzm)||(f._tzm=p._tzm),i(p._isUTC)||(f._isUTC=p._isUTC),i(p._offset)||(f._offset=p._offset),i(p._pf)||(f._pf=h(p)),i(p._locale)||(f._locale=p._locale),$>0)for(y=0;y<$;y++)b=A[y],L=p[b],i(L)||(f[b]=L);return f}function E(f){M(this,f),this._d=new Date(f._d!=null?f._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),O===!1&&(O=!0,e.updateOffset(this),O=!1)}function R(f){return f instanceof E||f!=null&&f._isAMomentObject!=null}function D(f){e.suppressDeprecationWarnings===!1&&typeof console!="undefined"&&console.warn&&console.warn("Deprecation warning: "+f)}function F(f,p){var y=!0;return d(function(){if(e.deprecationHandler!=null&&e.deprecationHandler(null,f),y){var b=[],L,$,Q,Te=arguments.length;for($=0;$<Te;$++){if(L="",typeof arguments[$]=="object"){L+=`
[`+$+"] ";for(Q in arguments[0])n(arguments[0],Q)&&(L+=Q+": "+arguments[0][Q]+", ");L=L.slice(0,-2)}else L=arguments[$];b.push(L)}D(f+`
Arguments: `+Array.prototype.slice.call(b).join("")+`
`+new Error().stack),y=!1}return p.apply(this,arguments)},p)}var V={};function q(f,p){e.deprecationHandler!=null&&e.deprecationHandler(f,p),V[f]||(D(p),V[f]=!0)}e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;function j(f){return typeof Function!="undefined"&&f instanceof Function||Object.prototype.toString.call(f)==="[object Function]"}function z(f){var p,y;for(y in f)n(f,y)&&(p=f[y],j(p)?this[y]=p:this["_"+y]=p);this._config=f,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function Y(f,p){var y=d({},f),b;for(b in p)n(p,b)&&(s(f[b])&&s(p[b])?(y[b]={},d(y[b],f[b]),d(y[b],p[b])):p[b]!=null?y[b]=p[b]:delete y[b]);for(b in f)n(f,b)&&!n(p,b)&&s(f[b])&&(y[b]=d({},y[b]));return y}function he(f){f!=null&&this.set(f)}var Fe;Object.keys?Fe=Object.keys:Fe=function(f){var p,y=[];for(p in f)n(f,p)&&y.push(p);return y};var G={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function oe(f,p,y){var b=this._calendar[f]||this._calendar.sameElse;return j(b)?b.call(p,y):b}function Se(f,p,y){var b=""+Math.abs(f),L=p-b.length,$=f>=0;return($?y?"+":"":"-")+Math.pow(10,Math.max(0,L)).toString().substr(1)+b}var je=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Oe=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,ce={},le={};function W(f,p,y,b){var L=b;typeof b=="string"&&(L=function(){return this[b]()}),f&&(le[f]=L),p&&(le[p[0]]=function(){return Se(L.apply(this,arguments),p[1],p[2])}),y&&(le[y]=function(){return this.localeData().ordinal(L.apply(this,arguments),f)})}function Le(f){return f.match(/\[[\s\S]/)?f.replace(/^\[|\]$/g,""):f.replace(/\\/g,"")}function it(f){var p=f.match(je),y,b;for(y=0,b=p.length;y<b;y++)le[p[y]]?p[y]=le[p[y]]:p[y]=Le(p[y]);return function(L){var $="",Q;for(Q=0;Q<b;Q++)$+=j(p[Q])?p[Q].call(L,f):p[Q];return $}}function pt(f,p){return f.isValid()?(p=gt(p,f.localeData()),ce[p]=ce[p]||it(p),ce[p](f)):f.localeData().invalidDate()}function gt(f,p){var y=5;function b(L){return p.longDateFormat(L)||L}for(Oe.lastIndex=0;y>=0&&Oe.test(f);)f=f.replace(Oe,b),Oe.lastIndex=0,y-=1;return f}var lt={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function St(f){var p=this._longDateFormat[f],y=this._longDateFormat[f.toUpperCase()];return p||!y?p:(this._longDateFormat[f]=y.match(je).map(function(b){return b==="MMMM"||b==="MM"||b==="DD"||b==="dddd"?b.slice(1):b}).join(""),this._longDateFormat[f])}var rt="Invalid date";function Zt(){return this._invalidDate}var Rs="%d",gn=/\d{1,2}/;function ns(f){return this._ordinal.replace("%d",f)}var ka={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function Os(f,p,y,b){var L=this._relativeTime[y];return j(L)?L(f,p,y,b):L.replace(/%d/i,f)}function Ca(f,p){var y=this._relativeTime[f>0?"future":"past"];return j(y)?y(p):y.replace(/%s/i,p)}var Dr={};function ct(f,p){var y=f.toLowerCase();Dr[y]=Dr[y+"s"]=Dr[p]=f}function Vt(f){return typeof f=="string"?Dr[f]||Dr[f.toLowerCase()]:void 0}function as(f){var p={},y,b;for(b in f)n(f,b)&&(y=Vt(b),y&&(p[y]=f[b]));return p}var Us={};function kt(f,p){Us[f]=p}function Ia(f){var p=[],y;for(y in f)n(f,y)&&p.push({unit:y,priority:Us[y]});return p.sort(function(b,L){return b.priority-L.priority}),p}function is(f){return f%4===0&&f%100!==0||f%400===0}function Jt(f){return f<0?Math.ceil(f)||0:Math.floor(f)}function $e(f){var p=+f,y=0;return p!==0&&isFinite(p)&&(y=Jt(p)),y}function no(f,p){return function(y){return y!=null?(yn(this,f,y),e.updateOffset(this,p),this):ls(this,f)}}function ls(f,p){return f.isValid()?f._d["get"+(f._isUTC?"UTC":"")+p]():NaN}function yn(f,p,y){f.isValid()&&!isNaN(y)&&(p==="FullYear"&&is(f.year())&&f.month()===1&&f.date()===29?(y=$e(y),f._d["set"+(f._isUTC?"UTC":"")+p](y,f.month(),Bi(y,f.month()))):f._d["set"+(f._isUTC?"UTC":"")+p](y))}function La(f){return f=Vt(f),j(this[f])?this[f]():this}function Ta(f,p){if(typeof f=="object"){f=as(f);var y=Ia(f),b,L=y.length;for(b=0;b<L;b++)this[y[b].unit](f[y[b].unit])}else if(f=Vt(f),j(this[f]))return this[f](p);return this}var xn=/\d/,qt=/\d\d/,bn=/\d{3}/,$s=/\d{4}/,X=/[+-]?\d{6}/,ue=/\d\d?/,ot=/\d\d\d\d?/,Vr=/\d\d\d\d\d\d?/,Qt=/\d{1,3}/,se=/\d{1,4}/,Me=/[+-]?\d{1,6}/,st=/\d+/,Rt=/[+-]?\d+/,Bs=/Z|[+-]\d\d:?\d\d/gi,vn=/Z|[+-]\d\d(?::?\d\d)?/gi,Pa=/[+-]?\d+(\.\d{1,3})?/,Da=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,$i;$i={};function we(f,p,y){$i[f]=j(p)?p:function(b,L){return b&&y?y:p}}function v_(f,p){return n($i,f)?$i[f](p._strict,p._locale):new RegExp(w_(f))}function w_(f){return br(f.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(p,y,b,L,$){return y||b||L||$}))}function br(f){return f.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var lf={};function et(f,p){var y,b=p,L;for(typeof f=="string"&&(f=[f]),l(p)&&(b=function($,Q){Q[p]=$e($)}),L=f.length,y=0;y<L;y++)lf[f[y]]=b}function Fa(f,p){et(f,function(y,b,L,$){L._w=L._w||{},p(y,L._w,L,$)})}function __(f,p,y){p!=null&&n(lf,f)&&lf[f](p,y._a,y,f)}var Xt=0,Io=1,ao=2,At=3,qr=4,Lo=5,Ns=6,S_=7,k_=8;function C_(f,p){return(f%p+p)%p}var Ct;Array.prototype.indexOf?Ct=Array.prototype.indexOf:Ct=function(f){var p;for(p=0;p<this.length;++p)if(this[p]===f)return p;return-1};function Bi(f,p){if(isNaN(f)||isNaN(p))return NaN;var y=C_(p,12);return f+=(p-y)/12,y===1?is(f)?29:28:31-y%7%2}W("M",["MM",2],"Mo",function(){return this.month()+1}),W("MMM",0,0,function(f){return this.localeData().monthsShort(this,f)}),W("MMMM",0,0,function(f){return this.localeData().months(this,f)}),ct("month","M"),kt("month",8),we("M",ue),we("MM",ue,qt),we("MMM",function(f,p){return p.monthsShortRegex(f)}),we("MMMM",function(f,p){return p.monthsRegex(f)}),et(["M","MM"],function(f,p){p[Io]=$e(f)-1}),et(["MMM","MMMM"],function(f,p,y,b){var L=y._locale.monthsParse(f,b,y._strict);L!=null?p[Io]=L:h(y).invalidMonth=f});var I_="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Ym="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Jm=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,L_=Da,T_=Da;function P_(f,p){return f?r(this._months)?this._months[f.month()]:this._months[(this._months.isFormat||Jm).test(p)?"format":"standalone"][f.month()]:r(this._months)?this._months:this._months.standalone}function D_(f,p){return f?r(this._monthsShort)?this._monthsShort[f.month()]:this._monthsShort[Jm.test(p)?"format":"standalone"][f.month()]:r(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function F_(f,p,y){var b,L,$,Q=f.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],b=0;b<12;++b)$=m([2e3,b]),this._shortMonthsParse[b]=this.monthsShort($,"").toLocaleLowerCase(),this._longMonthsParse[b]=this.months($,"").toLocaleLowerCase();return y?p==="MMM"?(L=Ct.call(this._shortMonthsParse,Q),L!==-1?L:null):(L=Ct.call(this._longMonthsParse,Q),L!==-1?L:null):p==="MMM"?(L=Ct.call(this._shortMonthsParse,Q),L!==-1?L:(L=Ct.call(this._longMonthsParse,Q),L!==-1?L:null)):(L=Ct.call(this._longMonthsParse,Q),L!==-1?L:(L=Ct.call(this._shortMonthsParse,Q),L!==-1?L:null))}function A_(f,p,y){var b,L,$;if(this._monthsParseExact)return F_.call(this,f,p,y);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),b=0;b<12;b++){if(L=m([2e3,b]),y&&!this._longMonthsParse[b]&&(this._longMonthsParse[b]=new RegExp("^"+this.months(L,"").replace(".","")+"$","i"),this._shortMonthsParse[b]=new RegExp("^"+this.monthsShort(L,"").replace(".","")+"$","i")),!y&&!this._monthsParse[b]&&($="^"+this.months(L,"")+"|^"+this.monthsShort(L,""),this._monthsParse[b]=new RegExp($.replace(".",""),"i")),y&&p==="MMMM"&&this._longMonthsParse[b].test(f))return b;if(y&&p==="MMM"&&this._shortMonthsParse[b].test(f))return b;if(!y&&this._monthsParse[b].test(f))return b}}function Qm(f,p){var y;if(!f.isValid())return f;if(typeof p=="string"){if(/^\d+$/.test(p))p=$e(p);else if(p=f.localeData().monthsParse(p),!l(p))return f}return y=Math.min(f.date(),Bi(f.year(),p)),f._d["set"+(f._isUTC?"UTC":"")+"Month"](p,y),f}function Xm(f){return f!=null?(Qm(this,f),e.updateOffset(this,!0),this):ls(this,"Month")}function M_(){return Bi(this.year(),this.month())}function E_(f){return this._monthsParseExact?(n(this,"_monthsRegex")||Zm.call(this),f?this._monthsShortStrictRegex:this._monthsShortRegex):(n(this,"_monthsShortRegex")||(this._monthsShortRegex=L_),this._monthsShortStrictRegex&&f?this._monthsShortStrictRegex:this._monthsShortRegex)}function R_(f){return this._monthsParseExact?(n(this,"_monthsRegex")||Zm.call(this),f?this._monthsStrictRegex:this._monthsRegex):(n(this,"_monthsRegex")||(this._monthsRegex=T_),this._monthsStrictRegex&&f?this._monthsStrictRegex:this._monthsRegex)}function Zm(){function f(Q,Te){return Te.length-Q.length}var p=[],y=[],b=[],L,$;for(L=0;L<12;L++)$=m([2e3,L]),p.push(this.monthsShort($,"")),y.push(this.months($,"")),b.push(this.months($,"")),b.push(this.monthsShort($,""));for(p.sort(f),y.sort(f),b.sort(f),L=0;L<12;L++)p[L]=br(p[L]),y[L]=br(y[L]);for(L=0;L<24;L++)b[L]=br(b[L]);this._monthsRegex=new RegExp("^("+b.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+y.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+p.join("|")+")","i")}W("Y",0,0,function(){var f=this.year();return f<=9999?Se(f,4):"+"+f}),W(0,["YY",2],0,function(){return this.year()%100}),W(0,["YYYY",4],0,"year"),W(0,["YYYYY",5],0,"year"),W(0,["YYYYYY",6,!0],0,"year"),ct("year","y"),kt("year",1),we("Y",Rt),we("YY",ue,qt),we("YYYY",se,$s),we("YYYYY",Me,X),we("YYYYYY",Me,X),et(["YYYYY","YYYYYY"],Xt),et("YYYY",function(f,p){p[Xt]=f.length===2?e.parseTwoDigitYear(f):$e(f)}),et("YY",function(f,p){p[Xt]=e.parseTwoDigitYear(f)}),et("Y",function(f,p){p[Xt]=parseInt(f,10)});function Aa(f){return is(f)?366:365}e.parseTwoDigitYear=function(f){return $e(f)+($e(f)>68?1900:2e3)};var eh=no("FullYear",!0);function O_(){return is(this.year())}function U_(f,p,y,b,L,$,Q){var Te;return f<100&&f>=0?(Te=new Date(f+400,p,y,b,L,$,Q),isFinite(Te.getFullYear())&&Te.setFullYear(f)):Te=new Date(f,p,y,b,L,$,Q),Te}function Ma(f){var p,y;return f<100&&f>=0?(y=Array.prototype.slice.call(arguments),y[0]=f+400,p=new Date(Date.UTC.apply(null,y)),isFinite(p.getUTCFullYear())&&p.setUTCFullYear(f)):p=new Date(Date.UTC.apply(null,arguments)),p}function Ni(f,p,y){var b=7+p-y,L=(7+Ma(f,0,b).getUTCDay()-p)%7;return-L+b-1}function th(f,p,y,b,L){var $=(7+y-b)%7,Q=Ni(f,b,L),Te=1+7*(p-1)+$+Q,Ve,tt;return Te<=0?(Ve=f-1,tt=Aa(Ve)+Te):Te>Aa(f)?(Ve=f+1,tt=Te-Aa(f)):(Ve=f,tt=Te),{year:Ve,dayOfYear:tt}}function Ea(f,p,y){var b=Ni(f.year(),p,y),L=Math.floor((f.dayOfYear()-b-1)/7)+1,$,Q;return L<1?(Q=f.year()-1,$=L+To(Q,p,y)):L>To(f.year(),p,y)?($=L-To(f.year(),p,y),Q=f.year()+1):(Q=f.year(),$=L),{week:$,year:Q}}function To(f,p,y){var b=Ni(f,p,y),L=Ni(f+1,p,y);return(Aa(f)-b+L)/7}W("w",["ww",2],"wo","week"),W("W",["WW",2],"Wo","isoWeek"),ct("week","w"),ct("isoWeek","W"),kt("week",5),kt("isoWeek",5),we("w",ue),we("ww",ue,qt),we("W",ue),we("WW",ue,qt),Fa(["w","ww","W","WW"],function(f,p,y,b){p[b.substr(0,1)]=$e(f)});function $_(f){return Ea(f,this._week.dow,this._week.doy).week}var B_={dow:0,doy:6};function N_(){return this._week.dow}function H_(){return this._week.doy}function V_(f){var p=this.localeData().week(this);return f==null?p:this.add((f-p)*7,"d")}function q_(f){var p=Ea(this,1,4).week;return f==null?p:this.add((f-p)*7,"d")}W("d",0,"do","day"),W("dd",0,0,function(f){return this.localeData().weekdaysMin(this,f)}),W("ddd",0,0,function(f){return this.localeData().weekdaysShort(this,f)}),W("dddd",0,0,function(f){return this.localeData().weekdays(this,f)}),W("e",0,0,"weekday"),W("E",0,0,"isoWeekday"),ct("day","d"),ct("weekday","e"),ct("isoWeekday","E"),kt("day",11),kt("weekday",11),kt("isoWeekday",11),we("d",ue),we("e",ue),we("E",ue),we("dd",function(f,p){return p.weekdaysMinRegex(f)}),we("ddd",function(f,p){return p.weekdaysShortRegex(f)}),we("dddd",function(f,p){return p.weekdaysRegex(f)}),Fa(["dd","ddd","dddd"],function(f,p,y,b){var L=y._locale.weekdaysParse(f,b,y._strict);L!=null?p.d=L:h(y).invalidWeekday=f}),Fa(["d","e","E"],function(f,p,y,b){p[b]=$e(f)});function W_(f,p){return typeof f!="string"?f:isNaN(f)?(f=p.weekdaysParse(f),typeof f=="number"?f:null):parseInt(f,10)}function z_(f,p){return typeof f=="string"?p.weekdaysParse(f)%7||7:isNaN(f)?null:f}function cf(f,p){return f.slice(p,7).concat(f.slice(0,p))}var K_="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),rh="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),G_="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),j_=Da,Y_=Da,J_=Da;function Q_(f,p){var y=r(this._weekdays)?this._weekdays:this._weekdays[f&&f!==!0&&this._weekdays.isFormat.test(p)?"format":"standalone"];return f===!0?cf(y,this._week.dow):f?y[f.day()]:y}function X_(f){return f===!0?cf(this._weekdaysShort,this._week.dow):f?this._weekdaysShort[f.day()]:this._weekdaysShort}function Z_(f){return f===!0?cf(this._weekdaysMin,this._week.dow):f?this._weekdaysMin[f.day()]:this._weekdaysMin}function eS(f,p,y){var b,L,$,Q=f.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],b=0;b<7;++b)$=m([2e3,1]).day(b),this._minWeekdaysParse[b]=this.weekdaysMin($,"").toLocaleLowerCase(),this._shortWeekdaysParse[b]=this.weekdaysShort($,"").toLocaleLowerCase(),this._weekdaysParse[b]=this.weekdays($,"").toLocaleLowerCase();return y?p==="dddd"?(L=Ct.call(this._weekdaysParse,Q),L!==-1?L:null):p==="ddd"?(L=Ct.call(this._shortWeekdaysParse,Q),L!==-1?L:null):(L=Ct.call(this._minWeekdaysParse,Q),L!==-1?L:null):p==="dddd"?(L=Ct.call(this._weekdaysParse,Q),L!==-1||(L=Ct.call(this._shortWeekdaysParse,Q),L!==-1)?L:(L=Ct.call(this._minWeekdaysParse,Q),L!==-1?L:null)):p==="ddd"?(L=Ct.call(this._shortWeekdaysParse,Q),L!==-1||(L=Ct.call(this._weekdaysParse,Q),L!==-1)?L:(L=Ct.call(this._minWeekdaysParse,Q),L!==-1?L:null)):(L=Ct.call(this._minWeekdaysParse,Q),L!==-1||(L=Ct.call(this._weekdaysParse,Q),L!==-1)?L:(L=Ct.call(this._shortWeekdaysParse,Q),L!==-1?L:null))}function tS(f,p,y){var b,L,$;if(this._weekdaysParseExact)return eS.call(this,f,p,y);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),b=0;b<7;b++){if(L=m([2e3,1]).day(b),y&&!this._fullWeekdaysParse[b]&&(this._fullWeekdaysParse[b]=new RegExp("^"+this.weekdays(L,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[b]=new RegExp("^"+this.weekdaysShort(L,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[b]=new RegExp("^"+this.weekdaysMin(L,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[b]||($="^"+this.weekdays(L,"")+"|^"+this.weekdaysShort(L,"")+"|^"+this.weekdaysMin(L,""),this._weekdaysParse[b]=new RegExp($.replace(".",""),"i")),y&&p==="dddd"&&this._fullWeekdaysParse[b].test(f))return b;if(y&&p==="ddd"&&this._shortWeekdaysParse[b].test(f))return b;if(y&&p==="dd"&&this._minWeekdaysParse[b].test(f))return b;if(!y&&this._weekdaysParse[b].test(f))return b}}function rS(f){if(!this.isValid())return f!=null?this:NaN;var p=this._isUTC?this._d.getUTCDay():this._d.getDay();return f!=null?(f=W_(f,this.localeData()),this.add(f-p,"d")):p}function oS(f){if(!this.isValid())return f!=null?this:NaN;var p=(this.day()+7-this.localeData()._week.dow)%7;return f==null?p:this.add(f-p,"d")}function sS(f){if(!this.isValid())return f!=null?this:NaN;if(f!=null){var p=z_(f,this.localeData());return this.day(this.day()%7?p:p-7)}else return this.day()||7}function nS(f){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||ff.call(this),f?this._weekdaysStrictRegex:this._weekdaysRegex):(n(this,"_weekdaysRegex")||(this._weekdaysRegex=j_),this._weekdaysStrictRegex&&f?this._weekdaysStrictRegex:this._weekdaysRegex)}function aS(f){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||ff.call(this),f?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(n(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Y_),this._weekdaysShortStrictRegex&&f?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function iS(f){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||ff.call(this),f?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(n(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=J_),this._weekdaysMinStrictRegex&&f?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function ff(){function f(er,Mo){return Mo.length-er.length}var p=[],y=[],b=[],L=[],$,Q,Te,Ve,tt;for($=0;$<7;$++)Q=m([2e3,1]).day($),Te=br(this.weekdaysMin(Q,"")),Ve=br(this.weekdaysShort(Q,"")),tt=br(this.weekdays(Q,"")),p.push(Te),y.push(Ve),b.push(tt),L.push(Te),L.push(Ve),L.push(tt);p.sort(f),y.sort(f),b.sort(f),L.sort(f),this._weekdaysRegex=new RegExp("^("+L.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+b.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+y.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+p.join("|")+")","i")}function uf(){return this.hours()%12||12}function lS(){return this.hours()||24}W("H",["HH",2],0,"hour"),W("h",["hh",2],0,uf),W("k",["kk",2],0,lS),W("hmm",0,0,function(){return""+uf.apply(this)+Se(this.minutes(),2)}),W("hmmss",0,0,function(){return""+uf.apply(this)+Se(this.minutes(),2)+Se(this.seconds(),2)}),W("Hmm",0,0,function(){return""+this.hours()+Se(this.minutes(),2)}),W("Hmmss",0,0,function(){return""+this.hours()+Se(this.minutes(),2)+Se(this.seconds(),2)});function oh(f,p){W(f,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),p)})}oh("a",!0),oh("A",!1),ct("hour","h"),kt("hour",13);function sh(f,p){return p._meridiemParse}we("a",sh),we("A",sh),we("H",ue),we("h",ue),we("k",ue),we("HH",ue,qt),we("hh",ue,qt),we("kk",ue,qt),we("hmm",ot),we("hmmss",Vr),we("Hmm",ot),we("Hmmss",Vr),et(["H","HH"],At),et(["k","kk"],function(f,p,y){var b=$e(f);p[At]=b===24?0:b}),et(["a","A"],function(f,p,y){y._isPm=y._locale.isPM(f),y._meridiem=f}),et(["h","hh"],function(f,p,y){p[At]=$e(f),h(y).bigHour=!0}),et("hmm",function(f,p,y){var b=f.length-2;p[At]=$e(f.substr(0,b)),p[qr]=$e(f.substr(b)),h(y).bigHour=!0}),et("hmmss",function(f,p,y){var b=f.length-4,L=f.length-2;p[At]=$e(f.substr(0,b)),p[qr]=$e(f.substr(b,2)),p[Lo]=$e(f.substr(L)),h(y).bigHour=!0}),et("Hmm",function(f,p,y){var b=f.length-2;p[At]=$e(f.substr(0,b)),p[qr]=$e(f.substr(b))}),et("Hmmss",function(f,p,y){var b=f.length-4,L=f.length-2;p[At]=$e(f.substr(0,b)),p[qr]=$e(f.substr(b,2)),p[Lo]=$e(f.substr(L))});function cS(f){return(f+"").toLowerCase().charAt(0)==="p"}var fS=/[ap]\.?m?\.?/i,uS=no("Hours",!0);function dS(f,p,y){return f>11?y?"pm":"PM":y?"am":"AM"}var nh={calendar:G,longDateFormat:lt,invalidDate:rt,ordinal:Rs,dayOfMonthOrdinalParse:gn,relativeTime:ka,months:I_,monthsShort:Ym,week:B_,weekdays:K_,weekdaysMin:G_,weekdaysShort:rh,meridiemParse:fS},yt={},Ra={},Oa;function pS(f,p){var y,b=Math.min(f.length,p.length);for(y=0;y<b;y+=1)if(f[y]!==p[y])return y;return b}function ah(f){return f&&f.toLowerCase().replace("_","-")}function mS(f){for(var p=0,y,b,L,$;p<f.length;){for($=ah(f[p]).split("-"),y=$.length,b=ah(f[p+1]),b=b?b.split("-"):null;y>0;){if(L=Hi($.slice(0,y).join("-")),L)return L;if(b&&b.length>=y&&pS($,b)>=y-1)break;y--}p++}return Oa}function hS(f){return f.match("^[^/\\\\]*$")!=null}function Hi(f){var p=null,y;if(yt[f]===void 0&&typeof va!="undefined"&&va&&va.exports&&hS(f))try{p=Oa._abbr,y=require,y("./locale/"+f),cs(p)}catch(b){yt[f]=null}return yt[f]}function cs(f,p){var y;return f&&(i(p)?y=Po(f):y=df(f,p),y?Oa=y:typeof console!="undefined"&&console.warn&&console.warn("Locale "+f+" not found. Did you forget to load it?")),Oa._abbr}function df(f,p){if(p!==null){var y,b=nh;if(p.abbr=f,yt[f]!=null)q("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),b=yt[f]._config;else if(p.parentLocale!=null)if(yt[p.parentLocale]!=null)b=yt[p.parentLocale]._config;else if(y=Hi(p.parentLocale),y!=null)b=y._config;else return Ra[p.parentLocale]||(Ra[p.parentLocale]=[]),Ra[p.parentLocale].push({name:f,config:p}),null;return yt[f]=new he(Y(b,p)),Ra[f]&&Ra[f].forEach(function(L){df(L.name,L.config)}),cs(f),yt[f]}else return delete yt[f],null}function gS(f,p){if(p!=null){var y,b,L=nh;yt[f]!=null&&yt[f].parentLocale!=null?yt[f].set(Y(yt[f]._config,p)):(b=Hi(f),b!=null&&(L=b._config),p=Y(L,p),b==null&&(p.abbr=f),y=new he(p),y.parentLocale=yt[f],yt[f]=y),cs(f)}else yt[f]!=null&&(yt[f].parentLocale!=null?(yt[f]=yt[f].parentLocale,f===cs()&&cs(f)):yt[f]!=null&&delete yt[f]);return yt[f]}function Po(f){var p;if(f&&f._locale&&f._locale._abbr&&(f=f._locale._abbr),!f)return Oa;if(!r(f)){if(p=Hi(f),p)return p;f=[f]}return mS(f)}function yS(){return Fe(yt)}function pf(f){var p,y=f._a;return y&&h(f).overflow===-2&&(p=y[Io]<0||y[Io]>11?Io:y[ao]<1||y[ao]>Bi(y[Xt],y[Io])?ao:y[At]<0||y[At]>24||y[At]===24&&(y[qr]!==0||y[Lo]!==0||y[Ns]!==0)?At:y[qr]<0||y[qr]>59?qr:y[Lo]<0||y[Lo]>59?Lo:y[Ns]<0||y[Ns]>999?Ns:-1,h(f)._overflowDayOfYear&&(p<Xt||p>ao)&&(p=ao),h(f)._overflowWeeks&&p===-1&&(p=S_),h(f)._overflowWeekday&&p===-1&&(p=k_),h(f).overflow=p),f}var xS=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,bS=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,vS=/Z|[+-]\d\d(?::?\d\d)?/,Vi=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],mf=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],wS=/^\/?Date\((-?\d+)/i,_S=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,SS={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function ih(f){var p,y,b=f._i,L=xS.exec(b)||bS.exec(b),$,Q,Te,Ve,tt=Vi.length,er=mf.length;if(L){for(h(f).iso=!0,p=0,y=tt;p<y;p++)if(Vi[p][1].exec(L[1])){Q=Vi[p][0],$=Vi[p][2]!==!1;break}if(Q==null){f._isValid=!1;return}if(L[3]){for(p=0,y=er;p<y;p++)if(mf[p][1].exec(L[3])){Te=(L[2]||" ")+mf[p][0];break}if(Te==null){f._isValid=!1;return}}if(!$&&Te!=null){f._isValid=!1;return}if(L[4])if(vS.exec(L[4]))Ve="Z";else{f._isValid=!1;return}f._f=Q+(Te||"")+(Ve||""),gf(f)}else f._isValid=!1}function kS(f,p,y,b,L,$){var Q=[CS(f),Ym.indexOf(p),parseInt(y,10),parseInt(b,10),parseInt(L,10)];return $&&Q.push(parseInt($,10)),Q}function CS(f){var p=parseInt(f,10);return p<=49?2e3+p:p<=999?1900+p:p}function IS(f){return f.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function LS(f,p,y){if(f){var b=rh.indexOf(f),L=new Date(p[0],p[1],p[2]).getDay();if(b!==L)return h(y).weekdayMismatch=!0,y._isValid=!1,!1}return!0}function TS(f,p,y){if(f)return SS[f];if(p)return 0;var b=parseInt(y,10),L=b%100,$=(b-L)/100;return $*60+L}function lh(f){var p=_S.exec(IS(f._i)),y;if(p){if(y=kS(p[4],p[3],p[2],p[5],p[6],p[7]),!LS(p[1],y,f))return;f._a=y,f._tzm=TS(p[8],p[9],p[10]),f._d=Ma.apply(null,f._a),f._d.setUTCMinutes(f._d.getUTCMinutes()-f._tzm),h(f).rfc2822=!0}else f._isValid=!1}function PS(f){var p=wS.exec(f._i);if(p!==null){f._d=new Date(+p[1]);return}if(ih(f),f._isValid===!1)delete f._isValid;else return;if(lh(f),f._isValid===!1)delete f._isValid;else return;f._strict?f._isValid=!1:e.createFromInputFallback(f)}e.createFromInputFallback=F("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(f){f._d=new Date(f._i+(f._useUTC?" UTC":""))});function wn(f,p,y){return f!=null?f:p!=null?p:y}function DS(f){var p=new Date(e.now());return f._useUTC?[p.getUTCFullYear(),p.getUTCMonth(),p.getUTCDate()]:[p.getFullYear(),p.getMonth(),p.getDate()]}function hf(f){var p,y,b=[],L,$,Q;if(!f._d){for(L=DS(f),f._w&&f._a[ao]==null&&f._a[Io]==null&&FS(f),f._dayOfYear!=null&&(Q=wn(f._a[Xt],L[Xt]),(f._dayOfYear>Aa(Q)||f._dayOfYear===0)&&(h(f)._overflowDayOfYear=!0),y=Ma(Q,0,f._dayOfYear),f._a[Io]=y.getUTCMonth(),f._a[ao]=y.getUTCDate()),p=0;p<3&&f._a[p]==null;++p)f._a[p]=b[p]=L[p];for(;p<7;p++)f._a[p]=b[p]=f._a[p]==null?p===2?1:0:f._a[p];f._a[At]===24&&f._a[qr]===0&&f._a[Lo]===0&&f._a[Ns]===0&&(f._nextDay=!0,f._a[At]=0),f._d=(f._useUTC?Ma:U_).apply(null,b),$=f._useUTC?f._d.getUTCDay():f._d.getDay(),f._tzm!=null&&f._d.setUTCMinutes(f._d.getUTCMinutes()-f._tzm),f._nextDay&&(f._a[At]=24),f._w&&typeof f._w.d!="undefined"&&f._w.d!==$&&(h(f).weekdayMismatch=!0)}}function FS(f){var p,y,b,L,$,Q,Te,Ve,tt;p=f._w,p.GG!=null||p.W!=null||p.E!=null?($=1,Q=4,y=wn(p.GG,f._a[Xt],Ea(mt(),1,4).year),b=wn(p.W,1),L=wn(p.E,1),(L<1||L>7)&&(Ve=!0)):($=f._locale._week.dow,Q=f._locale._week.doy,tt=Ea(mt(),$,Q),y=wn(p.gg,f._a[Xt],tt.year),b=wn(p.w,tt.week),p.d!=null?(L=p.d,(L<0||L>6)&&(Ve=!0)):p.e!=null?(L=p.e+$,(p.e<0||p.e>6)&&(Ve=!0)):L=$),b<1||b>To(y,$,Q)?h(f)._overflowWeeks=!0:Ve!=null?h(f)._overflowWeekday=!0:(Te=th(y,b,L,$,Q),f._a[Xt]=Te.year,f._dayOfYear=Te.dayOfYear)}e.ISO_8601=function(){},e.RFC_2822=function(){};function gf(f){if(f._f===e.ISO_8601){ih(f);return}if(f._f===e.RFC_2822){lh(f);return}f._a=[],h(f).empty=!0;var p=""+f._i,y,b,L,$,Q,Te=p.length,Ve=0,tt,er;for(L=gt(f._f,f._locale).match(je)||[],er=L.length,y=0;y<er;y++)$=L[y],b=(p.match(v_($,f))||[])[0],b&&(Q=p.substr(0,p.indexOf(b)),Q.length>0&&h(f).unusedInput.push(Q),p=p.slice(p.indexOf(b)+b.length),Ve+=b.length),le[$]?(b?h(f).empty=!1:h(f).unusedTokens.push($),__($,b,f)):f._strict&&!b&&h(f).unusedTokens.push($);h(f).charsLeftOver=Te-Ve,p.length>0&&h(f).unusedInput.push(p),f._a[At]<=12&&h(f).bigHour===!0&&f._a[At]>0&&(h(f).bigHour=void 0),h(f).parsedDateParts=f._a.slice(0),h(f).meridiem=f._meridiem,f._a[At]=AS(f._locale,f._a[At],f._meridiem),tt=h(f).era,tt!==null&&(f._a[Xt]=f._locale.erasConvertYear(tt,f._a[Xt])),hf(f),pf(f)}function AS(f,p,y){var b;return y==null?p:f.meridiemHour!=null?f.meridiemHour(p,y):(f.isPM!=null&&(b=f.isPM(y),b&&p<12&&(p+=12),!b&&p===12&&(p=0)),p)}function MS(f){var p,y,b,L,$,Q,Te=!1,Ve=f._f.length;if(Ve===0){h(f).invalidFormat=!0,f._d=new Date(NaN);return}for(L=0;L<Ve;L++)$=0,Q=!1,p=M({},f),f._useUTC!=null&&(p._useUTC=f._useUTC),p._f=f._f[L],gf(p),w(p)&&(Q=!0),$+=h(p).charsLeftOver,$+=h(p).unusedTokens.length*10,h(p).score=$,Te?$<b&&(b=$,y=p):(b==null||$<b||Q)&&(b=$,y=p,Q&&(Te=!0));d(f,y||p)}function ES(f){if(!f._d){var p=as(f._i),y=p.day===void 0?p.date:p.day;f._a=u([p.year,p.month,y,p.hour,p.minute,p.second,p.millisecond],function(b){return b&&parseInt(b,10)}),hf(f)}}function RS(f){var p=new E(pf(ch(f)));return p._nextDay&&(p.add(1,"d"),p._nextDay=void 0),p}function ch(f){var p=f._i,y=f._f;return f._locale=f._locale||Po(f._l),p===null||y===void 0&&p===""?v({nullInput:!0}):(typeof p=="string"&&(f._i=p=f._locale.preparse(p)),R(p)?new E(pf(p)):(c(p)?f._d=p:r(y)?MS(f):y?gf(f):OS(f),w(f)||(f._d=null),f))}function OS(f){var p=f._i;i(p)?f._d=new Date(e.now()):c(p)?f._d=new Date(p.valueOf()):typeof p=="string"?PS(f):r(p)?(f._a=u(p.slice(0),function(y){return parseInt(y,10)}),hf(f)):s(p)?ES(f):l(p)?f._d=new Date(p):e.createFromInputFallback(f)}function fh(f,p,y,b,L){var $={};return(p===!0||p===!1)&&(b=p,p=void 0),(y===!0||y===!1)&&(b=y,y=void 0),(s(f)&&a(f)||r(f)&&f.length===0)&&(f=void 0),$._isAMomentObject=!0,$._useUTC=$._isUTC=L,$._l=y,$._i=f,$._f=p,$._strict=b,RS($)}function mt(f,p,y,b){return fh(f,p,y,b,!1)}var US=F("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var f=mt.apply(null,arguments);return this.isValid()&&f.isValid()?f<this?this:f:v()}),$S=F("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var f=mt.apply(null,arguments);return this.isValid()&&f.isValid()?f>this?this:f:v()});function uh(f,p){var y,b;if(p.length===1&&r(p[0])&&(p=p[0]),!p.length)return mt();for(y=p[0],b=1;b<p.length;++b)(!p[b].isValid()||p[b][f](y))&&(y=p[b]);return y}function BS(){var f=[].slice.call(arguments,0);return uh("isBefore",f)}function NS(){var f=[].slice.call(arguments,0);return uh("isAfter",f)}var HS=function(){return Date.now?Date.now():+new Date},Ua=["year","quarter","month","week","day","hour","minute","second","millisecond"];function VS(f){var p,y=!1,b,L=Ua.length;for(p in f)if(n(f,p)&&!(Ct.call(Ua,p)!==-1&&(f[p]==null||!isNaN(f[p]))))return!1;for(b=0;b<L;++b)if(f[Ua[b]]){if(y)return!1;parseFloat(f[Ua[b]])!==$e(f[Ua[b]])&&(y=!0)}return!0}function qS(){return this._isValid}function WS(){return Wr(NaN)}function qi(f){var p=as(f),y=p.year||0,b=p.quarter||0,L=p.month||0,$=p.week||p.isoWeek||0,Q=p.day||0,Te=p.hour||0,Ve=p.minute||0,tt=p.second||0,er=p.millisecond||0;this._isValid=VS(p),this._milliseconds=+er+tt*1e3+Ve*6e4+Te*1e3*60*60,this._days=+Q+$*7,this._months=+L+b*3+y*12,this._data={},this._locale=Po(),this._bubble()}function Wi(f){return f instanceof qi}function yf(f){return f<0?Math.round(-1*f)*-1:Math.round(f)}function zS(f,p,y){var b=Math.min(f.length,p.length),L=Math.abs(f.length-p.length),$=0,Q;for(Q=0;Q<b;Q++)(y&&f[Q]!==p[Q]||!y&&$e(f[Q])!==$e(p[Q]))&&$++;return $+L}function dh(f,p){W(f,0,0,function(){var y=this.utcOffset(),b="+";return y<0&&(y=-y,b="-"),b+Se(~~(y/60),2)+p+Se(~~y%60,2)})}dh("Z",":"),dh("ZZ",""),we("Z",vn),we("ZZ",vn),et(["Z","ZZ"],function(f,p,y){y._useUTC=!0,y._tzm=xf(vn,f)});var KS=/([\+\-]|\d\d)/gi;function xf(f,p){var y=(p||"").match(f),b,L,$;return y===null?null:(b=y[y.length-1]||[],L=(b+"").match(KS)||["-",0,0],$=+(L[1]*60)+$e(L[2]),$===0?0:L[0]==="+"?$:-$)}function bf(f,p){var y,b;return p._isUTC?(y=p.clone(),b=(R(f)||c(f)?f.valueOf():mt(f).valueOf())-y.valueOf(),y._d.setTime(y._d.valueOf()+b),e.updateOffset(y,!1),y):mt(f).local()}function vf(f){return-Math.round(f._d.getTimezoneOffset())}e.updateOffset=function(){};function GS(f,p,y){var b=this._offset||0,L;if(!this.isValid())return f!=null?this:NaN;if(f!=null){if(typeof f=="string"){if(f=xf(vn,f),f===null)return this}else Math.abs(f)<16&&!y&&(f=f*60);return!this._isUTC&&p&&(L=vf(this)),this._offset=f,this._isUTC=!0,L!=null&&this.add(L,"m"),b!==f&&(!p||this._changeInProgress?gh(this,Wr(f-b,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?b:vf(this)}function jS(f,p){return f!=null?(typeof f!="string"&&(f=-f),this.utcOffset(f,p),this):-this.utcOffset()}function YS(f){return this.utcOffset(0,f)}function JS(f){return this._isUTC&&(this.utcOffset(0,f),this._isUTC=!1,f&&this.subtract(vf(this),"m")),this}function QS(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var f=xf(Bs,this._i);f!=null?this.utcOffset(f):this.utcOffset(0,!0)}return this}function XS(f){return this.isValid()?(f=f?mt(f).utcOffset():0,(this.utcOffset()-f)%60===0):!1}function ZS(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function e1(){if(!i(this._isDSTShifted))return this._isDSTShifted;var f={},p;return M(f,this),f=ch(f),f._a?(p=f._isUTC?m(f._a):mt(f._a),this._isDSTShifted=this.isValid()&&zS(f._a,p.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function t1(){return this.isValid()?!this._isUTC:!1}function r1(){return this.isValid()?this._isUTC:!1}function ph(){return this.isValid()?this._isUTC&&this._offset===0:!1}var o1=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,s1=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Wr(f,p){var y=f,b=null,L,$,Q;return Wi(f)?y={ms:f._milliseconds,d:f._days,M:f._months}:l(f)||!isNaN(+f)?(y={},p?y[p]=+f:y.milliseconds=+f):(b=o1.exec(f))?(L=b[1]==="-"?-1:1,y={y:0,d:$e(b[ao])*L,h:$e(b[At])*L,m:$e(b[qr])*L,s:$e(b[Lo])*L,ms:$e(yf(b[Ns]*1e3))*L}):(b=s1.exec(f))?(L=b[1]==="-"?-1:1,y={y:Hs(b[2],L),M:Hs(b[3],L),w:Hs(b[4],L),d:Hs(b[5],L),h:Hs(b[6],L),m:Hs(b[7],L),s:Hs(b[8],L)}):y==null?y={}:typeof y=="object"&&("from"in y||"to"in y)&&(Q=n1(mt(y.from),mt(y.to)),y={},y.ms=Q.milliseconds,y.M=Q.months),$=new qi(y),Wi(f)&&n(f,"_locale")&&($._locale=f._locale),Wi(f)&&n(f,"_isValid")&&($._isValid=f._isValid),$}Wr.fn=qi.prototype,Wr.invalid=WS;function Hs(f,p){var y=f&&parseFloat(f.replace(",","."));return(isNaN(y)?0:y)*p}function mh(f,p){var y={};return y.months=p.month()-f.month()+(p.year()-f.year())*12,f.clone().add(y.months,"M").isAfter(p)&&--y.months,y.milliseconds=+p-+f.clone().add(y.months,"M"),y}function n1(f,p){var y;return f.isValid()&&p.isValid()?(p=bf(p,f),f.isBefore(p)?y=mh(f,p):(y=mh(p,f),y.milliseconds=-y.milliseconds,y.months=-y.months),y):{milliseconds:0,months:0}}function hh(f,p){return function(y,b){var L,$;return b!==null&&!isNaN(+b)&&(q(p,"moment()."+p+"(period, number) is deprecated. Please use moment()."+p+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),$=y,y=b,b=$),L=Wr(y,b),gh(this,L,f),this}}function gh(f,p,y,b){var L=p._milliseconds,$=yf(p._days),Q=yf(p._months);f.isValid()&&(b=b==null?!0:b,Q&&Qm(f,ls(f,"Month")+Q*y),$&&yn(f,"Date",ls(f,"Date")+$*y),L&&f._d.setTime(f._d.valueOf()+L*y),b&&e.updateOffset(f,$||Q))}var a1=hh(1,"add"),i1=hh(-1,"subtract");function yh(f){return typeof f=="string"||f instanceof String}function l1(f){return R(f)||c(f)||yh(f)||l(f)||f1(f)||c1(f)||f===null||f===void 0}function c1(f){var p=s(f)&&!a(f),y=!1,b=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],L,$,Q=b.length;for(L=0;L<Q;L+=1)$=b[L],y=y||n(f,$);return p&&y}function f1(f){var p=r(f),y=!1;return p&&(y=f.filter(function(b){return!l(b)&&yh(f)}).length===0),p&&y}function u1(f){var p=s(f)&&!a(f),y=!1,b=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],L,$;for(L=0;L<b.length;L+=1)$=b[L],y=y||n(f,$);return p&&y}function d1(f,p){var y=f.diff(p,"days",!0);return y<-6?"sameElse":y<-1?"lastWeek":y<0?"lastDay":y<1?"sameDay":y<2?"nextDay":y<7?"nextWeek":"sameElse"}function p1(f,p){arguments.length===1&&(arguments[0]?l1(arguments[0])?(f=arguments[0],p=void 0):u1(arguments[0])&&(p=arguments[0],f=void 0):(f=void 0,p=void 0));var y=f||mt(),b=bf(y,this).startOf("day"),L=e.calendarFormat(this,b)||"sameElse",$=p&&(j(p[L])?p[L].call(this,y):p[L]);return this.format($||this.localeData().calendar(L,this,mt(y)))}function m1(){return new E(this)}function h1(f,p){var y=R(f)?f:mt(f);return this.isValid()&&y.isValid()?(p=Vt(p)||"millisecond",p==="millisecond"?this.valueOf()>y.valueOf():y.valueOf()<this.clone().startOf(p).valueOf()):!1}function g1(f,p){var y=R(f)?f:mt(f);return this.isValid()&&y.isValid()?(p=Vt(p)||"millisecond",p==="millisecond"?this.valueOf()<y.valueOf():this.clone().endOf(p).valueOf()<y.valueOf()):!1}function y1(f,p,y,b){var L=R(f)?f:mt(f),$=R(p)?p:mt(p);return this.isValid()&&L.isValid()&&$.isValid()?(b=b||"()",(b[0]==="("?this.isAfter(L,y):!this.isBefore(L,y))&&(b[1]===")"?this.isBefore($,y):!this.isAfter($,y))):!1}function x1(f,p){var y=R(f)?f:mt(f),b;return this.isValid()&&y.isValid()?(p=Vt(p)||"millisecond",p==="millisecond"?this.valueOf()===y.valueOf():(b=y.valueOf(),this.clone().startOf(p).valueOf()<=b&&b<=this.clone().endOf(p).valueOf())):!1}function b1(f,p){return this.isSame(f,p)||this.isAfter(f,p)}function v1(f,p){return this.isSame(f,p)||this.isBefore(f,p)}function w1(f,p,y){var b,L,$;if(!this.isValid())return NaN;if(b=bf(f,this),!b.isValid())return NaN;switch(L=(b.utcOffset()-this.utcOffset())*6e4,p=Vt(p),p){case"year":$=zi(this,b)/12;break;case"month":$=zi(this,b);break;case"quarter":$=zi(this,b)/3;break;case"second":$=(this-b)/1e3;break;case"minute":$=(this-b)/6e4;break;case"hour":$=(this-b)/36e5;break;case"day":$=(this-b-L)/864e5;break;case"week":$=(this-b-L)/6048e5;break;default:$=this-b}return y?$:Jt($)}function zi(f,p){if(f.date()<p.date())return-zi(p,f);var y=(p.year()-f.year())*12+(p.month()-f.month()),b=f.clone().add(y,"months"),L,$;return p-b<0?(L=f.clone().add(y-1,"months"),$=(p-b)/(b-L)):(L=f.clone().add(y+1,"months"),$=(p-b)/(L-b)),-(y+$)||0}e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function _1(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function S1(f){if(!this.isValid())return null;var p=f!==!0,y=p?this.clone().utc():this;return y.year()<0||y.year()>9999?pt(y,p?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):j(Date.prototype.toISOString)?p?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",pt(y,"Z")):pt(y,p?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function k1(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var f="moment",p="",y,b,L,$;return this.isLocal()||(f=this.utcOffset()===0?"moment.utc":"moment.parseZone",p="Z"),y="["+f+'("]',b=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",L="-MM-DD[T]HH:mm:ss.SSS",$=p+'[")]',this.format(y+b+L+$)}function C1(f){f||(f=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var p=pt(this,f);return this.localeData().postformat(p)}function I1(f,p){return this.isValid()&&(R(f)&&f.isValid()||mt(f).isValid())?Wr({to:this,from:f}).locale(this.locale()).humanize(!p):this.localeData().invalidDate()}function L1(f){return this.from(mt(),f)}function T1(f,p){return this.isValid()&&(R(f)&&f.isValid()||mt(f).isValid())?Wr({from:this,to:f}).locale(this.locale()).humanize(!p):this.localeData().invalidDate()}function P1(f){return this.to(mt(),f)}function xh(f){var p;return f===void 0?this._locale._abbr:(p=Po(f),p!=null&&(this._locale=p),this)}var bh=F("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(f){return f===void 0?this.localeData():this.locale(f)});function vh(){return this._locale}var Ki=1e3,_n=60*Ki,Gi=60*_n,wh=(365*400+97)*24*Gi;function Sn(f,p){return(f%p+p)%p}function _h(f,p,y){return f<100&&f>=0?new Date(f+400,p,y)-wh:new Date(f,p,y).valueOf()}function Sh(f,p,y){return f<100&&f>=0?Date.UTC(f+400,p,y)-wh:Date.UTC(f,p,y)}function D1(f){var p,y;if(f=Vt(f),f===void 0||f==="millisecond"||!this.isValid())return this;switch(y=this._isUTC?Sh:_h,f){case"year":p=y(this.year(),0,1);break;case"quarter":p=y(this.year(),this.month()-this.month()%3,1);break;case"month":p=y(this.year(),this.month(),1);break;case"week":p=y(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":p=y(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":p=y(this.year(),this.month(),this.date());break;case"hour":p=this._d.valueOf(),p-=Sn(p+(this._isUTC?0:this.utcOffset()*_n),Gi);break;case"minute":p=this._d.valueOf(),p-=Sn(p,_n);break;case"second":p=this._d.valueOf(),p-=Sn(p,Ki);break}return this._d.setTime(p),e.updateOffset(this,!0),this}function F1(f){var p,y;if(f=Vt(f),f===void 0||f==="millisecond"||!this.isValid())return this;switch(y=this._isUTC?Sh:_h,f){case"year":p=y(this.year()+1,0,1)-1;break;case"quarter":p=y(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":p=y(this.year(),this.month()+1,1)-1;break;case"week":p=y(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":p=y(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":p=y(this.year(),this.month(),this.date()+1)-1;break;case"hour":p=this._d.valueOf(),p+=Gi-Sn(p+(this._isUTC?0:this.utcOffset()*_n),Gi)-1;break;case"minute":p=this._d.valueOf(),p+=_n-Sn(p,_n)-1;break;case"second":p=this._d.valueOf(),p+=Ki-Sn(p,Ki)-1;break}return this._d.setTime(p),e.updateOffset(this,!0),this}function A1(){return this._d.valueOf()-(this._offset||0)*6e4}function M1(){return Math.floor(this.valueOf()/1e3)}function E1(){return new Date(this.valueOf())}function R1(){var f=this;return[f.year(),f.month(),f.date(),f.hour(),f.minute(),f.second(),f.millisecond()]}function O1(){var f=this;return{years:f.year(),months:f.month(),date:f.date(),hours:f.hours(),minutes:f.minutes(),seconds:f.seconds(),milliseconds:f.milliseconds()}}function U1(){return this.isValid()?this.toISOString():null}function $1(){return w(this)}function B1(){return d({},h(this))}function N1(){return h(this).overflow}function H1(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}W("N",0,0,"eraAbbr"),W("NN",0,0,"eraAbbr"),W("NNN",0,0,"eraAbbr"),W("NNNN",0,0,"eraName"),W("NNNNN",0,0,"eraNarrow"),W("y",["y",1],"yo","eraYear"),W("y",["yy",2],0,"eraYear"),W("y",["yyy",3],0,"eraYear"),W("y",["yyyy",4],0,"eraYear"),we("N",wf),we("NN",wf),we("NNN",wf),we("NNNN",X1),we("NNNNN",Z1),et(["N","NN","NNN","NNNN","NNNNN"],function(f,p,y,b){var L=y._locale.erasParse(f,b,y._strict);L?h(y).era=L:h(y).invalidEra=f}),we("y",st),we("yy",st),we("yyy",st),we("yyyy",st),we("yo",e0),et(["y","yy","yyy","yyyy"],Xt),et(["yo"],function(f,p,y,b){var L;y._locale._eraYearOrdinalRegex&&(L=f.match(y._locale._eraYearOrdinalRegex)),y._locale.eraYearOrdinalParse?p[Xt]=y._locale.eraYearOrdinalParse(f,L):p[Xt]=parseInt(f,10)});function V1(f,p){var y,b,L,$=this._eras||Po("en")._eras;for(y=0,b=$.length;y<b;++y){switch(typeof $[y].since){case"string":L=e($[y].since).startOf("day"),$[y].since=L.valueOf();break}switch(typeof $[y].until){case"undefined":$[y].until=1/0;break;case"string":L=e($[y].until).startOf("day").valueOf(),$[y].until=L.valueOf();break}}return $}function q1(f,p,y){var b,L,$=this.eras(),Q,Te,Ve;for(f=f.toUpperCase(),b=0,L=$.length;b<L;++b)if(Q=$[b].name.toUpperCase(),Te=$[b].abbr.toUpperCase(),Ve=$[b].narrow.toUpperCase(),y)switch(p){case"N":case"NN":case"NNN":if(Te===f)return $[b];break;case"NNNN":if(Q===f)return $[b];break;case"NNNNN":if(Ve===f)return $[b];break}else if([Q,Te,Ve].indexOf(f)>=0)return $[b]}function W1(f,p){var y=f.since<=f.until?1:-1;return p===void 0?e(f.since).year():e(f.since).year()+(p-f.offset)*y}function z1(){var f,p,y,b=this.localeData().eras();for(f=0,p=b.length;f<p;++f)if(y=this.clone().startOf("day").valueOf(),b[f].since<=y&&y<=b[f].until||b[f].until<=y&&y<=b[f].since)return b[f].name;return""}function K1(){var f,p,y,b=this.localeData().eras();for(f=0,p=b.length;f<p;++f)if(y=this.clone().startOf("day").valueOf(),b[f].since<=y&&y<=b[f].until||b[f].until<=y&&y<=b[f].since)return b[f].narrow;return""}function G1(){var f,p,y,b=this.localeData().eras();for(f=0,p=b.length;f<p;++f)if(y=this.clone().startOf("day").valueOf(),b[f].since<=y&&y<=b[f].until||b[f].until<=y&&y<=b[f].since)return b[f].abbr;return""}function j1(){var f,p,y,b,L=this.localeData().eras();for(f=0,p=L.length;f<p;++f)if(y=L[f].since<=L[f].until?1:-1,b=this.clone().startOf("day").valueOf(),L[f].since<=b&&b<=L[f].until||L[f].until<=b&&b<=L[f].since)return(this.year()-e(L[f].since).year())*y+L[f].offset;return this.year()}function Y1(f){return n(this,"_erasNameRegex")||_f.call(this),f?this._erasNameRegex:this._erasRegex}function J1(f){return n(this,"_erasAbbrRegex")||_f.call(this),f?this._erasAbbrRegex:this._erasRegex}function Q1(f){return n(this,"_erasNarrowRegex")||_f.call(this),f?this._erasNarrowRegex:this._erasRegex}function wf(f,p){return p.erasAbbrRegex(f)}function X1(f,p){return p.erasNameRegex(f)}function Z1(f,p){return p.erasNarrowRegex(f)}function e0(f,p){return p._eraYearOrdinalRegex||st}function _f(){var f=[],p=[],y=[],b=[],L,$,Q=this.eras();for(L=0,$=Q.length;L<$;++L)p.push(br(Q[L].name)),f.push(br(Q[L].abbr)),y.push(br(Q[L].narrow)),b.push(br(Q[L].name)),b.push(br(Q[L].abbr)),b.push(br(Q[L].narrow));this._erasRegex=new RegExp("^("+b.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+p.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+f.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+y.join("|")+")","i")}W(0,["gg",2],0,function(){return this.weekYear()%100}),W(0,["GG",2],0,function(){return this.isoWeekYear()%100});function ji(f,p){W(0,[f,f.length],0,p)}ji("gggg","weekYear"),ji("ggggg","weekYear"),ji("GGGG","isoWeekYear"),ji("GGGGG","isoWeekYear"),ct("weekYear","gg"),ct("isoWeekYear","GG"),kt("weekYear",1),kt("isoWeekYear",1),we("G",Rt),we("g",Rt),we("GG",ue,qt),we("gg",ue,qt),we("GGGG",se,$s),we("gggg",se,$s),we("GGGGG",Me,X),we("ggggg",Me,X),Fa(["gggg","ggggg","GGGG","GGGGG"],function(f,p,y,b){p[b.substr(0,2)]=$e(f)}),Fa(["gg","GG"],function(f,p,y,b){p[b]=e.parseTwoDigitYear(f)});function t0(f){return kh.call(this,f,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function r0(f){return kh.call(this,f,this.isoWeek(),this.isoWeekday(),1,4)}function o0(){return To(this.year(),1,4)}function s0(){return To(this.isoWeekYear(),1,4)}function n0(){var f=this.localeData()._week;return To(this.year(),f.dow,f.doy)}function a0(){var f=this.localeData()._week;return To(this.weekYear(),f.dow,f.doy)}function kh(f,p,y,b,L){var $;return f==null?Ea(this,b,L).year:($=To(f,b,L),p>$&&(p=$),i0.call(this,f,p,y,b,L))}function i0(f,p,y,b,L){var $=th(f,p,y,b,L),Q=Ma($.year,0,$.dayOfYear);return this.year(Q.getUTCFullYear()),this.month(Q.getUTCMonth()),this.date(Q.getUTCDate()),this}W("Q",0,"Qo","quarter"),ct("quarter","Q"),kt("quarter",7),we("Q",xn),et("Q",function(f,p){p[Io]=($e(f)-1)*3});function l0(f){return f==null?Math.ceil((this.month()+1)/3):this.month((f-1)*3+this.month()%3)}W("D",["DD",2],"Do","date"),ct("date","D"),kt("date",9),we("D",ue),we("DD",ue,qt),we("Do",function(f,p){return f?p._dayOfMonthOrdinalParse||p._ordinalParse:p._dayOfMonthOrdinalParseLenient}),et(["D","DD"],ao),et("Do",function(f,p){p[ao]=$e(f.match(ue)[0])});var Ch=no("Date",!0);W("DDD",["DDDD",3],"DDDo","dayOfYear"),ct("dayOfYear","DDD"),kt("dayOfYear",4),we("DDD",Qt),we("DDDD",bn),et(["DDD","DDDD"],function(f,p,y){y._dayOfYear=$e(f)});function c0(f){var p=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return f==null?p:this.add(f-p,"d")}W("m",["mm",2],0,"minute"),ct("minute","m"),kt("minute",14),we("m",ue),we("mm",ue,qt),et(["m","mm"],qr);var f0=no("Minutes",!1);W("s",["ss",2],0,"second"),ct("second","s"),kt("second",15),we("s",ue),we("ss",ue,qt),et(["s","ss"],Lo);var u0=no("Seconds",!1);W("S",0,0,function(){return~~(this.millisecond()/100)}),W(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),W(0,["SSS",3],0,"millisecond"),W(0,["SSSS",4],0,function(){return this.millisecond()*10}),W(0,["SSSSS",5],0,function(){return this.millisecond()*100}),W(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3}),W(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4}),W(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5}),W(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6}),ct("millisecond","ms"),kt("millisecond",16),we("S",Qt,xn),we("SS",Qt,qt),we("SSS",Qt,bn);var fs,Ih;for(fs="SSSS";fs.length<=9;fs+="S")we(fs,st);function d0(f,p){p[Ns]=$e(("0."+f)*1e3)}for(fs="S";fs.length<=9;fs+="S")et(fs,d0);Ih=no("Milliseconds",!1),W("z",0,0,"zoneAbbr"),W("zz",0,0,"zoneName");function p0(){return this._isUTC?"UTC":""}function m0(){return this._isUTC?"Coordinated Universal Time":""}var ie=E.prototype;ie.add=a1,ie.calendar=p1,ie.clone=m1,ie.diff=w1,ie.endOf=F1,ie.format=C1,ie.from=I1,ie.fromNow=L1,ie.to=T1,ie.toNow=P1,ie.get=La,ie.invalidAt=N1,ie.isAfter=h1,ie.isBefore=g1,ie.isBetween=y1,ie.isSame=x1,ie.isSameOrAfter=b1,ie.isSameOrBefore=v1,ie.isValid=$1,ie.lang=bh,ie.locale=xh,ie.localeData=vh,ie.max=$S,ie.min=US,ie.parsingFlags=B1,ie.set=Ta,ie.startOf=D1,ie.subtract=i1,ie.toArray=R1,ie.toObject=O1,ie.toDate=E1,ie.toISOString=S1,ie.inspect=k1,typeof Symbol!="undefined"&&Symbol.for!=null&&(ie[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),ie.toJSON=U1,ie.toString=_1,ie.unix=M1,ie.valueOf=A1,ie.creationData=H1,ie.eraName=z1,ie.eraNarrow=K1,ie.eraAbbr=G1,ie.eraYear=j1,ie.year=eh,ie.isLeapYear=O_,ie.weekYear=t0,ie.isoWeekYear=r0,ie.quarter=ie.quarters=l0,ie.month=Xm,ie.daysInMonth=M_,ie.week=ie.weeks=V_,ie.isoWeek=ie.isoWeeks=q_,ie.weeksInYear=n0,ie.weeksInWeekYear=a0,ie.isoWeeksInYear=o0,ie.isoWeeksInISOWeekYear=s0,ie.date=Ch,ie.day=ie.days=rS,ie.weekday=oS,ie.isoWeekday=sS,ie.dayOfYear=c0,ie.hour=ie.hours=uS,ie.minute=ie.minutes=f0,ie.second=ie.seconds=u0,ie.millisecond=ie.milliseconds=Ih,ie.utcOffset=GS,ie.utc=YS,ie.local=JS,ie.parseZone=QS,ie.hasAlignedHourOffset=XS,ie.isDST=ZS,ie.isLocal=t1,ie.isUtcOffset=r1,ie.isUtc=ph,ie.isUTC=ph,ie.zoneAbbr=p0,ie.zoneName=m0,ie.dates=F("dates accessor is deprecated. Use date instead.",Ch),ie.months=F("months accessor is deprecated. Use month instead",Xm),ie.years=F("years accessor is deprecated. Use year instead",eh),ie.zone=F("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",jS),ie.isDSTShifted=F("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",e1);function h0(f){return mt(f*1e3)}function g0(){return mt.apply(null,arguments).parseZone()}function Lh(f){return f}var Qe=he.prototype;Qe.calendar=oe,Qe.longDateFormat=St,Qe.invalidDate=Zt,Qe.ordinal=ns,Qe.preparse=Lh,Qe.postformat=Lh,Qe.relativeTime=Os,Qe.pastFuture=Ca,Qe.set=z,Qe.eras=V1,Qe.erasParse=q1,Qe.erasConvertYear=W1,Qe.erasAbbrRegex=J1,Qe.erasNameRegex=Y1,Qe.erasNarrowRegex=Q1,Qe.months=P_,Qe.monthsShort=D_,Qe.monthsParse=A_,Qe.monthsRegex=R_,Qe.monthsShortRegex=E_,Qe.week=$_,Qe.firstDayOfYear=H_,Qe.firstDayOfWeek=N_,Qe.weekdays=Q_,Qe.weekdaysMin=Z_,Qe.weekdaysShort=X_,Qe.weekdaysParse=tS,Qe.weekdaysRegex=nS,Qe.weekdaysShortRegex=aS,Qe.weekdaysMinRegex=iS,Qe.isPM=cS,Qe.meridiem=dS;function Yi(f,p,y,b){var L=Po(),$=m().set(b,p);return L[y]($,f)}function Th(f,p,y){if(l(f)&&(p=f,f=void 0),f=f||"",p!=null)return Yi(f,p,y,"month");var b,L=[];for(b=0;b<12;b++)L[b]=Yi(f,b,y,"month");return L}function Sf(f,p,y,b){typeof f=="boolean"?(l(p)&&(y=p,p=void 0),p=p||""):(p=f,y=p,f=!1,l(p)&&(y=p,p=void 0),p=p||"");var L=Po(),$=f?L._week.dow:0,Q,Te=[];if(y!=null)return Yi(p,(y+$)%7,b,"day");for(Q=0;Q<7;Q++)Te[Q]=Yi(p,(Q+$)%7,b,"day");return Te}function y0(f,p){return Th(f,p,"months")}function x0(f,p){return Th(f,p,"monthsShort")}function b0(f,p,y){return Sf(f,p,y,"weekdays")}function v0(f,p,y){return Sf(f,p,y,"weekdaysShort")}function w0(f,p,y){return Sf(f,p,y,"weekdaysMin")}cs("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(f){var p=f%10,y=$e(f%100/10)===1?"th":p===1?"st":p===2?"nd":p===3?"rd":"th";return f+y}}),e.lang=F("moment.lang is deprecated. Use moment.locale instead.",cs),e.langData=F("moment.langData is deprecated. Use moment.localeData instead.",Po);var Do=Math.abs;function _0(){var f=this._data;return this._milliseconds=Do(this._milliseconds),this._days=Do(this._days),this._months=Do(this._months),f.milliseconds=Do(f.milliseconds),f.seconds=Do(f.seconds),f.minutes=Do(f.minutes),f.hours=Do(f.hours),f.months=Do(f.months),f.years=Do(f.years),this}function Ph(f,p,y,b){var L=Wr(p,y);return f._milliseconds+=b*L._milliseconds,f._days+=b*L._days,f._months+=b*L._months,f._bubble()}function S0(f,p){return Ph(this,f,p,1)}function k0(f,p){return Ph(this,f,p,-1)}function Dh(f){return f<0?Math.floor(f):Math.ceil(f)}function C0(){var f=this._milliseconds,p=this._days,y=this._months,b=this._data,L,$,Q,Te,Ve;return f>=0&&p>=0&&y>=0||f<=0&&p<=0&&y<=0||(f+=Dh(kf(y)+p)*864e5,p=0,y=0),b.milliseconds=f%1e3,L=Jt(f/1e3),b.seconds=L%60,$=Jt(L/60),b.minutes=$%60,Q=Jt($/60),b.hours=Q%24,p+=Jt(Q/24),Ve=Jt(Fh(p)),y+=Ve,p-=Dh(kf(Ve)),Te=Jt(y/12),y%=12,b.days=p,b.months=y,b.years=Te,this}function Fh(f){return f*4800/146097}function kf(f){return f*146097/4800}function I0(f){if(!this.isValid())return NaN;var p,y,b=this._milliseconds;if(f=Vt(f),f==="month"||f==="quarter"||f==="year")switch(p=this._days+b/864e5,y=this._months+Fh(p),f){case"month":return y;case"quarter":return y/3;case"year":return y/12}else switch(p=this._days+Math.round(kf(this._months)),f){case"week":return p/7+b/6048e5;case"day":return p+b/864e5;case"hour":return p*24+b/36e5;case"minute":return p*1440+b/6e4;case"second":return p*86400+b/1e3;case"millisecond":return Math.floor(p*864e5)+b;default:throw new Error("Unknown unit "+f)}}function L0(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+$e(this._months/12)*31536e6:NaN}function Fo(f){return function(){return this.as(f)}}var T0=Fo("ms"),P0=Fo("s"),D0=Fo("m"),F0=Fo("h"),A0=Fo("d"),M0=Fo("w"),E0=Fo("M"),R0=Fo("Q"),O0=Fo("y");function U0(){return Wr(this)}function $0(f){return f=Vt(f),this.isValid()?this[f+"s"]():NaN}function Vs(f){return function(){return this.isValid()?this._data[f]:NaN}}var B0=Vs("milliseconds"),N0=Vs("seconds"),H0=Vs("minutes"),V0=Vs("hours"),q0=Vs("days"),W0=Vs("months"),z0=Vs("years");function K0(){return Jt(this.days()/7)}var Ao=Math.round,kn={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function G0(f,p,y,b,L){return L.relativeTime(p||1,!!y,f,b)}function j0(f,p,y,b){var L=Wr(f).abs(),$=Ao(L.as("s")),Q=Ao(L.as("m")),Te=Ao(L.as("h")),Ve=Ao(L.as("d")),tt=Ao(L.as("M")),er=Ao(L.as("w")),Mo=Ao(L.as("y")),us=$<=y.ss&&["s",$]||$<y.s&&["ss",$]||Q<=1&&["m"]||Q<y.m&&["mm",Q]||Te<=1&&["h"]||Te<y.h&&["hh",Te]||Ve<=1&&["d"]||Ve<y.d&&["dd",Ve];return y.w!=null&&(us=us||er<=1&&["w"]||er<y.w&&["ww",er]),us=us||tt<=1&&["M"]||tt<y.M&&["MM",tt]||Mo<=1&&["y"]||["yy",Mo],us[2]=p,us[3]=+f>0,us[4]=b,G0.apply(null,us)}function Y0(f){return f===void 0?Ao:typeof f=="function"?(Ao=f,!0):!1}function J0(f,p){return kn[f]===void 0?!1:p===void 0?kn[f]:(kn[f]=p,f==="s"&&(kn.ss=p-1),!0)}function Q0(f,p){if(!this.isValid())return this.localeData().invalidDate();var y=!1,b=kn,L,$;return typeof f=="object"&&(p=f,f=!1),typeof f=="boolean"&&(y=f),typeof p=="object"&&(b=Object.assign({},kn,p),p.s!=null&&p.ss==null&&(b.ss=p.s-1)),L=this.localeData(),$=j0(this,!y,b,L),y&&($=L.pastFuture(+this,$)),L.postformat($)}var Cf=Math.abs;function Cn(f){return(f>0)-(f<0)||+f}function Ji(){if(!this.isValid())return this.localeData().invalidDate();var f=Cf(this._milliseconds)/1e3,p=Cf(this._days),y=Cf(this._months),b,L,$,Q,Te=this.asSeconds(),Ve,tt,er,Mo;return Te?(b=Jt(f/60),L=Jt(b/60),f%=60,b%=60,$=Jt(y/12),y%=12,Q=f?f.toFixed(3).replace(/\.?0+$/,""):"",Ve=Te<0?"-":"",tt=Cn(this._months)!==Cn(Te)?"-":"",er=Cn(this._days)!==Cn(Te)?"-":"",Mo=Cn(this._milliseconds)!==Cn(Te)?"-":"",Ve+"P"+($?tt+$+"Y":"")+(y?tt+y+"M":"")+(p?er+p+"D":"")+(L||b||f?"T":"")+(L?Mo+L+"H":"")+(b?Mo+b+"M":"")+(f?Mo+Q+"S":"")):"P0D"}var Ye=qi.prototype;Ye.isValid=qS,Ye.abs=_0,Ye.add=S0,Ye.subtract=k0,Ye.as=I0,Ye.asMilliseconds=T0,Ye.asSeconds=P0,Ye.asMinutes=D0,Ye.asHours=F0,Ye.asDays=A0,Ye.asWeeks=M0,Ye.asMonths=E0,Ye.asQuarters=R0,Ye.asYears=O0,Ye.valueOf=L0,Ye._bubble=C0,Ye.clone=U0,Ye.get=$0,Ye.milliseconds=B0,Ye.seconds=N0,Ye.minutes=H0,Ye.hours=V0,Ye.days=q0,Ye.weeks=K0,Ye.months=W0,Ye.years=z0,Ye.humanize=Q0,Ye.toISOString=Ji,Ye.toString=Ji,Ye.toJSON=Ji,Ye.locale=xh,Ye.localeData=vh,Ye.toIsoString=F("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Ji),Ye.lang=bh,W("X",0,0,"unix"),W("x",0,0,"valueOf"),we("x",Rt),we("X",Pa),et("X",function(f,p,y){y._d=new Date(parseFloat(f)*1e3)}),et("x",function(f,p,y){y._d=new Date($e(f))});return e.version="2.29.4",t(mt),e.fn=ie,e.min=BS,e.max=NS,e.now=HS,e.utc=m,e.unix=h0,e.months=y0,e.isDate=c,e.locale=cs,e.invalid=v,e.duration=Wr,e.isMoment=R,e.weekdays=b0,e.parseZone=g0,e.localeData=Po,e.isDuration=Wi,e.monthsShort=x0,e.weekdaysMin=w0,e.defineLocale=df,e.updateLocale=gS,e.locales=yS,e.weekdaysShort=v0,e.normalizeUnits=Vt,e.relativeTimeRounding=Y0,e.relativeTimeThreshold=J0,e.calendarFormat=d1,e.prototype=ie,e.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},e})});var VE={};If(VE,{default:()=>af});module.exports=sk(VE);var Yt=require("obsidian"),y_=require("obsidian"),x_=qs(Ba());var ut=require("obsidian");var Ot=()=>new Map,Xi=o=>{let e=Ot();return o.forEach((t,r)=>{e.set(r,t)}),e},zr=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Rh=(o,e)=>{let t=[];for(let[r,s]of o)t.push(e(s,r));return t},Oh=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var lo=()=>new Set;var Zi=o=>o[o.length-1];var Uh=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},Kr=Array.from;var Tf=Array.isArray;var el=class{constructor(){this._observers=Ot()}on(e,t){return zr(this._observers,e,lo).add(t),t}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Kr((this._observers.get(e)||Ot()).values()).forEach(r=>r(...t))}destroy(){this._observers=Ot()}},Ln=class{constructor(){this._observers=Ot()}on(e,t){zr(this._observers,e,lo).add(t)}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Kr((this._observers.get(e)||Ot()).values()).forEach(r=>r(...t))}destroy(){this._observers=Ot()}};var pr=Math.floor;var Tn=Math.abs;var Pn=(o,e)=>o<e?o:e,Gr=(o,e)=>o>e?o:e,KE=Number.isNaN;var tl=o=>o!==0?o<0:1/o<0;var Df=Number.MAX_SAFE_INTEGER,GE=Number.MIN_SAFE_INTEGER,jE=1<<31;var $h=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&pr(o)===o),YE=Number.isNaN,JE=Number.parseInt;var ak=String.fromCharCode,QE=String.fromCodePoint,XE=ak(65535),ik=o=>o.toLowerCase(),lk=/^\s*/g,ck=o=>o.replace(lk,""),fk=/([A-Z])/g,Ff=(o,e)=>ck(o.replace(fk,t=>`${e}${ik(t)}`));var uk=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},An=typeof TextEncoder!="undefined"?new TextEncoder:null,dk=o=>An.encode(o),Nh=An?dk:uk;var Fn=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Fn&&Fn.decode(new Uint8Array).length===1&&(Fn=null);var Ws=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Ks=()=>new Ws;var pk=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var vr=o=>{let e=new Uint8Array(pk(o)),t=0;for(let r=0;r<o.bufs.length;r++){let s=o.bufs[r];e.set(s,t),t+=s.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},mk=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(Gr(t,e)*2),o.cpos=0)},Ut=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var ol=Ut;var Re=(o,e)=>{for(;e>127;)Ut(o,128|127&e),e=pr(e/128);Ut(o,127&e)},sl=(o,e)=>{let t=tl(e);for(t&&(e=-e),Ut(o,(e>63?128:0)|(t?64:0)|63&e),e=pr(e/64);e>0;)Ut(o,(e>127?128:0)|127&e),e=pr(e/128)},Mf=new Uint8Array(3e4),hk=Mf.length/3,gk=(o,e)=>{if(e.length<hk){let t=An.encodeInto(e,Mf).written||0;Re(o,t);for(let r=0;r<t;r++)Ut(o,Mf[r])}else $t(o,Nh(e))},yk=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Re(o,r);for(let s=0;s<r;s++)Ut(o,t.codePointAt(s))},Eo=An&&An.encodeInto?gk:yk;var Va=(o,e)=>{let t=o.cbuf.length,r=o.cpos,s=Pn(t-r,e.length),n=e.length-s;o.cbuf.set(e.subarray(0,s),r),o.cpos+=s,n>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(Gr(t*2,n)),o.cbuf.set(e.subarray(s)),o.cpos=n)},$t=(o,e)=>{Re(o,e.byteLength),Va(o,e)},Ef=(o,e)=>{mk(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},xk=(o,e)=>Ef(o,4).setFloat32(0,e,!1),bk=(o,e)=>Ef(o,8).setFloat64(0,e,!1),vk=(o,e)=>Ef(o,8).setBigInt64(0,e,!1);var Vh=new DataView(new ArrayBuffer(4)),wk=o=>(Vh.setFloat32(0,o),Vh.getFloat32(0)===o),En=(o,e)=>{switch(typeof e){case"string":Ut(o,119),Eo(o,e);break;case"number":$h(e)&&Tn(e)<=2147483647?(Ut(o,125),sl(o,e)):wk(e)?(Ut(o,124),xk(o,e)):(Ut(o,123),bk(o,e));break;case"bigint":Ut(o,122),vk(o,e);break;case"object":if(e===null)Ut(o,126);else if(Tf(e)){Ut(o,117),Re(o,e.length);for(let t=0;t<e.length;t++)En(o,e[t])}else if(e instanceof Uint8Array)Ut(o,116),$t(o,e);else{Ut(o,118);let t=Object.keys(e);Re(o,t.length);for(let r=0;r<t.length;r++){let s=t[r];Eo(o,s),En(o,e[s])}}break;case"boolean":Ut(o,e?120:121);break;default:Ut(o,127)}},Ha=class extends Ws{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Re(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var qh=o=>{o.count>0&&(sl(o.encoder,o.count===1?o.s:-o.s),o.count>1&&Re(o.encoder,o.count-2))},zs=class{constructor(){this.encoder=new Ws,this.s=0,this.count=0}write(e){this.s===e?this.count++:(qh(this),this.count=1,this.s=e)}toUint8Array(){return qh(this),vr(this.encoder)}};var Wh=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);sl(o.encoder,e),o.count>1&&Re(o.encoder,o.count-2)}},Rn=class{constructor(){this.encoder=new Ws,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Wh(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Wh(this),vr(this.encoder)}},rl=class{constructor(){this.sarr=[],this.s="",this.lensE=new zs}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new Ws;return this.sarr.push(this.s),this.s="",Eo(e,this.sarr.join("")),Va(e,this.lensE.toUint8Array()),vr(e)}};var Ar=o=>new Error(o),jr=()=>{throw Ar("Method unimplemented")},Mr=()=>{throw Ar("Unexpected case")};var zh=Ar("Unexpected end of array"),Kh=Ar("Integer out of Range"),On=class{constructor(e){this.arr=e,this.pos=0}},Jr=o=>new On(o),Gh=o=>o.pos!==o.arr.length;var _k=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},Wt=o=>_k(o,Ee(o));var Gs=o=>o.arr[o.pos++];var Ee=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let s=o.arr[o.pos++];if(e=e+(s&127)*t,t*=128,s<128)return e;if(e>Df)throw Kh}throw zh},al=o=>{let e=o.arr[o.pos++],t=e&63,r=64,s=(e&64)>0?-1:1;if(!(e&128))return s*t;let n=o.arr.length;for(;o.pos<n;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return s*t;if(t>Df)throw Kh}throw zh};var Sk=o=>{let e=Ee(o);if(e===0)return"";{let t=String.fromCodePoint(Gs(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(Gs(o));else for(;e>0;){let r=e<1e4?e:1e4,s=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,s),e-=r}return decodeURIComponent(escape(t))}},kk=o=>Fn.decode(Wt(o)),Yr=Fn?kk:Sk;var Uf=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},Ck=o=>Uf(o,4).getFloat32(0,!1),Ik=o=>Uf(o,8).getFloat64(0,!1),Lk=o=>Uf(o,8).getBigInt64(0,!1);var Tk=[o=>{},o=>null,al,Ck,Ik,Lk,o=>!1,o=>!0,Yr,o=>{let e=Ee(o),t={};for(let r=0;r<e;r++){let s=Yr(o);t[s]=Un(o)}return t},o=>{let e=Ee(o),t=[];for(let r=0;r<e;r++)t.push(Un(o));return t},Wt],Un=o=>Tk[127-Gs(o)](o),qa=class extends On{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Gh(this)?this.count=Ee(this)+1:this.count=-1),this.count--,this.s}};var js=class extends On{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=al(this);let e=tl(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ee(this)+2)}return this.count--,this.s}};var $n=class extends On{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=al(this),t=e&1;this.diff=pr(e/2),this.count=1,t&&(this.count=Ee(this)+2)}return this.s+=this.diff,this.count--,this.s}},nl=class{constructor(e){this.decoder=new js(e),this.str=Yr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var tR=crypto.subtle,jh=crypto.getRandomValues.bind(crypto);var Wa=()=>jh(new Uint32Array(1))[0];var Pk=[1e7]+-1e3+-4e3+-8e3+-1e11,Bn=()=>Pk.replace(/[018]/g,o=>(o^Wa()&15>>o/4).toString(16));var Ys=Date.now;var Ro=o=>new Promise(o);var Dk=Promise.all.bind(Promise);var Bf=o=>o===void 0?null:o;var Nf=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Qh=new Nf,Ak=!0;try{typeof localStorage!="undefined"&&localStorage&&(Qh=localStorage,Ak=!1)}catch(o){}var Xh=Qh;var Zh=Object.assign,Ek=Object.keys,eg=(o,e)=>{for(let t in o)e(o[t],t)};var za=o=>Ek(o).length;var tg=o=>{for(let e in o)return!1;return!0},Rk=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},Hf=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),Vf=(o,e)=>o===e||za(o)===za(e)&&Rk(o,(t,r)=>(t!==void 0||Hf(e,r))&&e[r]===t);var Ka=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&Ka(o,e,t+1)}};var og=o=>o,Ok=(o,e)=>o===e;var Nn=(o,e)=>{if(o==null||e==null)return Ok(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!Nn(o.get(t),e.get(t)))return!1;break}case Object:if(za(o)!==za(e))return!1;for(let t in o)if(!Hf(o,t)||!Nn(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!Nn(o[t],e[t]))return!1;break;default:return!1}return!0},sg=(o,e)=>e.includes(o);var Ga=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var sR=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,co,Uk=[],$k=()=>{if(co===void 0)if(Ga){co=Ot();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&co.set(e,""),e=r):e!==null?(co.set(e,r),e=null):Uk.push(r)}e!==null&&co.set(e,"")}else typeof location=="object"?(co=Ot(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");co.set(`--${Ff(e,"-")}`,t),co.set(`-${Ff(e,"-")}`,t)}})):co=Ot();return co},Wf=o=>$k().has(o);var zf=o=>Ga?Bf(process.env[o.toUpperCase().replaceAll("-","_")]):Bf(Xh.getItem(o));var Bk=o=>Wf("--"+o)||zf(o)!==null,nR=Bk("production"),ng=Ga&&sg(process.env.FORCE_COLOR,["true","1","2"]),ag=!Wf("no-colors")&&(!Ga||process.stdout.isTTY||ng)&&(!Ga||Wf("color")||ng||zf("COLORTERM")!==null||(zf("TERM")||"").includes("color"));var Hk=o=>new Uint8Array(o);var ig=o=>{let e=Hk(o.byteLength);return e.set(o),e};var Kf=class{constructor(e,t){this.left=e,this.right=t}},tr=(o,e)=>new Kf(o,e);var lg=(o,e)=>o.forEach(t=>e(t.left,t.right));var fo=typeof document!="undefined"?document:{},qk=o=>fo.createElement(o),Wk=()=>fo.createDocumentFragment(),zk=o=>fo.createTextNode(o),aR=typeof DOMParser!="undefined"?new DOMParser:null;var Kk=(o,e)=>(lg(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var Gk=o=>{let e=Wk();for(let t=0;t<o.length;t++)ug(e,o[t]);return e},cg=(o,e)=>(ug(o,Gk(e)),o);var ja=(o,e=[],t=[])=>cg(Kk(qk(o),e),t);var Hn=zk;var fg=o=>Rh(o,(e,t)=>`${t}:${e};`).join("");var ug=(o,e)=>o.appendChild(e),iR=fo.ELEMENT_NODE,lR=fo.TEXT_NODE,cR=fo.CDATA_SECTION_NODE,fR=fo.COMMENT_NODE,uR=fo.DOCUMENT_NODE,dR=fo.DOCUMENT_TYPE_NODE,pR=fo.DOCUMENT_FRAGMENT_NODE;var uo=Symbol;var Ya=uo(),Ja=uo(),jf=uo(),Yf=uo(),Jf=uo(),Qa=uo(),Qf=uo(),Xa=uo(),Xf=uo(),pg=o=>{var s;o.length===1&&((s=o[0])==null?void 0:s.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let n=o[r];n===void 0?e.push("undefined"):n.constructor===String||n.constructor===Number?e.push(n):n.constructor===Object&&t.push(JSON.stringify(n))}return t};var mR=Ys();var Jk={[Ya]:tr("font-weight","bold"),[Ja]:tr("font-weight","normal"),[jf]:tr("color","blue"),[Jf]:tr("color","green"),[Yf]:tr("color","grey"),[Qa]:tr("color","red"),[Qf]:tr("color","purple"),[Xa]:tr("color","orange"),[Xf]:tr("color","black")},Qk=o=>{var a;o.length===1&&((a=o[0])==null?void 0:a.constructor)===Function&&(o=o[0]());let e=[],t=[],r=Ot(),s=[],n=0;for(;n<o.length;n++){let i=o[n],l=Jk[i];if(l!==void 0)r.set(l.left,l.right);else{if(i===void 0)break;if(i.constructor===String||i.constructor===Number){let c=fg(r);n>0||c.length>0?(e.push("%c"+i),t.push(c)):e.push(i)}else break}}for(n>0&&(s=t,s.unshift(e.join("")));n<o.length;n++){let i=o[n];i instanceof Symbol||s.push(i)}return s},Xk=ag?Qk:pg,mg=(...o)=>{console.log(...Xk(o)),Zk.forEach(e=>e.print(o))};var Zk=lo();var hg=o=>({[Symbol.iterator](){return this},next:o}),gg=(o,e)=>hg(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),ll=(o,e)=>hg(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var ei=class{constructor(e,t){this.clock=e,this.len=t}},Js=class{constructor(){this.clients=new Map}},Fg=(o,e,t)=>e.clients.forEach((r,s)=>{let n=o.doc.store.clients.get(s);for(let a=0;a<r.length;a++){let i=r[a];Ng(o,n,i.clock,i.len,t)}}),sC=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let s=pr((t+r)/2),n=o[s],a=n.clock;if(a<=e){if(e<a+n.len)return s;t=s+1}else r=s-1}return null},mu=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&sC(t,e.clock)!==null},hu=o=>{o.clients.forEach(e=>{e.sort((s,n)=>s.clock-n.clock);let t,r;for(t=1,r=1;t<e.length;t++){let s=e[r-1],n=e[t];s.clock+s.len>=n.clock?s.len=Gr(s.len,n.clock+n.len-s.clock):(r<t&&(e[r]=n),r++)}e.length=r})},eu=o=>{let e=new Js;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,s)=>{if(!e.clients.has(s)){let n=r.slice();for(let a=t+1;a<o.length;a++)Uh(n,o[a].clients.get(s)||[]);e.clients.set(s,n)}});return hu(e),e},hl=(o,e,t,r)=>{zr(o.clients,e,()=>[]).push(new ei(t,r))},gu=()=>new Js,nC=o=>{let e=gu();return o.clients.forEach((t,r)=>{let s=[];for(let n=0;n<t.length;n++){let a=t[n];if(a.deleted){let i=a.id.clock,l=a.length;if(n+1<t.length)for(let c=t[n+1];n+1<t.length&&c.deleted;c=t[++n+1])l+=c.length;s.push(new ei(i,l))}}s.length>0&&e.clients.set(r,s)}),e},gs=(o,e)=>{Re(o.restEncoder,e.clients.size),Kr(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),Re(o.restEncoder,t);let s=r.length;Re(o.restEncoder,s);for(let n=0;n<s;n++){let a=r[n];o.writeDsClock(a.clock),o.writeDsLen(a.len)}})},ti=o=>{let e=new Js,t=Ee(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let s=Ee(o.restDecoder),n=Ee(o.restDecoder);if(n>0){let a=zr(e.clients,s,()=>[]);for(let i=0;i<n;i++)a.push(new ei(o.readDsClock(),o.readDsLen()))}}return e},bg=(o,e,t)=>{let r=new Js,s=Ee(o.restDecoder);for(let n=0;n<s;n++){o.resetDsCurVal();let a=Ee(o.restDecoder),i=Ee(o.restDecoder),l=t.clients.get(a)||[],c=Pt(t,a);for(let u=0;u<i;u++){let d=o.readDsClock(),m=d+o.readDsLen();if(d<c){c<m&&hl(r,a,c,m-c);let g=mo(l,d),h=l[g];for(!h.deleted&&h.id.clock<d&&(l.splice(g+1,0,kl(e,h,d-h.id.clock)),g++);g<l.length&&(h=l[g++],h.id.clock<m);)h.deleted||(m<h.id.clock+h.length&&l.splice(g,0,kl(e,h,m-h.id.clock)),h.delete(e))}else hl(r,a,d,m-d)}}if(r.clients.size>0){let n=new Oo;return Re(n.restEncoder,0),gs(n,r),n.toUint8Array()}return null};var Ag=Wa,wr=class extends el{constructor({guid:e=Bn(),collectionid:t=null,gc:r=!0,gcFilter:s=()=>!0,meta:n=null,autoLoad:a=!1,shouldLoad:i=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=Ag(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new vl,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=i,this.autoLoad=a,this.meta=n,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Ro(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});let l=()=>Ro(c=>{let u=d=>{(d===void 0||d===!0)&&(this.off("sync",u),c())};this.on("sync",u)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&Xe(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Kr(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Xe(this,e,t)}get(e,t=Mt){let r=zr(this.share,e,()=>{let n=new t;return n._integrate(this,null),n}),s=r.constructor;if(t!==Mt&&s!==t)if(s===Mt){let n=new t;n._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=n}),n._start=r._start;for(let a=n._start;a!==null;a=a.right)a.parent=n;return n._length=r._length,this.share.set(e,n),n._integrate(this,null),n}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,po)}getText(e=""){return this.get(e,bs)}getMap(e=""){return this.get(e,Uo)}getXmlElement(e=""){return this.get(e,vs)}getXmlFragment(e=""){return this.get(e,$o)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){Kr(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new wr({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Xe(e.parent.doc,r=>{let s=t.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Wn=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ee(this.restDecoder)}readDsLen(){return Ee(this.restDecoder)}},gl=class extends Wn{readLeftID(){return qe(Ee(this.restDecoder),Ee(this.restDecoder))}readRightID(){return qe(Ee(this.restDecoder),Ee(this.restDecoder))}readClient(){return Ee(this.restDecoder)}readInfo(){return Gs(this.restDecoder)}readString(){return Yr(this.restDecoder)}readParentInfo(){return Ee(this.restDecoder)===1}readTypeRef(){return Ee(this.restDecoder)}readLen(){return Ee(this.restDecoder)}readAny(){return Un(this.restDecoder)}readBuf(){return ig(Wt(this.restDecoder))}readJSON(){return JSON.parse(Yr(this.restDecoder))}readKey(){return Yr(this.restDecoder)}},tu=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ee(this.restDecoder),this.dsCurrVal}readDsLen(){let e=Ee(this.restDecoder)+1;return this.dsCurrVal+=e,e}},ys=class extends tu{constructor(e){super(e),this.keys=[],Ee(e),this.keyClockDecoder=new $n(Wt(e)),this.clientDecoder=new js(Wt(e)),this.leftClockDecoder=new $n(Wt(e)),this.rightClockDecoder=new $n(Wt(e)),this.infoDecoder=new qa(Wt(e),Gs),this.stringDecoder=new nl(Wt(e)),this.parentInfoDecoder=new qa(Wt(e),Gs),this.typeRefDecoder=new js(Wt(e)),this.lenDecoder=new js(Wt(e))}readLeftID(){return new hs(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new hs(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Un(this.restDecoder)}readBuf(){return Wt(this.restDecoder)}readJSON(){return Un(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},zn=class{constructor(){this.restEncoder=Ks()}toUint8Array(){return vr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Re(this.restEncoder,e)}writeDsLen(e){Re(this.restEncoder,e)}},Qs=class extends zn{writeLeftID(e){Re(this.restEncoder,e.client),Re(this.restEncoder,e.clock)}writeRightID(e){Re(this.restEncoder,e.client),Re(this.restEncoder,e.clock)}writeClient(e){Re(this.restEncoder,e)}writeInfo(e){ol(this.restEncoder,e)}writeString(e){Eo(this.restEncoder,e)}writeParentInfo(e){Re(this.restEncoder,e?1:0)}writeTypeRef(e){Re(this.restEncoder,e)}writeLen(e){Re(this.restEncoder,e)}writeAny(e){En(this.restEncoder,e)}writeBuf(e){$t(this.restEncoder,e)}writeJSON(e){Eo(this.restEncoder,JSON.stringify(e))}writeKey(e){Eo(this.restEncoder,e)}},yl=class{constructor(){this.restEncoder=Ks(),this.dsCurrVal=0}toUint8Array(){return vr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,Re(this.restEncoder,t)}writeDsLen(e){e===0&&Mr(),Re(this.restEncoder,e-1),this.dsCurrVal+=e}},Oo=class extends yl{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Rn,this.clientEncoder=new zs,this.leftClockEncoder=new Rn,this.rightClockEncoder=new Rn,this.infoEncoder=new Ha(ol),this.stringEncoder=new rl,this.parentInfoEncoder=new Ha(ol),this.typeRefEncoder=new zs,this.lenEncoder=new zs}toUint8Array(){let e=Ks();return Re(e,0),$t(e,this.keyClockEncoder.toUint8Array()),$t(e,this.clientEncoder.toUint8Array()),$t(e,this.leftClockEncoder.toUint8Array()),$t(e,this.rightClockEncoder.toUint8Array()),$t(e,vr(this.infoEncoder)),$t(e,this.stringEncoder.toUint8Array()),$t(e,vr(this.parentInfoEncoder)),$t(e,this.typeRefEncoder.toUint8Array()),$t(e,this.lenEncoder.toUint8Array()),Va(e,vr(this.restEncoder)),vr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){En(this.restEncoder,e)}writeBuf(e){$t(this.restEncoder,e)}writeJSON(e){En(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},aC=(o,e,t,r)=>{r=Gr(r,e[0].id.clock);let s=mo(e,r);Re(o.restEncoder,e.length-s),o.writeClient(t),Re(o.restEncoder,r);let n=e[s];n.write(o,r-n.id.clock);for(let a=s+1;a<e.length;a++)e[a].write(o,0)},yu=(o,e,t)=>{let r=new Map;t.forEach((s,n)=>{Pt(e,n)>s&&r.set(n,s)}),Cl(e).forEach((s,n)=>{t.has(n)||r.set(n,0)}),Re(o.restEncoder,r.size),Kr(r.entries()).sort((s,n)=>n[0]-s[0]).forEach(([s,n])=>{aC(o,e.clients.get(s),s,n)})},iC=(o,e)=>{let t=Ot(),r=Ee(o.restDecoder);for(let s=0;s<r;s++){let n=Ee(o.restDecoder),a=new Array(n),i=o.readClient(),l=Ee(o.restDecoder);t.set(i,{i:0,refs:a});for(let c=0;c<n;c++){let u=o.readInfo();switch(31&u){case 0:{let d=o.readLen();a[c]=new mr(qe(i,l),d),l+=d;break}case 10:{let d=Ee(o.restDecoder);a[c]=new hr(qe(i,l),d),l+=d;break}default:{let d=(u&192)===0,m=new xt(qe(i,l),null,(u&128)===128?o.readLeftID():null,null,(u&64)===64?o.readRightID():null,d?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,d&&(u&32)===32?o.readString():null,ny(o,u));a[c]=m,l+=m.length}}}}return t},lC=(o,e,t)=>{let r=[],s=Kr(t.keys()).sort((g,h)=>g-h);if(s.length===0)return null;let n=()=>{if(s.length===0)return null;let g=t.get(s[s.length-1]);for(;g.refs.length===g.i;)if(s.pop(),s.length>0)g=t.get(s[s.length-1]);else return null;return g},a=n();if(a===null)return null;let i=new vl,l=new Map,c=(g,h)=>{let _=l.get(g);(_==null||_>h)&&l.set(g,h)},u=a.refs[a.i++],d=new Map,m=()=>{for(let g of r){let h=g.id.client,_=t.get(h);_?(_.i--,i.clients.set(h,_.refs.slice(_.i)),t.delete(h),_.i=0,_.refs=[]):i.clients.set(h,[g]),s=s.filter(w=>w!==h)}r.length=0};for(;;){if(u.constructor!==hr){let h=zr(d,u.id.client,()=>Pt(e,u.id.client))-u.id.clock;if(h<0)r.push(u),c(u.id.client,u.id.clock-1),m();else{let _=u.getMissing(o,e);if(_!==null){r.push(u);let w=t.get(_)||{refs:[],i:0};if(w.refs.length===w.i)c(_,Pt(e,_)),m();else{u=w.refs[w.i++];continue}}else(h===0||h<u.length)&&(u.integrate(o,h),d.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(a!==null&&a.i<a.refs.length)u=a.refs[a.i++];else{if(a=n(),a===null)break;u=a.refs[a.i++]}}if(i.clients.size>0){let g=new Oo;return yu(g,i,new Map),Re(g.restEncoder,0),{missing:l,update:g.toUint8Array()}}return null},cC=(o,e)=>yu(o,e.doc.store,e.beforeState),fC=(o,e,t,r=new ys(o))=>Xe(e,s=>{s.local=!1;let n=!1,a=s.doc,i=a.store,l=iC(r,a),c=lC(s,i,l),u=i.pendingStructs;if(u){for(let[m,g]of u.missing)if(g<Pt(i,m)){n=!0;break}if(c){for(let[m,g]of c.missing){let h=u.missing.get(m);(h==null||h>g)&&u.missing.set(m,g)}u.update=wl([u.update,c.update])}}else i.pendingStructs=c;let d=bg(r,s,i);if(i.pendingDs){let m=new ys(Jr(i.pendingDs));Ee(m.restDecoder);let g=bg(m,s,i);d&&g?i.pendingDs=wl([d,g]):i.pendingDs=d||g}else i.pendingDs=d;if(n){let m=i.pendingStructs.update;i.pendingStructs=null,Mg(s.doc,m)}},t,!1);var Mg=(o,e,t,r=ys)=>{let s=Jr(e);fC(s,o,t,new r(s))},ho=(o,e,t)=>Mg(o,e,t,gl),uC=(o,e,t=new Map)=>{yu(o,e.store,t),gs(o,nC(e.store))},dC=(o,e=new Uint8Array([0]),t=new Oo)=>{let r=Eg(e);uC(t,o,r);let s=[t.toUint8Array()];if(o.store.pendingDs&&s.push(o.store.pendingDs),o.store.pendingStructs&&s.push(CC(o.store.pendingStructs.update,e)),s.length>1){if(t.constructor===Qs)return SC(s.map((n,a)=>a===0?n:LC(n)));if(t.constructor===Oo)return wl(s)}return s[0]},tn=(o,e)=>dC(o,e,new Qs),pC=o=>{let e=new Map,t=Ee(o.restDecoder);for(let r=0;r<t;r++){let s=Ee(o.restDecoder),n=Ee(o.restDecoder);e.set(s,n)}return e},Eg=o=>pC(new Wn(Jr(o))),Rg=(o,e)=>(Re(o.restEncoder,e.size),Kr(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{Re(o.restEncoder,t),Re(o.restEncoder,r)}),o),mC=(o,e)=>Rg(o,Cl(e.store)),hC=(o,e=new yl)=>(o instanceof Map?Rg(e,o):mC(e,o),e.toUint8Array()),Og=o=>hC(o,new zn),ru=class{constructor(){this.l=[]}},vg=()=>new ru,wg=(o,e)=>o.l.push(e),_g=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(s=>e!==s),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Ug=(o,e,t)=>Ka(o.l,[e,t]),hs=class{constructor(e,t){this.client=e,this.clock=t}},qn=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,qe=(o,e)=>new hs(o,e);var $g=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw Mr()};var xl=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let s=(n,a)=>{let i=n.get("ds"),l=n.get("ids"),c=u=>this.clients.set(u,a);i.observe(u=>{u.changes.added.forEach(d=>{d.content.getContent().forEach(m=>{m instanceof Uint8Array&&this.dss.set(a,eu([this.dss.get(a)||gu(),ti(new Wn(Jr(m)))]))})})}),this.dss.set(a,eu(i.map(u=>ti(new Wn(Jr(u)))))),l.observe(u=>u.changes.added.forEach(d=>d.content.getContent().forEach(c))),l.forEach(c)};t.observe(n=>{n.keysChanged.forEach(a=>s(t.get(a),a))}),t.forEach(s)}setUserMapping(e,t,r,{filter:s=()=>!0}={}){let n=this.yusers,a=n.get(r);a||(a=new Uo,a.set("ids",new po),a.set("ds",new po),n.set(r,a)),a.get("ids").push([t]),n.observe(i=>{setTimeout(()=>{let l=n.get(r);if(l!==a){a=l,this.clients.forEach((d,m)=>{r===d&&a.get("ids").push([m])});let c=new zn,u=this.dss.get(r);u&&(gs(c,u),a.get("ds").push([c.toUint8Array()]))}},0)}),e.on("afterTransaction",i=>{setTimeout(()=>{let l=a.get("ds"),c=i.deleteSet;if(i.local&&c.clients.size>0&&s(i,c)){let u=new zn;gs(u,c),l.push([u.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(mu(r,e))return t;return null}},bl=class{constructor(e,t,r,s=0){this.type=e,this.tname=t,this.item=r,this.assoc=s}};var xu=o=>new bl(o.type==null?null:qe(o.type.client,o.type.clock),o.tname||null,o.item==null?null:qe(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),ou=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},gC=(o,e,t=0)=>new ou(o,e,t),cl=(o,e,t)=>{let r=null,s=null;return o._item===null?s=$g(o):r=qe(o._item.id.client,o._item.id.clock),new bl(r,s,e,t)},bu=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return cl(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return cl(o,qe(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return cl(o,r.lastId,t);r=r.right}return cl(o,null,t)};var vu=(o,e)=>{let t=e.store,r=o.item,s=o.type,n=o.tname,a=o.assoc,i=null,l=0;if(r!==null){if(Pt(t,r.client)<=r.clock)return null;let c=Dg(t,r),u=c.item;if(!(u instanceof xt))return null;if(i=u.parent,i._item===null||!i._item.deleted){l=u.deleted||!u.countable?0:c.diff+(a>=0?0:1);let d=u.left;for(;d!==null;)!d.deleted&&d.countable&&(l+=d.length),d=d.left}}else{if(n!==null)i=e.get(n);else if(s!==null){if(Pt(t,s.client)<=s.clock)return null;let{item:c}=Dg(t,s);if(c instanceof xt&&c.content instanceof Rr)i=c.content.type;else return null}else throw Mr();a>=0?l=i._length:l=0}return gC(i,l,o.assoc)},wu=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&qn(o.item,e.item)&&qn(o.type,e.type)&&o.assoc===e.assoc,su=class{constructor(e,t){this.ds=e,this.sv=t}};var yC=(o,e)=>new su(o,e),kR=yC(gu(),new Map);var Vn=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!mu(e.ds,o.id),nu=(o,e)=>{let t=zr(o.meta,nu,lo),r=o.doc.store;t.has(e)||(e.sv.forEach((s,n)=>{s<Pt(r,n)&&xs(o,qe(n,s))}),Fg(o,e.ds,s=>{}),t.add(e))};var vl=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},Cl=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let s=t[t.length-1];e.set(r,s.id.clock+s.length)}),e},Pt=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},Bg=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Mr()}t.push(e)},mo=(o,e)=>{let t=0,r=o.length-1,s=o[r],n=s.id.clock;if(n===e)return r;let a=pr(e/(n+s.length-1)*r);for(;t<=r;){if(s=o[a],n=s.id.clock,n<=e){if(e<n+s.length)return a;t=a+1}else r=a-1;a=pr((t+r)/2)}throw Mr()},xC=(o,e)=>{let t=o.clients.get(e.client);return t[mo(t,e.clock)]},dl=xC,au=(o,e,t)=>{let r=mo(e,t),s=e[r];return s.id.clock<t&&s instanceof xt?(e.splice(r+1,0,kl(o,s,t-s.id.clock)),r+1):r},xs=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[au(o,t,e.clock)]},Sg=(o,e,t)=>{let r=e.clients.get(t.client),s=mo(r,t.clock),n=r[s];return t.clock!==n.id.clock+n.length-1&&n.constructor!==mr&&r.splice(s+1,0,kl(o,n,t.clock-n.id.clock+1)),n},bC=(o,e,t)=>{let r=o.clients.get(e.id.client);r[mo(r,e.id.clock)]=t},Ng=(o,e,t,r,s)=>{if(r===0)return;let n=t+r,a=au(o,e,t),i;do i=e[a++],n<i.id.clock+i.length&&au(o,e,n),s(i);while(a<e.length&&e[a].id.clock<n)},iu=class{constructor(e,t,r){this.doc=e,this.deleteSet=new Js,this.beforeState=Cl(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},kg=(o,e)=>e.deleteSet.clients.size===0&&!Oh(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(hu(e.deleteSet),cC(o,e),gs(o,e.deleteSet),!0),Cg=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&zr(o.changed,e,lo).add(t)},pl=(o,e)=>{let t=o[e],r=o[e-1],s=e;for(;s>0;t=r,r=o[--s-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof xt&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let n=e-s;return n&&o.splice(e+1-n,n),n},vC=(o,e,t)=>{for(let[r,s]of o.clients.entries()){let n=e.clients.get(r);for(let a=s.length-1;a>=0;a--){let i=s[a],l=i.clock+i.len;for(let c=mo(n,i.clock),u=n[c];c<n.length&&u.id.clock<l;u=n[++c]){let d=n[c];if(i.clock+i.len<=d.id.clock)break;d instanceof xt&&d.deleted&&!d.keep&&t(d)&&d.gc(e,!1)}}}},wC=(o,e)=>{o.clients.forEach((t,r)=>{let s=e.clients.get(r);for(let n=t.length-1;n>=0;n--){let a=t[n],i=Pn(s.length-1,1+mo(s,a.clock+a.len-1));for(let l=i,c=s[l];l>0&&c.id.clock>=a.clock;c=s[l])l-=1+pl(s,l)}})};var Hg=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,s=r.store,n=t.deleteSet,a=t._mergeStructs;try{hu(n),t.afterState=Cl(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let i=[];t.changed.forEach((l,c)=>i.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),i.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=c,u._path=null}),l.sort((u,d)=>u.path.length-d.path.length),Ug(c._dEH,l,t))})}),i.push(()=>r.emit("afterTransaction",[t,r])),Ka(i,[]),t._needFormattingCleanup&&$C(t)}finally{r.gc&&vC(n,s,r.gcFilter),wC(n,s),t.afterState.forEach((u,d)=>{let m=t.beforeState.get(d)||0;if(m!==u){let g=s.clients.get(d),h=Gr(mo(g,m),1);for(let _=g.length-1;_>=h;)_-=1+pl(g,_)}});for(let u=a.length-1;u>=0;u--){let{client:d,clock:m}=a[u].id,g=s.clients.get(d),h=mo(g,m);h+1<g.length&&pl(g,h+1)>1||h>0&&pl(g,h)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(mg(Xa,Ya,"[yjs] ",Ja,Qa,"Changed the client-id because another client seems to be using it."),r.clientID=Ag()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let u=new Qs;kg(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let u=new Oo;kg(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}let{subdocsAdded:i,subdocsLoaded:l,subdocsRemoved:c}=t;(i.size>0||c.size>0||l.size>0)&&(i.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),c.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:i,removed:c},r,t]),c.forEach(u=>u.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):Hg(o,e+1)}}},Xe=(o,e,t=null,r=!0)=>{let s=o._transactionCleanups,n=!1,a=null;o._transaction===null&&(n=!0,o._transaction=new iu(o,t,r),s.push(o._transaction),s.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{a=e(o._transaction)}finally{if(n){let i=o._transaction===s[0];o._transaction=null,i&&Hg(s,0)}}return a};function*_C(o){let e=Ee(o.restDecoder);for(let t=0;t<e;t++){let r=Ee(o.restDecoder),s=o.readClient(),n=Ee(o.restDecoder);for(let a=0;a<r;a++){let i=o.readInfo();if(i===10){let l=Ee(o.restDecoder);yield new hr(qe(s,n),l),n+=l}else if(31&i){let l=(i&192)===0,c=new xt(qe(s,n),null,(i&128)===128?o.readLeftID():null,null,(i&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(i&32)===32?o.readString():null,ny(o,i));yield c,n+=c.length}else{let l=o.readLen();yield new mr(qe(s,n),l),n+=l}}}}var ri=class{constructor(e,t){this.gen=_C(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===hr);return this.curr}};var oi=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},SC=o=>wl(o,gl,Qs);var kC=(o,e)=>{if(o.constructor===mr){let{client:t,clock:r}=o.id;return new mr(qe(t,r+e),o.length-e)}else if(o.constructor===hr){let{client:t,clock:r}=o.id;return new hr(qe(t,r+e),o.length-e)}else{let t=o,{client:r,clock:s}=t.id;return new xt(qe(r,s+e),null,qe(r,s+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},wl=(o,e=ys,t=Oo)=>{if(o.length===1)return o[0];let r=o.map(u=>new e(Jr(u))),s=r.map(u=>new ri(u,!0)),n=null,a=new t,i=new oi(a);for(;s=s.filter(m=>m.curr!==null),s.sort((m,g)=>{if(m.curr.id.client===g.curr.id.client){let h=m.curr.id.clock-g.curr.id.clock;return h===0?m.curr.constructor===g.curr.constructor?0:m.curr.constructor===hr?1:-1:h}else return g.curr.id.client-m.curr.id.client}),s.length!==0;){let u=s[0],d=u.curr.id.client;if(n!==null){let m=u.curr,g=!1;for(;m!==null&&m.id.clock+m.length<=n.struct.id.clock+n.struct.length&&m.id.client>=n.struct.id.client;)m=u.next(),g=!0;if(m===null||m.id.client!==d||g&&m.id.clock>n.struct.id.clock+n.struct.length)continue;if(d!==n.struct.id.client)ps(i,n.struct,n.offset),n={struct:m,offset:0},u.next();else if(n.struct.id.clock+n.struct.length<m.id.clock)if(n.struct.constructor===hr)n.struct.length=m.id.clock+m.length-n.struct.id.clock;else{ps(i,n.struct,n.offset);let h=m.id.clock-n.struct.id.clock-n.struct.length;n={struct:new hr(qe(d,n.struct.id.clock+n.struct.length),h),offset:0}}else{let h=n.struct.id.clock+n.struct.length-m.id.clock;h>0&&(n.struct.constructor===hr?n.struct.length-=h:m=kC(m,h)),n.struct.mergeWith(m)||(ps(i,n.struct,n.offset),n={struct:m,offset:0},u.next())}}else n={struct:u.curr,offset:0},u.next();for(let m=u.curr;m!==null&&m.id.client===d&&m.id.clock===n.struct.id.clock+n.struct.length&&m.constructor!==hr;m=u.next())ps(i,n.struct,n.offset),n={struct:m,offset:0}}n!==null&&(ps(i,n.struct,n.offset),n=null),_u(i);let l=r.map(u=>ti(u)),c=eu(l);return gs(a,c),a.toUint8Array()},CC=(o,e,t=ys,r=Oo)=>{let s=Eg(e),n=new r,a=new oi(n),i=new t(Jr(o)),l=new ri(i,!1);for(;l.curr;){let u=l.curr,d=u.id.client,m=s.get(d)||0;if(l.curr.constructor===hr){l.next();continue}if(u.id.clock+u.length>m)for(ps(a,u,Gr(m-u.id.clock,0)),l.next();l.curr&&l.curr.id.client===d;)ps(a,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===d&&l.curr.id.clock+l.curr.length<=m;)l.next()}_u(a);let c=ti(i);return gs(n,c),n.toUint8Array()};var Vg=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:vr(o.encoder.restEncoder)}),o.encoder.restEncoder=Ks(),o.written=0)},ps=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&Vg(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),Re(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},_u=o=>{Vg(o);let e=o.encoder.restEncoder;Re(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];Re(e,r.written),Va(e,r.restEncoder)}},IC=(o,e,t,r)=>{let s=new t(Jr(o)),n=new ri(s,!1),a=new r,i=new oi(a);for(let c=n.curr;c!==null;c=n.next())ps(i,e(c),0);_u(i);let l=ti(s);return gs(a,l),a.toUint8Array()};var LC=o=>IC(o,og,ys,Qs),Ig="You must not compute changes after the event-handler fired.",Kn=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=TC(this.currentTarget,this.target))}deletes(e){return mu(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ar(Ig);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(s=>{if(s!==null){let n=t._map.get(s),a,i;if(this.adds(n)){let l=n.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(n))if(l!==null&&this.deletes(l))a="delete",i=Zi(l.content.getContent());else return;else l!==null&&this.deletes(l)?(a="update",i=Zi(l.content.getContent())):(a="add",i=void 0)}else if(this.deletes(n))a="delete",i=Zi(n.content.getContent());else return;e.set(s,{action:a,oldValue:i})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ar(Ig);let t=this.target,r=lo(),s=lo(),n=[];if(e={added:r,deleted:s,delta:n,keys:this.keys},this.transaction.changed.get(t).has(null)){let i=null,l=()=>{i&&n.push(i)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((i===null||i.delete===void 0)&&(l(),i={delete:0}),i.delete+=c.length,s.add(c)):this.adds(c)?((i===null||i.insert===void 0)&&(l(),i={insert:[]}),i.insert=i.insert.concat(c.content.getContent()),r.add(c)):((i===null||i.retain===void 0)&&(l(),i={retain:0}),i.retain+=c.length);i!==null&&i.retain===void 0&&l()}this._changes=e}return e}},TC=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)s.deleted||r++,s=s.right;t.unshift(r)}e=e._item.parent}return t},qg=80,Su=0,lu=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Su++}},PC=o=>{o.timestamp=Su++},Wg=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=Su++},DC=(o,e,t)=>{if(o.length>=qg){let r=o.reduce((s,n)=>s.timestamp<n.timestamp?s:n);return Wg(r,e,t),r}else{let r=new lu(e,t);return o.push(r),r}},Il=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((n,a)=>Tn(e-n.index)<Tn(e-a.index)?n:a),r=o._start,s=0;for(t!==null&&(r=t.p,s=t.index,PC(t));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return t!==null&&Tn(t.index-s)<r.parent.length/qg?(Wg(t,r,s),t):DC(o._searchMarker,r,s)},si=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let s=o[r];if(t>0){let n=s.p;for(n.marker=!1;n&&(n.deleted||!n.countable);)n=n.left,n&&!n.deleted&&n.countable&&(s.index-=n.length);if(n===null||n.marker===!0){o.splice(r,1);continue}s.p=n,n.marker=!0}(e<s.index||t>0&&e===s.index)&&(s.index=Gr(e,s.index+t))}};var Ll=(o,e,t)=>{let r=o,s=e.changedParentTypes;for(;zr(s,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;Ug(r._eH,t,e)},Mt=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=vg(),this._dEH=vg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw jr()}clone(){throw jr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){wg(this._eH,e)}observeDeep(e){wg(this._dEH,e)}unobserve(e){_g(this._eH,e)}unobserveDeep(e){_g(this._dEH,e)}toJSON(){}},zg=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,s=[],n=o._start;for(;n!==null&&r>0;){if(n.countable&&!n.deleted){let a=n.content.getContent();if(a.length<=e)e-=a.length;else{for(let i=e;i<a.length&&r>0;i++)s.push(a[i]),r--;e=0}}n=n.right}return s},Kg=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}t=t.right}return e};var ni=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let s=r.content.getContent();for(let n=0;n<s.length;n++)e(s[n],t++,o)}r=r.right}},Gg=(o,e)=>{let t=[];return ni(o,(r,s)=>{t.push(e(r,s,o))}),t},FC=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let s=t[r++];return t.length<=r&&(t=null),{done:!1,value:s}}}},jg=(o,e)=>{let t=Il(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},_l=(o,e,t,r)=>{let s=t,n=o.doc,a=n.clientID,i=n.store,l=t===null?e._start:t.right,c=[],u=()=>{c.length>0&&(s=new xt(qe(a,Pt(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new No(c)),s.integrate(o,0),c=[])};r.forEach(d=>{if(d===null)c.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(d);break;default:switch(u(),d.constructor){case Uint8Array:case ArrayBuffer:s=new xt(qe(a,Pt(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Xs(new Uint8Array(d))),s.integrate(o,0);break;case wr:s=new xt(qe(a,Pt(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new en(d)),s.integrate(o,0);break;default:if(d instanceof Mt)s=new xt(qe(a,Pt(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Rr(d)),s.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Yg=()=>Ar("Length exceeded!"),Jg=(o,e,t,r)=>{if(t>e._length)throw Yg();if(t===0)return e._searchMarker&&si(e._searchMarker,t,r.length),_l(o,e,null,r);let s=t,n=Il(e,t),a=e._start;for(n!==null&&(a=n.p,t-=n.index,t===0&&(a=a.prev,t+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(t<=a.length){t<a.length&&xs(o,qe(a.id.client,a.id.clock+t));break}t-=a.length}return e._searchMarker&&si(e._searchMarker,s,r.length),_l(o,e,a,r)},AC=(o,e,t)=>{let s=(e._searchMarker||[]).reduce((n,a)=>a.index>n.index?a:n,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return _l(o,e,s,t)},Qg=(o,e,t,r)=>{if(r===0)return;let s=t,n=r,a=Il(e,t),i=e._start;for(a!==null&&(i=a.p,t-=a.index);i!==null&&t>0;i=i.right)!i.deleted&&i.countable&&(t<i.length&&xs(o,qe(i.id.client,i.id.clock+t)),t-=i.length);for(;r>0&&i!==null;)i.deleted||(r<i.length&&xs(o,qe(i.id.client,i.id.clock+r)),i.delete(o),r-=i.length),i=i.right;if(r>0)throw Yg();e._searchMarker&&si(e._searchMarker,s,-n+r)},Sl=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},ku=(o,e,t,r)=>{let s=e._map.get(t)||null,n=o.doc,a=n.clientID,i;if(r==null)i=new No([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:i=new No([r]);break;case Uint8Array:i=new Xs(r);break;case wr:i=new en(r);break;default:if(r instanceof Mt)i=new Rr(r);else throw new Error("Unexpected content type")}new xt(qe(a,Pt(n.store,a)),s,s&&s.lastId,null,null,e,t,i).integrate(o,0)},Cu=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},Xg=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Zg=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var MC=(o,e)=>{let t={};return o._map.forEach((r,s)=>{let n=r;for(;n!==null&&(!e.sv.has(n.id.client)||n.id.clock>=(e.sv.get(n.id.client)||0));)n=n.left;n!==null&&Vn(n,e)&&(t[s]=n.content.getContent()[n.length-1])}),t},fl=o=>gg(o.entries(),e=>!e[1].deleted),cu=class extends Kn{constructor(e,t){super(e,t),this._transaction=t}},po=class extends Mt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new po;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new po}clone(){let e=new po;return e.insert(0,this.toArray().map(t=>t instanceof Mt?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),Ll(this,e,new cu(this,e))}insert(e,t){this.doc!==null?Xe(this.doc,r=>{Jg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Xe(this.doc,t=>{AC(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Xe(this.doc,r=>{Qg(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return jg(this,e)}toArray(){return Kg(this)}slice(e=0,t=this.length){return zg(this,e,t)}toJSON(){return this.map(e=>e instanceof Mt?e.toJSON():e)}map(e){return Gg(this,e)}forEach(e){ni(this,e)}[Symbol.iterator](){return FC(this)}_write(e){e.writeTypeRef(eI)}},EC=o=>new po,fu=class extends Kn{constructor(e,t,r){super(e,t),this.keysChanged=r}},Uo=class extends Mt{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new Uo}clone(){let e=new Uo;return this.forEach((t,r)=>{e.set(r,t instanceof Mt?t.clone():t)}),e}_callObserver(e,t){Ll(this,e,new fu(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let s=t.content.getContent()[t.length-1];e[r]=s instanceof Mt?s.toJSON():s}}),e}get size(){return[...fl(this._map)].length}keys(){return ll(fl(this._map),e=>e[0])}values(){return ll(fl(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return ll(fl(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Xe(this.doc,t=>{Sl(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Xe(this.doc,r=>{ku(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return Cu(this,e)}has(e){return Zg(this,e)}clear(){this.doc!==null?Xe(this.doc,e=>{this.forEach(function(t,r,s){Sl(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(tI)}},RC=o=>new Uo,ms=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&Vf(o,e),ai=class{constructor(e,t,r,s){this.left=e,this.right=t,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Mr(),this.right.content.constructor){case It:this.right.deleted||Jn(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},Lg=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case It:e.right.deleted||Jn(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&xs(o,qe(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},ul=(o,e,t,r)=>{let s=new Map,n=r?Il(e,t):null;if(n){let a=new ai(n.p.left,n.p,n.index,s);return Lg(o,a,t-n.index)}else{let a=new ai(null,e._start,0,s);return Lg(o,a,t)}},ey=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===It&&ms(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let s=o.doc,n=s.clientID;r.forEach((a,i)=>{let l=t.left,c=t.right,u=new xt(qe(n,Pt(s.store,n)),l,l&&l.lastId,c,c&&c.id,e,null,new It(i,a));u.integrate(o,0),t.right=u,t.forward()})},Jn=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},ty=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===It&&ms((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},ry=(o,e,t,r)=>{var i;let s=o.doc,n=s.clientID,a=new Map;for(let l in r){let c=r[l],u=(i=t.currentAttributes.get(l))!=null?i:null;if(!ms(u,c)){a.set(l,u);let{left:d,right:m}=t;t.right=new xt(qe(n,Pt(s.store,n)),d,d&&d.lastId,m,m&&m.id,e,null,new It(l,c)),t.right.integrate(o,0),t.forward()}}return a},Zf=(o,e,t,r,s)=>{t.currentAttributes.forEach((m,g)=>{s[g]===void 0&&(s[g]=null)});let n=o.doc,a=n.clientID;ty(t,s);let i=ry(o,e,t,s),l=r.constructor===String?new Er(r):r instanceof Mt?new Rr(r):new Bo(r),{left:c,right:u,index:d}=t;e._searchMarker&&si(e._searchMarker,t.index,l.getLength()),u=new xt(qe(a,Pt(n.store,a)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(o,0),t.right=u,t.index=d,t.forward(),ey(o,e,t,i)},Tg=(o,e,t,r,s)=>{let n=o.doc,a=n.clientID;ty(t,s);let i=ry(o,e,t,s);e:for(;t.right!==null&&(r>0||i.size>0&&(t.right.deleted||t.right.content.constructor===It));){if(!t.right.deleted)switch(t.right.content.constructor){case It:{let{key:l,value:c}=t.right.content,u=s[l];if(u!==void 0){if(ms(u,c))i.delete(l);else{if(r===0)break e;i.set(l,c)}t.right.delete(o)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&xs(o,qe(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new xt(qe(a,Pt(n.store,a)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Er(l)),t.right.integrate(o,0),t.forward()}ey(o,e,t,i)},oy=(o,e,t,r,s)=>{var c,u;let n=e,a=Ot();for(;n&&(!n.countable||n.deleted);){if(!n.deleted&&n.content.constructor===It){let d=n.content;a.set(d.key,d)}n=n.right}let i=0,l=!1;for(;e!==n;){if(t===e&&(l=!0),!e.deleted){let d=e.content;switch(d.constructor){case It:{let{key:m,value:g}=d,h=(c=r.get(m))!=null?c:null;(a.get(m)!==d||h===g)&&(e.delete(o),i++,!l&&((u=s.get(m))!=null?u:null)===g&&h!==g&&(h===null?s.delete(m):s.set(m,h))),!l&&!e.deleted&&Jn(s,d);break}}}e=e.right}return i},OC=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===It){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},UC=o=>{let e=0;return Xe(o.doc,t=>{let r=o._start,s=o._start,n=Ot(),a=Xi(n);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case It:Jn(a,s.content);break;default:e+=oy(t,r,s,n,a),n=Xi(a),r=s;break}s=s.right}}),e},$C=o=>{let e=new Set,t=o.doc;for(let[r,s]of o.afterState.entries()){let n=o.beforeState.get(r)||0;s!==n&&Ng(o,t.store.clients.get(r),n,s,a=>{!a.deleted&&a.content.constructor===It&&a.constructor!==mr&&e.add(a.parent)})}Xe(t,r=>{Fg(o,o.deleteSet,s=>{if(s instanceof mr||!s.parent._hasFormatting||e.has(s.parent))return;let n=s.parent;s.content.constructor===It?e.add(n):OC(r,s)});for(let s of e)UC(s)})},Pg=(o,e,t)=>{let r=t,s=Xi(e.currentAttributes),n=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Rr:case Bo:case Er:t<e.right.length&&xs(o,qe(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}n&&oy(o,n,e.right,s,e.currentAttributes);let a=(e.left||e.right).parent;return a._searchMarker&&si(a._searchMarker,e.index,-r+t),e},uu=class extends Kn{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];Xe(e,r=>{var g,h,_;let s=new Map,n=new Map,a=this.target._start,i=null,l={},c="",u=0,d=0,m=()=>{if(i!==null){let w=null;switch(i){case"delete":d>0&&(w={delete:d}),d=0;break;case"insert":(typeof c=="object"||c.length>0)&&(w={insert:c},s.size>0&&(w.attributes={},s.forEach((v,A)=>{v!==null&&(w.attributes[A]=v)}))),c="";break;case"retain":u>0&&(w={retain:u},tg(l)||(w.attributes=Zh({},l))),u=0;break}w&&t.push(w),i=null}};for(;a!==null;){switch(a.content.constructor){case Rr:case Bo:this.adds(a)?this.deletes(a)||(m(),i="insert",c=a.content.getContent()[0],m()):this.deletes(a)?(i!=="delete"&&(m(),i="delete"),d+=1):a.deleted||(i!=="retain"&&(m(),i="retain"),u+=1);break;case Er:this.adds(a)?this.deletes(a)||(i!=="insert"&&(m(),i="insert"),c+=a.content.str):this.deletes(a)?(i!=="delete"&&(m(),i="delete"),d+=a.length):a.deleted||(i!=="retain"&&(m(),i="retain"),u+=a.length);break;case It:{let{key:w,value:v}=a.content;if(this.adds(a)){if(!this.deletes(a)){let A=(g=s.get(w))!=null?g:null;ms(A,v)?v!==null&&a.delete(r):(i==="retain"&&m(),ms(v,(h=n.get(w))!=null?h:null)?delete l[w]:l[w]=v)}}else if(this.deletes(a)){n.set(w,v);let A=(_=s.get(w))!=null?_:null;ms(A,v)||(i==="retain"&&m(),l[w]=A)}else if(!a.deleted){n.set(w,v);let A=l[w];A!==void 0&&(ms(A,v)?A!==null&&a.delete(r):(i==="retain"&&m(),v===null?delete l[w]:l[w]=v))}a.deleted||(i==="insert"&&m(),Jn(s,a.content));break}}a=a.right}for(m();t.length>0;){let w=t[t.length-1];if(w.retain!==void 0&&w.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},bs=class extends Mt{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new bs}clone(){let e=new bs;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new uu(this,e,t);Ll(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Er&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Xe(this.doc,r=>{let s=new ai(null,this._start,0,new Map);for(let n=0;n<e.length;n++){let a=e[n];if(a.insert!==void 0){let i=!t&&typeof a.insert=="string"&&n===e.length-1&&s.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof i!="string"||i.length>0)&&Zf(r,this,s,i,a.attributes||{})}else a.retain!==void 0?Tg(r,this,s,a.retain,a.attributes||{}):a.delete!==void 0&&Pg(r,s,a.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let s=[],n=new Map,a=this.doc,i="",l=this._start;function c(){if(i.length>0){let d={},m=!1;n.forEach((h,_)=>{m=!0,d[_]=h});let g={insert:i};m&&(g.attributes=d),s.push(g),i=""}}let u=()=>{for(;l!==null;){if(Vn(l,e)||t!==void 0&&Vn(l,t))switch(l.content.constructor){case Er:{let d=n.get("ychange");e!==void 0&&!Vn(l,e)?(d===void 0||d.user!==l.id.client||d.type!=="removed")&&(c(),n.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!Vn(l,t)?(d===void 0||d.user!==l.id.client||d.type!=="added")&&(c(),n.set("ychange",r?r("added",l.id):{type:"added"})):d!==void 0&&(c(),n.delete("ychange")),i+=l.content.str;break}case Rr:case Bo:{c();let d={insert:l.content.getContent()[0]};if(n.size>0){let m={};d.attributes=m,n.forEach((g,h)=>{m[h]=g})}s.push(d);break}case It:Vn(l,e)&&(c(),Jn(n,l.content));break}l=l.right}c()};return e||t?Xe(a,d=>{e&&nu(d,e),t&&nu(d,t),u()},"cleanup"):u(),s}insert(e,t,r){if(t.length<=0)return;let s=this.doc;s!==null?Xe(s,n=>{let a=ul(n,this,e,!r);r||(r={},a.currentAttributes.forEach((i,l)=>{r[l]=i})),Zf(n,this,a,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let s=this.doc;s!==null?Xe(s,n=>{let a=ul(n,this,e,!r);Zf(n,this,a,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?Xe(r,s=>{Pg(s,ul(s,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let s=this.doc;s!==null?Xe(s,n=>{let a=ul(n,this,e,!1);a.right!==null&&Tg(n,this,a,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Xe(this.doc,t=>{Sl(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Xe(this.doc,r=>{ku(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return Cu(this,e)}getAttributes(){return Xg(this)}_write(e){e.writeTypeRef(rI)}},BC=o=>new bs,Za=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===vs||t.constructor===$o)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},$o=class extends Mt{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new $o}clone(){let e=new $o;return e.insert(0,this.toArray().map(t=>t instanceof Mt?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Za(this,e)}querySelector(e){e=e.toUpperCase();let r=new Za(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Kr(new Za(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Ll(this,e,new du(this,t,e))}toString(){return Gg(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),ni(this,n=>{s.insertBefore(n.toDOM(e,t,r),null)}),s}insert(e,t){this.doc!==null?Xe(this.doc,r=>{Jg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Xe(this.doc,r=>{let s=e&&e instanceof Mt?e._item:e;_l(r,this,s,t)});else{let r=this._prelimContent,s=e===null?0:r.findIndex(n=>n===e)+1;if(s===0&&e!==null)throw Ar("Reference item not found");r.splice(s,0,...t)}}delete(e,t=1){this.doc!==null?Xe(this.doc,r=>{Qg(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return Kg(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return jg(this,e)}slice(e=0,t=this.length){return zg(this,e,t)}forEach(e){ni(this,e)}_write(e){e.writeTypeRef(sI)}},NC=o=>new $o,vs=class extends $o{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new vs(this.nodeName)}clone(){let e=new vs(this.nodeName),t=this.getAttributes();return eg(t,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof Mt?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let i in e)r.push(i);r.sort();let s=r.length;for(let i=0;i<s;i++){let l=r[i];t.push(l+'="'+e[l]+'"')}let n=this.nodeName.toLocaleLowerCase(),a=t.length>0?" "+t.join(" "):"";return`<${n}${a}>${super.toString()}</${n}>`}removeAttribute(e){this.doc!==null?Xe(this.doc,t=>{Sl(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Xe(this.doc,r=>{ku(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return Cu(this,e)}hasAttribute(e){return Zg(this,e)}getAttributes(e){return e?MC(this,e):Xg(this)}toDOM(e=document,t={},r){let s=e.createElement(this.nodeName),n=this.getAttributes();for(let a in n){let i=n[a];typeof i=="string"&&s.setAttribute(a,i)}return ni(this,a=>{s.appendChild(a.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(oI),e.writeKey(this.nodeName)}},HC=o=>new vs(o.readKey()),du=class extends Kn{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}},Gn=class extends Uo{constructor(e){super(),this.hookName=e}_copy(){return new Gn(this.hookName)}clone(){let e=new Gn(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let s=t[this.hookName],n;return s!==void 0?n=s.createDom(this):n=document.createElement(this.hookName),n.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(nI),e.writeKey(this.hookName)}},VC=o=>new Gn(o.readKey()),jn=class extends bs{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new jn}clone(){let e=new jn;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let s=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{let t=[];for(let s in e.attributes){let n=[];for(let a in e.attributes[s])n.push({key:a,value:e.attributes[s][a]});n.sort((a,i)=>a.key<i.key?-1:1),t.push({nodeName:s,attrs:n})}t.sort((s,n)=>s.nodeName<n.nodeName?-1:1);let r="";for(let s=0;s<t.length;s++){let n=t[s];r+=`<${n.nodeName}`;for(let a=0;a<n.attrs.length;a++){let i=n.attrs[a];r+=` ${i.key}="${i.value}"`}r+=">"}r+=e.insert;for(let s=t.length-1;s>=0;s--)r+=`</${t[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(aI)}},qC=o=>new jn,ii=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw jr()}mergeWith(e){return!1}write(e,t,r){throw jr()}integrate(e,t){throw jr()}},WC=0,mr=class extends ii{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),Bg(e.doc.store,this)}write(e,t){e.writeInfo(WC),e.writeLen(this.length-t)}getMissing(e,t){return null}},Xs=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Xs(this.content)}splice(e){throw jr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},zC=o=>new Xs(o.readBuf()),Zs=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Zs(this.len)}splice(e){let t=new Zs(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){hl(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},KC=o=>new Zs(o.readLen()),sy=(o,e)=>new wr({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),en=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new en(sy(this.doc.guid,this.opts))}splice(e){throw jr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},GC=o=>new en(sy(o.readString(),o.readAny())),Bo=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Bo(this.embed)}splice(e){throw jr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},jC=o=>new Bo(o.readJSON()),It=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new It(this.key,this.value)}splice(e){throw jr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},YC=o=>new It(o.readKey(),o.readJSON()),Yn=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Yn(this.arr)}splice(e){let t=new Yn(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let n=this.arr[s];e.writeString(n===void 0?"undefined":JSON.stringify(n))}}getRef(){return 2}},JC=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let s=o.readString();s==="undefined"?t.push(void 0):t.push(JSON.parse(s))}return new Yn(t)},No=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new No(this.arr)}splice(e){let t=new No(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let n=this.arr[s];e.writeAny(n)}}getRef(){return 8}},QC=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new No(t)},Er=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Er(this.str)}splice(e){let t=new Er(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},XC=o=>new Er(o.readString()),ZC=[EC,RC,BC,HC,NC,VC,qC],eI=0,tI=1,rI=2,oI=3,sI=4,nI=5,aI=6,Rr=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Rr(this.type._copy())}splice(e){throw jr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},iI=o=>new Rr(ZC[o.readTypeRef()](o)),Dg=(o,e)=>{let t=e,r=0,s;do r>0&&(t=qe(t.client,t.clock+r)),s=dl(o,t),r=t.clock-s.id.clock,t=s.redone;while(t!==null&&s instanceof xt);return{item:s,diff:r}};var kl=(o,e,t)=>{let{client:r,clock:s}=e.id,n=new xt(qe(r,s+t),e,qe(r,s+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&n.markDeleted(),e.keep&&(n.keep=!0),e.redone!==null&&(n.redone=qe(e.redone.client,e.redone.clock+t)),e.right=n,n.right!==null&&(n.right.left=n),o._mergeStructs.push(n),n.parentSub!==null&&n.right===null&&n.parent._map.set(n.parentSub,n),e.length=t,n};var xt=class extends ii{constructor(e,t,r,s,n,a,i,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=s,this.rightOrigin=n,this.parent=a,this.parentSub=i,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Pt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Pt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===hs&&this.id.client!==this.parent.client&&this.parent.clock>=Pt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Sg(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=xs(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===mr||this.right&&this.right.constructor===mr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===xt&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===xt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===hs){let r=dl(t,this.parent);r.constructor===mr?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=Sg(e,e.doc.store,qe(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;let n=new Set,a=new Set;for(;s!==null&&s!==this.right;){if(a.add(s),n.add(s),qn(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,n.clear();else if(qn(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&a.has(dl(e.doc.store,s.origin)))n.has(dl(e.doc.store,s.origin))||(r=s,n.clear());else break;s=s.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Bg(e.doc.store,this),this.content.integrate(e,this),Cg(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new mr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:qe(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&qn(e.origin,this.lastId)&&this.right===e&&qn(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),hl(e.deleteSet,this.id.client,this.id.clock,this.length),Cg(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Mr();this.content.gc(e),t?bC(e,this,new mr(this.id,this.length)):this.content=new Zs(this.length)}write(e,t){let r=t>0?qe(this.id.client,this.id.clock+t-1):this.origin,s=this.rightOrigin,n=this.parentSub,a=this.content.getRef()&31|(r===null?0:128)|(s===null?0:64)|(n===null?0:32);if(e.writeInfo(a),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){let i=this.parent;if(i._item!==void 0){let l=i._item;if(l===null){let c=$g(i);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else i.constructor===String?(e.writeParentInfo(!0),e.writeString(i)):i.constructor===hs?(e.writeParentInfo(!1),e.writeLeftID(i)):Mr();n!==null&&e.writeString(n)}this.content.write(e,t)}},ny=(o,e)=>lI[e&31](o),lI=[()=>{Mr()},KC,JC,zC,XC,jC,YC,iI,QC,GC,()=>{Mr()}],cI=10,hr=class extends ii{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Mr()}write(e,t){e.writeInfo(cI),Re(e.restEncoder,this.length-t)}getMissing(e,t){return null}},ay=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},iy="__ $YJS$ __";ay[iy]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");ay[iy]=!0;var rn=o=>Ro((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),ly=(o,e)=>Ro((t,r)=>{let s=indexedDB.open(o);s.onupgradeneeded=n=>e(n.target.result),s.onerror=n=>r(Ar(n.target.error)),s.onsuccess=n=>{let a=n.target.result;a.onversionchange=()=>{a.close()},t(a)}}),cy=o=>rn(indexedDB.deleteDatabase(o)),fy=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),Or=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(s=>pI(r,s))},Ho=(o,e)=>rn(o.count(e)),uy=(o,e)=>rn(o.get(e)),Iu=(o,e)=>rn(o.delete(e)),dy=(o,e,t)=>rn(o.put(e,t));var Tl=(o,e)=>rn(o.add(e)),py=(o,e,t)=>rn(o.getAll(e,t));var fI=(o,e,t)=>{let r=null;return dI(o,e,s=>(r=s,!1),t).then(()=>r)},my=(o,e=null)=>fI(o,e,"prev");var uI=(o,e)=>Ro((t,r)=>{o.onerror=r,o.onsuccess=async s=>{let n=s.target.result;if(n===null||await e(n)===!1)return t();n.continue()}});var dI=(o,e,t,r="next")=>uI(o.openKeyCursor(e,r),s=>t(s.key)),pI=(o,e)=>o.objectStore(e);var hy=(o,e)=>IDBKeyRange.upperBound(o,e),gy=(o,e)=>IDBKeyRange.lowerBound(o,e);var Lu="custom",yy="updates",xy=500,by=(o,e=()=>{},t=()=>{})=>{let[r]=Or(o.db,[yy]);return py(r,gy(o._dbref,!1)).then(s=>{o._destroyed||(e(r),Xe(o.doc,()=>{s.forEach(n=>ho(o.doc,n))},o,!1),t(r))}).then(()=>my(r).then(s=>{o._dbref=s+1})).then(()=>Ho(r).then(s=>{o._dbsize=s})).then(()=>r)},mI=(o,e=!0)=>by(o).then(t=>{(e||o._dbsize>=xy)&&Tl(t,tn(o.doc)).then(()=>Iu(t,hy(o._dbref,!0))).then(()=>Ho(t).then(r=>{o._dbsize=r}))});var ws=class extends Ln{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=ly(e,r=>fy(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Ro(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,by(this,a=>Tl(a,tn(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,s)=>{if(this.db&&s!==this){let[n]=Or(this.db,[yy]);Tl(n,r),++this._dbsize>=xy&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{mI(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{cy(this.name)})}get(e){return this._db.then(t=>{let[r]=Or(t,[Lu],"readonly");return uy(r,e)})}set(e,t){return this._db.then(r=>{let[s]=Or(r,[Lu]);return dy(s,t,e)})}del(e){return this._db.then(t=>{let[r]=Or(t,[Lu]);return Iu(r,e)})}};var Ir=qs(Ba());var vy=0,Dl=1,wy=2,Fl=(o,e)=>{Re(o,vy);let t=Og(e);$t(o,t)},Tu=(o,e,t)=>{Re(o,Dl),$t(o,tn(e,t))},hI=(o,e,t)=>Tu(e,t,Wt(o)),_y=(o,e,t)=>{try{ho(e,Wt(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Sy=(o,e)=>{Re(o,wy),$t(o,e)},gI=_y,ky=(o,e,t,r)=>{let s=Ee(o);switch(s){case vy:hI(o,e,t);break;case Dl:_y(o,t,r);break;case wy:gI(o,t,r);break;default:throw new Error("Unknown message type")}return s};var xI=0;var Cy=(o,e,t)=>{switch(Ee(o)){case xI:t(e,Yr(o))}};var Pu=3e4,Al=class extends Ln{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=Ys();this.getLocalState()!==null&&Pu/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((s,n)=>{n!==this.clientID&&Pu<=t-s.lastUpdated&&this.states.has(n)&&r.push(n)}),r.length>0&&Ml(this,r,"timeout")},pr(Pu/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),s=r===void 0?0:r.clock+1,n=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:Ys()});let a=[],i=[],l=[],c=[];e===null?c.push(t):n==null?e!=null&&a.push(t):(i.push(t),Nn(n,e)||l.push(t)),(a.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:a,updated:l,removed:c},"local"]),this.emit("update",[{added:a,updated:i,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},Ml=(o,e,t)=>{let r=[];for(let s=0;s<e.length;s++){let n=e[s];if(o.states.has(n)){if(o.states.delete(n),n===o.clientID){let a=o.meta.get(n);o.meta.set(n,{clock:a.clock+1,lastUpdated:Ys()})}r.push(n)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},Xn=(o,e,t=o.states)=>{let r=e.length,s=Ks();Re(s,r);for(let n=0;n<r;n++){let a=e[n],i=t.get(a)||null,l=o.meta.get(a).clock;Re(s,a),Re(s,l),Eo(s,JSON.stringify(i))}return vr(s)};var Iy=(o,e,t)=>{let r=Jr(e),s=Ys(),n=[],a=[],i=[],l=[],c=Ee(r);for(let u=0;u<c;u++){let d=Ee(r),m=Ee(r),g=JSON.parse(Yr(r)),h=o.meta.get(d),_=o.states.get(d),w=h===void 0?0:h.clock;(w<m||w===m&&g===null&&o.states.has(d))&&(g===null?d===o.clientID&&o.getLocalState()!=null?m++:o.states.delete(d):o.states.set(d,g),o.meta.set(d,{clock:m,lastUpdated:s}),h===void 0&&g!==null?n.push(d):h!==void 0&&g===null?l.push(d):g!==null&&(Nn(g,_)||i.push(d),a.push(d)))}(n.length>0||i.length>0||l.length>0)&&o.emit("change",[{added:n,updated:i,removed:l},t]),(n.length>0||a.length>0||l.length>0)&&o.emit("update",[{added:n,updated:a,removed:l},t])};var ea=()=>new Map,Fy=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Ay=()=>new Set,wI=Array.from,TR=Array.isArray,My=String.fromCharCode,PR=String.fromCodePoint,DR=My(65535),_I=o=>o.toLowerCase(),SI=/^\s*/g,kI=o=>o.replace(SI,""),CI=/([A-Z])/g,Ly=(o,e)=>kI(o.replace(CI,t=>`${e}${_I(t)}`)),II=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},li=typeof TextEncoder!="undefined"?new TextEncoder:null,LI=o=>li.encode(o),TI=li?LI:II,Du=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Du&&Du.decode(new Uint8Array).length===1&&(Du=null);var Ty=o=>o===void 0?null:o,PI=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},Ey=new PI,Ou=!0;try{typeof localStorage!="undefined"&&(Ey=localStorage,Ou=!1)}catch(o){}var Ry=Ey,DI=o=>Ou||addEventListener("storage",o),FI=o=>Ou||removeEventListener("storage",o),AI=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},MI=(o,e)=>e.includes(o),oa=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),Oy=typeof window!="undefined"&&typeof document!="undefined"&&!oa,FR=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,go,EI=[],RI=()=>{if(go===void 0)if(oa){go=ea();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&go.set(e,""),e=r):e!==null?(go.set(e,r),e=null):EI.push(r)}e!==null&&go.set(e,"")}else typeof location=="object"?(go=ea(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");go.set(`--${Ly(e,"-")}`,t),go.set(`-${Ly(e,"-")}`,t)}})):go=ea();return go},Au=o=>RI().has(o),Mu=o=>Ty(oa?process.env[o.toUpperCase()]:Ry.getItem(o)),OI=o=>Au("--"+o)||Mu(o)!==null,AR=OI("production"),Py=oa&&MI(process.env.FORCE_COLOR,["true","1","2"]),MR=!Au("no-colors")&&(!oa||process.stdout.isTTY||Py)&&(!oa||Au("color")||Py||Mu("COLORTERM")!==null||(Mu("TERM")||"").includes("color")),Uy=Math.floor,$y=(o,e)=>o<e?o:e,UI=(o,e)=>o>e?o:e,ER=Number.isNaN,$I=Math.pow,By=128,BI=1<<17,NI=1<<18,HI=1<<19,VI=1<<20,qI=1<<21,WI=1<<22,zI=1<<23,KI=1<<24,GI=1<<25,jI=1<<26,YI=1<<27,JI=1<<28,QI=1<<29,XI=1<<30,RR=1<<31,El=127,OR=BI-1,UR=NI-1,$R=HI-1,BR=VI-1,NR=qI-1,HR=WI-1,VR=zI-1,qR=KI-1,WR=GI-1,zR=jI-1,KR=YI-1,GR=JI-1,jR=QI-1,YR=XI-1,ZI=Number.MAX_SAFE_INTEGER,JR=Number.MIN_SAFE_INTEGER,QR=1<<31,XR=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&Uy(o)===o),ZR=Number.isNaN,e3=Number.parseInt,eL=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Qr=()=>new eL,Uu=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},Ur=o=>{let e=new Uint8Array(Uu(o)),t=0;for(let r=0;r<o.bufs.length;r++){let s=o.bufs[r];e.set(s,t),t+=s.length}return e.set(Vy(o.cbuf.buffer,0,o.cpos),t),e},Rl=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},rr=(o,e)=>{for(;e>El;)Rl(o,By|El&e),e=Uy(e/128);Rl(o,El&e)},Eu=new Uint8Array(3e4),tL=Eu.length/3,rL=(o,e)=>{if(e.length<tL){let t=li.encodeInto(e,Eu).written||0;rr(o,t);for(let r=0;r<t;r++)Rl(o,Eu[r])}else ta(o,TI(e))},oL=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;rr(o,r);for(let s=0;s<r;s++)Rl(o,t.codePointAt(s))},t3=li&&li.encodeInto?rL:oL,sL=(o,e)=>{let t=o.cbuf.length,r=o.cpos,s=$y(t-r,e.length),n=e.length-s;o.cbuf.set(e.subarray(0,s),r),o.cpos+=s,n>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(UI(t*2,n)),o.cbuf.set(e.subarray(s)),o.cpos=n)},ta=(o,e)=>{rr(o,e.byteLength),sL(o,e)},r3=new DataView(new ArrayBuffer(4)),Ny=o=>new Error(o),nL=Ny("Unexpected end of array"),aL=Ny("Integer out of Range"),iL=class{constructor(o){this.arr=o,this.pos=0}},lL=o=>new iL(o),cL=(o,e)=>{let t=Vy(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},fL=o=>cL(o,Hy(o)),Hy=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let s=o.arr[o.pos++];if(e=e+(s&El)*t,t*=128,s<By)return e;if(e>ZI)throw aL}throw nL},uL=o=>new Uint8Array(o),Vy=(o,e,t)=>new Uint8Array(o,e,t),dL=o=>new Uint8Array(o),pL=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=My(o[t]);return btoa(e)},mL=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),hL=o=>{let e=atob(o),t=uL(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},gL=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},yL=Oy?pL:mL,xL=Oy?hL:gL,qy=new Map,bL=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:xL(e.newValue||"")}),DI(this._onChange)}postMessage(o){Ry.setItem(this.room,yL(dL(o)))}close(){FI(this._onChange)}},vL=typeof BroadcastChannel=="undefined"?bL:BroadcastChannel,$u=o=>Fy(qy,o,()=>{let e=Ay(),t=new vL(o);return t.onmessage=r=>e.forEach(s=>s(r.data,"broadcastchannel")),{bc:t,subs:e}}),wL=(o,e)=>($u(o).subs.add(e),e),_L=(o,e)=>{let t=$u(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),qy.delete(o)),r},Zn=(o,e,t=null)=>{let r=$u(o);r.bc.postMessage(e),r.subs.forEach(s=>s(e,t))},Ru=Date.now,SL=class{constructor(){this._observers=ea()}on(o,e){Fy(this._observers,o,Ay).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return wI((this._observers.get(o)||ea()).values()).forEach(t=>t(...e))}destroy(){this._observers=ea()}},kL=o=>AI(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),on=0,Wy=3,ra=1,CL=2,ci=[];ci[on]=(o,e,t,r,s)=>{rr(o,on);let n=ky(e,o,t.doc,t);r&&n===Dl&&!t.synced&&(t.synced=!0)};ci[Wy]=(o,e,t,r,s)=>{rr(o,ra),ta(o,Xn(t.awareness,Array.from(t.awareness.getStates().keys())))};ci[ra]=(o,e,t,r,s)=>{Iy(t.awareness,fL(e),t)};ci[CL]=(o,e,t,r,s)=>{Cy(e,t.doc,(n,a)=>IL(t,a))};var Dy=3e4,IL=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),zy=(o,e,t)=>{let r=lL(e),s=Qr(),n=Hy(r),a=o.messageHandlers[n];return a?a(s,r,o,t,n):console.error("Unable to compute message"),s},Ky=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=Ru();let r=zy(o,new Uint8Array(t.data),!0);Uu(r)>1&&e.send(Ur(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,Ml(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(Ky,$y($I(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=Ru(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=Qr();if(rr(t,on),Fl(t,o.doc),e.send(Ur(t)),o.awareness.getLocalState()!==null){let r=Qr();rr(r,ra),ta(r,Xn(o.awareness,[o.doc.clientID])),e.send(Ur(r))}},o.emit("status",[{status:"connecting"}])}},Fu=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&Zn(o.bcChannel,e,o)},Gy=class extends SL{constructor(o,e,t,{connect:r=!0,awareness:s=new Al(t),params:n={},WebSocketPolyfill:a=WebSocket,resyncInterval:i=-1,maxBackoffTime:l=2500,disableBc:c=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let u=kL(n);this.maxBackoffTime=l,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(u.length===0?"":"?"+u),this.roomname=e,this.doc=t,this._WS=a,this.awareness=s,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=c,this.wsUnsuccessfulReconnects=0,this.messageHandlers=ci.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,i>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let d=Qr();rr(d,on),Fl(d,t),this.ws.send(Ur(d))}},i)),this._bcSubscriber=(d,m)=>{if(m!==this){let g=zy(this,new Uint8Array(d),!1);Uu(g)>1&&Zn(this.bcChannel,Ur(g),this)}},this._updateHandler=(d,m)=>{if(m!==this){let g=Qr();rr(g,on),Sy(g,d),Fu(this,Ur(g))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:d,updated:m,removed:g},h)=>{let _=d.concat(m).concat(g),w=Qr();rr(w,ra),ta(w,Xn(s,_)),Fu(this,Ur(w))},this._unloadHandler=()=>{Ml(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),s.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var d;this.wsconnected&&Dy<Ru()-this.wsLastMessageReceived&&((d=this.ws)==null||d.close())},Dy/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(wL(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=Qr();rr(o,on),Fl(o,this.doc),Zn(this.bcChannel,Ur(o),this);let e=Qr();rr(e,on),Tu(e,this.doc),Zn(this.bcChannel,Ur(e),this);let t=Qr();rr(t,Wy),Zn(this.bcChannel,Ur(t),this);let r=Qr();rr(r,ra),ta(r,Xn(this.awareness,[this.doc.clientID])),Zn(this.bcChannel,Ur(r),this)}disconnectBc(){let o=Qr();rr(o,ra),ta(o,Xn(this.awareness,[this.doc.clientID],new Map)),Fu(this,Ur(o)),this.bcconnected&&(_L(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Ky(this),this.connectBc())}};var Bt=new WeakMap,jy=!1;function Ul(o){jy=o}var Xr={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3},or,sr,Ol=[];function Yy(o,e,t,r){sr=o,or=t,r&&(Xr={...Xr,...r}),e.setInterval(Bu,Xr.batchInterval)}async function Bu(){if(Ol.length===0)return;let o=[...Ol];Ol.length=0;for(let e=0;e<Xr.maxRetries;e++)try{await LL();let t=o.map(Jy).join(`
`)+`
`;await sr.append(or,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===Xr.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function LL(){let o=await sr.stat(or);if(o&&o.size>Xr.maxFileSize){for(let e=Xr.maxBackups;e>0;e--){let t=`${or}.${e}`,r=`${or}.${e+1}`;await sr.exists(t)&&(e===Xr.maxBackups?await sr.remove(t):await sr.rename(t,r))}await sr.exists(or)&&await sr.rename(or,`${or}.1`),await sr.write(or,"")}}function Jy(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}function TL(o,e){return e?t=>(o.notify(t.name+`
`+t.message),t):t=>(o.notify(t.name+`:
An error has occurred, please reload Obsidian.`),t)}var PL=["token","authorization","email","key"];function DL(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var s;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&PL.some(n=>t.toLowerCase().includes(n.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(s=r.stack)==null?void 0:s.split(`
`).map(n=>n.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function Pe(o,e="log"){return(...t)=>{if(jy){let r=new Date().toISOString(),s=new Error().stack,n=s?s.split(`
`)[2].trim():"",a=t.map(DL).join(" "),i={timestamp:r,level:e,message:`${o}: ${a}`,callerInfo:n};Xr.disableConsole||console[e](Jy(i)),Ol.push(i)}}}async function $l(){let o=[];await sr.exists(or)&&o.push(or);for(let e=1;e<=Xr.maxBackups;e++){let t=`${or}.${e}`;await sr.exists(t)&&o.push(t)}return o}async function Qy(){let o=[];if(await sr.exists(or)){let e=await sr.read(or);o.push(e)}for(let e=1;e<=Xr.maxBackups;e++){let t=`${or}.${e}`;if(await sr.exists(t)){let r=await sr.read(t);o.push(r)}}return o.reverse().join(`
`)}var Dt=class{constructor(e){let t=e||this.constructor.name;this.debug=Pe(`[${t}]`,"debug"),this.log=Pe(`[${t}]`,"log"),this.warn=Pe(`[${t}]`,"warn"),this.error=Pe(`[${t}]`,"error")}setLoggers(e){this.debug=Pe(`[${e}]`,"debug"),this.log=Pe(`[${e}]`,"log"),this.warn=Pe(`[${e}]`,"warn"),this.error=Pe(`[${e}]`,"error")}},FL=!1;function Xy(o){return TL(o,FL)}var Nu=class{constructor(){this.platform="s3rn";this.product="relay"}},Hu=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},Vo=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},$r=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},nr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.canvasId=r;this.platform="s3rn";this.product="relay"}},qo=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.fileId=r;this.platform="s3rn";this.product="relay"}},Vu=class{constructor(e,t,r,s,n,a){this.relayId=e;this.folderId=t;this.fileId=r;this.hash=s;this.contentType=n;this.contentLength=a;this.platform="s3rn";this.product="relay"}},Br=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},Wo=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},sn=class{constructor(e,t){this.folderId=e;this.canvasId=t;this.platform="s3rn";this.product="relay"}},fi=class{constructor(e,t){this.folderId=e;this.fileId=t;this.platform="s3rn";this.product="relay"}},vt=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}if("canvasId"in e){if(!this.validateUUID(e.canvasId))throw new Error("Invalid document UUID");t+=`:canvas:${e.canvasId}`}if("fileId"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");if(t+=`:file:${e.fileId}`,"hash"in e&&e.hash&&"contentType"in e&&"contentLength"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");t+=`:sha256:${e.hash}`,t+=`:contentType:${e.contentType}`,t+=`:contentLength:${e.contentLength}`}}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,s,n,a,i,l,c,u,d,m,g,h,_]=t;if(!this.validateUUID(n))throw new Error("Invalid UUID");if(i&&!this.validateUUID(i))throw new Error("Invalid UUID");if(c&&!this.validateUUID(c))throw new Error("Invalid UUID");if(r==="relay"&&s==="relay"&&a==="folder"&&l==="doc")return new $r(n,i,c);if(r==="relay"&&s==="relay"&&a==="folder"&&l==="canvas")return new nr(n,i,c);if(r==="relay"&&s==="relay"&&a==="folder"&&l==="file"&&u==="hash"&&m==="contentType"&&h==="contentLength")return new Vu(n,i,c,d,g,_);if(r==="relay"&&s==="relay"&&a==="folder"&&l==="file")return new qo(n,i,c);if(r==="relay"&&s==="relay"&&a=="folder")return new Vo(n,i);if(r==="relay"&&s==="folder"&&a==="document")return new Wo(n,i);if(r==="relay"&&s==="folder"&&a==="canvas")return new sn(n,i);if(r==="relay"&&s==="folder")return new Br(n);if(r==="relay"&&s==="relay")return new Hu(n);if(s===void 0)return new Nu;throw new Error("Invalid s3rn format for the given product type")}};function AL(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function Zy(o){let e=JSON.stringify(o),t=AL(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var Bl={enableUpdateYDocFromDiskBuffer:!1,enableDocumentStatus:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableHTTPSync:!1,enableSyncMenu:!0,enableDocumentServer:!1,enableDocumentHistory:!1,enableEditorTweens:!1,enableSyncModal:!1,enableDesyncPill:!1,enableAttachmentSync:!0,enableNetworkLogging:!1,enableCanvasSync:!1};function ML(){return new Proxy({},{get:(o,e)=>e})}var yo=ML();var sa=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...s)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...s)},t)}}};var zt=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return zt.instance||(zt.instance=new zt(new sa),Bt.set(this.instance,"postie")),zt.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let s={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(s),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Pe("[postie]","debug");for(let[t,r]of this.mailboxes){for(let s of r)t(s),e("send",s.constructor.name,t),this.deliveredMailLog.push({sender:s,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Pe("[postie]","warn")("All Mail Log:"),this.prettyPrintMailLog(this.allMailLog)}prettyPrintDeliveredMailLog(){Pe("[postie]","warn")("Delivered Mail Log:"),this.prettyPrintMailLog(this.deliveredMailLog)}prettyPrintMailLog(e){let t=Pe("[postie]","warn");e.forEach((r,s)=>{t(`Mail #${s+1}:`),t(`  Timestamp: ${new Date(r.timestamp).toISOString()}`),t(`  Transaction ID: ${r.transactionId}`),t(`  Sender: ${r.sender.observableName||r.sender.constructor.name}`),t(`  Recipient: ${r.recipient.name||"Anonymous function"}`),t(`  Recipient Origin: ${r.recipientOrigin||"Unknown"}`),t("---")})}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let s=200,n=t.replace(/\s+/g," ").slice(0,s);return n.length===s&&(n+="..."),`AnonymousFunction(${n})`}static destroy(){zt.instance&&(zt.instance.mailboxes=null,zt.instance.allMailLog=[],zt.instance.deliveredMailLog=[],zt.instance.timeProvider.destroy(),zt.instance.timeProvider=null,zt.instance.isDelivering=!1,zt.instance.isInTransaction=!1,zt.instance.currentTransactionId=0,zt._destroyed=!0,zt.instance=void 0)}},Nr=zt;Nr._destroyed=!1;var qu=new Map;function ex(){for(let[,o]of qu)o();qu.clear()}var ft=class extends Dt{constructor(t){super();this.observableName=t;this.destroyed=!1;qu.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners on ${this.observableName}`)}),this._listeners=new Set,this.unsubscribes=[]}notifyListeners(){for(let t of this._listeners)Nr.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),Nr.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners&&this._listeners.delete(t)}destroy(){var t;this.destroyed=!0,this.unsubscribes&&this.unsubscribes.forEach(r=>{r()}),(t=this._listeners)==null||t.clear(),this._listeners=null}};function Je(){return{...Nt.getInstance().flags}}function zo(o,e,t=()=>{}){Nt.getInstance().flags[o]?e():t()}function tx(o,e,t=()=>{}){o.forEach(r=>{if(Nt.getInstance().flags[r]){e();return}}),t()}var Nt=class extends ft{constructor(){super();this.flags=Bl}async applyServerFlags(t){if(!this.settings)return;let s=t.filter(n=>n.override).reduce((n,a)=>(n[a.name]=a.value,n),{});this.log("applying server flags",s),await this.settings.update(n=>({...n,...s}),!0)}static getInstance(){return Nt.instance||(Nt.instance=new Nt),Nt.instance}setSettings(t){this.settings=t,this.settings.subscribe(r=>{this.flags={...this.flags,...r},this.notifyListeners()})}getFlag(t){return this.flags[t]}setFlag(t,r){this.settings&&this.settings.update(s=>({...s,[t]:r}))}static destroy(){Nt.instance=null}};var EL={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function rx(o,e,t){let r={token:o.token},s=new Gy(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&s.awareness.setLocalStateField("user",{name:t.name,color:t.color.color,colorLight:t.color.light}),s}var Ko=class extends Dt{constructor(t,r,s,n){var c;super();this.guid=t;this._s3rn=r;this.tokenStore=s;this.loginManager=n;this._providerSynced=!1;this.PROVIDER_MAX_ERRORS=3;this.listeners=new Map,this.loginManager=n;let a=(c=this.loginManager)==null?void 0:c.user;this.ydoc=new wr,Je().enableDocumentHistory&&(this.ydoc.gc=!1),a&&new xl(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,a.id),this.tokenStore=s,this.clientToken=this.tokenStore.getTokenSync(vt.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=rx(this.clientToken,this.ydoc,a);let i=this.providerConnectionErrorSubscription(u=>{this.log(`[${this.path}] disconnection event`,u);let d=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),d&&this.connect()});i.on(),this._offConnectionError=i.off;let l=this.providerStateSubscription(u=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${Zy(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(vt.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,s=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!s}return!1}refreshProvider(t){var a;this.clientToken=t;let r=new wr,s=rx(t,r),n=s.url;if(this._provider){if(this._provider.url!==n){this._provider.url=n,this._provider.wsUnsuccessfulReconnects=0;let i=this._provider.url.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${i}`),(a=this._provider.ws)==null||a.close()}}else throw new Error("missing provider!");s.awareness.destroy(),s.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:EL[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._providerSynced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=s=>{s.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}reset(){this.disconnect(),this.clientToken={token:"",url:"",docId:"-",expiryTime:0}}_injectIntent(t){return s=>{t({status:s.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var Go=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},Nl=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=s=>{s.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((s,n)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>n(l.error),l.onsuccess=()=>s()}catch(a){n(a)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,s)=>{try{let i=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);i.onerror=()=>s(i.error),i.onsuccess=()=>r(i.result?i.result.contents:null)}catch(n){s(n)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,s)=>{try{let i=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);i.onerror=()=>s(i.error),i.onsuccess=()=>r()}catch(n){s(n)}})}};var Zr=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=s=>{if(this.currentPromise&&this.resolver){let n=this.resolver;n(s),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let s=r(t);if(s)return s}return this.currentPromise||(this.currentPromise=new Promise((s,n)=>{this.resolver=s,this.timeoutId=window.setTimeout(()=>{Pe("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[a,i]=this.checkFunction();a&&r(i)},3e3),this.promiseFunction().then(a=>{this.timeoutId&&clearTimeout(this.timeoutId),s(a)},a=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,n(a)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},Hl=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{Pe("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function ui(o,...e){return new Promise((t,r)=>{let s=window.setTimeout(()=>{Pe("[Promise]","error")("Promise stuck after 3s:",...e)},3e3);o.then(n=>{clearTimeout(s),t(n)},n=>{clearTimeout(s),r(n)})})}var RL={md:"text/markdown",txt:"text/plain",json:"application/json",js:"application/javascript",ts:"application/typescript",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",pdf:"application/pdf",canvas:"application/canvas+json",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",mp3:"audio/mpeg",wav:"audio/wav",m4a:"audio/x-m4a",flac:"audio/flac",ogg:"audio/ogg",oga:"audio/ogg",opus:"audio/opus",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",mov:"video/quicktime",mkv:"video/x-matroska","3gp":"video/3gpp"};function _s(o){var t;let e=((t=o.split(".").pop())==null?void 0:t.toLowerCase())||"";return RL[e]||"application/octet-stream"}function eo(o){return o instanceof Lt}var Lt=class extends Ko{constructor(t,r,s,n){let a=n.relayId?new $r(n.relayId,n.guid,r):new Wo(n.guid,r);super(r,a,n.tokenStore,s);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=n,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let i=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new ws(i,this.ydoc)}catch(i){throw this.warn("Unable to open persistence.",this.guid),console.error(i),i}this.whenSynced().then(()=>{let i=l=>{let c=l.transaction.origin;l.changes.keys.size!==0&&c!=this&&this.updateStats()};this.ytext.observe(i),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(i)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",vt.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),zo(yo.enableDeltaLogging,()=>{let i=l=>{var u,d;let c="";c+=`Transaction origin: ${l.transaction.origin} ${(d=(u=l.transaction.origin)==null?void 0:u.constructor)==null?void 0:d.name}
`;for(let m of l.changes.delta)c+=`insert: ${m.insert}

retain: ${m.retain}

delete: ${m.delete}
`;this.debug(c)};this.ytext.observe(i),this.unsubscribes.push(()=>{this.ytext.unobserve(i)})}),this._tfile=null}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let s=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(n=>null);return s!==null&&s!==""?r=s:r=await this._parent.read(this),this.setDiskBuffer(r.replace(`\r
`,`
`))}catch(s){throw console.error(s),s}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new Go(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,s=this.text!==r;return s||this.clearDiskBuffer(),s}async connect(){return this.sharedFolder.s3rn instanceof Br?!1:(this.s3rn instanceof Wo&&(this.sharedFolder.relayId?this.s3rn=new $r(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Wo(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new Zr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new Zr(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}get mimetype(){return _s(this.path)}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Or(this._persistence.db,["updates"],"readonly"),r=await Ho(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}static checkExtension(t){return t.endsWith(".md")}destroy(){var t,r;this.unsubscribes.forEach(s=>{s()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}async read(){return this.text}async rename(t){this.move(t)}async cleanup(){var t;(t=this._diskBufferStore)==null||t.removeDiskBuffer(this.guid)}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var Ss=class extends ft{constructor(){super();this._set=new Set}add(t){return this._set.add(t),this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let s of this._set)t(s)&&r.push(s);return r}};var jo=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let s=r.split(`${this.namespace}${this.seperator}`)[1],n=this.get(s);e.call(t,n,s,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var Wu=require("obsidian");function zu(o){return o instanceof _r}var _r=class extends Dt{constructor(t,r,s,n){super();this.path=t;this.guid=r;this.relayManager=s;this._tfolder=null;this.ready=!1;this.createPromise=null;this.connected=!0;this._parent=n,this.name=this.path.split("/").pop()||"",this.vault=this._parent.vault;let a=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(t));a instanceof Wu.TFolder?(this._tfolder=a,this.ready=!0):(this.createPromise=this.vault.createFolder(this.sharedFolder.getPath(t)),this.createPromise.then(i=>{this._tfolder=i,this.ready=!0})),this.synctime=0,this.setLoggers(`[SyncFolder](${this.path})`),this.offFolderStatusListener=this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()}),(async()=>(this.createPromise&&await this.createPromise,n.markUploaded(this)))(),this.log("created")}static fromTFolder(t,r,s){return console.log("virtualpath for new syncfolder",r.getVirtualPath(s.path)),new _r(r.getVirtualPath(s.path),Bn(),t,r)}disconnect(){this.connected=!1}move(t){t!==this.path&&(this.log("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.setLoggers(`[SharedFolder](${this.path})`))}static checkPath(t){var s;return!((s=t.split("/").pop())==null?void 0:s.includes("."))}get tfolder(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof Wu.TFolder)return t;throw new Error("TFolder API used before file existed")}get parent(){var t;return((t=this.tfolder)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected))}async rename(t){this.move(t)}async delete(){return this.vault.delete(this.tfolder)}cleanup(){}destroy(){var t;(t=this.offFolderStatusListener)==null||t.call(this),this.offFolderStatusListener=null,this._parent=null,this.relayManager=null,this._tfolder=null}};var xo=qs(Ba());var Vl,OL=new Uint8Array(16);function Ku(){if(!Vl&&(Vl=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Vl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Vl(OL)}var Kt=[];for(let o=0;o<256;++o)Kt.push((o+256).toString(16).slice(1));function ox(o,e=0){return Kt[o[e+0]]+Kt[o[e+1]]+Kt[o[e+2]]+Kt[o[e+3]]+"-"+Kt[o[e+4]]+Kt[o[e+5]]+"-"+Kt[o[e+6]]+Kt[o[e+7]]+"-"+Kt[o[e+8]]+Kt[o[e+9]]+"-"+Kt[o[e+10]]+Kt[o[e+11]]+Kt[o[e+12]]+Kt[o[e+13]]+Kt[o[e+14]]+Kt[o[e+15]]}var UL=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Gu={randomUUID:UL};function $L(o,e,t){if(Gu.randomUUID&&!e&&!o)return Gu.randomUUID();o=o||{};let r=o.random||(o.rng||Ku)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return ox(r)}var na=$L;var BL={images:"image",audio:"audio",videos:"video",pdfs:"pdf",otherTypes:"file"};function ju(o){return(o==null?void 0:o.type)==="markdown"}function sx(o){return(o==null?void 0:o.type)==="folder"}function pi(o){return{version:0,id:o,type:"markdown"}}function nx(o){return{version:0,id:o,type:"canvas"}}function ql(o){return{version:0,id:o,type:"folder"}}function ax(o,e,t,r,s){return s||(s=Date.now()),{version:0,id:e,type:o,mimetype:t,synctime:s,hash:r}}var Yu=class extends ft{constructor(t,r){super();this.syncSettings=t;this.configs=r;this.protocols=new Map;r=r||Yu.defaults,r.forEach(([s,n])=>this.protocols.set(s,n)),this.unsubscribes.push(t.subscribe(s=>{this.updateFromSettings(s)}))}setEnabled(t,r){let s=this.protocols.get(t);s&&this.protocols.set(t,{...s,enabled:r})}canSync(t,r){var a,i;if(t.endsWith(".md")||Je().enableCanvasSync&&t.endsWith(".canvas")||!((a=t.split("/").pop())==null?void 0:a.includes(".")))return!0;if(!Je().enableAttachmentSync)return!1;if(r){let l=this.protocols.get(r.type);return l?l.enabled&&r.version<=l.maxVersion:!1}let n=this.getTypeForPath(t);return!!((i=this.protocols.get(n))!=null&&i.enabled)}updateFromSettings(t){Object.entries(BL).forEach(([r,s])=>{this.setEnabled(s,t[r])})}getEnabledFileSyncTypes(){if(!Je().enableAttachmentSync)return["markdown","canvas"];let t=[];return this.protocols.forEach((r,s)=>{r!=null&&r.enabled&&s!=="folder"&&t.push(s)}),t}getTypeForPath(t){let r=_s(t);for(let[s,n]of this.protocols)if(n.mimetypes.includes(r))return!Je().enableCanvasSync&&s==="canvas"?"file":s;return"file"}},di=Yu;di.defaults=[["folder",{maxVersion:0,mimetypes:[],enabled:!0}],["markdown",{maxVersion:0,mimetypes:["text/markdown"],enabled:!0}],["image",{maxVersion:0,mimetypes:["image/png","image/jpeg","image/gif","image/svg+xml","image/webp","image/avif","image/bmp"],enabled:!0}],["pdf",{maxVersion:0,mimetypes:["application/pdf"],enabled:!0}],["audio",{maxVersion:0,mimetypes:["audio/mpeg","audio/wav","audio/flac","audio/mp4","audio/x-m4a","audio/ogg","audio/opus"],enabled:!0}],["video",{maxVersion:0,mimetypes:["video/mp4","video/webm","video/ogg","video/quicktime","video/x-matroska"],enabled:!0}],["canvas",{maxVersion:0,mimetypes:["application/canvas+json"],enabled:!0}],["file",{maxVersion:0,mimetypes:["application/octet-stream"],enabled:!1}]];var Wl=class extends ft{constructor(t,r,s,n){super();this.ydoc=t;this.namespace=r;this.pendingUpload=s;this.syncSettingsManager=n;this.legacyIds=this.ydoc.getMap("docs"),this.meta=this.ydoc.getMap("filemeta_v0"),this.overlay=new Map,this.renames=new Map,this.deleteSet=new Set,this.typeRegistry=new di(this.syncSettingsManager)}assertVPath(t){if(t.startsWith(this.namespace+xo.sep))throw new Error("Expected virtual path"+t)}print(){this.log("files",Array.from(this.meta.entries()).map(([t,r])=>({path:t,...r}))),this.log("pending...",Array.from(this.pendingUpload.entries()).map(([t,r])=>({path:t,guid:r})))}canSync(t){let r=this.getMeta(t);return this.typeRegistry.canSync(t,r)}resolveMove(t){this.log("resolving alias",t),this.renames.delete(t)}resolveAll(){this.renames.clear()}move(t,r){this.log("moving file",t,"to",r),this.assertVPath(t),this.assertVPath(r),this.renames.set(t,r);let s=this.pendingUpload.get(t);s&&(this.pendingUpload.set(r,s),this.pendingUpload.delete(t)),this.deleteSet.has(t)&&(this.deleteSet.add(r),this.deleteSet.delete(t));let n=this.overlay.get(t);n&&(this.overlay.set(r,n),this.overlay.delete(t));let a=this.meta.get(t);sx(a)?this.moveFolder(t,r):a&&(this.set(r,a),this.delete(t))}new(t){this.assertVPath(t);let r=na();return this.pendingUpload.set(t,r),r}forEach(t){this.meta.forEach((r,s)=>{this.deleteSet.has(s)||t(r,s)}),this.overlay.forEach((r,s)=>{this.deleteSet.has(s)||t(r,s)})}has(t){return this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t)?!1:this.meta.has(t)||this.legacyIds.has(t)||this.overlay.has(t)||this.pendingUpload.has(t)}set(t,r){this.assertVPath(t),ju(r)&&this.legacyIds.get(t)!==r.id&&this.legacyIds.set(t,r.id);let s=this.meta.get(t);s&&s.id===r.id&&s.mimetype==r.mimetype&&s.type===r.type&&s.hash===r.hash||(this.log("metadata write (path, existing, meta)",t,s,r),this.meta.set(t,r),this.pendingUpload.has(t)&&this.pendingUpload.delete(t))}processFolderOperation(t){let r=new Map,s=new Map;t.changes.keys.forEach((n,a)=>{if(n.action==="delete"){let i=n.oldValue;(i==null?void 0:i.type)==="folder"&&r.set(i.id,a)}else if(n.action==="add"||n.action==="update"){let i=this.meta.get(a);(i==null?void 0:i.type)==="folder"&&s.set(i.id,a)}}),r.forEach((n,a)=>{let i=s.get(a);if(i&&n!==i){this.log(`Detected folder move from ${n} to ${i}`);let l=new Map;this.meta.forEach((c,u)=>{u.startsWith(i+xo.sep)&&l.set(u,c)}),this.renames.set(n,i),this.log("setting alias",n,i),this.log("paths to move",l),l.forEach((c,u)=>{let d=u.slice(i.length),m=n+d;this.renames.set(m,u),this.log("setting alias",m,u)})}})}start(){zo(yo.enableDeltaLogging,()=>{let s=n=>{var i,l;let a="";a+=`Transaction origin: ${n.transaction.origin}${(l=(i=n.transaction.origin)==null?void 0:i.constructor)==null?void 0:l.name}
`,n.changes.keys.forEach((c,u)=>{c.action==="add"&&(a+=`Added ${u}: ${this.get(u)}
`),c.action==="update"&&(a+=`Updated ${u}: ${this.get(u)}
`),c.action==="delete"&&(a+=`Deleted ${u}
`)}),this.debug(a)};this.legacyIds.observe(s),this.meta.observe(s),this.unsubscribes.push(()=>{this.legacyIds.unobserve(s)}),this.unsubscribes.push(()=>{this.meta.unobserve(s)})});let t=async s=>{if(s.changes.keys.size===0){this.log("no changes detected");return}s.transaction.origin!=this&&(this.processFolderOperation(s),this.notifyListeners())},r=async s=>{this.migrateUp(),this.notifyListeners()};this.legacyIds.observe(r),this.meta.observe(t),this.unsubscribes.push(()=>{this.legacyIds.unobserve(r)}),this.unsubscribes.push(()=>{this.meta.unobserve(t)}),this.unsubscribes.push(this.typeRegistry.subscribe(()=>{this.log("type registry change"),this.notifyListeners()}))}get(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.pendingUpload.get(t);if(r)return r;let s=this.getMeta(t);if(s)return s.id}getMeta(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.meta.get(t)||this.overlay.get(t),s=this.legacyIds.has(t);if(!r&&this.legacyIds.has(t)){let n=this.legacyIds.get(t),a=pi(n);return this.overlay.set(t,a),a}if(r){if(ju(r)&&!s){this.deleteSet.add(t);return}return r}}delete(t){return this.assertVPath(t),this.legacyIds.delete(t),this.pendingUpload.delete(t),this.meta.delete(t)}get remoteIds(){let t=new Set;return this.forEach(r=>{t.add(r.id)}),t}commit(){this.overlay.size>0&&this.log("committing overlay",[...this.overlay.keys()]),this.overlay.forEach((t,r)=>{this.set(r,t),t.type==="markdown"&&this.legacyIds.get(r)!==t.id&&this.legacyIds.set(r,t.id)}),this.overlay=new Map,this.deleteSet.size>0&&this.log("committing deleteSet",[...this.deleteSet]),this.deleteSet.forEach(t=>this.delete(t)),this.deleteSet=new Set}detectFolderMoves(){let t=new Map,r=new Set;this.legacyIds.forEach((n,a)=>{let i;if(this.meta.forEach((l,c)=>{l.type==="markdown"&&l.id===n&&c!==a&&(i=c)}),i){let l=(0,xo.dirname)(i),c=(0,xo.dirname)(a);l!==c&&t.set(l,c)}}),Array.from(t.entries()).sort(([n],[a])=>a.length-n.length).forEach(([n,a])=>{r.has(n)||(this.moveFolder(n,a),r.add(n))})}moveFolder(t,r){this.log("moving folder",t,"to",r);let s=new Map;this.meta.forEach((a,i)=>{(i===t||i.startsWith(t+xo.sep))&&s.set(i,a)}),this.overlay.forEach((a,i)=>{(i===t||i.startsWith(t+xo.sep))&&s.set(i,a)});let n=this.meta.get(t);n&&(this.meta.set(r,n),this.meta.delete(t)),s.forEach((a,i)=>{if(i===t)return;let l=i.slice(t.length),c=r+l;this.move(i,c)})}markUploaded(t,r){if(!this.has(t))throw new Error(`unexpected vpath ${t} marked uploaded`);this.set(t,r)}migrateFile(t,r){var i;if(this.assertVPath(r),((i=this.meta.get(r))==null?void 0:i.id)===t)return;let s=new Set,n=r.split(xo.sep),a="";for(let l=0;l<n.length-1;l++)a=n.slice(0,l+1).join(xo.sep),s.add(a);this.meta.has(r)||this.overlay.has(r)||r.endsWith(".md")&&(this.warn(`migrated legacy key on ${r}`),this.overlay.set(r,pi(t))),s.forEach(l=>{if(l&&!(this.meta.has(l)||this.overlay.has(l))){let c=na();console.log("creating folder path",l,c),this.overlay.set(l,ql(c))}})}migrateUp(){this.detectFolderMoves(),this.legacyIds.forEach((t,r)=>{this.migrateFile(t,r)})}destroy(){super.destroy(),this.overlay.clear(),this.deleteSet.clear(),this.renames.clear(),this.legacyIds=null,this.meta=null}};function ix(o,e,t=(r,s)=>r.substring(s.length).replace(/^\/+/,"")){return new Proxy(o,{get(r,s){let n=r[s];return typeof n=="function"?function(...a){return a.length>0&&typeof a[0]=="string"&&(a[0]=t(a[0],e)),n.apply(r,a)}:n}})}var mx=require("obsidian"),hx=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkFetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(hx.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=px()));var Et=async(o,e)=>{let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",s=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.5.5"}),n={url:t,method:r,body:e==null?void 0:e.body,headers:s,throw:!1},a;if(a=await(0,mx.requestUrl)(n),!a.arrayBuffer.byteLength)return new Response(null,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});let i=new Response(a.arrayBuffer,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});if(Object.defineProperty(i,"json",{value:async()=>JSON.parse(a.text)}),Je().enableNetworkLogging){let c=a.status>=500?"error":a.status>=400?"warn":"debug",u=a.text,d;if((a.headers["content-type"]||"").includes("application/json"))try{d=JSON.parse(u)}catch(g){}Pe("[CustomFetch]",c)(a.status.toString(),r,t,d||u)}if(a.status>=500)throw new Error(a.text);return i};var ar=class extends Error{constructor(e){var t,r,s,n;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,ar.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof ar||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(n=(s=(r=this.originalError)==null?void 0:r.cause)==null?void 0:s.message)!=null&&n.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},zl=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function ZL(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||e2,s=0;for(;s<o.length;){let n=o.indexOf("=",s);if(n===-1)break;let a=o.indexOf(";",s);if(a===-1)a=o.length;else if(a<n){s=o.lastIndexOf(";",n-1)+1;continue}let i=o.slice(s,n).trim();if(t[i]===void 0){let l=o.slice(n+1,a).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[i]=r(l)}catch(c){t[i]=l}}s=a+1}return t}function gx(o,e,t){let r=Object.assign({},t||{}),s=r.encode||t2;if(!zl.test(o))throw new TypeError("argument name is invalid");let n=s(e);if(n&&!zl.test(n))throw new TypeError("argument val is invalid");let a=o+"="+n;if(r.maxAge!=null){let i=r.maxAge-0;if(isNaN(i)||!isFinite(i))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(i)}if(r.domain){if(!zl.test(r.domain))throw new TypeError("option domain is invalid");a+="; Domain="+r.domain}if(r.path){if(!zl.test(r.path))throw new TypeError("option path is invalid");a+="; Path="+r.path}if(r.expires){if(!function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");a+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":a+="; Priority=Low";break;case"medium":a+="; Priority=Medium";break;case"high":a+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a}function e2(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function t2(o){return encodeURIComponent(o)}var bx;function Kl(o){if(o)try{let e=decodeURIComponent(bx(o.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function vx(o,e=0){let t=Kl(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}bx=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,s=0,n=0,a="";r=e.charAt(n++);~r&&(t=s%4?64*t+r:r,s++%4)?a+=String.fromCharCode(255&t>>(-2*s&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};var yx="pb_auth",hi=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!vx(this.token)}get isAdmin(){return Kl(this.token).type==="admin"}get isAuthRecord(){return Kl(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=yx){let r=ZL(e||"")[t]||"",s={};try{s=JSON.parse(r),(typeof s===null||typeof s!="object"||Array.isArray(s))&&(s={})}catch(n){}this.save(s.token||"",s.model||null)}exportToCookie(e,t=yx){var l,c;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},s=Kl(this.token);r.expires=s!=null&&s.exp?new Date(1e3*s.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let n={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},a=gx(t,JSON.stringify(n),e),i=typeof Blob!="undefined"?new Blob([a]).size:a.length;if(n.model&&i>4096){n.model={id:(l=n==null?void 0:n.model)==null?void 0:l.id,email:(c=n==null?void 0:n.model)==null?void 0:c.email};let u=["collectionId","username","verified"];for(let d in this.model)u.includes(d)&&(n.model[d]=this.model[d]);a=gx(t,JSON.stringify(n),e)}return a}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},Qu=class extends hi{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},Yo=class{constructor(e){this.client=e}},Xu=class extends Yo{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,s,n,a){return a=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:s,duration:n}},a),this.client.send("/api/settings/apple/generate-client-secret",a)}},gi=class extends Yo{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(s=>{var n;return s.items=((n=s.items)==null?void 0:n.map(a=>this.decode(a)))||[],s})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var s;if(!((s=r==null?void 0:r.items)!=null&&s.length))throw new ar({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new ar({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(s=>this.decode(s))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],s=async n=>this.getList(n,e||500,t).then(a=>{let i=a.items;return r=r.concat(i),i.length==a.perPage?s(n+1):r});return s(1)}};function Sr(o,e,t,r){let s=r!==void 0;return s||t!==void 0?s?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function Ju(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var Zu=class extends gi{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(s=>{var n,a;return((n=this.client.authStore.model)==null?void 0:n.id)===s.id&&((a=this.client.authStore.model)==null?void 0:a.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(r=>{var s,n;return r&&((s=this.client.authStore.model)==null?void 0:s.id)===e&&((n=this.client.authStore.model)==null?void 0:n.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,s){let n={method:"POST",body:{identity:e,password:t}};n=Sr("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",n,r,s);let a=n.autoRefreshThreshold;delete n.autoRefreshThreshold,n.autoRefresh||Ju(this.client);let i=await this.client.send(this.baseCrudPath+"/auth-with-password",n);return i=this.authResponse(i),a&&function(c,u,d,m){Ju(c);let g=c.beforeSend,h=c.authStore.model,_=c.authStore.onChange((w,v)=>{(!w||(v==null?void 0:v.id)!=(h==null?void 0:h.id)||(v!=null&&v.collectionId||h!=null&&h.collectionId)&&(v==null?void 0:v.collectionId)!=(h==null?void 0:h.collectionId))&&Ju(c)});c._resetAutoRefresh=function(){_(),c.beforeSend=g,delete c._resetAutoRefresh},c.beforeSend=async(w,v)=>{var E;let A=c.authStore.token;if((E=v.query)!=null&&E.autoRefresh)return g?g(w,v):{url:w,sendOptions:v};let O=c.authStore.isValid;if(O&&vx(c.authStore.token,u))try{await d()}catch(R){O=!1}O||await m();let M=v.headers||{};for(let R in M)if(R.toLowerCase()=="authorization"&&A==M[R]&&c.authStore.token){M[R]=c.authStore.token;break}return v.headers=M,g?g(w,v):{url:w,sendOptions:v}}}(this.client,a,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},n))),i}async authRefresh(e,t){let r={method:"POST"};return r=Sr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let s={method:"POST",body:{email:e}};return s=Sr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,r,s,n){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=Sr("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",a,s,n),this.client.send(this.baseCrudPath+"/confirm-password-reset",a).then(()=>!0)}},r2=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function wx(o){if(o){o.query=o.query||{};for(let e in o)r2.includes(e)||(o.query[e]=o[e],delete o[e])}}var Gl=class extends Yo{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var a;if(!e)throw new Error("topic must be set.");let s=e;if(r){wx(r);let i="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));s+=(s.includes("?")?"&":"?")+i}let n=function(i){let l=i,c;try{c=JSON.parse(l==null?void 0:l.data)}catch(u){}t(c||{})};return this.subscriptions[s]||(this.subscriptions[s]=[]),this.subscriptions[s].push(n),this.isConnected?this.subscriptions[s].length===1?await this.submitSubscriptions():(a=this.eventSource)==null||a.addEventListener(s,n):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,n)}async unsubscribe(e){var r;let t=!1;if(e){let s=this.getSubscriptionsByTopic(e);for(let n in s)if(this.hasSubscriptionListeners(n)){for(let a of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,a);delete this.subscriptions[n],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let s in this.subscriptions)if((s+"?").startsWith(e)){t=!0;for(let n of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,n);delete this.subscriptions[s]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var n;let r=!1,s=this.getSubscriptionsByTopic(e);for(let a in s){if(!Array.isArray(this.subscriptions[a])||!this.subscriptions[a].length)continue;let i=!1;for(let l=this.subscriptions[a].length-1;l>=0;l--)this.subscriptions[a][l]===t&&(i=!0,delete this.subscriptions[a][l],this.subscriptions[a].splice(l,1),(n=this.eventSource)==null||n.removeEventListener(a,t));i&&(this.subscriptions[a].length||delete this.subscriptions[a],r||this.hasSubscriptionListeners(a)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let s in this.subscriptions)if((r=this.subscriptions[s])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let s of this.pendingConnects)s.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let s in r)for(let n of r[s])n(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new ar(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},ed=class extends gi{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(s=>{var n,a,i;return((n=this.client.authStore.model)==null?void 0:n.id)!==(s==null?void 0:s.id)||((a=this.client.authStore.model)==null?void 0:a.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(r=>{var s,n,a;return!r||((s=this.client.authStore.model)==null?void 0:s.id)!==e||((n=this.client.authStore.model)==null?void 0:n.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,s){let n={method:"POST",body:{identity:e,password:t}};return n=Sr("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",n,r,s),this.client.send(this.baseCollectionPath+"/auth-with-password",n).then(a=>this.authResponse(a))}async authWithOAuth2Code(e,t,r,s,n,a,i){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:s,createData:n}};return l=Sr("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,a,i),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then(c=>this.authResponse(c))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(l=>l.name===t.provider);if(!r)throw new ar(new Error(`Missing or invalid provider "${t.provider}".`));let s=this.client.buildUrl("/api/oauth2-redirect"),n=new Gl(this.client),a=null;function i(){a==null||a.close(),n.unsubscribe()}return t.urlCallback||(a=xx(void 0)),new Promise(async(l,c)=>{var u;try{await n.subscribe("@oauth2",async h=>{let _=n.clientId;try{if(!h.state||_!==h.state)throw new Error("State parameters don't match.");let w=Object.assign({},t);delete w.provider,delete w.scopes,delete w.createData,delete w.urlCallback;let v=await this.authWithOAuth2Code(r.name,h.code,r.codeVerifier,s,t.createData,w);l(v)}catch(w){c(new ar(w))}i()});let d={state:n.clientId};(u=t.scopes)!=null&&u.length&&(d.scope=t.scopes.join(" "));let m=this._replaceQueryParams(r.authUrl+s,d);await(t.urlCallback||function(h){a?a.location.href=h:a=xx(h)})(m)}catch(d){i(),c(new ar(d))}})}async authRefresh(e,t){let r={method:"POST"};return r=Sr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(s=>this.authResponse(s))}async requestPasswordReset(e,t,r){let s={method:"POST",body:{email:e}};return s=Sr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,r,s,n){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=Sr("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",a,s,n),this.client.send(this.baseCollectionPath+"/confirm-password-reset",a).then(()=>!0)}async requestVerification(e,t,r){let s={method:"POST",body:{email:e}};return s=Sr("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-verification",s).then(()=>!0)}async confirmVerification(e,t,r){let s={method:"POST",body:{token:e}};return s=Sr("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",s).then(()=>!0)}async requestEmailChange(e,t,r){let s={method:"POST",body:{newEmail:e}};return s=Sr("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",s).then(()=>!0)}async confirmEmailChange(e,t,r,s){let n={method:"POST",body:{token:e,password:t}};return n=Sr("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",n,r,s),this.client.send(this.baseCollectionPath+"/confirm-email-change",n).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,s="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),s=e.substring(e.indexOf("?")+1));let n={},a=s.split("&");for(let i of a){if(i=="")continue;let l=i.split("=");n[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let i in t)t.hasOwnProperty(i)&&(t[i]==null?delete n[i]:n[i]=t[i]);s="";for(let i in n)n.hasOwnProperty(i)&&(s!=""&&(s+="&"),s+=encodeURIComponent(i.replace(/%20/g,"+"))+"="+encodeURIComponent(n[i].replace(/%20/g,"+")));return s!=""?r+"?"+s:r}};function xx(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new ar(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,s=window.innerHeight;e=e>r?r:e,t=t>s?s:t;let n=r/2-e/2,a=s/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+a+",left="+n+",resizable,menubar=no")}var td=class extends gi{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},rd=class extends Yo{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new ar({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},od=class extends Yo{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},sd=class extends Yo{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let s=[];s.push("api"),s.push("files"),s.push(encodeURIComponent(e.collectionId||e.collectionName)),s.push(encodeURIComponent(e.id)),s.push(encodeURIComponent(t));let n=this.client.buildUrl(s.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let a=new URLSearchParams(r);n+=(n.includes("?")?"&":"?")+a}return n}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},nd=class extends Yo{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},aa=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new Qu,this.admins=new Zu(this),this.collections=new td(this),this.files=new sd(this),this.logs=new rd(this),this.settings=new Xu(this),this.realtime=new Gl(this),this.health=new od(this),this.backups=new nd(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new ed(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let s=t[r];switch(typeof s){case"boolean":case"number":s=""+s;break;case"string":s="'"+s.replace(/'/g,"\\'")+"'";break;default:s=s===null?"null":s instanceof Date?"'"+s.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(s).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",s)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let s=Object.assign({},await this.beforeSend(r,t));s.url!==void 0||s.options!==void 0?(r=s.url||r,t=s.options||t):Object.keys(s).length&&(t=s,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let s=this.serializeQueryParams(t.query);s&&(r+=(r.includes("?")?"&":"?")+s),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async s=>{let n={};try{n=await s.json()}catch(a){}if(this.afterSend&&(n=await this.afterSend(s,n)),s.status>=400)throw new ar({url:s.url,status:s.status,data:n});return n}).catch(s=>{throw new ar(s)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),wx(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let s=new AbortController;this.cancelControllers[r]=s,t.signal=s.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let s=this.normalizeFormDataValue(e[r]),n=Array.isArray(s)?s:[s];if(n.length)for(let a of n)t.append(r,a);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let s of r)if(typeof Blob!="undefined"&&s instanceof Blob||typeof File!="undefined"&&s instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let s=e[r],n=encodeURIComponent(r);if(Array.isArray(s))for(let a of s)t.push(n+"="+encodeURIComponent(a));else s instanceof Date?t.push(n+"="+encodeURIComponent(s.toISOString())):typeof s!==null&&typeof s=="object"?t.push(n+"="+encodeURIComponent(JSON.stringify(s))):t.push(n+"="+encodeURIComponent(s))}return t.join("&")}};var jl=class extends Dt{constructor(t){super();this.pb=new aa("https://auth.system3.md",t.loginManager.authStore),this.tokenStore=t.tokenStore}async readFile(t){if(!t.meta)throw new Error("cannot pull file with missing hash");let r=t.meta.hash,s=await this.tokenStore.getFileToken(vt.encode(t.s3rn),r,t.mimetype,0),i=(await(await Et(s.baseUrl+"/download-url",{method:"GET",headers:{Authorization:`Bearer ${s.token}`}})).json()).downloadUrl;return(await Et(i)).arrayBuffer()}async writeFile(t){let r=await t.caf.read(),s=await t.caf.hash();if(this.log("writeFile",s),!(r&&s))throw new Error("invalid caf");let n=await this.tokenStore.getFileToken(vt.encode(t.s3rn),s,t.mimetype,r.byteLength),a=await Et(n.baseUrl+"/upload-url",{method:"POST",headers:{Authorization:`Bearer ${n.token}`}}),i=await a.json();if(a.status!==200)throw new Error(i.error);let l=i.uploadUrl;await Et(l,{method:"PUT",headers:{"Content-Type":t.mimetype},body:r})}destroy(){this.pb.cancelAllRequests(),this.pb=null,this.tokenStore=null}};var gr=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var Yl=class extends ft{constructor(t,r){super();this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.log("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),s=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(s)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},kr=class extends ft{constructor(t,r){super();this.settings=t;this.patterns=[];this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new gr("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new gr(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new gr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let n=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([i])=>n.test(i)).reduce((i,[l,c])=>(i[l]=c,i),{})}let s=this.getNestedValue(t);return s===void 0?{}:s}async set(t){if(this.destroyed)throw new gr("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new gr("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let s=this.patterns.find(this.isWildcardPattern);if(s){if(this.path.length===1){let l=new RegExp(`^${s.wildcardPattern}$`),c={...r};return Object.entries(t).forEach(([u,d])=>{l.test(u)&&(c[u]=d)}),c}let n={...r},a=n;this.path.forEach(l=>{a[l]=a[l]||{},a=a[l]});let i=new RegExp(`^${s.wildcardPattern}$`);return Object.entries(t).forEach(([l,c])=>{i.test(l)&&(a[l]=c)}),n}return this.setNestedValue(r,t)})}catch(r){let s=r instanceof Error?r.message:"Unknown error";throw new gr(`Failed to set value at path ${this.getPath()}: ${s}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new gr("Cannot use destroyed settings",this.getPath());let s=this.get(),n=t(s);!r&&JSON.stringify(s)===JSON.stringify(n)||await this.set(n)}async flush(){if(this.destroyed)throw new gr("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(i=>i),s=[],n=[],a=[];return r.forEach((i,l)=>{let c=i.match(/^\[(\w+)=(.+)\]$/),u=i.match(/^\((.+?)\)$/);if(c){let[,d,m]=c,g=l>0?n[l-1]:i.split("[")[0];a.push({type:"arrayMatch",key:d,value:m,level:l}),s.push(i),n.push(g)}else if(u){let[,d]=u;a.push({type:"wildcard",wildcardPattern:this.createPatternRegex(d),level:l}),s.push(i),n.push(i)}else s.push(i),n.push(i)}),[s,n,a]}getNestedValue(t){let r=t,s=this.patterns.find(this.isWildcardPattern);if(s&&this.path.length===1){let a=new RegExp(`^${s.wildcardPattern}$`);return Object.entries(r).filter(([l])=>a.test(l)).reduce((l,[c,u])=>(l[c]=u,l),{})}let n=this.patterns[0];if((n==null?void 0:n.type)==="arrayMatch"){let a=this.basePath[0];if(!Array.isArray(r[a]))return;let i=r[a].find(c=>c[n.key]===n.value);if(!i)return;let l=this.basePath.slice(n.level+1);if(l.length>0){let c=i;for(let u of l){if(!c||typeof c!="object")return;c=c[u]}return c}return i}for(let a=0;a<this.basePath.length;a++){if(!r)return;r=r[this.basePath[a]]}return r}setNestedValue(t,r){let s={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];s[l]||(s[l]=[]);let c=s[l].findIndex(d=>d[n.key]===n.value),u=this.basePath.slice(n.level+1);if(c>=0)if(u.length>0){let d=s[l][c];for(let g=0;g<u.length-1;g++){let h=u[g];d[h]=d[h]||{},d=d[h]}let m=u[u.length-1];d[m]=r}else s[l][c]={...s[l][c],...r,[n.key]:n.value};else if(u.length>0){let d={[n.key]:n.value},m=d;for(let h=0;h<u.length-1;h++){let _=u[h];m[_]={},m=m[_]}let g=u[u.length-1];m[g]=r,s[l].push(d)}else s[l].push({...r,[n.key]:n.value});return s}let a=s;for(let l=0;l<this.basePath.length-1;l++){let c=this.basePath[l];a[c]=a[c]||{},a=a[c]}let i=this.basePath[this.basePath.length-1];return a[i]=r,s}getParent(){if(this.destroyed)throw new gr("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new kr(this.settings,t)}getChild(t,r){let s=[...this.path,t].join("/");return r?r(this.settings,s):(this.log("getChild",this.path,t,s,this.patterns),new kr(this.settings,s))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new gr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new gr("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(c=>c[s.key]!==s.value),r[l].length===0&&delete r[l]),r}let n=r,a=this.basePath.slice(0,-1);for(let l of a){if(!n[l])return r;n=n[l]}let i=this.basePath[this.basePath.length-1];return delete n[i],r})}subscribe(t){if(this.destroyed)throw new gr("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var ks=class extends kr{constructor(t,r,s=!0){super(t,r);this.enabled=s}isExtensionEnabled(t){var n,a;let s=(t.split(".").pop()||"").toLowerCase();if(s==="md"||Je().enableCanvasSync&&s==="canvas")return!0;if(!this.enabled||!Je().enableAttachmentSync)return!1;for(let[i,l]of Object.entries(ks.schema)){let c=i;if(((n=this.get()[c])!=null?n:l.defaultEnabled)&&l.extensions.includes(s))return!0}return(a=this.get().otherTypes)!=null?a:ks.schema.otherTypes.defaultEnabled}getCategory(t){var n;let r=ks.schema[t];return{enabled:(n=this.get()[t])!=null?n:r.defaultEnabled,name:r.name,description:r.description,extensions:r.extensions}}getCategories(){return Object.keys(ks.schema).reduce((t,r)=>(t[r]=this.getCategory(r),t),{})}async toggleCategory(t,r){await this.update(s=>({...s,[t]:r})),this.log(`setting ${t} to ${r}`),this.notifyListeners()}async resetToDefault(){await this.update(()=>({...ks.defaultFlags}))}},Cs=ks;Cs.schema={images:{name:"Images",description:"Sync image files (.bmp, .png, .jpg, .jpeg, .gif, .svg, .webp, .avif)",extensions:["bmp","png","jpg","jpeg","gif","svg","webp","avif"],defaultEnabled:!0},audio:{name:"Audio",description:"Sync audio files (.mp3, .wav, .m4a, .3gp, .flac, .ogg, .oga, .opus)",extensions:["mp3","wav","m4a","3gp","flac","ogg","oga","opus"],defaultEnabled:!0},videos:{name:"Videos",description:"Sync video files (.mp4, .webm, .ogv, .mov, .mkv)",extensions:["mp4","webm","ogv","mov","mkv"],defaultEnabled:!0},pdfs:{name:"PDFs",description:"Sync PDF files (.pdf)",extensions:["pdf"],defaultEnabled:!0},otherTypes:{name:"Other files",description:"Sync unsupported file types",extensions:[],defaultEnabled:!1}},Cs.defaultFlags=Object.fromEntries(Object.entries(ks.schema).map(([t,r])=>[t,r.defaultEnabled]));var yi=require("obsidian");async function _x(o){let e=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function Jo(o){return!!o&&o instanceof xi}var Jl=class extends Dt{constructor(t){super();this.db=null;this.setLoggers("[ContentAddressedFileStore]"),this.dbName=`${t}-relay-hashes`,this.ready=this.openDB()}async openDB(){return new Promise((t,r)=>{let s=indexedDB.open(this.dbName,1);s.onupgradeneeded=n=>{let a=s.result;a.objectStoreNames.contains("files")||a.createObjectStore("files",{keyPath:"path"})},s.onsuccess=n=>{this.db=s.result,t()},s.onerror=n=>{this.error("Error opening ContentAddressedFile database:",s.error),r(s.error)}})}async saveHash(t,r,s){if(await this.ready,!!this.db)return new Promise((n,a)=>{if(!this.db)return;let c=this.db.transaction(["files"],"readwrite").objectStore("files").put({path:t,hash:r,modifiedAt:s});c.onsuccess=()=>n(),c.onerror=()=>{this.error("Error saving hash:",c.error),a(c.error)}})}async getHash(t){return await this.ready,this.db?new Promise((r,s)=>{if(!this.db)return null;let i=this.db.transaction(["files"],"readonly").objectStore("files").get(t);i.onsuccess=()=>{r(i.result||null)},i.onerror=()=>{this.error("Error retrieving hash:",i.error),s(i.error)}}):null}async removeHash(t){if(await this.ready,!!this.db)return new Promise((r,s)=>{if(!this.db)return null;let i=this.db.transaction(["files"],"readwrite").objectStore("files").delete(t);i.onsuccess=()=>r(),i.onerror=()=>{this.error("Error removing hash:",i.error),s(i.error)}})}destroy(){this.db&&(this.db.close(),this.db=null)}},ad=class extends Dt{constructor(t,r,s,n){super();this.vault=t;this.path=r;this.metadataCache=s;this.store=n;this.content=null;this._tfile=null;let a=this.vault.getAbstractFileByPath(r);a&&a instanceof yi.TFile&&(this._tfile=a)}get tfile(){if(!this._tfile){let t=this.vault.getAbstractFileByPath(this.path);if(t&&t instanceof yi.TFile)this._tfile=t;else throw new Error("missing tfile")}return this._tfile}async loadHashFromStore(){try{let t=await this.store.getHash(this.path);if(t&&t.modifiedAt===this.tfile.stat.mtime)return t.hash}catch(t){this.warn("Failed to load hash from store:",t)}}get modifiedAt(){if(!this.tfile)throw new Error("missing tfile");return this.tfile.stat.mtime}async read(){this.log("reading content from disk");let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),s=await _x(r);try{await this.store.saveHash(this.path,s,t)}catch(n){this.warn("Failed to save hash to store:",n)}return r}exists(){if(this._tfile)return!0;let t=this.vault.getAbstractFileByPath(this.path);return t&&t instanceof yi.TFile?(this._tfile=t,!0):!1}async clear(){this._tfile=null,this.store.removeHash(this.path).catch(t=>{this.warn("Failed to remove hash from store:",t)})}async hash(){let t=await this.loadHashFromStore();if(t)return t;if(await this.read(),t=await this.loadHashFromStore(),!t)throw new Error("missing hash");return t}destroy(){this.vault=null,this._tfile=null,this.metadataCache=null}},xi=class extends ft{constructor(t,r,s,n,a){super();this.path=t;this.guid=r;this.metadataCache=s;this.hashStore=n;this.ready=!1;this.connected=!0;this.offFileInfo=()=>{};this.uploadError=void 0;this.s3rn=a.relayId?new qo(a.relayId,a.guid,r):new fi(a.guid,r),this._parent=a,this.setLoggers(`[SharedFile](${this.path})`),this.name=this.path.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault;let i=this.sharedFolder.syncStore.typeRegistry.getTypeForPath(t);if(!i)throw new Error("unexpected synctype");this.type=i,this.caf=new ad(this.vault,this.sharedFolder.getPath(t),this.metadataCache,this.hashStore),this.log("created")}get mimetype(){return _s(this.path)}disconnect(){}get inMeta(){return!!this.sharedFolder.syncStore.getMeta(this.path)}move(t){t!==this.path&&(this.debug("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedFile](${this.path})`))}get lastModified(){return this.stat.mtime}async push(){if(this.log("push"),!this.sharedFolder.connected)return this.log("skipping push -- folder is disconnected"),"";if(!this.sharedFolder.syncStore.canSync(this.path))return this.log("skipping push -- filetype is disabled"),"";let t=await this.caf.hash(),r=this.sharedFolder.syncStore.getMeta(this.path);if(!r||t&&r.hash!==t)try{await this.sharedFolder.cas.writeFile(this),this.sharedFolder.markUploaded(this),this.uploadError=void 0,this.notifyListeners()}catch(s){let n="Failed to push file";try{n=s.toString().slice(7)}catch(a){}this.uploadError=n,this.notifyListeners()}return await this.caf.hash()}async sync(){var r;this.log("sync");let t=this.sharedFolder.syncStore.getMeta(this.path);t?await this.caf.hash()!==t.hash&&(t.synctime>this.stat.mtime?(this.warn("synctime",t.synctime,(r=this.meta)==null?void 0:r.synctime,this.stat.mtime),await this.pull()):await this.push()):await this.push()}shouldPull(t){return!this.tfile||t.synctime>this.stat.mtime}async pull(){this.log("pull");let t=this.sharedFolder.syncStore.getMeta(this.path);if(t?this.meta=t:this.warn("meta fail",t),!this.meta)throw new Error("cannot pull without meta");if(this.caf.exists()&&await this.caf.hash()===this.meta.hash)return;let r=await this.sharedFolder.cas.readFile(this);await this.vault.adapter.writeBinary(this.sharedFolder.getPath(this.path),r),await this.caf.hash()}get tfile(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof yi.TFile)return t;throw new Error("TFile API used before file existed")}get stat(){return this.tfile.stat}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.s3rn instanceof Br?!1:(this.s3rn instanceof Wo&&(this.sharedFolder.relayId?this.s3rn=new qo(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new fi(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected)))}async read(){return this.vault.read(this.tfile)}async rename(t){this.move(t)}async delete(){return await this.caf.clear(),this.vault.delete(this.tfile)}async write(t){this.vault.adapter.write(this.tfile.path,t),await this.caf.hash()}async append(t){this.vault.append(this.tfile,t),await this.caf.hash()}cleanup(){}destroy(){var t;(t=this.offFileInfo)==null||t.call(this),this.offFileInfo=null,this._parent=null,this.metadataCache=null,this.caf.destroy()}};function bo(o,e){if(!o||!e)return!1;for(let t in o)if(typeof o[t]=="object"&&o[t]!==null){if(!bo(o[t],e[t]))return!1}else if(o[t]!==e[t])return!1;for(let t in e)if(!(t in o))return!1;return!0}function Cr(o){return o instanceof wt}var wt=class extends Ko{constructor(t,r,s,n){let a=n.relayId?new nr(n.relayId,n.guid,r):new sn(n.guid,r);super(r,a,n.tokenStore,s);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=n,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this.unsubscribes.push(this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[Canvas](${this.path})`);try{let i=`${this.sharedFolder.appId}-relay-canvas-${this.guid}`;this._persistence=new ws(i,this.ydoc)}catch(i){throw this.warn("Unable to open persistence.",this.guid),console.error(i),i}this.whenSynced().then(()=>{this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",vt.encode(this.s3rn))}catch(i){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),this._tfile=null}get yedges(){return this.ydoc.getMap("edges")}get ynodes(){return this.ydoc.getMap("nodes")}textNode(t){let r=this.ydoc.getText(t.id);return r.toString()===""&&r.insert(0,t.text),r}static exportCanvasData(t){let r=t.getMap("edges"),s=t.getMap("nodes"),n=[],a=[];for(let[,i]of r.entries())n.push({...i});for(let[,i]of s.entries()){let l=t.getText(i.id);a.push({...i,text:l.toString()||i.text})}return{edges:n,nodes:a}}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async connect(){return this.sharedFolder.s3rn instanceof Br?!1:(this.s3rn instanceof sn&&(this.sharedFolder.relayId?this.s3rn=new nr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new sn(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Or(this._persistence.db,["updates"],"readonly"),r=await Ho(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new Zr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new Zr(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}get sharedFolder(){return this._parent}static checkExtension(t){return t.endsWith(".canvas")&&Je().enableCanvasSync}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async applyJSON(t){if(t==="")return;let r=JSON.parse(t);return await this.applyData(r)}async importFromView(t){if(t.file&&this.sharedFolder.getVirtualPath(t.file.path)===this.path)return await this.applyData(t.canvas.getData());console.warn("tried to apply updates from another file",this.path)}async applyData(t){let r=this.yedges,s=this.ynodes,n=new Set,a=new Map,i=new Set,l=new Map,c=new Set;t.nodes.forEach(u=>{n.add(u.id);let d=s.get(u.id);d?bo(d,u)||a.set(u.id,u):(a.set(u.id,u),u.type==="text"&&this.textNode(u))});for(let u of s.keys())n.has(u)||i.add(u);t.edges.forEach(u=>{n.add(u.id);let d=r.get(u.id);d&&bo(d,u)||l.set(u.id,u)});for(let u of r.keys())n.has(u)||c.add(u);(a.size>0||i.size>0||l.size>0||c.size>0)&&Xe(this.ydoc,()=>{for(let u of a.values())this.ynodes.set(u.id,u);for(let u of i)this.ynodes.delete(u);for(let u of l.values())this.yedges.set(u.id,u);for(let u of c)this.yedges.delete(u)},this)}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get mimetype(){return _s(this.path)}get json(){let t=wt.exportCanvasData(this.ydoc);return JSON.stringify(t)}async cleanup(){}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.json.length}destroy(){var t,r;this.unsubscribes.forEach(s=>{s()}),super.destroy(),this.ydoc.destroy(),(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}};var id=class extends Ss{constructor(){super(...arguments);this.notifyListeners=(0,ut.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){let s=this.find(n=>n.guid===t.guid);return s&&s!==t&&(this.error("duplicate guid",s,t),this._set.delete(s)),this._set.add(t),r&&this.notifyListeners(),this}},Ql=class extends Ko{constructor(t,r,s,n,a,i,l,c,u,d,m,g,h,_=!0){var v;let w=h?new Vo(h,r):new Br(r);super(r,w,l,n);this.appId=t;this.metadataCache=u;this.hashStore=d;this.backgroundSync=m;this._settings=g;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getSyncFiles(),r=[],s=this.placeHold(t);t.forEach(n=>{let a=this.getVirtualPath(n.path),i=s.contains(a);if(_r.checkPath(a)){let l=this.getSyncFolder(a,!1);r.push(l)}else if(Lt.checkExtension(a))if(i){let l=this.uploadDoc(a,!1);r.push(l)}else{let l=this.getDoc(a,!1);r.push(l)}else if(wt.checkExtension(a))if(i){let l=this.uploadCanvas(a,!1);r.push(l)}else{let l=this.getCanvas(a,!1);r.push(l)}else if(this.syncStore.canSync(a))if(i){let l=this.uploadSyncFile(a,!1);r.push(l)}else{let l=this.downloadSyncFile(a,!1);r.push(l)}}),r.length>0&&this.fset.update()};this.path=s,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=i,this.vault=a,this.files=new Map,this.fset=new id,this.pendingUpload=new jo(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.relayManager=c,this.relayId=h,this.diskBufferStore=new Nl,this._shouldConnect=(v=this.settings.connect)!=null?v:!0,this.authoritative=!_,this.syncSettingsManager=this._settings.getChild("sync",(A,O)=>new Cs(A,O)),this.syncStore=new Wl(this.ydoc,this.path,this.pendingUpload,this.syncSettingsManager),this.syncStore.on(async()=>{await this.syncFileTree(this.syncStore)}),this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(A=>{this.remote=A.find(O=>O.guid==this.guid)})),this.proxy=ix(this,this.path,A=>this.getVirtualPath(A));try{this._persistence=new ws(this.guid,this.ydoc)}catch(A){throw this.warn("Unable to open persistence.",this.guid),console.error(A),A}n.loggedIn&&this.connect(),this.cas=new jl(this),this.whenReady().then(()=>{this.destroyed||(this.addLocalDocs(),this.syncFileTree(this.syncStore))}),this.whenSynced().then(async()=>{this.syncStore.start();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",vt.encode(this.s3rn))}catch(A){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),Bt.set(this,this.path)}get server(){return this._server}set server(t){if(t===this._server)return;this.warn("server changed -- reinitializing all connections");let r=this.shouldConnect;this.reset();let s=[];this.fset.forEach(n=>{n instanceof Ko&&(n.connected&&s.push(n),n.reset())}),this.tokenStore.clear(n=>{var a;return!!(this.relayId&&((a=n.token)!=null&&a.docId.startsWith(this.relayId)))}),r&&(this.connect(),s.forEach(n=>{n.connect()})),this._server=t}get tfolder(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof ut.TFolder))throw new Error("tfolder is not a folder");return t}isSyncableTFile(t){let r=this.checkPath(t.path);if(t instanceof ut.TFolder&&!_r.checkPath)throw new Error("logical error");let s=this.getVirtualPath(t.path),n=this.syncStore.canSync(s),a=this.syncSettingsManager.isExtensionEnabled(s);return r&&n&&a}getSyncFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof ut.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return ut.Vault.recurseChildren(t,s=>{s!==t&&r.push(s)}),r.filter(s=>this.isSyncableTFile(s))}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.syncStore),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}async sync(){await this.syncFileTree(this.syncStore)}connect(){return this.s3rn instanceof Vo&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new Vo(this.relayId,this.guid):new Br(this.guid),this._settings.update(s=>({...s,relay:this.relayId})),t&&(this._server=t.relay.providerId,this.unsubscribes.push(t.relay.subscribe(s=>{s.guid===this.relayId&&(this.server=s.providerId)}))),this.server=t==null?void 0:t.relay.providerId,this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._serverSynced||this.synced)}async count(){if(this._persistence.db===null)throw new Error("unexpected missing database");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Or(this._persistence.db,["updates"],"readonly"),r=await Ho(t);return this._dbsize=r,this._dbsize}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}hasLocalDB(){return this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new Zr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>{if(this._persistence.synced){await this.count(),this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new Zr(t,()=>(this._persistence.synced&&this._dbsize&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,s,n){if(n==null||n.push(`${s.path} was renamed to ${this.getPath(r)}`),s instanceof ut.TFile){let a=(0,Ir.dirname)(r);this.existsSync(a)||(await this.mkdir(a),n==null||n.push(`creating directory ${a}`))}await this.fileManager.renameFile(s,(0,ut.normalizePath)(this.getPath(r))).then(()=>{t.move(r)})}async _handleServerCreate(t,r){let s=(0,Ir.dirname)(t);if(this.existsSync(s)||(await this.mkdir(s),r==null||r.push(`creating directory ${s}`)),Lt.checkExtension(t))return r==null||r.push(`created local file for remotely added doc ${t}`),await this.downloadDoc(t,!1);if(wt.checkExtension(t))return r==null||r.push(`created local file for remotely added canvas ${t}`),await this.downloadCanvas(t,!1);if(_r.checkPath(t))return this.getSyncFolder(t,!1);if(this.syncStore.canSync(t))return this.downloadSyncFile(t,!1);throw new Error("unexpected file")}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.syncStore.delete(t);return}}applyRemoteState(t,r,s,n){let a=this.files.get(t),i=this.syncStore.getMeta(r);if(!i)return this.warn("unknown sync type",r),{op:"noop",path:r,promise:Promise.resolve()};if(this.existsSync(r))return a&&Jo(a)&&a.shouldPull(i)?{op:"update",path:r,promise:a.pull()}:{op:"noop",path:r,promise:Promise.resolve()};if(s.has(t)&&a){let c=this.getPath(a.path),u=this.vault.getAbstractFileByPath(c);if(u){let d=this._handleServerRename(a,r,u,n);return{op:"rename",path:r,from:c,to:r,promise:d}}}let l=this._handleServerCreate(r,n);return{op:"create",path:r,promise:l}}cleanupExtraLocalFiles(t,r){let s=this.getSyncFiles(),n=[],a=s.filter(c=>c instanceof ut.TFolder),i=s.filter(c=>c instanceof ut.TFile),l=c=>{var w,v;let u=this.isSyncableTFile(c),d=this.checkPath(c.path),m=t.contains(c.path.slice(this.path.length)),g=this.pendingUpload.has(this.getVirtualPath(c.path)),h=this.getVirtualPath(c.path),_=((w=this._provider)==null?void 0:w.synced)&&((v=this._persistence)==null?void 0:v.synced);if(d&&u&&!m&&!g&&_){r.push(`deleted local file ${h} for remotely deleted doc`);let A=this.vault.adapter.trashLocal(c.path);n.push({op:"delete",path:h,promise:A})}};return i.forEach(l),a.forEach(l),n}syncByType(t,r,s,n){t.forEach((a,i)=>{this._assertNamespacing(i),n.contains(a.type)&&(this._assertNamespacing(i),s.push(this.applyRemoteState(a.id,i,t.remoteIds,r)))})}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let s=this.syncFileTreePromise.getPromise();return s.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),s}let r=async()=>{try{let s=[],n=[];this.ydoc.transact(async()=>{this.syncStore.migrateUp(),this.syncByType(t,n,s,["folder"])},this),await Promise.all(s.map(u=>u.promise)),this.ydoc.transact(async()=>{this.syncByType(t,n,s,this.syncStore.typeRegistry.getEnabledFileSyncTypes()),this.syncStore.commit()},this);let a=s.filter(u=>u.op==="create"),i=s.filter(u=>u.op==="rename"),l=s.map(u=>u.path);await Promise.all([...a,...i].map(u=>ui(u.promise,u)));let c=this.cleanupExtraLocalFiles(l,n);[...s,...c].every(u=>u.op==="noop")?this.debug("sync: noop"):(this.log("remote paths",l),this.log("operations",[...s,...c])),(i.length>0||a.length>0||c.length>0)&&this.fset.update(),n.length>0&&this.log(`syncFileTree diff:
`+n.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new Hl(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,Ir.join)(this.path,t.path);return this.vault.adapter.read((0,ut.normalizePath)(r))}existsSync(t){let r=(0,ut.normalizePath)((0,Ir.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,Ir.join)(this.path,t.path);return this.vault.adapter.exists((0,ut.normalizePath)(r))}flush(t,r){let s=(0,Ir.join)(this.path,t.path);return this.log("writing to ",(0,ut.normalizePath)(s)),this.vault.adapter.write((0,ut.normalizePath)(s),r)}getPath(t){return(0,Ir.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,Ir.join)(this.path,t);return this.vault.adapter.mkdir((0,ut.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+Ir.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof ut.TFile?r:null}getDoc(t,r=!0){let s=this.syncStore.get(t);if(s!==void 0){let n=this.files.get(s);if(n!==void 0){if(n.move(t),!eo(n))throw new Error("unexpected ifile type");return n}else return this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r)}else{this.warn("[getDoc]: creating new shared ID for existing tfile");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!(n instanceof ut.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([n]).length>0?this.uploadDoc(t):this.createDoc(t,r)}}getCanvas(t,r=!0){let s=this.syncStore.get(t);if(s!==void 0){let n=this.files.get(s);if(n!==void 0){if(n.move(t),!Cr(n))throw new Error("unexpected ifile type");return n}else return this.log("[getCanvas]: creating canvas for shared ID"),this.createCanvas(t,r)}else{this.warn("[getCanvas]: creating new shared ID for existing tfile");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!(n instanceof ut.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([n]).length>0?this.uploadCanvas(t):this.createCanvas(t,r)}}async markUploaded(t){if(eo(t)){let r=pi(t.guid);this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,r)},this);return}if(Cr(t)){let r=nx(t.guid);this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,r)},this);return}if(zu(t)){let r=ql(t.guid);this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,r)},this);return}if(Jo(t)){let r=this.syncStore.typeRegistry.getTypeForPath(t.path);if(!r)throw new Error("unexpected sync type");let s=await t.caf.hash();if(!s)throw new Error("file hash not yet computed");let n=this.syncStore.getMeta(this.path);if(n&&t.caf.value===n.hash)return;let a=ax(r,t.guid,t.mimetype,s,t.stat.mtime);this.log("new meta",a),this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,a)},this);return}}getFile(t,r=!0){let s=this.syncStore.get(t);if(s){let n=this.files.get(s);if(n)return n}return Lt.checkExtension(t)?this.getDoc(t):wt.checkExtension(t)?this.getCanvas(t):_r.checkPath(t)?this.getSyncFolder(t,r):this.syncStore.canSync(t)?this.getSyncFile(t,r):null}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(s=>{let n=this.getVirtualPath(s.path);this.syncStore.has(n)||(this.log("place hold new",n),this.syncStore.new(n),r.push(n))})},this),r}getOrCreateCanvas(t,r){let s=this.files.get(t)||new wt(r,t,this.loginManager,this);if(!Cr(s))throw new Error("unexpected ifile type");return s.move(r),s}async downloadCanvas(t,r=!0){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error(`called download on item that is not in ids ${t}`);let n=this.getOrCreateCanvas(s,t);return n.markOrigin("remote"),ui(this.backgroundSync.enqueueCanvasDownload(n),n.path),this.files.set(s,n),this.fset.add(n,r),n}uploadCanvas(t,r=!0){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("expected guid");let n=this.getOrCreateCanvas(s,t),a=n.getOrigin(),i=this.awaitingUpdates();return(async()=>{if(!await this.exists(n))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,u,d]=await Promise.all([this.read(n),a,i]);!d&&u===void 0&&(this.log(`[${n.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{try{n.applyJSON(c)}catch(m){throw console.warn(c),m}},this._persistence),n.markOrigin("local"),this.log(`[${n.path}] Uploading file`),await this.backgroundSync.enqueueSync(n),this.markUploaded(n))})(),this.files.set(s,n),this.fset.add(n,r),n}createCanvas(t,r){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("expected guid");let n=this.getOrCreateCanvas(s,t);return(async()=>this.whenReady().then(async()=>{let a=await n.getServerSynced();n.stat.size===0&&!a?this.backgroundSync.enqueueCanvasDownload(n):this.pendingUpload.get(n.path)&&this.backgroundSync.enqueueSync(n)}))(),this.files.set(s,n),this.fset.add(n,r),n}viewDoc(t){let r=this.syncStore.get(t);if(!r)return;let s=this.files.get(r);if(!eo(s))throw new Error("unexpected ifile type");return s}viewSyncFile(t){let r=this.syncStore.get(t);if(!r)return;let s=this.files.get(r);if(!Jo(s))throw new Error("unexpected ifile type");return s}getOrCreateDoc(t,r){let s=this.files.get(t)||new Lt(r,t,this.loginManager,this);if(!eo(s))throw new Error("unexpected ifile type");return s.move(r),s}async downloadDoc(t,r=!0){if(!Lt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error(`called download on item that is not in ids ${t}`);let n=this.getOrCreateDoc(s,t);return n.markOrigin("remote"),ui(this.backgroundSync.enqueueDownload(n),n.path),this.files.set(s,n),this.fset.add(n,r),n}uploadDoc(t,r=!0){if(!Lt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("missing guid");let n=this.getOrCreateDoc(s,t),a=n.getOrigin(),i=this.awaitingUpdates();return(async()=>{if(!await this.exists(n))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,u,d]=await Promise.all([this.read(n),a,i]),m=n.ydoc.getText("contents");!d&&u===void 0&&(this.log(`[${n.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{m.insert(0,c)},this._persistence),n.markOrigin("local"),this.log(`[${n.path}] Uploading file`),await this.backgroundSync.enqueueSync(n),this.markUploaded(n))})(),this.files.set(s,n),this.fset.add(n,r),n}createDoc(t,r=!0){if(!Lt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("expected guid");let n=this.getOrCreateDoc(s,t);return(async()=>this.whenReady().then(async()=>{var i;let a=await n.getServerSynced();((i=n.tfile)==null?void 0:i.stat.size)===0&&!a?this.backgroundSync.enqueueDownload(n):this.pendingUpload.get(n.path)&&this.backgroundSync.enqueueSync(n)}))(),this.files.set(s,n),this.fset.add(n,r),n}getOrCreateSyncFolder(t,r){let s=this.files.get(t)||new _r(r,t,this.relayManager,this);if(!zu(s))throw new Error("unexpected ifile type");return s.move(r),s}getSyncFolder(t,r){if(this.log("[getSyncFolder]","getting syncfolder"),!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("expected guid");let n=this.getOrCreateSyncFolder(s,t);return this.files.set(s,n),this.fset.add(n,r),n}getOrCreateSyncFile(t,r,s){let n=this.files.get(t)||new xi(r,t,this.metadataCache,this.hashStore,this);if(!Jo(n))throw new Error("unexpected ifile type");return n.move(r),this.files.set(t,n),n}downloadSyncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error(`called download on item that is not in ids ${t}`);let n=this.syncStore.getMeta(t);if(!n||!n.hash)return this.uploadSyncFile(t,r);let a=this.getOrCreateSyncFile(s,t,n.hash);return ui(a.pull()),this.files.set(s,a),this.fset.add(a,r),a}uploadSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("missing guid");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!n)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(n instanceof ut.TFile))throw new Error(`Upload failed, expected file at ${t}`);let a=this.getOrCreateSyncFile(s,t,n);return(async()=>{if(!this.existsSync(t))throw new Error(`Upload failed, file does not exist at ${t}`);await a.push()})(),this.fset.add(a,r),a}getSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("missing guid");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!n)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(n instanceof ut.TFile))throw new Error(`Upload failed, expected file at ${t}`);let a=this.getOrCreateSyncFile(s,t,n);return this.syncStore.getMeta(t)?a.pull():(this.log("get syncfile missing meta"),a.push()),this.files.set(s,a),this.fset.add(a,r),a}uploadFile(t,r=!0){if(Lt.checkExtension(t))return this.uploadDoc(t,r);if(wt.checkExtension(t))return this.uploadCanvas(t,r);if(_r.checkPath(t))return this.getSyncFolder(t,r);if(this.syncStore.canSync(t))return this.uploadSyncFile(t,r);throw new Error("unexpectedly unable to upload")}deleteFile(t){let r=this.syncStore.get(t);r&&this.ydoc.transact(()=>{this.syncStore.delete(t);let s=this.files.get(r);s&&(s.cleanup(),this.fset.delete(s)),this.files.delete(r)},this)}renameFile(t,r){let s=t.path,n="",a="";try{n=this.getVirtualPath(s)}catch(i){this.log("Moving out of shared folder")}try{a=this.getVirtualPath(r)}catch(i){this.log("Moving in from outside of shared folder")}if(!(!n&&!a))if(a){let i=this.syncStore.get(a);if(!i)return;let l=this.files.get(i);if(!n)this.ydoc.transact(()=>{this.syncStore.delete(a)},this),l&&(l.cleanup(),l.destroy(),this.fset.delete(l)),this.files.delete(i);else{if(!this.syncStore.get(a))return;let u=[];l instanceof _r&&this.syncStore.forEach((d,m)=>{if(m.startsWith(a+Ir.sep)){let g=m.replace(a,n);u.push([d.id,m,g])}}),this.ydoc.transact(()=>{this.syncStore.move(a,n),l&&l.move(n),u.forEach(d=>{let[m,g,h]=d;this.syncStore.move(g,h);let _=this.files.get(m);_&&_.move(h)})},this),this.syncStore.resolveMove(a)}}else{if(this.assertPath(s),!this.syncStore.canSync(n))return;this.placeHold([t]),this.uploadFile(n)}}destroy(){var t,r,s;this.destroyed=!0,this.unsubscribes.forEach(n=>{n()}),this.files.forEach(n=>{n.destroy(),this.files.delete(n.guid)}),this.syncStore.destroy(),this.syncSettingsManager.destroy(),super.destroy(),this.ydoc.destroy(),this.fset.clear(),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.syncStore=null,this.syncSettingsManager=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(s=this.syncFileTreePromise)==null||s.destroy(),this.syncFileTreePromise=null}},Xl=class extends Ss{constructor(t,r,s,n){super();this.relayManager=t;this.vault=r;this.settings=n;this.update=(0,ut.debounce)(this.notifyListeners,100);this.folderBuilder=s,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(a=>{let i=!1;this.items().forEach(l=>{let c=a.find(u=>u.guid==l.guid);l.remote!=c&&(i=!0),l.remote=c}),i&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(s=>s.filter(n=>n.guid!==t.guid)),r}lookup(t){let r=this.find(s=>s.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(s=>{if(!this.vault.getFolderByPath(s.path)){this.warn(`Invalid settings, ${s.path} does not exist`);return}this._new(s.path,s.guid,s==null?void 0:s.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,s,n){let a=this.find(u=>u.path==t&&u.guid==r);if(a)return a;let i=this.find(u=>u.guid==r);if(i)throw new Error(`This folder is already mounted at ${i.path}.`);if(this.find(u=>u.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let c=this.folderBuilder(t,r,s,n);return this._set.add(c),c}new(t,r,s,n){let a=this._new(t,r,s,n);return this.notifyListeners(),a}};var bc=require("@codemirror/state"),ya=require("obsidian");function J(){}function fe(o,e){for(let t in e)o[t]=e[t];return o}function Sx(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function ld(o){return o()}function ec(){return Object.create(null)}function Ce(o){o.forEach(ld)}function ht(o){return typeof o=="function"}function Z(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var Zl;function cd(o,e){return o===e?!0:(Zl||(Zl=document.createElement("a")),Zl.href=e,o===Zl.href)}function kx(o){return Object.keys(o).length===0}function ir(o,...e){if(o==null){for(let r of e)r(void 0);return J}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function ge(o,e,t){o.$$.on_destroy.push(ir(e,t))}function ye(o,e,t,r){if(o){let s=Cx(o,e,t,r);return o[0](s)}}function Cx(o,e,t,r){return o[1]&&r?fe(t.ctx.slice(),o[1](r(e))):t.ctx}function xe(o,e,t,r){if(o[2]&&r){let s=o[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){let n=[],a=Math.max(e.dirty.length,s.length);for(let i=0;i<a;i+=1)n[i]=e.dirty[i]|s[i];return n}return e.dirty|s}return e.dirty}function be(o,e,t,r,s,n){if(s){let a=Cx(e,t,r,n);o.p(a,s)}}function ve(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function ke(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function fd(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function ia(o){return o==null?"":o}function Ix(o,e,t){return o.set(t),e}function tc(o){return o&&ht(o.destroy)?o.destroy:J}var nn=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var la=class{constructor(e){bt(this,"_listeners","WeakMap"in nn?new WeakMap:void 0);bt(this,"_observer");bt(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let s of t)la.entries.set(s.target,s),(r=this._listeners.get(s.target))==null||r(s)})}};la.entries="WeakMap"in nn?new WeakMap:void 0;var Lx=!1;function Tx(){Lx=!0}function Px(){Lx=!1}function k(o,e){o.appendChild(e)}function De(o,e,t){let r=Dx(o);if(!r.getElementById(e)){let s=P("style");s.id=e,s.textContent=t,n2(r,s)}}function Dx(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function n2(o,e){return k(o.head||o,e),e.sheet}function I(o,e,t){o.insertBefore(e,t||null)}function C(o){o.parentNode&&o.parentNode.removeChild(o)}function nt(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function P(o){return document.createElement(o)}function to(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function K(o){return document.createTextNode(o)}function U(){return K(" ")}function Ie(){return K("")}function te(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function Fx(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function x(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function bi(o,e){for(let t in e)x(o,t,e[t])}function Ax(o){return Array.from(o.childNodes)}function ne(o,e){e=""+e,o.data!==e&&(o.data=e)}function lr(o,e){o.value=e==null?"":e}function de(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function Ne(o,e,t){o.classList.toggle(e,!!t)}function rc(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var Is=class{constructor(e=!1){bt(this,"is_svg",!1);bt(this,"e");bt(this,"n");bt(this,"t");bt(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=to(t.nodeName):this.e=P(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)I(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(C)}};function Mx(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function ca(o,e){return new o(e)}var Ls;function Lr(o){Ls=o}function vi(){if(!Ls)throw new Error("Function called outside component initialization");return Ls}function cr(o){vi().$$.on_mount.push(o)}function ud(o){vi().$$.on_destroy.push(o)}function Gt(){let o=vi();return(e,t,{cancelable:r=!1}={})=>{let s=o.$$.callbacks[e];if(s){let n=rc(e,t,{cancelable:r});return s.slice().forEach(a=>{a.call(o,n)}),!n.defaultPrevented}return!0}}function ro(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var an=[];var Hr=[],ua=[],Ex=[],u2=Promise.resolve(),pd=!1;function Rx(){pd||(pd=!0,u2.then(_i))}function wi(o){ua.push(o)}var dd=new Set,fa=0;function _i(){if(fa!==0)return;let o=Ls;do{try{for(;fa<an.length;){let e=an[fa];fa++,Lr(e),d2(e.$$)}}catch(e){throw an.length=0,fa=0,e}for(Lr(null),an.length=0,fa=0;Hr.length;)Hr.pop()();for(let e=0;e<ua.length;e+=1){let t=ua[e];dd.has(t)||(dd.add(t),t())}ua.length=0}while(an.length);for(;Ex.length;)Ex.pop()();pd=!1,dd.clear(),Lr(o)}function d2(o){if(o.fragment!==null){o.update(),Ce(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(wi)}}function Ox(o){let e=[],t=[];ua.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),ua=e}var oc=new Set,ln;function pe(){ln={r:0,c:[],p:ln}}function me(){ln.r||Ce(ln.c),ln=ln.p}function S(o,e){o&&o.i&&(oc.delete(o),o.i(e))}function T(o,e,t,r){if(o&&o.o){if(oc.has(o))return;oc.add(o),ln.c.push(()=>{oc.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}function Qo(o,e){let t=e.token={};function r(s,n,a,i){if(e.token!==t)return;e.resolved=i;let l=e.ctx;a!==void 0&&(l=l.slice(),l[a]=i);let c=s&&(e.current=s)(l),u=!1;e.block&&(e.blocks?e.blocks.forEach((d,m)=>{m!==n&&d&&(pe(),T(d,1,1,()=>{e.blocks[m]===d&&(e.blocks[m]=null)}),me())}):e.block.d(1),c.c(),S(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[n]=c),u&&_i()}if(Sx(o)){let s=vi();if(o.then(n=>{Lr(s),r(e.then,1,e.value,n),Lr(null)},n=>{if(Lr(s),r(e.catch,2,e.error,n),Lr(null),!e.hasCatch)throw n}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function da(o,e,t){let r=e.slice(),{resolved:s}=o;o.current===o.then&&(r[o.value]=s),o.current===o.catch&&(r[o.error]=s),o.block.p(r,t)}function Ae(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function Ux(o,e){T(o,1,1,()=>{e.delete(o.key)})}function $x(o,e,t,r,s,n,a,i,l,c,u,d){let m=o.length,g=n.length,h=m,_={};for(;h--;)_[o[h].key]=h;let w=[],v=new Map,A=new Map,O=[];for(h=g;h--;){let D=d(s,n,h),F=t(D),V=a.get(F);V?r&&O.push(()=>V.p(D,e)):(V=c(F,D),V.c()),v.set(F,w[h]=V),F in _&&A.set(F,Math.abs(h-_[F]))}let M=new Set,E=new Set;function R(D){S(D,1),D.m(i,u),a.set(D.key,D),u=D.first,g--}for(;m&&g;){let D=w[g-1],F=o[m-1],V=D.key,q=F.key;D===F?(u=D.first,m--,g--):v.has(q)?!a.has(V)||M.has(V)?R(D):E.has(q)?m--:A.get(V)>A.get(q)?(E.add(V),R(D)):(M.add(q),m--):(l(F,a),m--)}for(;m--;){let D=o[m];v.has(D.key)||l(D,a)}for(;g;)R(w[g-1]);return Ce(O),w}function Ue(o,e){let t={},r={},s={$$scope:1},n=o.length;for(;n--;){let a=o[n],i=e[n];if(i){for(let l in a)l in i||(r[l]=1);for(let l in i)s[l]||(t[l]=i[l],s[l]=1);o[n]=i}else for(let l in a)s[l]=1}for(let a in r)a in t||(t[a]=void 0);return t}function We(o){return typeof o=="object"&&o!==null?o:{}}var p2=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],m2=new Set([...p2]);function H(o){o&&o.c()}function B(o,e,t){let{fragment:r,after_update:s}=o.$$;r&&r.m(e,t),wi(()=>{let n=o.$$.on_mount.map(ld).filter(ht);o.$$.on_destroy?o.$$.on_destroy.push(...n):Ce(n),o.$$.on_mount=[]}),s.forEach(wi)}function N(o,e){let t=o.$$;t.fragment!==null&&(Ox(t.after_update),Ce(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function g2(o,e){o.$$.dirty[0]===-1&&(an.push(o),Rx(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function re(o,e,t,r,s,n,a=null,i=[-1]){let l=Ls;Lr(o);let c=o.$$={fragment:null,ctx:[],props:n,update:J,not_equal:s,bound:ec(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:ec(),dirty:i,skip_bound:!1,root:e.target||l.$$.root};a&&a(c.root);let u=!1;if(c.ctx=t?t(o,e.props||{},(d,m,...g)=>{let h=g.length?g[0]:m;return c.ctx&&s(c.ctx[d],c.ctx[d]=h)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](h),u&&g2(o,d)),m}):[],c.update(),u=!0,Ce(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){Tx();let d=Ax(e.target);c.fragment&&c.fragment.l(d),d.forEach(C)}else c.fragment&&c.fragment.c();e.intro&&S(o.$$.fragment),B(o,e.target,e.anchor),Px(),_i()}Lr(l)}var y2;typeof HTMLElement=="function"&&(y2=class extends HTMLElement{constructor(e,t,r){super();bt(this,"$$ctor");bt(this,"$$s");bt(this,"$$c");bt(this,"$$cn",!1);bt(this,"$$d",{});bt(this,"$$r",!1);bt(this,"$$p_d",{});bt(this,"$$l",{});bt(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let s=this.$$c.$on(e,t);this.$$l_u.set(t,s)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let s=this.$$l_u.get(t);s&&(s(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(n){return()=>{let a;return{c:function(){a=P("slot"),n!=="default"&&x(a,"name",n)},m:function(c,u){I(c,a,u)},d:function(c){c&&C(a)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=Mx(this);for(let n of this.$$s)n in r&&(t[n]=[e(n)]);for(let n of this.attributes){let a=this.$$g_p(n.name);a in this.$$d||(this.$$d[a]=md(a,n.value,this.$$p_d,"toProp"))}for(let n in this.$$p_d)!(n in this.$$d)&&this[n]!==void 0&&(this.$$d[n]=this[n],delete this[n]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let s=()=>{this.$$r=!0;for(let n in this.$$p_d)if(this.$$d[n]=this.$$c.$$.ctx[this.$$c.$$.props[n]],this.$$p_d[n].reflect){let a=md(n,this.$$d[n],this.$$p_d,"toAttribute");a==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,a)}this.$$r=!1};this.$$c.$$.after_update.push(s),s();for(let n in this.$$l)for(let a of this.$$l[n]){let i=this.$$c.$on(n,a);this.$$l_u.set(a,i)}this.$$l={}}}attributeChangedCallback(e,t,r){var s;this.$$r||(e=this.$$g_p(e),this.$$d[e]=md(e,r,this.$$p_d,"toProp"),(s=this.$$c)==null||s.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function md(o,e,t,r){var n;let s=(n=t[o])==null?void 0:n.type;if(e=s==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(s){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(s){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var ee=class{constructor(){bt(this,"$$");bt(this,"$$set")}$destroy(){N(this,1),this.$destroy=J}$on(e,t){if(!ht(t))return J;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!kx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var Bx="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Bx);var x2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},hd=x2;function Nx(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function gd(o){let e,t=[o[12]],r={};for(let s=0;s<t.length;s+=1)r=fe(r,t[s]);return{c(){e=to(o[11]),bi(e,r)},m(s,n){I(s,e,n)},p(s,n){bi(e,r=Ue(t,[n&32&&s[12]]))},d(s){s&&C(e)}}}function Hx(o){let e=o[11],t,r=o[11]&&gd(o);return{c(){r&&r.c(),t=Ie()},m(s,n){r&&r.m(s,n),I(s,t,n)},p(s,n){s[11]?e?Z(e,s[11])?(r.d(1),r=gd(s),e=s[11],r.c(),r.m(t.parentNode,t)):r.p(s,n):(r=gd(s),e=s[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=s[11])},d(s){s&&C(t),r&&r.d(s)}}}function b2(o){let e,t,r,s,n,a=Ae(o[5]),i=[];for(let m=0;m<a.length;m+=1)i[m]=Hx(Nx(o,a,m));let l=o[10].default,c=ye(l,o,o[9],null),u=[hd,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:s=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],d={};for(let m=0;m<u.length;m+=1)d=fe(d,u[m]);return{c(){e=to("svg");for(let m=0;m<i.length;m+=1)i[m].c();t=Ie(),c&&c.c(),bi(e,d)},m(m,g){I(m,e,g);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(e,null);k(e,t),c&&c.m(e,null),n=!0},p(m,[g]){if(g&32){a=Ae(m[5]);let h;for(h=0;h<a.length;h+=1){let _=Nx(m,a,h);i[h]?i[h].p(_,g):(i[h]=Hx(_),i[h].c(),i[h].m(e,t))}for(;h<i.length;h+=1)i[h].d(1);i.length=a.length}c&&c.p&&(!n||g&512)&&be(c,l,m,m[9],n?xe(l,m[9],g,null):ve(m[9]),null),bi(e,d=Ue(u,[hd,g&128&&m[7],(!n||g&4)&&{width:m[2]},(!n||g&4)&&{height:m[2]},(!n||g&2)&&{stroke:m[1]},(!n||g&28&&r!==(r=m[4]?Number(m[3])*24/Number(m[2]):m[3]))&&{"stroke-width":r},(!n||g&257&&s!==(s=m[6]("lucide-icon","lucide",m[0]?`lucide-${m[0]}`:"",m[8].class)))&&{class:s}]))},i(m){n||(S(c,m),n=!0)},o(m){T(c,m),n=!1},d(m){m&&C(e),nt(i,m),c&&c.d(m)}}}function v2(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],s=fd(e,r),{$$slots:n={},$$scope:a}=e,{name:i=void 0}=e,{color:l="currentColor"}=e,{size:c=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:d=!1}=e,{iconNode:m}=e,g=(...h)=>h.filter((_,w,v)=>Boolean(_)&&v.indexOf(_)===w).join(" ");return o.$$set=h=>{t(8,e=fe(fe({},e),ke(h))),t(7,s=fd(e,r)),"name"in h&&t(0,i=h.name),"color"in h&&t(1,l=h.color),"size"in h&&t(2,c=h.size),"strokeWidth"in h&&t(3,u=h.strokeWidth),"absoluteStrokeWidth"in h&&t(4,d=h.absoluteStrokeWidth),"iconNode"in h&&t(5,m=h.iconNode),"$$scope"in h&&t(9,a=h.$$scope)},e=ke(e),[i,l,c,u,d,m,g,s,e,a,n]}var yd=class extends ee{constructor(e){super(),re(this,e,v2,b2,Z,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},ze=yd;function w2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function _2(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],s={$$slots:{default:[w2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function S2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var xd=class extends ee{constructor(e){super(),re(this,e,S2,_2,Z,{})}},bd=xd;function k2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function C2(o){let e,t,r=[{name:"arrow-up-down"},o[1],{iconNode:o[0]}],s={$$slots:{default:[k2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function I2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var vd=class extends ee{constructor(e){super(),re(this,e,I2,C2,Z,{})}},wd=vd;function L2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function T2(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],s={$$slots:{default:[L2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function P2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var _d=class extends ee{constructor(e){super(),re(this,e,P2,T2,Z,{})}},Sd=_d;function D2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function F2(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],s={$$slots:{default:[D2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function A2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var kd=class extends ee{constructor(e){super(),re(this,e,A2,F2,Z,{})}},Cd=kd;function M2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function E2(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],s={$$slots:{default:[M2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function R2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Id=class extends ee{constructor(e){super(),re(this,e,R2,E2,Z,{})}},Ld=Id;function O2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function U2(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],s={$$slots:{default:[O2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function $2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Td=class extends ee{constructor(e){super(),re(this,e,$2,U2,Z,{})}},Si=Td;function B2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function N2(o){let e,t,r=[{name:"clock"},o[1],{iconNode:o[0]}],s={$$slots:{default:[B2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function H2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Pd=class extends ee{constructor(e){super(),re(this,e,H2,N2,Z,{})}},ki=Pd;function V2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function q2(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],s={$$slots:{default:[V2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function W2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Dd=class extends ee{constructor(e){super(),re(this,e,W2,q2,Z,{})}},Fd=Dd;function z2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function K2(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],s={$$slots:{default:[z2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function G2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Ad=class extends ee{constructor(e){super(),re(this,e,G2,K2,Z,{})}},Md=Ad;function j2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function Y2(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],s={$$slots:{default:[j2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function J2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Ed=class extends ee{constructor(e){super(),re(this,e,J2,Y2,Z,{})}},Rd=Ed;function Q2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function X2(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],s={$$slots:{default:[Q2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Z2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Od=class extends ee{constructor(e){super(),re(this,e,Z2,X2,Z,{})}},Xo=Od;function eT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function tT(o){let e,t,r=[{name:"lock"},o[1],{iconNode:o[0]}],s={$$slots:{default:[eT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function rT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Ud=class extends ee{constructor(e){super(),re(this,e,rT,tT,Z,{})}},$d=Ud;function oT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function sT(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],s={$$slots:{default:[oT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function nT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Bd=class extends ee{constructor(e){super(),re(this,e,nT,sT,Z,{})}},Nd=Bd;function aT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function iT(o){let e,t,r=[{name:"pause"},o[1],{iconNode:o[0]}],s={$$slots:{default:[aT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function lT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Hd=class extends ee{constructor(e){super(),re(this,e,lT,iT,Z,{})}},Vd=Hd;function cT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function fT(o){let e,t,r=[{name:"play"},o[1],{iconNode:o[0]}],s={$$slots:{default:[cT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function uT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var qd=class extends ee{constructor(e){super(),re(this,e,uT,fT,Z,{})}},Wd=qd;function dT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function pT(o){let e,t,r=[{name:"refresh-cw"},o[1],{iconNode:o[0]}],s={$$slots:{default:[dT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function mT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var zd=class extends ee{constructor(e){super(),re(this,e,mT,pT,Z,{})}},Kd=zd;function hT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function gT(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],s={$$slots:{default:[hT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function yT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Gd=class extends ee{constructor(e){super(),re(this,e,yT,gT,Z,{})}},cn=Gd;function xT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function bT(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],s={$$slots:{default:[xT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function vT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var jd=class extends ee{constructor(e){super(),re(this,e,vT,bT,Z,{})}},Yd=jd;function wT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function _T(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],s={$$slots:{default:[wT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function ST(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Jd=class extends ee{constructor(e){super(),re(this,e,ST,_T,Z,{})}},Ci=Jd;function kT(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&be(r,t,s,s[3],e?xe(t,s[3],n,null):ve(s[3]),null)},i(s){e||(S(r,s),e=!0)},o(s){T(r,s),e=!1},d(s){r&&r.d(s)}}}function CT(o){let e,t,r=[{name:"upload"},o[1],{iconNode:o[0]}],s={$$slots:{default:[kT]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=fe(s,r[n]);return e=new ze({props:s}),{c(){H(e.$$.fragment)},m(n,a){B(e,n,a),t=!0},p(n,[a]){let i=a&3?Ue(r,[r[0],a&2&&We(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(S(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function IT(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"17 8 12 3 7 8"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15"}]];return o.$$set=a=>{t(1,e=fe(fe({},e),ke(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=ke(e),[n,e,r,s]}var Qd=class extends ee{constructor(e){super(),re(this,e,IT,CT,Z,{})}},Xd=Qd;function LT(o){De(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function TT(o){let e,t,r,s,n,a;return t=new Xo({props:{class:"svg-icon inline-icon"}}),{c(){var i;e=P("button"),H(t.$$.fragment),x(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),x(e,"aria-label",s=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),x(e,"tabindex","0"),x(e,"data-filename",n=(i=o[0].view.file)==null?void 0:i.name)},m(i,l){I(i,e,l),B(t,e,null),a=!0},p(i,l){var c;(!a||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(i[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&x(e,"class",r),(!a||l&1&&s!==(s=i[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&x(e,"aria-label",s),(!a||l&1&&n!==(n=(c=i[0].view.file)==null?void 0:c.name))&&x(e,"data-filename",n)},i(i){a||(S(t.$$.fragment,i),a=!0)},o(i){T(t.$$.fragment,i),a=!1},d(i){i&&C(e),N(t)}}}function PT(o){let e,t,r,s,n,a,i,l,c,u,d,m,g;return t=new Xo({props:{class:"svg-icon inline-icon"}}),l=new cn({props:{class:"svg-icon inline-icon"}}),{c(){var h;e=P("button"),H(t.$$.fragment),a=U(),i=P("button"),H(l.$$.fragment),x(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),x(e,"aria-label",s=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),x(e,"tabindex","0"),x(e,"data-filename",n=(h=o[0].view.file)==null?void 0:h.name),x(i,"class",c="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),x(i,"aria-label",u=`${o[2].relay.name} (${o[1].status})`),x(i,"tabindex","0")},m(h,_){I(h,e,_),B(t,e,null),I(h,a,_),I(h,i,_),B(l,i,null),d=!0,m||(g=[te(i,"click",o[3]),te(i,"keypress",o[4])],m=!0)},p(h,_){var w;(!d||_&1&&r!==(r="clickable-icon view-action system3-view-action "+(h[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&x(e,"class",r),(!d||_&1&&s!==(s=h[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&x(e,"aria-label",s),(!d||_&1&&n!==(n=(w=h[0].view.file)==null?void 0:w.name))&&x(e,"data-filename",n),(!d||_&2&&c!==(c="system3-"+h[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&x(i,"class",c),(!d||_&6&&u!==(u=`${h[2].relay.name} (${h[1].status})`))&&x(i,"aria-label",u)},i(h){d||(S(t.$$.fragment,h),S(l.$$.fragment,h),d=!0)},o(h){T(t.$$.fragment,h),T(l.$$.fragment,h),d=!1},d(h){h&&(C(e),C(a),C(i)),N(t),N(l),m=!1,Ce(g)}}}function DT(o){let e,t,r,s,n=[PT,TT],a=[];function i(l,c){return l[2]?0:1}return e=i(o,-1),t=a[e]=n[e](o),{c(){t.c(),r=Ie()},m(l,c){a[e].m(l,c),I(l,r,c),s=!0},p(l,[c]){let u=e;e=i(l,c),e===u?a[e].p(l,c):(pe(),T(a[u],1,1,()=>{a[u]=null}),me(),t=a[e],t?t.p(l,c):(t=a[e]=n[e](l),t.c()),S(t,1),t.m(r.parentNode,r))},i(l){s||(S(t),s=!0)},o(l){T(t),s=!1},d(l){l&&C(r),a[e].d(l)}}}function FT(o,e,t){let{view:r}=e,{state:s}=e,{remote:n}=e,a={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},i=()=>{r.toggleConnection()},l=c=>{c.key==="Enter"&&i()};return o.$$set=c=>{"view"in c&&t(0,r=c.view),"state"in c&&t(1,s=c.state),"remote"in c&&t(2,n=c.remote)},[r,s,n,i,l]}var Zd=class extends ee{constructor(e){super(),re(this,e,FT,DT,Z,{view:0,state:1,remote:2},LT)}},ep=Zd;var fn=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){if(!this.view)return!0;let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let s=e.querySelector(".system3-banner");if(!s){s=document.createElement("div"),s.classList.add("system3-banner");let n=s.createSpan();n.setText(this.text),s.appendChild(n),r.appendChild(s);let a=async()=>{await this.onClick()&&this.destroy()};s.addEventListener("click",a)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),!0}};var sc=require("@codemirror/state"),Vx=require("@codemirror/view");function un(o,e){let t=Object.keys(e).map(r=>AT(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function AT(o,e,t){let r=o[e],s=o.hasOwnProperty(e),n=s?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},a=t(n);return r&&Object.setPrototypeOf(a,r),Object.setPrototypeOf(i,a),o[e]=i,l;function i(...c){return a===n&&o[e]===i&&l(),a.apply(this,c)}function l(){o[e]===i&&(s?o[e]=n:delete o[e]),a!==n&&(a=n,Object.setPrototypeOf(i,r||Function))}}var qx=qs(tp());var MT=25,b6=sc.Facet.define({combine(o){return o[o.length-1]}}),rp=sc.Annotation.define(),op=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};var r,s,n,a;if(this.editor=e,this.connectionManager=this.editor.state.field(wo),this.view=(r=this.connectionManager)==null?void 0:r.findView(e),!this.view||(this.log=Pe(`[LiveCMPluginValue][${(s=this.view.view.file)==null?void 0:s.path}]`,"log"),this.warn=Pe(`[LiveCMPluginValue][${(n=this.view.view.file)==null?void 0:n.path}]`,"warn"),this.debug=Pe(`[LiveCMPluginValue][${(a=this.view.view.file)==null?void 0:a.path}]`,"debug"),this.debug("created"),!this.view.document))return;let t=this;this.uninstallMonkeyPatch=un(this.view.view,{setViewData(i){return function(l,c){return c&&(vo(t.view)&&t.view.document.text===l&&(t.view.tracking=!0),t.resync()),i.call(this,l,c)}}}),this.view.document.connected?this.resync():this.view.document.onceConnected().then(()=>{this.resync()}),this._observer=async(i,l)=>{if(!vo(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(l.origin!==this){let c=i.delta,u=[],d=0;for(let m=0;m<c.length;m++){let g=c[m];g.insert!=null?u.push({from:d,to:d,insert:g.insert}):g.delete!=null?(u.push({from:d,to:d+g.delete,insert:""}),d+=g.delete):g.retain!=null&&(d+=g.retain)}!this.view.tracking||Je().enableEditorTweens&&this.keyFrameCounter>MT?(this.keyFrameCounter=0,u=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),vo(this.view)&&(e.dispatch({changes:u,annotations:[rp.of(this.editor)]}),this.view.tracking=!0)}},this.observer=(i,l)=>{var c;try{(c=this._observer)==null||c.call(this,i,l)}catch(u){u instanceof RangeError&&vo(this.view)&&(this.view.tracking=!1)}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new qx.default,s=r.diff_main(t,e);r.diff_cleanupSemantic(s);let n=[],a=0;for(let[i,l]of s)switch(i){case 0:a+=l.length;break;case 1:n.push({from:a,to:a,insert:l}),a+=l.length;break;case-1:n.push({from:a,to:a+l.length,insert:""});break}return n}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if(vo(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();vo(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[rp.of(this.editor)]})}}async getKeyFrame(e=!1){return!vo(this.view)||this.destroyed?[]:this.view.document.text===this.view.view.getViewData()?(this.view.tracking=!0,[]):(this.warn(`|${this.view.document.text}|
|${this.view.view.getViewData()}|`),this.warn("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(this.view.tracking||this.view.checkStale(),vo(this.view)&&!this.destroyed?[this.getBufferChange(this.view.document.text,e)]:[]))}update(e){var s,n,a,i;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(rp)===this.editor)return;let t=e.view;this.view=(s=this.connectionManager)==null?void 0:s.findView(t);let r=(a=(n=this.view)==null?void 0:n.document)==null?void 0:a.ytext;r&&((i=r.doc)==null||i.transact(()=>{let l=0;e.changes.iterChanges((c,u,d,m,g)=>{let h=g.sliceString(0,g.length,`
`);c!==u&&r.delete(c+l,u-c),h.length>0&&r.insert(c+l,h),l+=h.length-(u-c)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.uninstallMonkeyPatch&&(this.uninstallMonkeyPatch(),this.uninstallMonkeyPatch=void 0),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Wx=Vx.ViewPlugin.fromClass(op);var nc=require("@codemirror/state"),yr=require("@codemirror/view");var zx=yr.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),ET=nc.Annotation.define(),sp=class extends yr.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return ja("span",[tr("class","cm-ySelectionCaret"),tr("style",`background-color: ${this.color}; border-color: ${this.color}`)],[Hn("\u2060"),ja("div",[tr("class","cm-ySelectionCaretDot")]),Hn("\u2060"),ja("div",[tr("class","cm-ySelectionInfo")],[Hn(this.name)]),Hn("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},np=class{constructor(e){var r,s;this.editor=e,this.decorations=nc.RangeSet.of([]),this.connectionManager=this.editor.state.field(wo);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof Ts){this.view=t;let n=(s=this.view.document)==null?void 0:s._provider;this._listener=({added:a,updated:i,removed:l},c,u)=>{a.concat(i).concat(l).findIndex(m=>{var g;return m!==((g=this._awareness)==null?void 0:g.doc.clientID)})>=0&&e.dispatch({annotations:[ET.of([])]})},n&&(this._awareness=n.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var c,u,d,m;let t=e.view;this.view=(c=this.connectionManager)==null?void 0:c.findView(t);let r=(d=(u=this.view)==null?void 0:u.document)==null?void 0:d.ytext;if(!(this.view&&r&&r.doc))return;let s=(m=this.view.document)==null?void 0:m._provider;if(!s)return;this._awareness=s.awareness;let n=this._awareness,a=r.doc,i=[],l=this._awareness.getLocalState();if(l!=null){let g=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),h=g?e.state.selection.main:null,_=l.cursor==null?null:xu(l.cursor.anchor),w=l.cursor==null?null:xu(l.cursor.head);if(h!=null){let v=bu(r,h.anchor),A=bu(r,h.head);(l.cursor==null||!wu(_,v)||!wu(w,A))&&n.setLocalStateField("cursor",{anchor:v,head:A})}else l.cursor!=null&&g&&n.setLocalStateField("cursor",null)}n.getStates().forEach((g,h)=>{if(h===n.doc.clientID)return;let _=g.cursor;if(_==null||_.anchor==null||_.head==null)return;let w=vu(_.anchor,a),v=vu(_.head,a);if(w==null||v==null||w.type!==r||v.type!==r)return;if(w.index>e.state.doc.length||v.index>e.state.doc.length){Pe("[RemoteSelections]","warn")(`cursor positions (${w.index}, ${v.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=yr.Decoration.none;return}let{color:A="#30bced",name:O="Anonymous"}=g.user||{},M=g.user&&g.user.colorLight||A+"33",E=Pn(w.index,v.index),R=Gr(w.index,v.index),D=e.view.state.doc.lineAt(E),F=e.view.state.doc.lineAt(R);if(D.number===F.number)i.push({from:E,to:R,value:yr.Decoration.mark({attributes:{style:`background-color: ${M}`},class:"cm-ySelection"})});else{i.push({from:E,to:D.from+D.length,value:yr.Decoration.mark({attributes:{style:`background-color: ${M}`},class:"cm-ySelection"})}),i.push({from:F.from,to:R,value:yr.Decoration.mark({attributes:{style:`background-color: ${M}`},class:"cm-ySelection"})});for(let V=D.number+1;V<F.number;V++){let q=e.view.state.doc.line(V).from;i.push({from:q,to:q,value:yr.Decoration.line({attributes:{style:`background-color: ${M}`,class:"cm-yLineSelection"}})})}}i.push({from:v.index,to:v.index,value:yr.Decoration.widget({side:v.index-w.index>0?-1:1,block:!1,widget:new sp(A,O)})})}),this.decorations=yr.Decoration.set(i,!0)}},Kx=yr.ViewPlugin.fromClass(np,{decorations:o=>o.decorations});var ac=require("@codemirror/state"),Zo=require("@codemirror/view"),Gx=require("@codemirror/view");var M6=ac.Annotation.define(),ip=class extends Gx.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},ap=ac.StateEffect.define(),lp=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(wo),this.decorations=Zo.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,s)=>{this.updateFromMetadata(s),this.editor.dispatch({effects:ap.of(null)})},!this.connectionManager){Pe("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=Pe(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var r,s;if(this.connectionManager&&this.app&&((s=(r=this.view)==null?void 0:r.document)!=null&&s.tfile)){this.connectionManager.onMeta(this.view.document.tfile,this.cb);let n=this.app.metadataCache.getFileCache(this.view.document.tfile);n&&(this.updateFromMetadata(n),this.editor.dispatch({effects:ap.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(Zo.EditorView.decorations).forEach(s=>{(typeof s=="function"?s(e):s).between(0,e.state.doc.length,(a,i,l)=>{var d;(((d=l.spec)==null?void 0:d.class)||"").contains("cm-formatting-link-end")&&t.push({from:a,to:i})})}),t}updateFromMetadata(e){var r,s,n,a;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((s=(r=this.view)==null?void 0:r.document)!=null&&s.sharedFolder)||!((a=(n=this.view)==null?void 0:n.document)!=null&&a.tfile))return;let t=new Map;for(let i of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}for(let i of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(s){this.metadata.delete(t)}}updateFromEditor(e){var n,a,i,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((a=(n=this.view)==null?void 0:n.document)!=null&&a.sharedFolder)||!((l=(i=this.view)==null?void 0:i.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),s=this.findInternalLinks(this.editor);for(let c of s){let u=null;for(let[g,h]of r)if(c.from<=h.to&&c.to>=h.from){u=h,r.delete(g);break}if(!u)continue;let d=this.app.metadataCache.getFirstLinkpathDest(u.link,this.view.document.path);d&&!this.view.document.sharedFolder.checkPath(d.path)&&t.push(c.from)}t.filter(c=>c<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>Zo.Decoration.widget({widget:new ip,side:1}).range(t));e.length>0?this.decorations=Zo.Decoration.set(e,!0):this.decorations=Zo.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(s=>s.is(ap))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},jx=Zo.ViewPlugin.fromClass(lp,{decorations:o=>o.decorations});function es(){}es.prototype={diff:function(e,t){var r,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=s.callback;typeof s=="function"&&(n=s,s={}),this.options=s;var a=this;function i(M){return n?(setTimeout(function(){n(void 0,M)},0),!0):M}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,c=e.length,u=1,d=l+c;s.maxEditLength&&(d=Math.min(d,s.maxEditLength));var m=(r=s.timeout)!==null&&r!==void 0?r:1/0,g=Date.now()+m,h=[{oldPos:-1,lastComponent:void 0}],_=this.extractCommon(h[0],t,e,0);if(h[0].oldPos+1>=c&&_+1>=l)return i([{value:this.join(t),count:t.length}]);var w=-1/0,v=1/0;function A(){for(var M=Math.max(w,-u);M<=Math.min(v,u);M+=2){var E=void 0,R=h[M-1],D=h[M+1];R&&(h[M-1]=void 0);var F=!1;if(D){var V=D.oldPos-M;F=D&&0<=V&&V<l}var q=R&&R.oldPos+1<c;if(!F&&!q){h[M]=void 0;continue}if(!q||F&&R.oldPos+1<D.oldPos?E=a.addToPath(D,!0,void 0,0):E=a.addToPath(R,void 0,!0,1),_=a.extractCommon(E,t,e,M),E.oldPos+1>=c&&_+1>=l)return i(RT(a,E.lastComponent,t,e,a.useLongestToken));h[M]=E,E.oldPos+1>=c&&(v=Math.min(v,M-1)),_+1>=l&&(w=Math.max(w,M+1))}u++}if(n)(function M(){setTimeout(function(){if(u>d||Date.now()>g)return n();A()||M()},0)})();else for(;u<=d&&Date.now()<=g;){var O=A();if(O)return O}},addToPath:function(e,t,r,s){var n=e.lastComponent;return n&&n.added===t&&n.removed===r?{oldPos:e.oldPos+s,lastComponent:{count:n.count+1,added:t,removed:r,previousComponent:n.previousComponent}}:{oldPos:e.oldPos+s,lastComponent:{count:1,added:t,removed:r,previousComponent:n}}},extractCommon:function(e,t,r,s){for(var n=t.length,a=r.length,i=e.oldPos,l=i-s,c=0;l+1<n&&i+1<a&&this.equals(t[l+1],r[i+1]);)l++,i++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=i,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function RT(o,e,t,r,s){for(var n=[],a;e;)n.push(e),a=e.previousComponent,delete e.previousComponent,e=a;n.reverse();for(var i=0,l=n.length,c=0,u=0;i<l;i++){var d=n[i];if(d.removed){if(d.value=o.join(r.slice(u,u+d.count)),u+=d.count,i&&n[i-1].added){var g=n[i-1];n[i-1]=n[i],n[i]=g}}else{if(!d.added&&s){var m=t.slice(c,c+d.count);m=m.map(function(_,w){var v=r[u+w];return v.length>_.length?v:_}),d.value=o.join(m)}else d.value=o.join(t.slice(c,c+d.count));c+=d.count,d.added||(u+=d.count)}}var h=n[l-1];return l>1&&typeof h.value=="string"&&(h.added||h.removed)&&o.equals("",h.value)&&(n[l-2].value+=h.value,n.pop()),n}var R6=new es;function OT(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var Yx=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Jx=/\S/,pp=new es;pp.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!Jx.test(o)&&!Jx.test(e)};pp.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Yx.test(e[t])&&Yx.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Qx(o,e,t){return t=OT(t,{ignoreWhitespace:!0}),pp.diff(o,e,t)}var mp=new es;mp.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var s=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=s:(this.options.ignoreWhitespace&&(s=s.trim()),e.push(s))}return e};function UT(o,e,t){return mp.diff(o,e,t)}var $T=new es;$T.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var BT=new es;BT.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function ic(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ic=function(e){return typeof e}:ic=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ic(o)}function cp(o){return NT(o)||HT(o)||VT(o)||qT()}function NT(o){if(Array.isArray(o))return fp(o)}function HT(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function VT(o,e){if(o){if(typeof o=="string")return fp(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fp(o,e)}}function fp(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function qT(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var WT=Object.prototype.toString,Ii=new es;Ii.useLongestToken=!0;Ii.tokenize=mp.tokenize;Ii.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,s=r===void 0?function(n,a){return typeof a=="undefined"?t:a}:r;return typeof o=="string"?o:JSON.stringify(up(o,null,null,s),s,"  ")};Ii.equals=function(o,e){return es.prototype.equals.call(Ii,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function up(o,e,t,r,s){e=e||[],t=t||[],r&&(o=r(s,o));var n;for(n=0;n<e.length;n+=1)if(e[n]===o)return t[n];var a;if(WT.call(o)==="[object Array]"){for(e.push(o),a=new Array(o.length),t.push(a),n=0;n<o.length;n+=1)a[n]=up(o[n],e,t,r,s);return e.pop(),t.pop(),a}if(o&&o.toJSON&&(o=o.toJSON()),ic(o)==="object"&&o!==null){e.push(o),a={},t.push(a);var i=[],l;for(l in o)o.hasOwnProperty(l)&&i.push(l);for(i.sort(),n=0;n<i.length;n+=1)l=i[n],a[l]=up(o[l],e,t,r,l);e.pop(),t.pop()}else a=o;return a}var dp=new es;dp.tokenize=function(o){return o.slice()};dp.join=dp.removeEmpty=function(o){return o};function Xx(o,e,t,r,s,n,a){a||(a={}),typeof a.context=="undefined"&&(a.context=4);var i=UT(t,r,a);if(!i)return;i.push({value:"",lines:[]});function l(v){return v.map(function(A){return" "+A})}for(var c=[],u=0,d=0,m=[],g=1,h=1,_=function(A){var O=i[A],M=O.lines||O.value.replace(/\n$/,"").split(`
`);if(O.lines=M,O.added||O.removed){var E;if(!u){var R=i[A-1];u=g,d=h,R&&(m=a.context>0?l(R.lines.slice(-a.context)):[],u-=m.length,d-=m.length)}(E=m).push.apply(E,cp(M.map(function(he){return(O.added?"+":"-")+he}))),O.added?h+=M.length:g+=M.length}else{if(u)if(M.length<=a.context*2&&A<i.length-2){var D;(D=m).push.apply(D,cp(l(M)))}else{var F,V=Math.min(M.length,a.context);(F=m).push.apply(F,cp(l(M.slice(0,V))));var q={oldStart:u,oldLines:g-u+V,newStart:d,newLines:h-d+V,lines:m};if(A>=i.length-2&&M.length<=a.context){var j=/\n$/.test(t),z=/\n$/.test(r),Y=M.length==0&&m.length>q.oldLines;!j&&Y&&t.length>0&&m.splice(q.oldLines,0,"\\ No newline at end of file"),(!j&&!Y||!z)&&m.push("\\ No newline at end of file")}c.push(q),u=0,d=0,m=[]}g+=M.length,h+=M.length}},w=0;w<i.length;w++)_(w);return{oldFileName:o,newFileName:e,oldHeader:s,newHeader:n,hunks:c}}var tb=require("obsidian");var gp=require("obsidian");var Zx=qs(tp());var fr=class extends ft{constructor(t){super();this.observableName=t;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,s]of this._map)if(t(s,r))return s}some(t){for(let[r,s]of this._map)if(t(s,r))return!0;return!1}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let s=new hp(this,t);return this._derivedMaps.set(t,s),s}},hp=class extends fr{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.sub(),this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(()=>{let t=new Map;this.parentMap.forEach((r,s)=>{this.predicate(r,s)&&t.set(s,r)}),this._map=t,this.notifyListeners()}))}subscribe(t){return this.sub(),super.subscribe(t),()=>{this.unsubscribe(t)}}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){this.unsub&&this.unsub()}};function ma(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let s=Math.min(t.length,r.length);for(let n=0;n<s;n++)if(t[n]!==r[n]){if(n===t.length-1){let a=t[n].match(/\d+/g),i=r[n].match(/\d+/g);if(a&&i){let l=parseInt(a[0]),c=parseInt(i[0]);if(l!==c)return l-c}}return t[n].localeCompare(r[n])}return t.length-r.length}function cc(o,e){let t=o.getText("contents"),r=t.toString(),s=new Zx.diff_match_patch,n=s.diff_main(r,e);s.diff_cleanupSemantic(n);let a=0,i=Pe("[updateYDocFromDiskBuffer]","debug");i("Updating YDoc:"),i("Current content length:",r.length),i("Disk buffer length:",e.length),n.length!=0&&(o.transact(()=>{for(let[l,c]of n)switch(l){case 1:i(`Inserting "${c}" at position ${a}`),t.insert(a,c),a+=c.length;break;case 0:i(`Keeping "${c}" (length: ${c.length})`),a+=c.length;break;case-1:i(`Deleting "${c}" at position ${a}`),t.delete(a,c.length);break}}),i("Update complete. New content length:",t.toString().length))}var lc=class extends Dt{constructor(t,r,s,n=3){super();this.loginManager=t;this.timeProvider=r;this.sharedFolders=s;this.concurrency=n;this.activeSync=new Ss;this.activeDownloads=new Ss;this.syncGroups=new fr;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.subscriptions=[];this.start=this.resume;Bt.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let t=0,r=0,s=0,n=0,a=0,i=0;this.syncGroups.forEach(d=>{t+=d.total,r+=d.completed,s+=d.syncs,n+=d.completedSyncs,a+=d.downloads,i+=d.completedDownloads});let l=t>0?r/t*100:0,c=s>0?n/s*100:0,u=a>0?i/a*100:0;return{totalPercent:Math.round(l),syncPercent:Math.round(c),downloadPercent:Math.round(u),totalItems:t,completedItems:r,syncItems:s,completedSyncs:n,downloadItems:a,completedDownloads:i}}getGroupProgress(t){let r=this.syncGroups.get(t);if(!r)return null;let s=r.total>0?r.completed/r.total*100:0,n=r.syncs>0?r.completedSyncs/r.syncs*100:0,a=r.downloads>0?r.completedDownloads/r.downloads*100:0;return{percent:Math.round(s),syncPercent:Math.round(n),downloadPercent:Math.round(a),sharedFolder:t,status:r.status}}getAllGroupsProgress(){let t=[];return this.syncGroups.forEach((r,s)=>{let n=this.getGroupProgress(s);n&&t.push(n)}),t}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let t=this.syncQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeSync.size<this.concurrency;){let r=t.shift();if(!r)break;this.syncQueue=this.syncQueue.filter(s=>s.guid!==r.guid),r.status="running",this.activeSync.add(r);try{let s=r.doc;await this.syncDocument(s),r.status="completed";let n=this.syncCompletionCallbacks.get(r.guid);n&&(n.resolve(),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.debug(`[Sync Progress] Before: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completedSyncs++,a.completed++,this.debug(`[Sync Progress] After: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completed===a.total&&(a.status="completed",this.debug("[Sync Progress] Group completed!")),this.syncGroups.set(r.sharedFolder,a))}catch(s){r.status="failed";let n=this.syncCompletionCallbacks.get(r.guid);n&&(n.reject(s instanceof Error?s:new Error(String(s))),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.error("[Sync Failed]",s),a.status="failed",this.syncGroups.set(r.sharedFolder,a))}finally{this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid)}}this.isProcessingSync=!1,this.syncQueue.length>0&&!this.isPaused&&this.syncQueue.some(s=>s.sharedFolder.connected)&&this.processSyncQueue()}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let t=this.downloadQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeDownloads.size<this.concurrency;){let r=t.shift();if(!r)break;this.downloadQueue=this.downloadQueue.filter(s=>s.guid!==r.guid),r.status="running",this.activeDownloads.add(r);try{r.doc instanceof wt?await this.getCanvas(r.doc):await this.getDocument(r.doc),r.status="completed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.resolve(),this.downloadCompletionCallbacks.delete(r.guid));let n=this.syncGroups.get(r.sharedFolder);n&&(n.completedDownloads++,n.completed++,n.completed===n.total&&(n.status="completed"),this.syncGroups.set(r.sharedFolder,n))}catch(s){r.status="failed";let n=this.downloadCompletionCallbacks.get(r.guid);n&&(n.reject(s instanceof Error?s:new Error(String(s))),this.downloadCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(a.status="failed",this.syncGroups.set(r.sharedFolder,a)),this.error("[processDownloadQueue]",s)}finally{this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid)}}this.isProcessingDownloads=!1,this.downloadQueue.length>0&&!this.isPaused&&this.downloadQueue.some(s=>s.sharedFolder.connected)&&this.processDownloadQueue()}async enqueueSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?new Promise((l,c)=>{i.resolve=l,i.reject=c}):(this.processSyncQueue(),Promise.resolve())}let r=t.sharedFolder,s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r},n=this.syncGroups.get(r);n||(n={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),n.total++,n.syncs++,this.syncGroups.set(r,n),this.inProgressSyncs.add(t.guid);let a=new Promise((i,l)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:l})});return this.syncQueue.push(s),this.syncQueue.sort(ma),this.processSyncQueue(),a}enqueueDownload(t){if(this.inProgressDownloads.has(t.guid)){this.debug(`[enqueueDownload] Item ${t.guid} already in progress, skipping`);let i=this.downloadCompletionCallbacks.get(t.guid);return i?(this.processDownloadQueue(),new Promise((l,c)=>{i.resolve=l,i.reject=c})):(this.processDownloadQueue(),Promise.resolve())}let r=t.sharedFolder,s=this.syncGroups.get(r);s||(s={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),s.downloads++,s.total++,this.syncGroups.set(r,s);let n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressDownloads.add(t.guid);let a=new Promise((i,l)=>{this.downloadCompletionCallbacks.set(t.guid,{resolve:i,reject:l})});return this.downloadQueue.push(n),this.downloadQueue.sort(ma),this.processDownloadQueue(),a}enqueueSharedFolderSync(t){let r=[...t.files.values()].filter(eo),s=[...t.files.values()].filter(Cr),n=[...r,...s],a={sharedFolder:t,total:n.length,completed:0,status:"pending",downloads:0,syncs:n.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(t,a);let i=[...r].sort(ma),l=[...s].sort(ma);for(let c of i)this.enqueueDocumentForGroupSync(c);for(let c of l)this.enqueueCanvasForGroupSync(c,t);a.status="running",this.syncGroups.set(t,a)}async enqueueDocumentForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueDocumentForGroupSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?(this.processSyncQueue(),new Promise((i,l)=>{a.resolve=i,a.reject=l})):Promise.resolve()}let r=t.sharedFolder,s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let n=new Promise((a,i)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:i})});return this.syncQueue.push(s),this.syncQueue.sort(ma),this.processSyncQueue(),n}getAuthHeader(t){var r;return{Authorization:Je().enableDocumentServer?`Bearer ${t.token}`:`Bearer ${(r=this.loginManager.user)==null?void 0:r.token}`}}getBaseUrl(t,r){var i;let s=new URL(t.url);s.protocol="https:";let n=s.pathname.split("/");n.pop(),n.push(t.docId),s.pathname=n.join("/");let a=((i=t.baseUrl)==null?void 0:i.replace(/\/$/,""))||s.toString();if(Je().enableDocumentServer)return a;if(r instanceof $r)return`https://api.system3.md/relay/${r.relayId}/doc/${r.documentId}`;if(r instanceof nr)return`https://api.system3.md/relay/${r.relayId}/doc/${r.canvasId}`;throw new Error("unexpected case")}async downloadItem(t){let r=u=>u instanceof nr?u.canvasId:u.documentId,s=t.s3rn;if(this.log("[downloadItem]",t.path,`${vt.encode(s)}`),!(s instanceof $r||s instanceof nr))throw new Error(`Unable to decode S3RN: ${vt.encode(s)}`);let n=await t.getProviderToken(),a=this.getAuthHeader(n),l=`${this.getBaseUrl(n,s)}/as-update`,c=await(0,gp.requestUrl)({url:l,method:"GET",headers:a,throw:!1});if(c.status===200)this.debug("[downloadItem]",r(s),c.status);else throw this.error("[downloadItem]",r(s),l,c.status,c.text),new Error(`Unable to download item: ${vt.encode(s)}`);return c}async syncDocumentWebsocket(t){let r="",s="",n=null;Cr(t)?(n=wt.exportCanvasData(t.ydoc),s=JSON.stringify(n)):eo(t)&&(s=t.text);try{r=await t.sharedFolder.read(t)}catch(c){}let a=!1;if(Cr(t)&&n){let c=r?JSON.parse(r):{nodes:[],edges:[]};a=bo(n,c)}else a=s===r;if(!a&&r)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let i=t.onceProviderSynced(),l=t.intent;return t.connect(),l==="disconnected"&&!t.userLock&&await i,l==="disconnected"&&!t.userLock&&(t.disconnect(),t.sharedFolder.tokenStore.removeFromRefreshQueue(vt.encode(t.s3rn))),!0}async uploadItem(t){let r=t.s3rn;if(this.log("[uploadItem]",`${vt.encode(r)}`),!(r instanceof $r)&&!(r instanceof nr))throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let s=await t.getProviderToken(),n={"Content-Type":"application/octet-stream",...this.getAuthHeader(s)},a=tn(t.ydoc),l=`${this.getBaseUrl(s,r)}/update`,c=await(0,gp.requestUrl)({url:l,method:"POST",headers:n,body:a.buffer,throw:!1});return c.status===200?this.debug("[uploadItem]",r instanceof nr?r.canvasId:r.documentId,c.status,c.text):this.error("[uploadItem]",r instanceof nr?r.canvasId:r.documentId,l,c.status,c.text),c}enqueueCanvasDownload(t){return this.enqueueDownload(t)}async enqueueCanvasForGroupSync(t,r){try{if(!r.syncStore.has(t.path)){this.debug("[enqueueCanvasForGroupSync] Skipping canvas, not in sync list",t.path);return}await this.enqueueDownload(t)}catch(s){this.error("[enqueueCanvasForGroupSync]",s)}}async getCanvas(t,r=3,s=3e3){try{let n=wt.exportCanvasData(t.ydoc),a={edges:[],nodes:[]};try{let m=await t.sharedFolder.read(t);a=JSON.parse(m)}catch(m){}let i=bo(n.edges,a.edges)&&bo(n.nodes,a.nodes),l=a.nodes.length>0,u=(await this.downloadItem(t)).arrayBuffer,d=new Uint8Array(u);if(this.log("[getCanvas] applying content from server"),ho(t.ydoc,d),l&&!i){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.json),this.log("[getCanvas] flushed"))}catch(n){throw this.error(n),n}}async getDocument(t,r=3,s=3e3){try{let n=t.text,a="";try{a=await t.sharedFolder.read(t)}catch(_){}let i=n===a,l=a!=="",u=(await this.downloadItem(t)).arrayBuffer,d=new Uint8Array(u),m=new wr;ho(m,d);let g=m.getMap("users");if(m.getText("contents").toString()===""){if(g.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",g.size,r,s),r>0&&this.timeProvider.setTimeout(()=>{this.getDocument(t,r-1,s*2)},s);return}if(t.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(t);return}}if(this.log("[getDocument] applying content from server"),ho(t.ydoc,d),l&&!i){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.text),this.log("[getDocument] flushed"))}catch(n){throw this.error(n),n}}async syncItem(t){let r="",s="",n=null;Cr(t)?(n=wt.exportCanvasData(t.ydoc),s=JSON.stringify(n)):eo(t)&&(s=t.text);try{r=await t.sharedFolder.read(t)}catch(g){}let a=!1;if(Cr(t)&&n){let g=r?JSON.parse(r):{nodes:[],edges:[]};a=bo(n,g)}else a=s===r;if(!a)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let i=await this.downloadItem(t);if(i.status!==200)return this.log("server returned an error."),!1;let l=i.arrayBuffer,c=new Uint8Array(l),u=new wr;ho(u,c);let d=u.getMap("users"),m=!1;if(Cr(t)&&n){let g=wt.exportCanvasData(u);m=d.size>0&&bo(g,n)}else{let g=u.getText("contents").toString();m=d.size>0&&g===s}return m||(ho(t.ydoc,c),Cr(t)?t.sharedFolder.flush(t,t.json):eo(t)&&t.sharedFolder.flush(t,t.text),this.uploadItem(t)),!0}async syncDocument(t){var r;try{Je().enableHTTPSync&&((r=t.sharedFolder.remote)!=null&&r.relay.provider)?await this.syncItem(t):(this.debug("fallback to websocket sync"),eo(t)?await this.syncDocumentWebsocket(t):Cr(t)&&await this.syncDocumentWebsocket(t))}catch(s){console.error(s);return}}subscribeToSync(t){return this.activeSync.subscribe(t)}subscribeToDownloads(t){return this.activeDownloads.subscribe(t)}subscribeToSyncGroups(t){return this.syncGroups.subscribe(t)}subscribeToProgress(t){let r=()=>{t(this.getOverallProgress())},s=this.activeSync.subscribe(()=>r()),n=this.activeDownloads.subscribe(()=>r()),a=this.syncGroups.subscribe(()=>r());return()=>{s(),n(),a()}}subscribeToGroupProgress(t,r){return this.syncGroups.subscribe(()=>{r(this.getGroupProgress(t))})}pause(){this.isPaused=!0}resume(){this.debug("starting"),this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[t,r]of this.syncCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(t);for(let[t,r]of this.downloadCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(t);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.timeProvider=null,this.subscriptions.forEach(t=>t())}};var fc=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var uc=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let s=0,n=0;for(let a=0;a<r.lines.length;a+=1){let i=r.lines[a];if(i.startsWith("+")||i.startsWith("-")){let l=a,c=l;for(;c<r.lines.length-1&&(r.lines[c+1].startsWith("+")||r.lines[c+1].startsWith("-"));)c+=1;let u=r.lines.slice(l,c+1).filter(m=>m.startsWith("-")).map(m=>m.slice(1)),d=r.lines.slice(l,c+1).filter(m=>m.startsWith("+")).map(m=>m.slice(1));t.push(new fc({file1Start:r.oldStart+l-n-1,file2Start:r.newStart+l-s-1,file1Lines:u,file2Lines:d})),s+=u.length,n+=d.length,a+=c-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function yp(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function Li(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function Ti(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function ha(o){return o!==""?o:"\u200E"}var xr=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var _o=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var dc=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof Lt){cc(e.ydoc,t);return}else if(e instanceof Go){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,s=this.difference.file2Lines.length>0;s&&r?(new xr({text:"Accept Top (Editor)",onClick:n=>this.acceptTopClick(n,this.difference)}).build(t),_o.build(t),new xr({text:"Accept Bottom (Local Disk)",onClick:n=>this.acceptBottomClick(n,this.difference)}).build(t),_o.build(t),new xr({text:"Accept All",onClick:n=>this.acceptAllClick(n,this.difference)}).build(t),_o.build(t),new xr({text:"Accept None",onClick:n=>this.acceptNoneClick(n,this.difference)}).build(t)):r?(new xr({text:"Keep in Editor",onClick:n=>this.insertFile1Difference(n,this.difference)}).build(t),_o.build(t),new xr({text:"Discard in Editor",onClick:n=>this.discardFile1Difference(n,this.difference)}).build(t)):s&&(new xr({text:"Accept from Local Disk",onClick:n=>this.insertFile2Difference(n,this.difference)}).build(t),_o.build(t),new xr({text:"Discard on Disk",onClick:n=>this.discardFile2Difference(n,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),s=Li({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),s=Li({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,s),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),s=Li({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,s);let n=Li({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=Ti({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let s=Ti({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),s=yp({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,s),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),s=yp({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,s),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=Ti({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=Ti({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var ga="system3-differences-view";async function rb(o,e){o.detachLeavesOfType(ga);let t=o.getLeaf(!0);t.setViewState({type:ga,active:!0,state:e}),o.revealLeaf(t)}var pc=class extends tb.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[]}async getContent(t){return t instanceof Lt?t.text:t instanceof Go?t.contents:await this.app.vault.cachedRead(t)}getViewType(){return ga}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,s;if(((r=this.state)==null?void 0:r.file1)==null||((s=this.state)==null?void 0:s.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(n=>n.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(n=>n.trimEnd());let t=Xx(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));this.fileDifferences=uc.fromParsedDiff(t),this.fileDifferences.differences.length===0&&this.leaf.detach()}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new xr({text:"Keep Editor Contents",onClick:async s=>{s.preventDefault(),await this.acceptAllFromLeft()}}).build(r),_o.build(r),new xr({text:"Accept All from Local Disk",onClick:async s=>{s.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async modify(t,r){if(t instanceof Lt){cc(t.ydoc,r);return}else if(t instanceof Go){t.contents=r;return}await this.app.vault.modify(t,r)}async acceptAllFromLeft(){!this.state||!this.fileDifferences||(await this.modify(this.state.file2,this.file1Content||""),this.leaf.detach())}async acceptAllFromRight(){!this.state||!this.fileDifferences||(await this.modify(this.state.file1,this.file2Content||""),this.leaf.detach())}buildLines(t){var a,i,l;let r=0,s=0,n=Math.max(((a=this.file1Lines)==null?void 0:a.length)||0,((i=this.file2Lines)==null?void 0:i.length)||0);for(;r<=n||s<=n;){let c=(l=this.fileDifferences)==null?void 0:l.differences.find(u=>u.file1Start===r&&u.file2Start===s);if(c!=null){let u=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(u,c),r+=c.file1Lines.length,s+=c.file2Lines.length}else{let u=r<=s?this.file1Lines[r]:this.file2Lines[s];t.createDiv({text:ha(u),cls:"file-diff__line"}),r+=1,s+=1}}}buildDifferenceVisualizer(t,r){var s;(s=this.state)!=null&&s.showMergeOption&&new dc(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let n=0;n<r.file1Lines.length;n+=1){let a=r.file1Lines[n],i=r.file2Lines[n],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),c=this.buildDiffLine(a,i,"file-diff_top-line__character");(n<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),n!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(c)}for(let n=0;n<r.file2Lines.length;n+=1){let a=r.file1Lines[n],i=r.file2Lines[n],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),c=this.buildDiffLine(i,a,"file-diff_bottom-line__character");(n==0&&r.file1Lines.length>0||n>0)&&l.classList.add("file-diff__no-top-border"),n<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(c)}}buildDiffLine(t,r,s){let n=document.createElement("div");if(t!=null&&t.length===0)n.textContent=ha(t);else if(t!=null&&r!=null){let a=Qx(r,t);for(let i of a){if(i.removed)continue;let l=document.createElement("span");l.textContent=ha(i.value),i.added&&l.classList.add(s),n.appendChild(l)}}else if(t!=null&&r==null){let a=document.createElement("span");a.textContent=ha(t),a.classList.add(s),n.appendChild(a)}else n.textContent=ha(t);return n}scrollToFirstDifference(){var s;if(((s=this.fileDifferences)==null?void 0:s.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var mc=class extends Dt{constructor(t){super();this.view=t.view,this.canvas=t.view.canvas,this.relayCanvas=t.canvas,this.unsubscribes=[],this.relayCanvasView=t,this.observedTextNodes=new Set,this.install()}destroy(){this.canvas&&(this.unsubscribes.forEach(t=>t()),this.unsubscribes=[],console.log("uninstall successful")),this.relayCanvasView.tracking=!1,this.canvas=null,this.relayCanvas=null,this.relayCanvasView=null,this.unsubscribes.length=0}observeNode(t){if(!this.observedTextNodes.has(t.id)&&t.type==="text"){let r=this.relayCanvas.textNode(t),s=t.id,n=a=>{let i=this.canvas.nodes.get(s);i&&(i.setText(r.toString()),this.canvas.markDirty(i))};r.observe(n),this.unsubscribes.push(()=>{this.relayCanvas.textNode(t).unobserve(n),this.observedTextNodes.delete(s)})}}markDirty(t){let r=this.canvas.nodes.get(t.id);r&&this.canvas.markDirty(r)}install(){var i;if(!this.canvas)return;this.debug("connecting canvas view to canvas",(i=this.view.file)==null?void 0:i.path,this.relayCanvas.path);let t=this,r=wt.exportCanvasData(this.relayCanvas.ydoc);this.canvas.importData(r,!0),this.unsubscribes.push(un(this.canvas,{requestSave(l){return function(){let c=l.call(this);try{t.relayCanvas.importFromView(t.view)}catch(u){console.error(u)}return c}},applyHistory(l){return function(c){let u=l.call(this,c);try{t.relayCanvas.importFromView(t.view)}catch(d){console.error(d)}return u}}}));let s=(l,c)=>{var m,g,h,_;let u="";if(u+=`Transaction origin: ${l.transaction.origin} ${(g=(m=l.transaction.origin)==null?void 0:m.constructor)==null?void 0:g.name}
`,this.relayCanvas||this.warn("relay canvas is already destroyed"),!this.canvas){this.warn("canvas is already destroyed");return}if(!((h=this.view.file)!=null&&h.path.endsWith(this.relayCanvas.path))){this.log("event is for another node");return}if(l.transaction.origin===this.relayCanvas)return;let d=wt.exportCanvasData(this.relayCanvas.ydoc);for(let[w,v]of l.changes.keys)u+=`key: ${w} action: ${v.action}

`;this.debug(u),this.debug("importing data",(_=this.view.file)==null?void 0:_.path,this.relayCanvas.path,d),this.canvas.importData(d,!0),this.canvas.requestSave();for(let w of l.keysChanged){let v=c.get(w);v&&(this.canvas.nodes.has(v.id)&&this.observeNode(v.getData()),this.canvas.markMoved(v),this.canvas.markDirty(v))}},n=l=>s(l,this.canvas.nodes);this.relayCanvas.ynodes.observe(n),this.unsubscribes.push(()=>{this.relayCanvas.ynodes.unobserve(n)});for(let[,l]of this.relayCanvas.ynodes)this.observeNode(l);let a=l=>s(l,this.canvas.edges);this.relayCanvas.yedges.observe(a),this.unsubscribes.push(()=>{this.relayCanvas.yedges.unobserve(a)}),this.relayCanvasView.tracking=!0}};var hc=require("@codemirror/state"),sb=require("@codemirror/view");var PB=hc.Facet.define({combine(o){return o[o.length-1]}}),ob=hc.Annotation.define(),xp=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};this.embed=!1;var t,r,s,n;this.editor=e,this.connectionManager=this.editor.state.field(wo),this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor),this.node=this.getNode(),this._ytext=this.getYText(),this._ytext&&this.view&&(this.log=Pe(`[LiveNodePluginValue][${this.view.canvas.path}#${(r=this.node)==null?void 0:r.id}]`,"log"),this.warn=Pe(`[LiveNodePluginValue][${this.view.canvas.path}#${(s=this.node)==null?void 0:s.id}]`,"warn"),this.debug=Pe(`[LiveNodePluginValue][${this.view.canvas.path}#${(n=this.node)==null?void 0:n.id}]`,"debug"),this.debug("created"),this._observer=async(a,i)=>{var l;if(this._ytext=this.getYText(),this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(i.origin!==this){let c=a.delta,u=[],d=0;for(let m=0;m<c.length;m++){let g=c[m];g.insert!=null?u.push({from:d,to:d,insert:g.insert}):g.delete!=null?(u.push({from:d,to:d+g.delete,insert:""}),d+=g.delete):g.retain!=null&&(d+=g.retain)}(l=this.view)!=null&&l.canvas&&e.dispatch({changes:u,annotations:[ob.of(this.editor)]})}},this.observer=(a,i)=>{var l;try{(l=this._observer)==null||l.call(this,a,i)}catch(c){c instanceof RangeError&&console.warn("range errors!")}},this._ytext.observe(this.observer))}getNode(){let e=this.editor.state.values.find(t=>{if(t&&t.node)return t.node});if(e)return this.node=e.node,this.node}getYText(){var t,r,s,n,a;this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor);let e=this.editor.state.values.find(i=>{if(i&&i.node)return i.node});if(!e){this.observer&&((r=this._ytext)==null||r.unobserve(this.observer));return}return e.node.id!==((s=this.node)==null?void 0:s.id)&&this.observer&&((n=this._ytext)==null||n.unobserve(this.observer)),this.node=e.node,(a=this.view)==null?void 0:a.canvas.textNode(e.node)}update(e){var r;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(ob)===this.editor)return;let t=this.getYText();t&&((r=t.doc)==null||r.transact(()=>{let s=0;e.changes.iterChanges((n,a,i,l,c)=>{let u=c.sliceString(0,c.length,`
`);n!==a&&t.delete(n+s,a-n),u.length>0&&t.insert(n+s,u),s+=u.length-(a-n)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},nb=sb.ViewPlugin.fromClass(xp);var KT=3;function bp(o,e){o.iterateAllLeaves(t=>{t.view instanceof ya.MarkdownView&&e(t.view)})}function vp(o,e){o.iterateAllLeaves(t=>{t.view.getViewType()==="canvas"&&Je().enableCanvasSync&&e(t.view)})}function GT(o,e){var t,r,s,n;if(o.length!==e.length)return!1;for(let a=0;a<o.length;a++)if(((t=o[a].view.file)==null?void 0:t.path)!==((r=e[a].view.file)==null?void 0:r.path)||((s=o[a].document)==null?void 0:s.path)!==((n=e[a].document)==null?void 0:n.path))return!1;return!0}var gc=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new fn(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){this.release(),this.banner=void 0,this.view=null}};function vo(o){return o instanceof Ts&&o.document!==void 0&&o.document.text!==void 0}function jT(o){return o instanceof yc&&o.document!==void 0}var yc=class{constructor(e,t,r,s=!0,n=!0){this._parent=e,this.view=t,this.canvas=r,this.document=r,this._tracking=!1,this.shouldConnect=s,this.canConnect=n,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.canvas.connect().then(e=>{e||(this.shouldConnect=!1)}):this.canvas.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}offlineBanner(){if(this.shouldConnect){let e=new fn(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new ep({target:e,anchor:e.firstChild,props:{view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.canvas.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.canvas.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}attach(){return this.canvas.userLock=!0,this.setConnectionDot(),this.plugin||(this.plugin=new mc(this)),new Promise(e=>this.canvas.whenReady().then(t=>{this._parent.networkStatus.online&&this.canvas.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.canvas.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.canvas.connect()}release(){var e,t,r;(e=this.plugin)==null||e.destroy(),this.plugin=void 0,(t=this._viewActions)==null||t.$destroy(),this._viewActions=void 0,(r=this._banner)==null||r.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.canvas.disconnect(),this.canvas.userLock=!1}destroy(){var e;(e=this.plugin)==null||e.destroy(),this.plugin=null,this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.canvas=null}},Ts=class{constructor(e,t,r,s=!0,n=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=s,this.canConnect=n,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new fn(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new fn(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new ep({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.document.userLock=!0,this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect(),this.document.userLock=!1}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},xc=class{constructor(e,t,r,s){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=s,this.refreshQueue=[],this._compartment=new bc.Compartment,this.log=Pe("[LiveViews]","log"),this.warn=Pe("[LiveViews]","warn"),this.metadataListeners=new Map;let n=(l,c,u)=>{let d=this.metadataListeners.get(l);d==null||d(c,u)},a=this.app.metadataCache.on("changed",n);this.offListeners.push(()=>{this.app.metadataCache.offref(a)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let i=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(c=>{this.views.forEach(u=>{var d;((d=u.document)==null?void 0:d.sharedFolder)===l&&u.offlineBanner()})}))(),l.fset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,c)=>{this.sharedFolders.has(c)||(l(),this.folderListeners.delete(c))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,i(l))})})),Bt.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([wo.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){rb(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return bp(this.workspace,t=>{var n;let r=(n=t.file)==null?void 0:n.path;if(!r)return;let s=this.sharedFolders.lookup(r);s&&e.add(s)}),vp(this.workspace,t=>{var n;let r=(n=t.file)==null?void 0:n.path;if(!r)return;let s=this.sharedFolders.lookup(r);s&&e.add(s)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(bp(this.workspace,r=>{var a;let s=(a=r.file)==null?void 0:a.path;if(!s)return;let n=this.sharedFolders.lookup(s);n&&e.add(n)}),vp(this.workspace,r=>{var a;let s=(a=r.file)==null?void 0:a.path;if(!s)return;let n=this.sharedFolders.lookup(s);n&&e.add(n)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return bp(this.workspace,async t=>{var n;let r=(n=t.file)==null?void 0:n.path;if(!r)return;let s=this.sharedFolders.lookup(r);if(s)if(this.loginManager.loggedIn)if(s.ready){let a=s.proxy.getDoc(r),i=new Ts(this,t,a);e.push(i)}else this.log(`Folder not ready, skipping views. folder=${s.path}`);else{let a=new gc(this,t,()=>this.loginManager.openLoginPage());e.push(a)}}),vp(this.workspace,t=>{var n;let r=(n=t.file)==null?void 0:n.path;if(!r)return;let s=this.sharedFolders.lookup(r);if(s)if(this.loginManager.loggedIn)if(s.ready){let a=s.proxy.getCanvas(r),i=new yc(this,t,a);e.push(i)}else this.log(`Folder not ready, skipping views. folder=${s.path}`);else{let a=new gc(this,t,()=>this.loginManager.openLoginPage());e.push(a)}}),e}findView(e){return this.views.filter(vo).find(t=>t.view.editor.cm===e)}findCanvas(e){let t=e.state.values.find(r=>{if(r&&r.node)return r.node});if(t)return this.views.filter(jT).find(r=>r.view.canvas===t.node.canvas)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof Ts).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=KT){let r=this.workspace.getActiveViewOfType(ya.MarkdownView),s=0,n=e.sort((i,l)=>l.view.leaf.activeTime-i.view.leaf.activeTime),a=new Set;for(let i of n)i instanceof Ts&&(i.view===r||a.has(i.document)?(i.canConnect=!0,a.add(i.document)):s<t?(i.canConnect=!0,a.add(i.document),s++):i.canConnect=!1);return s>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${s-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(s=>{let n=e.find(a=>{if(s.document==a.document&&s.view==a.view)return!0});n?(r.push(s),e.remove(n)):t.push(s)}),e.forEach(s=>{r.push(s)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,s=Pe(r,"debug"),n=(d,m)=>{s(d,m.map(g=>{var h;return{type:g.constructor.name,file:(h=g.document)==null?void 0:h.path,canConnect:g.canConnect}}))};if(s("Refresh"),this.destroyed)return!1;await this.foldersReady();let a=[];try{a=await this.getViews()}catch(d){return this.warn("[System 3][Relay][Live Views] error getting views",d),!1}let i=this.findFolders();if(i.length===0&&a.length===0)return this.extensions.length!==0&&(s("Unexpected plugins loaded."),this.wipe()),n("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?i.forEach(d=>{d.connect()}):this.sharedFolders.forEach(d=>{d.disconnect()});let[l,c]=this.deduplicate(a);if(n("Releasing Views",c),this.releaseViews(c),c.length===0&&GT(l,this.views)){let d=await this.viewsAttachedWithConnectionPool(this.views);n("Attached Views",d)}else{let d=await this.viewsReady(l);n("Ready Views",d);let m=await this.viewsAttachedWithConnectionPool(d);n("Attached Views",m),this.views=l}s("loading plugins"),this.load();let u=ya.moment.utc();return s(`refresh completed in ${u.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=Pe(e,"warn"),r=ya.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let s=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=s().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(wo.init(()=>this)),Wx,nb,zx,Kx,jx]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},wo=bc.StateField.define({create(o){},update(o,e){return o}});var xa=require("obsidian");function YT(o){De(o,"svelte-1siabfk",".system3-folder-icons.svelte-1siabfk{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.system3-icon.svelte-1siabfk{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1siabfk{color:var(--color-accent)}span.system3-disconnected.svelte-1siabfk{color:var(--color-base-40)}span.notebook.svelte-1siabfk{color:var(--color-accent)}span.hidden.svelte-1siabfk{display:none}.system3-progress-text.svelte-1siabfk{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1siabfk{animation:svelte-1siabfk-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1siabfk{color:var(--color-red)}@keyframes svelte-1siabfk-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function ab(o){let e,t,r,s;return{c(){e=P("span"),t=K(o[3]),r=K("%"),x(e,"class",s="system3-progress-text system3-"+o[4]+" svelte-1siabfk"),de(e,"opacity","1")},m(n,a){I(n,e,a),k(e,t),k(e,r)},p(n,a){a&8&&ne(t,n[3]),a&16&&s!==(s="system3-progress-text system3-"+n[4]+" svelte-1siabfk")&&x(e,"class",s)},d(n){n&&C(e)}}}function JT(o){let e,t,r;return t=new Xo({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=P("span"),H(t.$$.fragment),x(e,"class","notebook system3-icon svelte-1siabfk"),x(e,"aria-label","Tracking Changes")},m(s,n){I(s,e,n),B(t,e,null),r=!0},p:J,i(s){r||(S(t.$$.fragment,s),r=!0)},o(s){T(t.$$.fragment,s),r=!1},d(s){s&&C(e),N(t)}}}function QT(o){let e,t,r,s,n,a,i,l;return t=new Xo({props:{class:"inline-icon",style:"width: 0.8em"}}),n=new cn({props:{class:"inline-icon"}}),{c(){var c;e=P("span"),H(t.$$.fragment),r=U(),s=P("span"),H(n.$$.fragment),x(e,"class","notebook system3-icon hidden svelte-1siabfk"),x(e,"aria-label","Tracking Changes"),x(s,"class",a="satellite system3-icon system3-"+o[0]+" svelte-1siabfk"),x(s,"aria-label",i=`${((c=o[2])==null?void 0:c.relay.name)||"Relay Server"} (${o[0]})`)},m(c,u){I(c,e,u),B(t,e,null),I(c,r,u),I(c,s,u),B(n,s,null),l=!0},p(c,u){var d;(!l||u&1&&a!==(a="satellite system3-icon system3-"+c[0]+" svelte-1siabfk"))&&x(s,"class",a),(!l||u&5&&i!==(i=`${((d=c[2])==null?void 0:d.relay.name)||"Relay Server"} (${c[0]})`))&&x(s,"aria-label",i)},i(c){l||(S(t.$$.fragment,c),S(n.$$.fragment,c),l=!0)},o(c){T(t.$$.fragment,c),T(n.$$.fragment,c),l=!1},d(c){c&&(C(e),C(r),C(s)),N(t),N(n)}}}function XT(o){let e,t,r,s,n,a=o[5]&&ab(o),i=[QT,JT],l=[];function c(u,d){return u[1]?0:1}return r=c(o,-1),s=l[r]=i[r](o),{c(){e=P("div"),a&&a.c(),t=U(),s.c(),x(e,"class","system3-folder-icons svelte-1siabfk")},m(u,d){I(u,e,d),a&&a.m(e,null),k(e,t),l[r].m(e,null),n=!0},p(u,[d]){u[5]?a?a.p(u,d):(a=ab(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null);let m=r;r=c(u,d),r===m?l[r].p(u,d):(pe(),T(l[m],1,1,()=>{l[m]=null}),me(),s=l[r],s?s.p(u,d):(s=l[r]=i[r](u),s.c()),S(s,1),s.m(e,null))},i(u){n||(S(s),n=!0)},o(u){T(s),n=!1},d(u){u&&C(e),a&&a.d(),l[r].d()}}}function ZT(o,e,t){let r,{status:s="disconnected"}=e,{relayId:n}=e,{remote:a}=e,{progress:i=0}=e,{syncStatus:l="pending"}=e;return o.$$set=c=>{"status"in c&&t(0,s=c.status),"relayId"in c&&t(1,n=c.relayId),"remote"in c&&t(2,a=c.remote),"progress"in c&&t(3,i=c.progress),"syncStatus"in c&&t(4,l=c.syncStatus)},o.$$.update=()=>{if(o.$$.dirty&24){e:t(5,r=(l!=="completed"||i<100)&&i>0)}},[s,n,a,i,l,r]}var wp=class extends ee{constructor(e){super(),re(this,e,ZT,XT,Z,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},YT)}},ib=wp;function eP(o){De(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function tP(o){let e,t,r;return{c(){e=P("div"),t=P("span"),r=K(o[0]),x(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),x(e,"aria-label",o[1])},m(s,n){I(s,e,n),k(e,t),k(t,r)},p(s,[n]){n&1&&ne(r,s[0]),n&2&&x(e,"aria-label",s[1])},i:J,o:J,d(s){s&&C(e)}}}function rP(o,e,t){let{text:r}=e,{label:s}=e;return o.$$set=n=>{"text"in n&&t(0,r=n.text),"label"in n&&t(1,s=n.label)},[r,s]}var _p=class extends ee{constructor(e){super(),re(this,e,rP,tP,Z,{text:0,label:1},eP)}},Sp=_p;function oP(o){De(o,"svelte-1ljf67u",".system3-uploadpill.svelte-1ljf67u{text-wrap:nowrap}")}function sP(o){let e,t,r,s;return{c(){e=P("div"),t=P("span"),r=K(o[0]),x(e,"class","nav-file-tag system3-uploadpill svelte-1ljf67u"),x(e,"aria-label",o[1]),x(e,"style",s=o[2]?`color:${o[2]}`:"")},m(n,a){I(n,e,a),k(e,t),k(t,r)},p(n,[a]){a&1&&ne(r,n[0]),a&2&&x(e,"aria-label",n[1]),a&4&&s!==(s=n[2]?`color:${n[2]}`:"")&&x(e,"style",s)},i:J,o:J,d(n){n&&C(e)}}}function nP(o,e,t){let{text:r}=e,{label:s}=e,{color:n}=e;return o.$$set=a=>{"text"in a&&t(0,r=a.text),"label"in a&&t(1,s=a.label),"color"in a&&t(2,n=a.color)},[r,s,n]}var kp=class extends ee{constructor(e){super(),re(this,e,nP,sP,Z,{text:0,label:1,color:2},oP)}},lb=kp;var Cp=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,s)=>{for(let n of r)n.type==="childList"&&e.nextSibling&&(t(e),s.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},ts=class{visitFolder(e,t,r,s){return null}visitFile(e,t,r,s){return null}},Ip=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new Cp(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},Lp=class extends ts{visitFolder(e,t,r,s){return s&&s.path===e.path?r||new Ip(t.selfEl,s):(r&&r.destroy(),null)}},Tp=class{constructor(e,t){this.sharedFolder=t;let r=e.querySelectorAll(".system3-folder-icons");r.length>1&&(r==null||r.forEach(n=>{n.remove()})),this.el=e,this.el.addClass("system3-pill"),this.pill=new ib({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let s=[];s.push(this.sharedFolder.subscribe(this.el,n=>{this.pill.$set({status:n.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),s.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,n=>{n&&this.pill.$set({progress:n.percent,syncStatus:n.status})})),this.unsubscribe=()=>s.forEach(n=>n())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},Pp=class extends ts{visitFolder(e,t,r,s){return s&&s.path===e.path?r||new Tp(t.selfEl,s):(r&&r.destroy(),null)}},Dp=class{constructor(e,t,r,s){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=s;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},Fp=class extends ts{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,s,n){return n&&n.ready&&n.checkPath(t.path)&&Lt.checkExtension(t.path)?s||new Dp(r.el,t.path,this.activeSync,this.activeDownloads):(s&&s.destroy(),null)}},Ap=class{constructor(e,t){this.el=e;this.file=t;this.unsubscribes=[];this.el.querySelectorAll(".system3-uploadpill").forEach(s=>{s.remove()});let r=s=>{var n;if(s.inMeta)(n=this.pill)==null||n.$destroy();else{let a=s.uploadError||"pending",i=s.uploadError?"var(--red)":void 0;this.pill?this.pill.$set({text:a,color:i}):this.pill=new lb({target:this.el,props:{text:a,color:i}})}};this.unsubscribes.push(this.file.subscribe(s=>{r(s)}))}destroy(){var e;this.unsubscribes.forEach(t=>t()),(e=this.pill)==null||e.$destroy(),this.el.querySelectorAll(".system3-uploadpill").forEach(t=>{t.remove()})}},Mp=class extends ts{visitFile(e,t,r,s){if(s&&s.ready)try{let n=s.proxy.viewSyncFile(e.path);if(n&&Jo(n)&&s.isSyncableTFile(e)&&s.connected)return r&&r.file===n?r:new Ap(t.selfEl,n)}catch(n){}return r&&r.destroy(),null}},Ep=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new Sp({target:this.el,props:{text:"NOT SYNCED",label:"Syncing this file type is disabled"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},Rp=class extends ts{visitFile(e,t,r,s){return s&&s.checkPath(e.path)&&!s.isSyncableTFile(e)?r||new Ep(t.selfEl):(r&&r.destroy(),null)}},Op=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,s=>{this.docStatus(s)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},Up=class extends ts{visitFile(e,t,r,s){if(s)try{let n=s.getVirtualPath(e.path),a=s.syncStore.get(n);if(!a)return null;let i=s.files.get(a);return!(i instanceof Lt)||!i?null:r||new Op(t.el,i,e)}catch(n){return null}return r&&r.destroy(),null}},$p=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new Sp({target:this.el,props:{text:"DESYNC",label:"File content does not match document content"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},Bp=class extends ts{visitFile(e,t,r,s){if(s&&Lt.checkExtension(e.path)){let n=s.proxy.viewDoc(e.path);if(!n||!n.ready)return null;if(e.stat.size!==n.stat.size)return r||new $p(t.selfEl)}return r&&r.destroy(),null}},vc=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let s of this.visitors)this.storage.set(s,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(n=>n.path===e.path)||t,s=this.getFileExplorerItem(this.fileExplorer,e);s&&this.storage.forEach((n,a)=>{let i=n.get(s),l=a.visitFolder(e,s,i,r);i&&!l?n.delete(s):l&&n.set(s,l)}),e.children.forEach(n=>{if(n instanceof xa.TFolder)this.walk(n,r);else if(n instanceof xa.TFile){let a=this.getFileExplorerItem(this.fileExplorer,n);if(!a)return;this.storage.forEach((i,l)=>{let c=i.get(a),u=l.visitFile(n,a,c,r);c&&!u?i.delete(a):u&&i.set(a,u)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},wc=class{constructor(e,t,r,s){this.layoutReady=!1;this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=s,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.unsubscribes=[],this.unsubscribes.push(s.activeSync.subscribe(()=>this.quickRefresh()),s.activeDownloads.subscribe(()=>this.quickRefresh()),s.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(n=>{tx([yo.enableDocumentStatus],()=>{this.offDocumentListeners.get(n)||this.offDocumentListeners.set(n,n.fset.on(()=>{this.refresh()}))}),n.whenReady().then(()=>{this.refresh()}),this.unsubscribes.push(n.syncSettingsManager.subscribe(a=>{this.quickRefresh()})),this.unsubscribes.push(n.subscribe(this,()=>{this.quickRefresh()}))}),this.refresh()}),this.offLayoutChange=(()=>{let n=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(n)}})()}makeVisitors(){let e=[];return e.push(new Lp),e.push(new Pp),zo(yo.enableDocumentStatus,()=>{e.push(new Up),e.push(new Fp(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),e.push(new Mp),zo(yo.enableDesyncPill,()=>{e.push(new Bp)}),e.push(new Rp),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let s=this.treeState.get(r)||new vc(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,s);for(let n of t){let a=this.vault.getAbstractFileByPath(n);a instanceof xa.TFolder&&s.walk(a)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new vc(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let s=this.vault.getAbstractFileByPath("/");s instanceof xa.TFolder&&r.walk(s)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.unsubscribes.forEach(t=>t()),this.unsubscribes.length=0,this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var Iv=require("obsidian");function Ke(o,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function i(u){try{c(r.next(u))}catch(d){a(d)}}function l(u){try{c(r.throw(u))}catch(d){a(d)}}function c(u){u.done?n(u.value):s(u.value).then(i,l)}c((r=r.apply(o,e||[])).next())})}var Ps=require("obsidian");function aP(o){let e,t,r;return{c(){e=to("svg"),t=to("g"),r=to("path"),x(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),x(r,"fill","#5865F2"),x(r,"fill-rule","nonzero"),x(e,"width",o[0]),x(e,"height",o[0]),x(e,"viewBox","0 -28.5 256 256"),x(e,"version","1.1"),x(e,"xmlns","http://www.w3.org/2000/svg"),x(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),x(e,"preserveAspectRatio","xMidYMid")},m(s,n){I(s,e,n),k(e,t),k(t,r)},p(s,[n]){n&1&&x(e,"width",s[0]),n&1&&x(e,"height",s[0])},i:J,o:J,d(s){s&&C(e)}}}function iP(o,e,t){let{size:r="1em"}=e;return o.$$set=s=>{"size"in s&&t(0,r=s.size)},[r]}var Np=class extends ee{constructor(e){super(),re(this,e,iP,aP,Z,{size:0})}},_c=Np;function lP(o){De(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function cb(o){let e,t,r,s,n,a,i,l,c,u,d,m,g;return i=new _c({props:{size:20}}),{c(){e=P("div"),t=P("div"),r=U(),s=P("div"),n=P("span"),a=P("a"),H(i.$$.fragment),l=U(),c=P("span"),c.textContent="Join the community",x(t,"class","arrow svelte-4t8k3t"),x(a,"href","https://discord.system3.md"),x(a,"target","_blank"),x(a,"rel","noopener noreferrer"),x(a,"class","menu-item svelte-4t8k3t"),de(n,"text-align","center"),de(n,"display","flex"),x(s,"class","menu-content svelte-4t8k3t"),x(e,"class","menu-dropdown svelte-4t8k3t")},m(h,_){I(h,e,_),k(e,t),k(e,r),k(e,s),k(s,n),k(n,a),B(i,a,null),k(a,l),k(a,c),d=!0,m||(g=tc(u=o[1].call(null,e)),m=!0)},i(h){d||(S(i.$$.fragment,h),d=!0)},o(h){T(i.$$.fragment,h),d=!1},d(h){h&&C(e),N(i),m=!1,g()}}}function cP(o){let e,t,r,s,n,a,i;r=new Nd({props:{size:"20px"}});let l=o[0]&&cb(o);return{c(){e=P("div"),t=P("button"),H(r.$$.fragment),s=U(),l&&l.c(),x(t,"class","menu-button svelte-4t8k3t"),x(e,"class","menu-container svelte-4t8k3t")},m(c,u){I(c,e,u),k(e,t),B(r,t,null),k(e,s),l&&l.m(e,null),n=!0,a||(i=te(t,"click",Fx(o[2])),a=!0)},p(c,[u]){c[0]?l?u&1&&S(l,1):(l=cb(c),l.c(),S(l,1),l.m(e,null)):l&&(pe(),T(l,1,1,()=>{l=null}),me())},i(c){n||(S(r.$$.fragment,c),S(l),n=!0)},o(c){T(r.$$.fragment,c),T(l),n=!1},d(c){c&&C(e),N(r),l&&l.d(),a=!1,i()}}}function fP(o,e,t){let r=!1;function s(a){let i=l=>{let c=document.querySelector(".menu-button");!a.contains(l.target)&&l.target!==c&&!(c!=null&&c.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",i)},0),{destroy(){document.removeEventListener("click",i)}}}function n(a){a.stopPropagation(),t(0,r=!r)}return[r,s,n]}var Hp=class extends ee{constructor(e){super(),re(this,e,fP,cP,Z,{},lP)}},fb=Hp;function uP(o){De(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function dP(o){let e,t;return{c(){e=to("svg"),t=to("path"),x(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),x(e,"class","relay-text svelte-ycfe1d"),x(e,"width",o[0]),x(e,"height",o[1]),x(e,"viewBox","0 0 154.24573 66.293579"),x(e,"xmlns","http://www.w3.org/2000/svg")},m(r,s){I(r,e,s),k(e,t)},p:J,i:J,o:J,d(r){r&&C(e)}}}function pP(o,e,t){let{size:r=64}=e,s=r,n=r/2;return o.$$set=a=>{"size"in a&&t(2,r=a.size)},[s,n,r]}var Vp=class extends ee{constructor(e){super(),re(this,e,pP,dP,Z,{size:2},uP)}},Sc=Vp;function mP(o){De(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function hP(o){let e,t,r,s,n,a;return e=new Sc({props:{size:140}}),{c(){H(e.$$.fragment),t=U(),r=P("p"),r.textContent="Real-time collaboration in Obsidian",s=U(),n=P("p"),n.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,x(r,"class","subtitle svelte-120r7kg"),x(n,"class","description svelte-120r7kg")},m(i,l){B(e,i,l),I(i,t,l),I(i,r,l),I(i,s,l),I(i,n,l),a=!0},p:J,i(i){a||(S(e.$$.fragment,i),a=!0)},o(i){T(e.$$.fragment,i),a=!1},d(i){i&&(C(t),C(r),C(s),C(n)),N(e,i)}}}var qp=class extends ee{constructor(e){super(),re(this,e,null,hP,Z,{},mP)}},ub=qp;var kc=require("obsidian");function gP(o){De(o,"svelte-1kvxms3",`.help-section.svelte-1kvxms3{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1kvxms3{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1kvxms3{position:relative;max-width:640px;margin:0 auto}.why-google.svelte-1kvxms3:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-google.svelte-1kvxms3{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-google.svelte-1kvxms3:hover{color:var(--text-normal)}.help-content.svelte-1kvxms3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1kvxms3{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1kvxms3{opacity:1;visibility:visible}.popover.svelte-1kvxms3:not(.visible){transition-delay:0s}.arrow.svelte-1kvxms3{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1kvxms3{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function yP(o){let e,t,r,s;return{c(){e=P("div"),t=P("div"),r=U(),s=P("p"),s.textContent=`${pb}`,x(t,"class","arrow svelte-1kvxms3"),x(e,"class","popover svelte-1kvxms3"),Ne(e,"visible",o[0])},m(n,a){I(n,e,a),k(e,t),k(e,r),k(e,s),o[9](e)},p(n,a){a&1&&Ne(e,"visible",n[0])},d(n){n&&C(e),o[9](null)}}}function xP(o){let e,t=o[0]&&db(o);return{c(){t&&t.c(),e=Ie()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[0]?t?t.p(r,s):(t=db(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function db(o){let e,t;return{c(){e=P("div"),t=P("p"),t.textContent=`${pb}`,x(e,"class","help-content svelte-1kvxms3")},m(r,s){I(r,e,s),k(e,t)},p:J,d(r){r&&C(e)}}}function bP(o){let e,t,r,s,n,a,i,l,c,u,d,m;function g(w,v){return w[1]?xP:yP}let h=g(o,-1),_=h(o);return l=new _c({}),{c(){e=P("div"),t=P("div"),r=P("button"),r.textContent="Why sign in with Google?",s=U(),_.c(),n=U(),a=P("div"),i=P("a"),H(l.$$.fragment),c=K(`
		Join the project on Discord`),x(r,"class","why-google svelte-1kvxms3"),Ne(r,"mobile",o[1]),x(t,"class","help-container svelte-1kvxms3"),x(e,"class","help-section svelte-1kvxms3"),x(i,"href","https://discord.system3.md"),x(i,"class","discord-link svelte-1kvxms3"),x(a,"class","footer svelte-1kvxms3")},m(w,v){I(w,e,v),k(e,t),k(t,r),o[8](r),k(t,s),_.m(t,null),I(w,n,v),I(w,a,v),k(a,i),B(l,i,null),k(i,c),u=!0,d||(m=[te(r,"mouseenter",o[4]),te(r,"mouseleave",o[5]),te(r,"click",o[6])],d=!0)},p(w,[v]){(!u||v&2)&&Ne(r,"mobile",w[1]),h===(h=g(w,v))&&_?_.p(w,v):(_.d(1),_=h(w),_&&(_.c(),_.m(t,null)))},i(w){u||(S(l.$$.fragment,w),u=!0)},o(w){T(l.$$.fragment,w),u=!1},d(w){w&&(C(e),C(n),C(a)),o[8](null),_.d(),N(l),d=!1,Ce(m)}}}var pb="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. An identity provider like Google helps to prevent spam accounts. We may add more sign-in options based on user feedback \u2014 let us know in Discord.";function vP(o,e,t){var r;let s=!1,n=!1,a,i;function l(){n||t(0,s=!0)}function c(){n||t(0,s=!1)}function u(){n&&t(0,s=!s)}function d(g){Hr[g?"unshift":"push"](()=>{a=g,t(2,a)})}function m(g){Hr[g?"unshift":"push"](()=>{i=g,t(3,i)})}return o.$$.update=()=>{if(o.$$.dirty&128){e:t(1,n=t(7,r=kc.Platform===null||kc.Platform===void 0?void 0:kc.Platform.isMobile)!==null&&r!==void 0?r:!1)}},[s,n,a,i,l,c,u,r,d,m]}var Wp=class extends ee{constructor(e){super(),re(this,e,vP,bP,Z,{},gP)}},mb=Wp;var hb=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],Cc=class{constructor(e,t,r,s,n){this.id=e;this.name=t;this.email=r;this.picture=s;this.token=n;this.color=hb[Wa()%hb.length]}};function wP(o){De(o,"svelte-18fffd7",".avatar.svelte-18fffd7.svelte-18fffd7{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.avatar.svelte-18fffd7>img.svelte-18fffd7{margin:0px}.initial.svelte-18fffd7.svelte-18fffd7{color:var(--text-on-accent)}img.svelte-18fffd7.svelte-18fffd7{width:100%;height:100%;object-fit:cover}")}function _P(o){let e,t;return{c(){e=P("span"),t=K(o[5]),x(e,"class","initial svelte-18fffd7"),de(e,"font-size",o[4])},m(r,s){I(r,e,s),k(e,t)},p(r,s){s&32&&ne(t,r[5]),s&16&&de(e,"font-size",r[4])},d(r){r&&C(e)}}}function SP(o){let e,t,r,s;return{c(){e=P("img"),cd(e.src,t=o[0].picture)||x(e,"src",t),x(e,"alt",o[1]),x(e,"referrerpolicy","no-referrer"),x(e,"class","svelte-18fffd7")},m(n,a){I(n,e,a),r||(s=te(e,"error",o[6]),r=!0)},p(n,a){a&1&&!cd(e.src,t=n[0].picture)&&x(e,"src",t),a&2&&x(e,"alt",n[1])},d(n){n&&C(e),r=!1,s()}}}function kP(o){let e;function t(n,a){return!n[3]&&n[0].picture?SP:_P}let r=t(o,-1),s=r(o);return{c(){e=P("div"),s.c(),x(e,"class","avatar svelte-18fffd7"),de(e,"width",o[2]),de(e,"height",o[2])},m(n,a){I(n,e,a),s.m(e,null)},p(n,[a]){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e,null))),a&4&&de(e,"width",n[2]),a&4&&de(e,"height",n[2])},i:J,o:J,d(n){n&&C(e),s.d()}}}function CP(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function IP(o,e,t){let r,s,n,{user:a}=e,{alt:i="Profile picture"}=e,{size:l="40px"}=e,c=!1;function u(){t(3,c=!0)}return o.$$set=d=>{"user"in d&&t(0,a=d.user),"alt"in d&&t(1,i=d.alt),"size"in d&&t(2,l=d.size)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(5,r=a.name?a.name.charAt(0).toUpperCase():"?")}if(o.$$.dirty&4){e:t(7,s=CP(l))}if(o.$$.dirty&132){e:t(4,n=`${parseFloat(l)/2}${s}`)}},[a,i,l,c,n,r,u,s]}var zp=class extends ee{constructor(e){super(),re(this,e,IP,kP,Z,{user:0,alt:1,size:2},wP)}},gb=zp;var rN=require("obsidian");function LP(o){De(o,"svelte-zlums1",".setting-item-control.svelte-zlums1{width:unset !important;margin-top:unset !important}.setting-item.svelte-zlums1{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-zlums1{min-width:0;margin-top:auto;margin-bottom:auto}")}function TP(o){let e,t,r,s,n,a=(o[0].name||"")+"",i,l,c,u,d=(o[0].email||"")+"",m,g,h,_;t=new gb({props:{size:"2.5em",user:o[0]}});let w=o[2].default,v=ye(w,o,o[1],null);return{c(){e=P("div"),H(t.$$.fragment),r=U(),s=P("div"),n=P("div"),i=K(a),l=U(),c=P("br"),u=U(),m=K(d),g=U(),h=P("div"),v&&v.c(),x(n,"class","setting-item-description"),x(s,"class","setting-item-info svelte-zlums1"),de(s,"display","grid"),x(h,"class","setting-item-control svelte-zlums1"),x(e,"class","setting-item svelte-zlums1")},m(A,O){I(A,e,O),B(t,e,null),k(e,r),k(e,s),k(s,n),k(n,i),k(n,l),k(n,c),k(n,u),k(n,m),k(e,g),k(e,h),v&&v.m(h,null),_=!0},p(A,[O]){let M={};O&1&&(M.user=A[0]),t.$set(M),(!_||O&1)&&a!==(a=(A[0].name||"")+"")&&ne(i,a),(!_||O&1)&&d!==(d=(A[0].email||"")+"")&&ne(m,d),v&&v.p&&(!_||O&2)&&be(v,w,A,A[1],_?xe(w,A[1],O,null):ve(A[1]),null)},i(A){_||(S(t.$$.fragment,A),S(v,A),_=!0)},o(A){T(t.$$.fragment,A),T(v,A),_=!1},d(A){A&&C(e),N(t),v&&v.d(A)}}}function PP(o,e,t){let{$$slots:r={},$$scope:s}=e,{user:n}=e;return o.$$set=a=>{"user"in a&&t(0,n=a.user),"$$scope"in a&&t(1,s=a.$$scope)},[n,s,r]}var Kp=class extends ee{constructor(e){super(),re(this,e,PP,TP,Z,{user:0},LP)}},Ic=Kp;var Lc=require("obsidian");function DP(o){De(o,"svelte-5zjjwa",".help-container.svelte-5zjjwa{position:relative;display:inline-block}button.svelte-5zjjwa{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-5zjjwa:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-5zjjwa:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.popover.svelte-5zjjwa{position:absolute;z-index:50;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.popover.left.svelte-5zjjwa{right:100%;margin-right:8px}.popover.right.svelte-5zjjwa{left:0}.arrow.svelte-5zjjwa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-5zjjwa{right:8px}.arrow.right.svelte-5zjjwa{left:8px}p.svelte-5zjjwa{margin:0;color:var(--text-normal)}")}function yb(o){let e,t,r,s,n;return{c(){e=P("div"),t=P("div"),r=U(),s=P("p"),n=K(o[0]),x(t,"class","arrow svelte-5zjjwa"),Ne(t,"left",o[4]==="left"),Ne(t,"right",o[4]==="right"),x(s,"class","svelte-5zjjwa"),x(e,"class","popover svelte-5zjjwa"),Ne(e,"left",o[4]==="left"),Ne(e,"right",o[4]==="right")},m(a,i){I(a,e,i),k(e,t),k(e,r),k(e,s),k(s,n),o[9](e)},p(a,i){i&16&&Ne(t,"left",a[4]==="left"),i&16&&Ne(t,"right",a[4]==="right"),i&1&&ne(n,a[0]),i&16&&Ne(e,"left",a[4]==="left"),i&16&&Ne(e,"right",a[4]==="right")},d(a){a&&C(e),o[9](null)}}}function FP(o){let e,t,r,s,n,a,i;r=new Si({props:{size:16}});let l=o[1]&&yb(o);return{c(){e=P("div"),t=P("button"),H(r.$$.fragment),s=U(),l&&l.c(),x(t,"type","button"),x(t,"class","svelte-5zjjwa"),x(e,"class","help-container svelte-5zjjwa")},m(c,u){I(c,e,u),k(e,t),B(r,t,null),o[8](t),k(e,s),l&&l.m(e,null),n=!0,a||(i=[te(t,"mouseenter",o[5]),te(t,"mouseleave",o[6]),te(t,"click",o[7])],a=!0)},p(c,[u]){c[1]?l?l.p(c,u):(l=yb(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(c){n||(S(r.$$.fragment,c),n=!0)},o(c){T(r.$$.fragment,c),n=!1},d(c){c&&C(e),N(r),o[8](null),l&&l.d(),a=!1,Ce(i)}}}function AP(o,e,t){let{helpText:r}=e,s=!1,n="right",a,i;function l(){t(1,s=!0)}function c(){t(1,s=!1)}function u(){t(1,s=!s)}function d(g){Hr[g?"unshift":"push"](()=>{a=g,t(2,a)})}function m(g){Hr[g?"unshift":"push"](()=>{i=g,t(3,i)})}return o.$$set=g=>{"helpText"in g&&t(0,r=g.helpText)},o.$$.update=()=>{if(o.$$.dirty&14){e:if(s&&a&&i){let g=a.getBoundingClientRect(),h=i.getBoundingClientRect(),_=window.innerWidth;t(4,n=g.right+h.width>_-20?"left":"right")}}},[r,s,a,i,n,l,c,u,d,m]}var Gp=class extends ee{constructor(e){super(),re(this,e,AP,FP,Z,{helpText:0},DP)}},xb=Gp;function MP(o){De(o,"svelte-1v3t6m3",".setting-item-name.svelte-1v3t6m3{display:flex;align-items:center;gap:8px}.help-button.svelte-1v3t6m3{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-1v3t6m3:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-1v3t6m3:active{color:var(--text-normal)}.help-content.svelte-1v3t6m3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-1v3t6m3{margin:0}")}var EP=o=>({}),bb=o=>({}),RP=o=>({}),vb=o=>({}),OP=o=>({}),wb=o=>({});function UP(o){let e;return{c(){e=K(o[0])},m(t,r){I(t,e,r)},p(t,r){r&1&&ne(e,t[0])},d(t){t&&C(e)}}}function _b(o){let e,t,r,s,n=[BP,$P],a=[];function i(l,c){return l[3]?0:1}return e=i(o,-1),t=a[e]=n[e](o),{c(){t.c(),r=Ie()},m(l,c){a[e].m(l,c),I(l,r,c),s=!0},p(l,c){let u=e;e=i(l,c),e===u?a[e].p(l,c):(pe(),T(a[u],1,1,()=>{a[u]=null}),me(),t=a[e],t?t.p(l,c):(t=a[e]=n[e](l),t.c()),S(t,1),t.m(r.parentNode,r))},i(l){s||(S(t),s=!0)},o(l){T(t),s=!1},d(l){l&&C(r),a[e].d(l)}}}function $P(o){let e,t;return e=new xb({props:{helpText:o[1]}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&2&&(n.helpText=r[1]),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function BP(o){let e,t,r,s,n;return t=new Si({props:{size:16}}),{c(){e=P("button"),H(t.$$.fragment),x(e,"class","help-button svelte-1v3t6m3"),x(e,"aria-expanded",o[2])},m(a,i){I(a,e,i),B(t,e,null),r=!0,s||(n=te(e,"click",o[4]),s=!0)},p(a,i){(!r||i&4)&&x(e,"aria-expanded",a[2])},i(a){r||(S(t.$$.fragment,a),r=!0)},o(a){T(t.$$.fragment,a),r=!1},d(a){a&&C(e),N(t),s=!1,n()}}}function NP(o){let e,t,r=o[7].description,s=ye(r,o,o[6],bb);return{c(){e=P("div"),s&&s.c(),x(e,"class","setting-item-description")},m(n,a){I(n,e,a),s&&s.m(e,null),t=!0},p(n,a){s&&s.p&&(!t||a&64)&&be(s,r,n,n[6],t?xe(r,n[6],a,EP):ve(n[6]),bb)},i(n){t||(S(s,n),t=!0)},o(n){T(s,n),t=!1},d(n){n&&C(e),s&&s.d(n)}}}function Sb(o){let e,t,r;return{c(){e=P("div"),t=P("p"),r=K(o[1]),x(t,"class","svelte-1v3t6m3"),x(e,"class","help-content svelte-1v3t6m3"),Ne(e,"expanded",o[2])},m(s,n){I(s,e,n),k(e,t),k(t,r)},p(s,n){n&2&&ne(r,s[1]),n&4&&Ne(e,"expanded",s[2])},d(s){s&&C(e)}}}function HP(o){let e,t,r,s,n,a,i,l,c,u=o[7].name,d=ye(u,o,o[6],wb),m=d||UP(o),g=o[1]&&_b(o),h=o[7].description,_=ye(h,o,o[6],vb),w=_||NP(o),v=o[1]&&o[2]&&o[3]&&Sb(o),A=o[7].default,O=ye(A,o,o[6],null);return{c(){e=P("div"),t=P("div"),r=P("div"),m&&m.c(),s=U(),g&&g.c(),n=U(),w&&w.c(),a=U(),v&&v.c(),i=U(),l=P("div"),O&&O.c(),x(r,"class","setting-item-name svelte-1v3t6m3"),x(t,"class","setting-item-info"),x(l,"class","setting-item-control"),x(e,"class","setting-item setting-item-heading mod-list-item")},m(M,E){I(M,e,E),k(e,t),k(t,r),m&&m.m(r,null),k(r,s),g&&g.m(r,null),k(t,n),w&&w.m(t,null),k(t,a),v&&v.m(t,null),k(e,i),k(e,l),O&&O.m(l,null),c=!0},p(M,[E]){d?d.p&&(!c||E&64)&&be(d,u,M,M[6],c?xe(u,M[6],E,OP):ve(M[6]),wb):m&&m.p&&(!c||E&1)&&m.p(M,c?E:-1),M[1]?g?(g.p(M,E),E&2&&S(g,1)):(g=_b(M),g.c(),S(g,1),g.m(r,null)):g&&(pe(),T(g,1,1,()=>{g=null}),me()),_?_.p&&(!c||E&64)&&be(_,h,M,M[6],c?xe(h,M[6],E,RP):ve(M[6]),vb):w&&w.p&&(!c||E&64)&&w.p(M,c?E:-1),M[1]&&M[2]&&M[3]?v?v.p(M,E):(v=Sb(M),v.c(),v.m(t,null)):v&&(v.d(1),v=null),O&&O.p&&(!c||E&64)&&be(O,A,M,M[6],c?xe(A,M[6],E,null):ve(M[6]),null)},i(M){c||(S(m,M),S(g),S(w,M),S(O,M),c=!0)},o(M){T(m,M),T(g),T(w,M),T(O,M),c=!1},d(M){M&&C(e),m&&m.d(M),g&&g.d(),w&&w.d(M),v&&v.d(),O&&O.d(M)}}}function VP(o,e,t){let{$$slots:r={},$$scope:s}=e;var n;let{name:a=""}=e,{helpText:i=void 0}=e,l=!1,c=!1;function u(){c&&t(2,l=!l)}return o.$$set=d=>{"name"in d&&t(0,a=d.name),"helpText"in d&&t(1,i=d.helpText),"$$scope"in d&&t(6,s=d.$$scope)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,c=t(5,n=Lc.Platform===null||Lc.Platform===void 0?void 0:Lc.Platform.isMobile)!==null&&n!==void 0?n:!1)}},[a,i,l,c,u,n,s,r]}var jp=class extends ee{constructor(e){super(),re(this,e,VP,HP,Z,{name:0,helpText:1},MP)}},Ge=jp;var ba=[];function qP(o,e){return{subscribe:_e(o,e).subscribe}}function _e(o,e=J){let t,r=new Set;function s(i){if(Z(o,i)&&(o=i,t)){let l=!ba.length;for(let c of r)c[1](),ba.push(c,o);if(l){for(let c=0;c<ba.length;c+=2)ba[c][0](ba[c+1]);ba.length=0}}}function n(i){s(i(o))}function a(i,l=J){let c=[i,l];return r.add(c),r.size===1&&(t=e(s,n)||J),i(o),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:s,update:n,subscribe:a}}function oo(o,e,t){let r=!Array.isArray(o),s=r?[o]:o;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let n=e.length<2;return qP(t,(a,i)=>{let l=!1,c=[],u=0,d=J,m=()=>{if(u)return;d();let h=e(r?c[0]:c,a,i);n?a(h):d=ht(h)?h:J},g=s.map((h,_)=>ir(h,w=>{c[_]=w,u&=~(1<<_),l&&m()},()=>{u|=1<<_}));return l=!0,m(),function(){Ce(g),d(),l=!1}})}function WP(o){De(o,"svelte-xcpzqp",`.continue.svelte-xcpzqp{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-xcpzqp{color:var(--text-muted)}.link.svelte-xcpzqp:hover{color:var(--text-normal)}.not-working.svelte-xcpzqp{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-xcpzqp{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-xcpzqp:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-xcpzqp{height:auto;padding:0;color:var(--text-faint)}.welcome.svelte-xcpzqp{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-xcpzqp{height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-xcpzqp:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-xcpzqp:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}`)}function zP(o){let e,t,r,s,n,a,i;t=new ub({});function l(h,_){return h[3]?jP:GP}let c=l(o,[-1,-1]),u=c(o);function d(h,_){if(h[5])return JP;if(h[4])return YP}let m=d(o,[-1,-1]),g=m&&m(o);return a=new mb({}),{c(){e=P("div"),H(t.$$.fragment),r=U(),u.c(),s=U(),g&&g.c(),n=U(),H(a.$$.fragment),x(e,"class","welcome svelte-xcpzqp")},m(h,_){I(h,e,_),B(t,e,null),k(e,r),u.m(e,null),k(e,s),g&&g.m(e,null),I(h,n,_),B(a,h,_),i=!0},p(h,_){c===(c=l(h,_))&&u?u.p(h,_):(u.d(1),u=c(h),u&&(u.c(),u.m(e,s))),m===(m=d(h,_))&&g?g.p(h,_):(g&&g.d(1),g=m&&m(h),g&&(g.c(),g.m(e,null)))},i(h){i||(S(t.$$.fragment,h),S(a.$$.fragment,h),i=!0)},o(h){T(t.$$.fragment,h),T(a.$$.fragment,h),i=!1},d(h){h&&(C(e),C(n)),N(t),u.d(),g&&g.d(),N(a,h)}}}function KP(o){let e,t,r,s,n,a,i;e=new Ge({props:{$$slots:{name:[XP],default:[QP]},$$scope:{ctx:o}}}),r=new Ge({props:{name:"Account"}}),n=new Ic({props:{user:o[2].user,$$slots:{default:[ZP]},$$scope:{ctx:o}}});let l=o[18].default,c=ye(l,o,o[25],null);return{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment),s=U(),H(n.$$.fragment),a=U(),c&&c.c()},m(u,d){B(e,u,d),I(u,t,d),B(r,u,d),I(u,s,d),B(n,u,d),I(u,a,d),c&&c.m(u,d),i=!0},p(u,d){let m={};d[0]&33554432&&(m.$$scope={dirty:d,ctx:u}),e.$set(m);let g={};d[0]&4&&(g.user=u[2].user),d[0]&33554432&&(g.$$scope={dirty:d,ctx:u}),n.$set(g),c&&c.p&&(!i||d[0]&33554432)&&be(c,l,u,u[25],i?xe(l,u[25],d,null):ve(u[25]),null)},i(u){i||(S(e.$$.fragment,u),S(r.$$.fragment,u),S(n.$$.fragment,u),S(c,u),i=!0)},o(u){T(e.$$.fragment,u),T(r.$$.fragment,u),T(n.$$.fragment,u),T(c,u),i=!1},d(u){u&&(C(t),C(s),C(a)),N(e,u),N(r,u),N(n,u),c&&c.d(u)}}}function GP(o){let e,t,r,s,n;return{c(){e=P("a"),t=P("button"),r=K("Sign in with Google"),x(t,"class","google-sign-in-button svelte-xcpzqp"),t.disabled=o[4],x(e,"href",o[1]),x(e,"target","_blank")},m(a,i){I(a,e,i),k(e,t),k(t,r),s||(n=te(t,"click",o[21]),s=!0)},p(a,i){i[0]&16&&(t.disabled=a[4]),i[0]&2&&x(e,"href",a[1])},d(a){a&&C(e),s=!1,n()}}}function jP(o){let e,t,r,s;return{c(){e=P("button"),t=K("Sign in with Google"),x(e,"class","google-sign-in-button svelte-xcpzqp"),e.disabled=o[4]},m(n,a){I(n,e,a),k(e,t),r||(s=te(e,"click",(0,Ps.debounce)(o[20])),r=!0)},p(n,a){a[0]&16&&(e.disabled=n[4])},d(n){n&&C(e),r=!1,s()}}}function YP(o){let e,t,r,s,n,a,i,l;return{c(){e=P("div"),t=P("p"),t.textContent="Continue in your browser...",r=U(),s=P("p"),n=K(`Not working?
					`),a=P("button"),a.textContent="(try again)",x(t,"class","continue svelte-xcpzqp"),x(a,"class","link link-button svelte-xcpzqp"),x(s,"class","not-working svelte-xcpzqp")},m(c,u){I(c,e,u),k(e,t),k(e,r),k(e,s),k(s,n),k(s,a),i||(l=te(a,"click",o[24]),i=!0)},p:J,d(c){c&&C(e),i=!1,l()}}}function JP(o){let e,t,r,s,n,a,i,l,c,u,d,m=o[6]&&kb(o);return{c(){e=P("p"),t=K(o[5]),r=K("."),s=P("br"),n=U(),m&&m.c(),a=U(),i=P("p"),l=K(`Not working?
				`),c=P("button"),c.textContent="(try again)",x(c,"class","link link-button svelte-xcpzqp"),x(i,"class","not-working svelte-xcpzqp")},m(g,h){I(g,e,h),k(e,t),k(e,r),k(e,s),k(e,n),m&&m.m(e,null),I(g,a,h),I(g,i,h),k(i,l),k(i,c),u||(d=te(c,"click",o[23]),u=!0)},p(g,h){h[0]&32&&ne(t,g[5]),g[6]?m?m.p(g,h):(m=kb(g),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(g){g&&(C(e),C(a),C(i)),m&&m.d(),u=!1,d()}}}function kb(o){let e,t,r,s;return{c(){e=K("Already logged in? "),t=P("button"),t.textContent="(click here)",x(t,"class","link link-button svelte-xcpzqp")},m(n,a){I(n,e,a),I(n,t,a),r||(s=te(t,"click",(0,Ps.debounce)(o[22])),r=!0)},p:J,d(n){n&&(C(e),C(t)),r=!1,s()}}}function QP(o){let e,t;return e=new fb({}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function XP(o){let e,t;return e=new Sc({props:{slot:"name"}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p:J,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function ZP(o){let e,t,r;return{c(){e=P("button"),e.textContent="Logout"},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Ps.debounce)(o[19])),t=!0)},p:J,d(s){s&&C(e),t=!1,r()}}}function eD(o){let e,t,r,s,n=[KP,zP],a=[];function i(l,c){return l[2].hasUser&&l[2].user?0:1}return e=i(o,[-1,-1]),t=a[e]=n[e](o),{c(){t.c(),r=Ie()},m(l,c){a[e].m(l,c),I(l,r,c),s=!0},p(l,c){let u=e;e=i(l,c),e===u?a[e].p(l,c):(pe(),T(a[u],1,1,()=>{a[u]=null}),me(),t=a[e],t?t.p(l,c):(t=a[e]=n[e](l),t.c()),S(t,1),t.m(r.parentNode,r))},i(l){s||(S(t),s=!0)},o(l){T(t),s=!1},d(l){l&&C(r),a[e].d(l)}}}function tD(o,e,t){let r,s,n,a=J,i=()=>(a(),a=ir(_,le=>t(2,n=le)),_),l,c,u,d;o.$$.on_destroy.push(()=>a());let{$$slots:m={},$$scope:g}=e,{plugin:h}=e,_,w=_e(!Ps.Platform.isIosApp);ge(o,w,le=>t(3,l=le));let v=_e(!1);ge(o,v,le=>t(4,c=le)),i(_=h.loginManager);let A=_e(!1);ge(o,A,le=>t(6,d=le));let O=_e(!1),M=_e(!0);ge(o,M,le=>t(28,r=le));let E=_e("please wait...");ge(o,E,le=>t(1,s=le));let R,D,F=_e("");ge(o,F,le=>t(5,u=le));function V(){return Ke(this,void 0,void 0,function*(){h.loginManager.logout(),O.set(!1),A.set(!1)})}function q(){return Ke(this,void 0,void 0,function*(){try{yield h.loginManager.login()}catch(le){w.set(!1),O.set(!1),s&&s!=="please wait..."&&(window.open(s,"_blank"),he())}})}let j=_e(h.loginManager.pb);function z(){j.set(h.loginManager.pb)}function Y(){try{let le=r?Et:fetch;R=void 0,E.set("please wait..."),_.initiateManualOAuth2CodeFlow(le).then(([W,Le,it])=>{R=Le,D=it,E.set(W)}).catch(W=>{let Le=W.message;throw Le=Le,F.set(Le),O.set(!1),W})}catch(le){F.set(le.message)}}cr(()=>{O.set(!1),Y()});function he(){return Ke(this,void 0,void 0,function*(){if(!(!R||!D))return yield h.loginManager.poll(R,D).then(le=>{O.set(!0),v.set(!1),F.set("")}).catch(le=>{A.set(!0),v.set(!1),O.set(!1),F.set(le.message)})})}function Fe(le){let W=le.target;W.focus(),W.select(),navigator.clipboard.writeText(W.value).then(()=>new Ps.Notice("Invite link copied")).catch(Le=>{}),he()}let G=()=>{V()},oe=async()=>{v.set(!0),await q()},Se=()=>{v.set(!0),he()},je=()=>{he()},Oe=()=>{v.set(!1),w.set(!1),F.set(""),Y()},ce=()=>{v.set(!1),w.set(!1)};return o.$$set=le=>{"plugin"in le&&t(17,h=le.plugin),"$$scope"in le&&t(25,g=le.$$scope)},[_,s,n,l,c,u,d,w,v,A,M,E,F,V,q,Y,he,h,m,G,oe,Se,je,Oe,ce,g]}var Yp=class extends ee{constructor(e){super(),re(this,e,tD,eD,Z,{plugin:17},WP,[-1,-1])}},Cb=Yp;function Ib(o,e,t){let r=o.slice();return r[5]=e[t],r}var rD=o=>({}),Lb=o=>({}),oD=o=>({}),Tb=o=>({});function sD(o){let e;return{c(){e=K(o[0])},m(t,r){I(t,e,r)},p(t,r){r&1&&ne(e,t[0])},d(t){t&&C(e)}}}function nD(o){let e,t=Ae(o[1]),r=[];for(let s=0;s<t.length;s+=1)r[s]=Pb(Ib(o,t,s));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=Ie()},m(s,n){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(s,n);I(s,e,n)},p(s,n){if(n&2){t=Ae(s[1]);let a;for(a=0;a<t.length;a+=1){let i=Ib(s,t,a);r[a]?r[a].p(i,n):(r[a]=Pb(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&C(e),nt(r,s)}}}function Pb(o){let e;return{c(){e=P("div"),e.textContent=`${o[5]} `},m(t,r){I(t,e,r)},p:J,d(t){t&&C(e)}}}function aD(o){let e,t=o[1].length>0&&nD(o);return{c(){t&&t.c(),e=Ie()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[1].length>0&&t.p(r,s)},d(r){r&&C(e),t&&t.d(r)}}}function iD(o){let e,t,r,s,n,a,i,l,c=o[4].name,u=ye(c,o,o[3],Tb),d=u||sD(o),m=o[4].description,g=ye(m,o,o[3],Lb),h=g||aD(o),_=o[4].default,w=ye(_,o,o[3],null);return{c(){e=P("div"),t=P("div"),r=P("div"),d&&d.c(),s=U(),n=P("div"),h&&h.c(),a=U(),i=P("div"),w&&w.c(),x(r,"class","setting-item-name"),de(r,"display","grid"),de(r,"align-items","center"),x(n,"class","setting-item-description"),x(t,"class","setting-item-info"),de(t,"display","grid"),x(i,"class","setting-item-control"),x(e,"class","setting-item")},m(v,A){I(v,e,A),k(e,t),k(t,r),d&&d.m(r,null),k(t,s),k(t,n),h&&h.m(n,null),k(e,a),k(e,i),w&&w.m(i,null),l=!0},p(v,[A]){u?u.p&&(!l||A&8)&&be(u,c,v,v[3],l?xe(c,v[3],A,oD):ve(v[3]),Tb):d&&d.p&&(!l||A&1)&&d.p(v,l?A:-1),g&&g.p&&(!l||A&8)&&be(g,m,v,v[3],l?xe(m,v[3],A,rD):ve(v[3]),Lb),w&&w.p&&(!l||A&8)&&be(w,_,v,v[3],l?xe(_,v[3],A,null):ve(v[3]),null)},i(v){l||(S(d,v),S(h,v),S(w,v),l=!0)},o(v){T(d,v),T(h,v),T(w,v),l=!1},d(v){v&&C(e),d&&d.d(v),h&&h.d(v),w&&w.d(v)}}}function lD(o,e,t){let{$$slots:r={},$$scope:s}=e,{name:n=""}=e,{description:a}=e,i=a!==void 0?a.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,n=l.name),"description"in l&&t(2,a=l.description),"$$scope"in l&&t(3,s=l.$$scope)},[n,i,a,s,r]}var Jp=class extends ee{constructor(e){super(),re(this,e,lD,iD,Z,{name:0,description:2})}},Be=Jp;function cD(o){De(o,"svelte-11hpkul",".setting-item-control.svelte-11hpkul{width:unset !important;margin-top:unset !important}.setting-item.svelte-11hpkul{flex-direction:unset !important}.setting-item-info.svelte-11hpkul{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-11hpkul{min-width:0}.truncate.svelte-11hpkul *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var fD=o=>({}),Db=o=>({}),uD=o=>({}),Fb=o=>({});function dD(o){let e;return{c(){e=K(o[0])},m(t,r){I(t,e,r)},p(t,r){r&1&&ne(e,t[0])},d(t){t&&C(e)}}}function Ab(o){let e,t;return{c(){e=P("div"),t=K(o[1]),x(e,"class","setting-item-description")},m(r,s){I(r,e,s),k(e,t)},p(r,s){s&2&&ne(t,r[1])},d(r){r&&C(e)}}}function pD(o){let e,t=o[1]&&Ab(o);return{c(){t&&t.c(),e=Ie()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[1]?t?t.p(r,s):(t=Ab(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function mD(o){let e,t,r,s,n,a,i,l=o[3].name,c=ye(l,o,o[2],Fb),u=c||dD(o),d=o[3].description,m=ye(d,o,o[2],Db),g=m||pD(o),h=o[3].default,_=ye(h,o,o[2],null);return{c(){e=P("div"),t=P("div"),r=P("div"),u&&u.c(),s=U(),g&&g.c(),n=U(),a=P("div"),_&&_.c(),x(r,"class","setting-item-name truncate svelte-11hpkul"),x(t,"class","setting-item-info svelte-11hpkul"),x(a,"class","setting-item-control svelte-11hpkul"),x(e,"class","setting-item mod-list-item svelte-11hpkul")},m(w,v){I(w,e,v),k(e,t),k(t,r),u&&u.m(r,null),k(t,s),g&&g.m(t,null),k(e,n),k(e,a),_&&_.m(a,null),i=!0},p(w,[v]){c?c.p&&(!i||v&4)&&be(c,l,w,w[2],i?xe(l,w[2],v,uD):ve(w[2]),Fb):u&&u.p&&(!i||v&1)&&u.p(w,i?v:-1),m?m.p&&(!i||v&4)&&be(m,d,w,w[2],i?xe(d,w[2],v,fD):ve(w[2]),Db):g&&g.p&&(!i||v&2)&&g.p(w,i?v:-1),_&&_.p&&(!i||v&4)&&be(_,h,w,w[2],i?xe(h,w[2],v,null):ve(w[2]),null)},i(w){i||(S(u,w),S(g,w),S(_,w),i=!0)},o(w){T(u,w),T(g,w),T(_,w),i=!1},d(w){w&&C(e),u&&u.d(w),g&&g.d(w),_&&_.d(w)}}}function hD(o,e,t){let{$$slots:r={},$$scope:s}=e,{name:n=""}=e,{description:a=""}=e;return o.$$set=i=>{"name"in i&&t(0,n=i.name),"description"in i&&t(1,a=i.description),"$$scope"in i&&t(2,s=i.$$scope)},[n,a,s,r]}var Qp=class extends ee{constructor(e){super(),re(this,e,hD,mD,Z,{name:0,description:1},cD)}},Ft=Qp;function gD(o){De(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function yD(o){let e,t,r,s,n;return t=new Yd({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){e=P("div"),H(t.$$.fragment),x(e,"class","clickable-icon extra-setting-button svelte-y529x8"),x(e,"aria-label","Options"),x(e,"role","button"),x(e,"tabindex","0")},m(a,i){I(a,e,i),B(t,e,null),r=!0,s||(n=[te(e,"click",o[0]),te(e,"keydown",o[0])],s=!0)},p:J,i(a){r||(S(t.$$.fragment,a),r=!0)},o(a){T(t.$$.fragment,a),r=!1},d(a){a&&C(e),N(t),s=!1,Ce(n)}}}function xD(o){let e=Gt();function t(r){(r instanceof MouseEvent||r instanceof KeyboardEvent&&(r.key==="Enter"||r.key===" "))&&e("settings")}return[t]}var Xp=class extends ee{constructor(e){super(),re(this,e,xD,yD,Z,{},gD)}},dn=Xp;function bD(o){let e,t,r,s,n,a;t=new cn({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let i=o[3].default,l=ye(i,o,o[2],null);return{c(){e=P("span"),H(t.$$.fragment),r=U(),l&&l.c(),x(e,"role","button"),x(e,"tabindex","0"),de(e,"display","flex"),de(e,"align-items","center"),de(e,"width","100%")},m(c,u){I(c,e,u),B(t,e,null),k(e,r),l&&l.m(e,null),s=!0,n||(a=[te(e,"keypress",o[0]),te(e,"click",o[0])],n=!0)},p(c,[u]){l&&l.p&&(!s||u&4)&&be(l,i,c,c[2],s?xe(i,c[2],u,null):ve(c[2]),null)},i(c){s||(S(t.$$.fragment,c),S(l,c),s=!0)},o(c){T(t.$$.fragment,c),T(l,c),s=!1},d(c){c&&C(e),N(t),l&&l.d(c),n=!1,Ce(a)}}}function vD(o,e,t){let{$$slots:r={},$$scope:s}=e,{relay:n=void 0}=e,a=Gt();function i(){n&&a("manageRelay",{relay:n})}return o.$$set=l=>{"relay"in l&&t(1,n=l.relay),"$$scope"in l&&t(2,s=l.$$scope)},[i,n,s,r]}var Zp=class extends ee{constructor(e){super(),re(this,e,vD,bD,Z,{relay:1})}},Ds=Zp;function wD(o){let e,t,r,s,n,a;t=new Md({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let i=o[3].default,l=ye(i,o,o[2],null);return{c(){e=P("span"),H(t.$$.fragment),r=U(),l&&l.c(),x(e,"role","button"),x(e,"tabindex","0"),de(e,"display","inline-flex"),de(e,"align-items","center"),de(e,"width","100%")},m(c,u){I(c,e,u),B(t,e,null),k(e,r),l&&l.m(e,null),s=!0,n||(a=[te(e,"keypress",o[0]),te(e,"click",o[0])],n=!0)},p(c,[u]){l&&l.p&&(!s||u&4)&&be(l,i,c,c[2],s?xe(i,c[2],u,null):ve(c[2]),null)},i(c){s||(S(t.$$.fragment,c),S(l,c),s=!0)},o(c){T(t.$$.fragment,c),T(l,c),s=!1},d(c){c&&C(e),N(t),l&&l.d(c),n=!1,Ce(a)}}}function _D(o,e,t){let{$$slots:r={},$$scope:s}=e,{folder:n=void 0}=e,a=Gt();function i(){var l;n&&a("manageSharedFolder",{folder:n,relay:(l=n.remote)===null||l===void 0?void 0:l.relay})}return o.$$set=l=>{"folder"in l&&t(1,n=l.folder),"$$scope"in l&&t(2,s=l.$$scope)},[i,n,s,r]}var em=class extends ee{constructor(e){super(),re(this,e,_D,wD,Z,{folder:1})}},So=em;function SD(o){let e,t=o[0].name+"",r;return{c(){e=P("span"),r=K(t),de(e,"overflow","hidden"),de(e,"text-overflow","ellipsis"),de(e,"white-space","nowrap")},m(s,n){I(s,e,n),k(e,r)},p(s,n){n&1&&t!==(t=s[0].name+"")&&ne(r,t)},d(s){s&&C(e)}}}function Mb(o){let e,t,r,s,n;return t=new bd({props:{size:16,class:"svg-icon"}}),s=new Ds({props:{relay:o[1],$$slots:{default:[kD]},$$scope:{ctx:o}}}),s.$on("manageRelay",o[3]),{c(){e=P("span"),H(t.$$.fragment),r=U(),H(s.$$.fragment),de(e,"width","16px"),de(e,"flex-shrink","0"),de(e,"display","flex"),de(e,"justify-content","center")},m(a,i){I(a,e,i),B(t,e,null),I(a,r,i),B(s,a,i),n=!0},p(a,i){let l={};i&2&&(l.relay=a[1]),i&17&&(l.$$scope={dirty:i,ctx:a}),s.$set(l)},i(a){n||(S(t.$$.fragment,a),S(s.$$.fragment,a),n=!0)},o(a){T(t.$$.fragment,a),T(s.$$.fragment,a),n=!1},d(a){a&&(C(e),C(r)),N(t),N(s,a)}}}function kD(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=P("span"),r=K(t),de(e,"flex","1"),de(e,"min-width","0"),de(e,"text-overflow","ellipsis"),de(e,"white-space","nowrap")},m(s,n){I(s,e,n),k(e,r)},p(s,n){n&1&&t!==(t=s[0].remote.relay.name+"")&&ne(r,t)},d(s){s&&C(e)}}}function CD(o){let e,t,r,s,n;r=new So({props:{folder:o[0],$$slots:{default:[SD]},$$scope:{ctx:o}}}),r.$on("manageSharedFolder",o[2]);let a=o[0].remote&&Mb(o);return{c(){e=P("span"),t=P("span"),H(r.$$.fragment),s=U(),a&&a.c(),de(t,"display","inline-flex"),de(t,"align-items","center"),de(t,"width","200px"),de(t,"min-width","200px"),de(t,"flex-shrink","0"),de(e,"display","inline-flex"),de(e,"align-items","center"),de(e,"width","100%"),de(e,"gap","8px")},m(i,l){I(i,e,l),k(e,t),B(r,t,null),k(e,s),a&&a.m(e,null),n=!0},p(i,[l]){let c={};l&1&&(c.folder=i[0]),l&17&&(c.$$scope={dirty:l,ctx:i}),r.$set(c),i[0].remote?a?(a.p(i,l),l&1&&S(a,1)):(a=Mb(i),a.c(),S(a,1),a.m(e,null)):a&&(pe(),T(a,1,1,()=>{a=null}),me())},i(i){n||(S(r.$$.fragment,i),S(a),n=!0)},o(i){T(r.$$.fragment,i),T(a),n=!1},d(i){i&&C(e),N(r),a&&a.d()}}}function ID(o,e,t){let{folder:r}=e,{relay:s}=e;function n(i){ro.call(this,o,i)}function a(i){ro.call(this,o,i)}return o.$$set=i=>{"folder"in i&&t(0,r=i.folder),"relay"in i&&t(1,s=i.relay)},[r,s,n,a]}var tm=class extends ee{constructor(e){super(),re(this,e,ID,CD,Z,{folder:0,relay:1})}},Eb=tm;var Fs=require("obsidian");function LD(o){De(o,"svelte-yg42fv","input.system3-input-invalid.svelte-yg42fv{border:1px solid var(--color-red) !important}span.faint.svelte-yg42fv{color:var(--text-faint)}")}function Rb(o,e,t){let r=o.slice();return r[22]=e[t],r}function Ob(o,e,t){let r=o.slice();return r[25]=e[t],r}function TD(o){let e,t,r,s,n,a,i;return{c(){e=P("input"),r=U(),s=P("button"),n=K("Join"),x(e,"type","text"),x(e,"placeholder","Enter share key"),e.disabled=o[3],x(e,"class",t=ia(o[2]?"system3-input-invalid":"")+" svelte-yg42fv"),x(s,"class","mod-cta"),s.disabled=o[3]},m(l,c){I(l,e,c),lr(e,o[1]),I(l,r,c),I(l,s,c),k(s,n),a||(i=[te(e,"input",o[13]),te(e,"input",o[9]),te(s,"click",function(){ht((0,Fs.debounce)(o[14]))&&(0,Fs.debounce)(o[14]).apply(this,arguments)})],a=!0)},p(l,c){o=l,c&8&&(e.disabled=o[3]),c&4&&t!==(t=ia(o[2]?"system3-input-invalid":"")+" svelte-yg42fv")&&x(e,"class",t),c&2&&e.value!==o[1]&&lr(e,o[1]),c&8&&(s.disabled=o[3])},d(l){l&&(C(e),C(r),C(s)),a=!1,Ce(i)}}}function PD(o){let e;return{c(){e=P("span"),e.textContent="Relay Servers",x(e,"slot","name"),de(e,"display","inline-flex"),de(e,"align-items","center")},m(t,r){I(t,e,r)},p:J,d(t){t&&C(e)}}}function DD(o){let e,t;function r(){return o[16](o[25])}return e=new dn({}),e.$on("settings",r),{c(){H(e.$$.fragment)},m(s,n){B(e,s,n),t=!0},p(s,n){o=s},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){T(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function FD(o){let e;return{c(){e=P("span"),e.textContent="(Untitled Relay Server)",x(e,"class","faint svelte-yg42fv")},m(t,r){I(t,e,r)},p:J,d(t){t&&C(e)}}}function AD(o){let e=o[25].name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s&16&&e!==(e=r[25].name+"")&&ne(t,e)},d(r){r&&C(t)}}}function MD(o){let e;function t(n,a){return n[25].name?AD:FD}let r=t(o,-1),s=r(o);return{c(){s.c(),e=Ie()},m(n,a){s.m(n,a),I(n,e,a)},p(n,a){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&C(e),s.d(n)}}}function ED(o){let e,t;return e=new Ds({props:{slot:"name",relay:o[25],t:"name",$$slots:{default:[MD]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[15]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&16&&(n.relay=r[25]),s&268435472&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Ub(o){let e,t;return e=new Ft({props:{$$slots:{name:[ED],default:[DD]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&268435472&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function RD(o){let e,t,r;return{c(){e=P("button"),e.textContent="Create",x(e,"class","mod-cta")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Fs.debounce)(o[17])),t=!0)},p:J,d(s){s&&C(e),t=!1,r()}}}function $b(o){let e,t;return e=new Be({props:{description:"Go to a Relay Server's settings page above to share existing folders, or add Shared Folders to your vault."}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function OD(o){let e,t,r;function s(){return o[20](o[22])}return e=new dn({}),e.$on("settings",function(){ht((0,Fs.debounce)(s))&&(0,Fs.debounce)(s).apply(this,arguments)}),{c(){H(e.$$.fragment),t=U()},m(n,a){B(e,n,a),I(n,t,a),r=!0},p(n,a){o=n},i(n){r||(S(e.$$.fragment,n),r=!0)},o(n){T(e.$$.fragment,n),r=!1},d(n){n&&C(t),N(e,n)}}}function UD(o){var r;let e,t;return e=new Eb({props:{folder:o[22],relay:(r=o[22].remote)==null?void 0:r.relay,slot:"name"}}),e.$on("manageRelay",o[18]),e.$on("manageSharedFolder",o[19]),{c(){H(e.$$.fragment)},m(s,n){B(e,s,n),t=!0},p(s,n){var i;let a={};n&32&&(a.folder=s[22]),n&32&&(a.relay=(i=s[22].remote)==null?void 0:i.relay),e.$set(a)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){T(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function Bb(o){let e,t;return e=new Ft({props:{$$slots:{name:[UD],default:[OD]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&268435504&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function $D(o){let e,t,r,s,n,a,i,l,c,u,d,m=o[5].items().length===0,g,h,_;e=new Ge({props:{name:"Join a Relay Server"}}),r=new Be({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[TD]},$$scope:{ctx:o}}}),n=new Ge({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[PD]},$$scope:{ctx:o}}});let w=Ae(o[4].values().sort(Nb)),v=[];for(let D=0;D<w.length;D+=1)v[D]=Ub(Ob(o,w,D));let A=D=>T(v[D],1,1,()=>{v[D]=null});l=new Be({props:{name:"",description:"",$$slots:{default:[RD]},$$scope:{ctx:o}}}),u=new Ge({props:{name:"Shared Folders",helpText:"Shared Folders enhance local folders by tracking edits. You can see what Relay Server a Shared Folder is connected to below."}});let O=m&&$b(o),M=Ae(o[5].items()),E=[];for(let D=0;D<M.length;D+=1)E[D]=Bb(Rb(o,M,D));let R=D=>T(E[D],1,1,()=>{E[D]=null});return{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment),s=U(),H(n.$$.fragment),a=U();for(let D=0;D<v.length;D+=1)v[D].c();i=U(),H(l.$$.fragment),c=U(),H(u.$$.fragment),d=U(),O&&O.c(),g=U();for(let D=0;D<E.length;D+=1)E[D].c();h=Ie()},m(D,F){B(e,D,F),I(D,t,F),B(r,D,F),I(D,s,F),B(n,D,F),I(D,a,F);for(let V=0;V<v.length;V+=1)v[V]&&v[V].m(D,F);I(D,i,F),B(l,D,F),I(D,c,F),B(u,D,F),I(D,d,F),O&&O.m(D,F),I(D,g,F);for(let V=0;V<E.length;V+=1)E[V]&&E[V].m(D,F);I(D,h,F),_=!0},p(D,[F]){let V={};F&268435470&&(V.$$scope={dirty:F,ctx:D}),r.$set(V);let q={};if(F&268435456&&(q.$$scope={dirty:F,ctx:D}),n.$set(q),F&144){w=Ae(D[4].values().sort(Nb));let z;for(z=0;z<w.length;z+=1){let Y=Ob(D,w,z);v[z]?(v[z].p(Y,F),S(v[z],1)):(v[z]=Ub(Y),v[z].c(),S(v[z],1),v[z].m(i.parentNode,i))}for(pe(),z=w.length;z<v.length;z+=1)A(z);me()}let j={};if(F&268435456&&(j.$$scope={dirty:F,ctx:D}),l.$set(j),F&32&&(m=D[5].items().length===0),m?O?F&32&&S(O,1):(O=$b(D),O.c(),S(O,1),O.m(g.parentNode,g)):O&&(pe(),T(O,1,1,()=>{O=null}),me()),F&304){M=Ae(D[5].items());let z;for(z=0;z<M.length;z+=1){let Y=Rb(D,M,z);E[z]?(E[z].p(Y,F),S(E[z],1)):(E[z]=Bb(Y),E[z].c(),S(E[z],1),E[z].m(h.parentNode,h))}for(pe(),z=M.length;z<E.length;z+=1)R(z);me()}},i(D){if(!_){S(e.$$.fragment,D),S(r.$$.fragment,D),S(n.$$.fragment,D);for(let F=0;F<w.length;F+=1)S(v[F]);S(l.$$.fragment,D),S(u.$$.fragment,D),S(O);for(let F=0;F<M.length;F+=1)S(E[F]);_=!0}},o(D){T(e.$$.fragment,D),T(r.$$.fragment,D),T(n.$$.fragment,D),v=v.filter(Boolean);for(let F=0;F<v.length;F+=1)T(v[F]);T(l.$$.fragment,D),T(u.$$.fragment,D),T(O),E=E.filter(Boolean);for(let F=0;F<E.length;F+=1)T(E[F]);_=!1},d(D){D&&(C(t),C(s),C(a),C(i),C(c),C(d),C(g),C(h)),N(e,D),N(r,D),N(n,D),nt(v,D),N(l,D),N(u,D),O&&O.d(D),nt(E,D)}}}function Nb(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function BD(o,e,t){let r,s=J,n=()=>(s(),s=ir(l,j=>t(4,r=j)),l),a;o.$$.on_destroy.push(()=>s());let{plugin:i}=e,{relays:l}=e;n();let c=i.sharedFolders;ge(o,c,j=>t(5,a=j));let u="",d=!1,m=!1,g=Gt();function h(j){j&&g("manageRelay",{relay:j})}function _(j,z){j&&g("manageSharedFolder",{folder:j,relay:z})}function w(){t(2,d=!1)}function v(j){return Ke(this,void 0,void 0,function*(){try{t(3,m=!0);let z=yield i.relayManager.acceptInvitation(j).catch(Y=>{throw Y.status===429&&new Fs.Notice("Slow down"),Y});t(3,m=!1),g("joinRelay",{relay:z})}catch(z){t(2,d=!0),t(3,m=!1)}})}function A(){g("createRelay")}function O(){u=this.value,t(1,u)}let M=()=>v(u);function E(j){ro.call(this,o,j)}let R=j=>{h(j)},D=()=>A();function F(j){ro.call(this,o,j)}function V(j){ro.call(this,o,j)}let q=j=>{let z=r.values().find(Y=>{var he;return((he=j.remote)==null?void 0:he.relay.guid)===Y.guid});_(j,z)};return o.$$set=j=>{"plugin"in j&&t(12,i=j.plugin),"relays"in j&&n(t(0,l=j.relays))},[l,u,d,m,r,a,c,h,_,w,v,A,i,O,M,E,R,D,F,V,q]}var rm=class extends ee{constructor(e){super(),re(this,e,BD,$D,Z,{plugin:12,relays:0},LD)}},ko=rm;var Ze=require("obsidian");var mv=qs(Ba());function ND(o){De(o,"svelte-15ov1wm",".lock-icon.svelte-15ov1wm{width:16px;height:16px;opacity:0.5;display:flex;align-items:center;justify-content:center}")}function HD(o){let e,t,r;return t=new $d({props:{class:"svg-icon"}}),{c(){e=P("span"),H(t.$$.fragment),x(e,"class","lock-icon svelte-15ov1wm")},m(s,n){I(s,e,n),B(t,e,null),r=!0},p:J,i(s){r||(S(t.$$.fragment,s),r=!0)},o(s){T(t.$$.fragment,s),r=!1},d(s){s&&C(e),N(t)}}}var om=class extends ee{constructor(e){super(),re(this,e,null,HD,Z,{},ND)}},Tc=om;function VD(o){let e,t,r,s,n,a,i,l,c;s=new Cd({props:{size:16}});let u=o[3].default,d=ye(u,o,o[4],null);return{c(){e=P("span"),t=K(o[1]),r=U(),H(s.$$.fragment),n=U(),a=P("span"),d&&d.c(),x(e,"tabindex","0"),x(e,"role","button"),de(a,"flex","1"),de(a,"min-width","0"),de(a,"text-overflow","ellipsis"),de(a,"white-space","nowrap"),de(a,"overflow","hidden")},m(m,g){I(m,e,g),k(e,t),I(m,r,g),B(s,m,g),I(m,n,g),I(m,a,g),d&&d.m(a,null),i=!0,l||(c=[te(e,"click",o[2]),te(e,"keypress",o[2])],l=!0)},p(m,g){(!i||g&2)&&ne(t,m[1]),d&&d.p&&(!i||g&16)&&be(d,u,m,m[4],i?xe(u,m[4],g,null):ve(m[4]),null)},i(m){i||(S(s.$$.fragment,m),S(d,m),i=!0)},o(m){T(s.$$.fragment,m),T(d,m),i=!1},d(m){m&&(C(e),C(r),C(n),C(a)),N(s,m),d&&d.d(m),l=!1,Ce(c)}}}function qD(o){let e,t,r;var s=o[0];function n(a,i){return{props:{$$slots:{default:[VD]},$$scope:{ctx:a}}}}return s&&(t=ca(s,n(o))),{c(){e=P("h4"),t&&H(t.$$.fragment)},m(a,i){I(a,e,i),t&&B(t,e,null),r=!0},p(a,[i]){if(i&1&&s!==(s=a[0])){if(t){pe();let l=t;T(l.$$.fragment,1,0,()=>{N(l,1)}),me()}s?(t=ca(s,n(a,i)),H(t.$$.fragment),S(t.$$.fragment,1),B(t,e,null)):t=null}else if(s){let l={};i&18&&(l.$$scope={dirty:i,ctx:a}),t.$set(l)}},i(a){r||(t&&S(t.$$.fragment,a),r=!0)},o(a){t&&T(t.$$.fragment,a),r=!1},d(a){a&&C(e),t&&N(t)}}}function WD(o,e,t){let{$$slots:r={},$$scope:s}=e,{category:n}=e,{categoryText:a}=e,i=Gt();function l(){i("goBack")}return o.$$set=c=>{"category"in c&&t(0,n=c.category),"categoryText"in c&&t(1,a=c.categoryText),"$$scope"in c&&t(4,s=c.$$scope)},[n,a,l,r,s]}var sm=class extends ee{constructor(e){super(),re(this,e,WD,qD,Z,{category:0,categoryText:1})}},Pc=sm;function zD(o){De(o,"svelte-1ezpbya",'.system3-disk-usage-container.svelte-1ezpbya{width:100%;background-color:var(--interactive-normal);overflow:hidden}.system3-disk-usage-bar.svelte-1ezpbya{height:0.5rem;background-color:var(--color-accent);transition:width 0.6s ease}.system3-disk-usage-report.svelte-1ezpbya{text-align:center}.system3-disk-usage-bar[data-state="warning"].svelte-1ezpbya{height:0.3rem;background-color:var(--red);transition:width 0.6s ease}')}function KD(o){let e,t,r,s,n,a;return{c(){e=P("div"),t=P("div"),s=U(),n=P("div"),a=K(o[1]),x(t,"class","system3-disk-usage-bar svelte-1ezpbya"),de(t,"width",o[0]+"%"),x(t,"data-state",r=o[0]>90?"warning":""),x(e,"class","system3-disk-usage-container svelte-1ezpbya"),x(n,"class","system3-disk-usage-report svelte-1ezpbya")},m(i,l){I(i,e,l),k(e,t),I(i,s,l),I(i,n,l),k(n,a)},p(i,[l]){l&1&&de(t,"width",i[0]+"%"),l&1&&r!==(r=i[0]>90?"warning":"")&&x(t,"data-state",r),l&2&&ne(a,i[1])},i:J,o:J,d(i){i&&(C(e),C(s),C(n))}}}function GD(o,e,t){let{diskUsagePercentage:r=0}=e,{text:s=""}=e;return r=Math.max(0,r),r=Math.min(100,r),o.$$set=n=>{"diskUsagePercentage"in n&&t(0,r=n.diskUsagePercentage),"text"in n&&t(1,s=n.text)},[r,s]}var nm=class extends ee{constructor(e){super(),re(this,e,GD,KD,Z,{diskUsagePercentage:0,text:1},zD)}},Hb=nm;var Fc=require("obsidian");function jD(o){let e,t,r=o[0].shared&&Vb(o);return{c(){e=P("div"),r&&r.c(),x(e,"class","suggestion-icon")},m(s,n){I(s,e,n),r&&r.m(e,null),t=!0},p(s,n){s[0].shared?r?n&1&&S(r,1):(r=Vb(s),r.c(),S(r,1),r.m(e,null)):r&&(pe(),T(r,1,1,()=>{r=null}),me())},i(s){t||(S(r),t=!0)},o(s){T(r),t=!1},d(s){s&&C(e),r&&r.d()}}}function YD(o){let e;return{c(){e=P("span"),e.textContent="Enter to create",x(e,"class","suggestion-action")},m(t,r){I(t,e,r)},p:J,i:J,o:J,d(t){t&&C(e)}}}function Vb(o){let e,t;return e=new Xo({props:{class:"svg-icon"}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function JD(o){let e,t,r=o[0].folder+"",s,n,a,i,l,c,u=[YD,jD],d=[];function m(g,h){return g[0].exists?1:0}return i=m(o,-1),l=d[i]=u[i](o),{c(){e=P("div"),t=P("div"),s=K(r),n=U(),a=P("div"),l.c(),x(t,"class","suggestion-title"),x(e,"class","suggestion-content"),x(a,"class","suggestion-aux")},m(g,h){I(g,e,h),k(e,t),k(t,s),I(g,n,h),I(g,a,h),d[i].m(a,null),c=!0},p(g,[h]){(!c||h&1)&&r!==(r=g[0].folder+"")&&ne(s,r);let _=i;i=m(g,h),i===_?d[i].p(g,h):(pe(),T(d[_],1,1,()=>{d[_]=null}),me(),l=d[i],l?l.p(g,h):(l=d[i]=u[i](g),l.c()),S(l,1),l.m(a,null))},i(g){c||(S(l),c=!0)},o(g){T(l),c=!1},d(g){g&&(C(e),C(n),C(a)),d[i].d()}}}function QD(o,e,t){let{suggestion:r}=e;return o.$$set=s=>{"suggestion"in s&&t(0,r=s.suggestion)},[r]}var am=class extends ee{constructor(e){super(),re(this,e,QD,JD,Z,{suggestion:0})}},qb=am;var Dc=class extends Fc.SuggestModal{constructor(t,r,s){super(t);this.sharedFolders=r;this.onChoose=s;this.components=[];this.sharedPaths=new Set(this.sharedFolders.map(n=>n.path)),this.hasRemotes=new Set(this.sharedFolders.filter(n=>n.remote!==void 0).map(n=>n.path)),this.setInstructions([{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}])}sortFn(t,r){return t.exists&&!r.exists?1:!t.exists&&r.exists||t.shared&&!r.shared?-1:r.shared&&!t.shared?1:t.folder.localeCompare(r.folder)}onClose(){super.onClose(),this.components.forEach(t=>{t.$destroy()})}getSuggestions(t){this.components.forEach(i=>{i.$destroy()});let r=t.toLowerCase(),s=[],n=this.app.vault.getAbstractFileByPath(t)!==null;t.length>0&&!n&&s.push({folder:t,exists:!1,shared:!1});let a=i=>{let l=this.sharedPaths.has(i.path),c=this.hasRemotes.has(i.path);if(i.path.toLowerCase().contains(r)&&i.path.length>1&&!c&&s.push({folder:i.path,exists:!0,shared:l}),!l)for(let u of i.children)u instanceof Fc.TFolder&&a(u)};return a(this.app.vault.getRoot()),s.sort(this.sortFn)}renderSuggestion(t,r){r.addClass("mod-complex");let s=new qb({target:r,props:{suggestion:t}});this.components.push(s)}onChooseSuggestion(t,r){this.onChoose(t.folder)}};var Yb=require("obsidian");var lm=require("obsidian");var Wb=require("obsidian"),zb=require("obsidian"),Ac=class extends zb.AbstractInputSuggest{constructor(t,r,s){super(t,s);this.app=t;this.sharedFolders=r;this.inputEl=s;this.sharedPaths=new Set(this.sharedFolders.map(n=>n.path))}getSuggestions(t){let r=t.toLowerCase(),s=[],n=a=>{if(!this.sharedPaths.has(a.path)){a.path.toLowerCase().contains(r)&&s.push(a.path);for(let l of a.children)l instanceof Wb.TFolder&&n(l)}};return n(this.app.vault.getRoot()),s}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};function XD(o){let e,t,r,s;return{c(){e=P("div"),t=P("input"),x(t,"type","text"),x(t,"placeholder","/"),x(e,"class","folder-suggest-container")},m(n,a){I(n,e,a),k(e,t),o[5](t),lr(t,o[2]),r||(s=[te(t,"input",ZD),te(t,"input",o[6])],r=!0)},p(n,[a]){a&4&&t.value!==n[2]&&lr(t,n[2])},i:J,o:J,d(n){n&&C(e),o[5](null),r=!1,Ce(s)}}}function ZD(){}function eF(o,e,t){let r,s=J,n=()=>(s(),s=ir(u,g=>t(2,r=g)),u);o.$$.on_destroy.push(()=>s());let{app:a}=e,i,l,{sharedFolders:c}=e,{selectedFolder:u=_e()}=e;n(),cr(()=>{l=new Ac(a,c,i);let g=h=>{n(t(0,u=h.detail.folder.path))};return i.addEventListener("folder-selected",g),()=>{i.removeEventListener("folder-selected",g)}}),ud(()=>{l&&l.close()});function d(g){Hr[g?"unshift":"push"](()=>{i=g,t(1,i)})}function m(){r=this.value,u.set(r)}return o.$$set=g=>{"app"in g&&t(3,a=g.app),"sharedFolders"in g&&t(4,c=g.sharedFolders),"selectedFolder"in g&&n(t(0,u=g.selectedFolder))},[u,i,r,a,c,d,m]}var im=class extends ee{constructor(e){super(),re(this,e,eF,XD,Z,{app:3,sharedFolders:4,selectedFolder:0})}},Kb=im;function tF(o){De(o,"svelte-hgd3zf","span.error.svelte-hgd3zf{flex:auto;align-content:center}")}function rF(o){let e,t,r;return{c(){e=P("input"),x(e,"type","text")},m(s,n){I(s,e,n),lr(e,o[4]),t||(r=te(e,"input",o[8]),t=!0)},p(s,n){n&16&&e.value!==s[4]&&lr(e,s[4])},d(s){s&&C(e),t=!1,r()}}}function oF(o){let e,t;return e=new Kb({props:{app:o[0],sharedFolders:o[2],selectedFolder:o[7]}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.app=r[0]),s&4&&(n.sharedFolders=r[2]),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Gb(o){let e,t;return{c(){e=P("span"),t=K(o[5]),x(e,"class","mod-warning error svelte-hgd3zf")},m(r,s){I(r,e,s),k(e,t)},p(r,s){s&32&&ne(t,r[5])},d(r){r&&C(e)}}}function sF(o){let e,t,r,s,n,a,i,l,c,u,d,m,g;s=new Be({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[rF]},$$scope:{ctx:o}}}),a=new Be({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[oF]},$$scope:{ctx:o}}});let h=o[5]&&Gb(o);return{c(){e=P("div"),e.textContent="Add to vault",t=U(),r=P("div"),H(s.$$.fragment),n=U(),H(a.$$.fragment),i=U(),l=P("div"),h&&h.c(),c=U(),u=P("button"),u.textContent="Confirm",x(e,"class","modal-title"),x(u,"class","mod-cta"),x(l,"class","modal-button-container"),x(r,"class","modal-content")},m(_,w){I(_,e,w),I(_,t,w),I(_,r,w),B(s,r,null),k(r,n),B(a,r,null),k(r,i),k(r,l),h&&h.m(l,null),k(l,c),k(l,u),d=!0,m||(g=te(u,"click",function(){ht((0,lm.debounce)(o[9]))&&(0,lm.debounce)(o[9]).apply(this,arguments)}),m=!0)},p(_,[w]){o=_;let v={};w&1040&&(v.$$scope={dirty:w,ctx:o}),s.$set(v);let A={};w&1029&&(A.$$scope={dirty:w,ctx:o}),a.$set(A),o[5]?h?h.p(o,w):(h=Gb(o),h.c(),h.m(l,c)):h&&(h.d(1),h=null)},i(_){d||(S(s.$$.fragment,_),S(a.$$.fragment,_),d=!0)},o(_){T(s.$$.fragment,_),T(a.$$.fragment,_),d=!1},d(_){_&&(C(e),C(t),C(r)),N(s),N(a),h&&h.d(),m=!1,g()}}}function nF(o,e,t){let r,{app:s}=e,{remoteFolder:n}=e,{sharedFolders:a}=e,{onConfirm:i}=e,l=n.name,c=_e();ge(o,c,g=>t(6,r=g));let u="";function d(){l=this.value,t(4,l)}let m=async()=>{i(n,l,r||"").catch(g=>{t(5,u=g.message)})};return o.$$set=g=>{"app"in g&&t(0,s=g.app),"remoteFolder"in g&&t(1,n=g.remoteFolder),"sharedFolders"in g&&t(2,a=g.sharedFolders),"onConfirm"in g&&t(3,i=g.onConfirm)},[s,n,a,i,l,u,r,c,d,m]}var cm=class extends ee{constructor(e){super(),re(this,e,nF,sF,Z,{app:0,remoteFolder:1,sharedFolders:2,onConfirm:3},tF)}},jb=cm;var Mc=class extends Yb.Modal{constructor(t,r,s,n){super(t);this.sharedFolders=r;this.remoteFolder=s;this.onConfirm=n;this.onConfirm=n}onOpen(){let{contentEl:t}=this;this.component=new jb({target:t,props:{remoteFolder:this.remoteFolder,sharedFolders:this.sharedFolders,onConfirm:async(r,s,n)=>{await this.onConfirm(r,s,n),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var um=qs(Jb());function aF(o){let e=[],t="",r=0;for(;r<o.length;)o[r]==="*"&&r+1<o.length&&o[r+1]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"DOUBLE_STAR"}),r+=2):o[r]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"STAR"}),r++):(t+=o[r],r++);return t&&e.push({type:"TEXT",value:t}),e}function iF(o){let e="",t="NORMAL",r=0;for(;r<o.length;){let s=o[r];switch(t){case"NORMAL":s.type==="TEXT"?e+=s.value:s.type==="STAR"?(t="EMPHASIS",e+="<u>"):s.type==="DOUBLE_STAR"&&(t="BOLD",e+="<strong>");break;case"EMPHASIS":s.type==="TEXT"?e+=s.value:s.type==="STAR"?(t="NORMAL",e+="</u>"):s.type==="DOUBLE_STAR"&&(t="BOLD",e+="</u><strong>");break;case"BOLD":s.type==="TEXT"?e+=s.value:s.type==="STAR"?e+="*":s.type==="DOUBLE_STAR"&&(t="NORMAL",e+="</strong>");break}r++}return t==="EMPHASIS"?e+="</u>":t==="BOLD"&&(e+="</strong>"),e}function As(o){let e=aF(o);return iF(e)}function lF(o){De(o,"svelte-8ji5zx",".faint.svelte-8ji5zx.svelte-8ji5zx{color:var(--text-faint)}.share-key-container.svelte-8ji5zx.svelte-8ji5zx{width:100%}.input-with-icon.svelte-8ji5zx.svelte-8ji5zx{position:relative;width:100%}.share-key-toggle-icon.svelte-8ji5zx.svelte-8ji5zx{position:relative}.share-key-toggle-icon.svelte-8ji5zx.svelte-8ji5zx{display:flex;align-items:center;justify-content:center;cursor:pointer;width:24px;height:24px;position:absolute;right:4px;top:50%;transform:translateY(-50%);border-radius:4px}.share-key-toggle-icon.svelte-8ji5zx.svelte-8ji5zx:hover{background-color:var(--background-modifier-hover)}.share-key-disabled-notice.svelte-8ji5zx.svelte-8ji5zx{color:var(--text-error) !important;font-size:0.85em !important}.input-with-icon.svelte-8ji5zx>input.svelte-8ji5zx{padding-right:28px}.system3-invite.svelte-8ji5zx.svelte-8ji5zx{padding:4px 28px 4px 8px !important;padding-inline:2px;font-family:monospace}.relay-host-check.svelte-8ji5zx.svelte-8ji5zx{text-align:right}")}function Qb(o,e,t){let r=o.slice();return r[70]=e[t],r}function Xb(o,e,t){let r=o.slice();return r[73]=e[t],r}function cF(o){let e;return{c(){e=P("span"),e.textContent="(Untitled Relay Server)",x(e,"class","faint svelte-8ji5zx")},m(t,r){I(t,e,r)},p:J,d(t){t&&C(e)}}}function fF(o){let e=o[0].name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&1&&e!==(e=r[0].name+"")&&ne(t,e)},d(r){r&&C(t)}}}function uF(o){let e;function t(n,a){return n[0].name?fF:cF}let r=t(o,[-1,-1,-1]),s=r(o);return{c(){s.c(),e=Ie()},m(n,a){s.m(n,a),I(n,e,a)},p(n,a){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&C(e),s.d(n)}}}function Zb(o){let e,t;return e=new Be({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[dF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&1065|s[2]&16384&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function dF(o){let e,t,r,s;return{c(){e=P("input"),x(e,"type","text"),x(e,"spellcheck","false"),x(e,"placeholder","Example: Shared Notes"),x(e,"class",t=ia((o[10]?"system3-updating":"")+(o[5]?"":" system3-input-invalid"))+" svelte-8ji5zx")},m(n,a){I(n,e,a),lr(e,o[0].name),o[46](e),r||(s=[te(e,"input",o[45]),te(e,"input",o[37])],r=!0)},p(n,a){a[0]&1056&&t!==(t=ia((n[10]?"system3-updating":"")+(n[5]?"":" system3-input-invalid"))+" svelte-8ji5zx")&&x(e,"class",t),a[0]&1&&e.value!==n[0].name&&lr(e,n[0].name)},d(n){n&&C(e),o[46](null),r=!1,Ce(s)}}}function pF(o){let e,t;return e=new Ft({props:{$$slots:{name:[yF],default:[hF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&2048|s[2]&16384&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function mF(o){let e,t;return e=new Ft({props:{$$slots:{name:[vF],default:[xF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&6144|s[2]&16384&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function hF(o){let e,t,r;function s(){return o[50](o[73])}return{c(){e=P("button"),e.textContent="Add to Vault",x(e,"class","mod-cta"),x(e,"aria-label","Add shared folder to vault"),de(e,"max-width","8em")},m(n,a){I(n,e,a),t||(r=te(e,"click",function(){ht((0,Ze.debounce)(s))&&(0,Ze.debounce)(s).apply(this,arguments)}),t=!0)},p(n,a){o=n},d(n){n&&C(e),t=!1,r()}}}function gF(o){let e=o[73].name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&2048&&e!==(e=r[73].name+"")&&ne(t,e)},d(r){r&&C(t)}}}function yF(o){let e,t;return e=new So({props:{slot:"name",$$slots:{default:[gF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&2048|s[2]&16384&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function xF(o){let e,t;function r(){return o[49](o[73])}return e=new dn({}),e.$on("settings",function(){ht((0,Ze.debounce)(r))&&(0,Ze.debounce)(r).apply(this,arguments)}),{c(){H(e.$$.fragment)},m(s,n){B(e,s,n),t=!0},p(s,n){o=s},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){T(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function bF(o){let e=o[73].name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&2048&&e!==(e=r[73].name+"")&&ne(t,e)},d(r){r&&C(t)}}}function vF(o){let e,t;function r(...s){return o[47](o[73],...s)}return e=new So({props:{folder:o[12].find(r),slot:"name",$$slots:{default:[bF]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[48]),{c(){H(e.$$.fragment)},m(s,n){B(e,s,n),t=!0},p(s,n){o=s;let a={};n[0]&6144&&(a.folder=o[12].find(r)),n[0]&2048|n[2]&16384&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(s){t||(S(e.$$.fragment,s),t=!0)},o(s){T(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function ev(o){let e,t,r,s,n;function a(...u){return o[44](o[73],...u)}let i=[mF,pF],l=[];function c(u,d){return d[0]&6144&&(e=null),e==null&&(e=!!u[12].find(a)),e?0:1}return t=c(o,[-1,-1,-1]),r=l[t]=i[t](o),{c(){r.c(),s=Ie()},m(u,d){l[t].m(u,d),I(u,s,d),n=!0},p(u,d){o=u;let m=t;t=c(o,d),t===m?l[t].p(o,d):(pe(),T(l[m],1,1,()=>{l[m]=null}),me(),r=l[t],r?r.p(o,d):(r=l[t]=i[t](o),r.c()),S(r,1),r.m(s.parentNode,s))},i(u){n||(S(r),n=!0)},o(u){T(r),n=!1},d(u){u&&C(s),l[t].d(u)}}}function wF(o){let e,t,r;return{c(){e=P("button"),e.textContent="Share a folder",x(e,"class","mod-cta"),x(e,"aria-label","Select a folder to share it with this Relay Server")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Ze.debounce)(o[51])),t=!0)},p:J,d(s){s&&C(e),t=!1,r()}}}function _F(o){let e=o[13].values().length+"",t,r,s=o[8].userLimit+"",n;return{c(){t=K(e),r=K(" / "),n=K(s)},m(a,i){I(a,t,i),I(a,r,i),I(a,n,i)},p(a,i){i[0]&8192&&e!==(e=a[13].values().length+"")&&ne(t,e),i[0]&256&&s!==(s=a[8].userLimit+"")&&ne(n,s)},d(a){a&&(C(t),C(r),C(n))}}}function tv(o){let e,t,r;function s(){return o[52](o[70])}return{c(){e=P("button"),e.textContent="Kick",x(e,"class","mod-destructive")},m(n,a){I(n,e,a),t||(r=te(e,"click",function(){ht((0,Ze.debounce)(s))&&(0,Ze.debounce)(s).apply(this,arguments)}),t=!0)},p(n,a){o=n},d(n){n&&C(e),t=!1,r()}}}function SF(o){let e,t=o[70].role==="Member"&&o[8].owner&&tv(o);return{c(){t&&t.c(),e=U()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[70].role==="Member"&&r[8].owner?t?t.p(r,s):(t=tv(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function rv(o){let e,t;return e=new Ic({props:{user:o[70].user,$$slots:{default:[SF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&8192&&(n.user=r[70].user),s[0]&8448|s[2]&16384&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function ov(o){let e,t;return e=new Tc({}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function kF(o){let e,t,r,s,n,a,i,l,c,u,d,m=!o[0].owner&&ov(o);return{c(){e=P("div"),m&&m.c(),t=U(),r=P("div"),s=P("input"),a=U(),i=P("div"),x(s,"type","checkbox"),s.checked=o[7],s.disabled=n=!o[0].owner,x(i,"class","checkbox-toggle"),x(r,"role","checkbox"),x(r,"aria-checked",o[7]),x(r,"tabindex","0"),x(r,"class",l=o[0].owner?"checkbox-container":"checkbox-container checkbox-locked"),Ne(r,"is-enabled",o[7]),x(e,"class","setting-item-control")},m(g,h){I(g,e,h),m&&m.m(e,null),k(e,t),k(e,r),k(r,s),k(r,a),k(r,i),c=!0,u||(d=[te(s,"change",o[53]),te(r,"keypress",o[54]),te(r,"click",o[55])],u=!0)},p(g,h){g[0].owner?m&&(pe(),T(m,1,1,()=>{m=null}),me()):m?h[0]&1&&S(m,1):(m=ov(g),m.c(),S(m,1),m.m(e,t)),(!c||h[0]&128)&&(s.checked=g[7]),(!c||h[0]&1&&n!==(n=!g[0].owner))&&(s.disabled=n),(!c||h[0]&128)&&x(r,"aria-checked",g[7]),(!c||h[0]&1&&l!==(l=g[0].owner?"checkbox-container":"checkbox-container checkbox-locked"))&&x(r,"class",l),(!c||h[0]&129)&&Ne(r,"is-enabled",g[7])},i(g){c||(S(m),c=!0)},o(g){T(m),c=!1},d(g){g&&C(e),m&&m.d(),u=!1,Ce(d)}}}function CF(o){let e;return{c(){e=P("div"),e.textContent="The owner of this Relay Server has disabled key sharing.",x(e,"class","setting-item-description mod-warning")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function IF(o){let e;return{c(){e=P("div"),e.textContent="The owner of this Relay Server has enabled key sharing.",x(e,"class","setting-item-description")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function LF(o){let e;return{c(){e=P("div"),e.textContent="Allow others to join this Relay Server with a Share Key.",x(e,"class","setting-item-description")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function TF(o){let e;function t(n,a){return n[0].owner?LF:n[7]?IF:CF}let r=t(o,[-1,-1,-1]),s=r(o);return{c(){e=P("fragment"),s.c(),x(e,"slot","description")},m(n,a){I(n,e,a),s.m(e,null)},p(n,a){r!==(r=t(n,a))&&(s.d(1),s=r(n),s&&(s.c(),s.m(e,null)))},d(n){n&&C(e),s.d()}}}function sv(o){let e,t,r,s;e=new Be({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[MF]},$$scope:{ctx:o}}});let n=o[0].owner&&nv(o);return{c(){H(e.$$.fragment),t=U(),n&&n.c(),r=Ie()},m(a,i){B(e,a,i),I(a,t,i),n&&n.m(a,i),I(a,r,i),s=!0},p(a,i){let l={};i[0]&208|i[2]&16384&&(l.$$scope={dirty:i,ctx:a}),e.$set(l),a[0].owner?n?(n.p(a,i),i[0]&1&&S(n,1)):(n=nv(a),n.c(),S(n,1),n.m(r.parentNode,r)):n&&(pe(),T(n,1,1,()=>{n=null}),me())},i(a){s||(S(e.$$.fragment,a),S(n),s=!0)},o(a){T(e.$$.fragment,a),T(n),s=!1},d(a){a&&(C(t),C(r)),N(e,a),n&&n.d(a)}}}function PF(o){let e,t,r,s,n,a,i;function l(d,m){return d[6]&&d[4]?AF:FF}let c=l(o,[-1,-1,-1]),u=c(o);return{c(){e=P("div"),u.c(),t=U(),r=P("div"),x(r,"class","share-key-toggle-icon svelte-8ji5zx"),x(r,"role","button"),x(r,"tabindex","0"),x(r,"aria-label",s=o[6]?"Hide share key":"Show share key"),x(e,"class","input-with-icon svelte-8ji5zx")},m(d,m){I(d,e,m),u.m(e,null),k(e,t),k(e,r),a||(i=[tc(n=o[33].call(null,r)),te(r,"click",o[56]),te(r,"keypress",o[57])],a=!0)},p(d,m){c===(c=l(d,m))&&u?u.p(d,m):(u.d(1),u=c(d),u&&(u.c(),u.m(e,t))),m[0]&64&&s!==(s=d[6]?"Hide share key":"Show share key")&&x(r,"aria-label",s)},d(d){d&&C(e),u.d(),a=!1,Ce(i)}}}function DF(o){let e;return{c(){e=P("span"),e.textContent="Share key is currently disabled",x(e,"role","button"),x(e,"tabindex","0"),x(e,"class","input-like share-key-disabled-notice svelte-8ji5zx")},m(t,r){I(t,e,r)},p:J,d(t){t&&C(e)}}}function FF(o){let e,t,r,s,n;return{c(){e=P("input"),e.value=t=o[4]?o[4].key:"please wait...",x(e,"type","password"),e.readOnly=!0,x(e,"class","system3-invite svelte-8ji5zx"),e.disabled=r=!o[7]},m(a,i){I(a,e,i),s||(n=te(e,"click",(0,Ze.debounce)(o[41])),s=!0)},p(a,i){i[0]&16&&t!==(t=a[4]?a[4].key:"please wait...")&&e.value!==t&&(e.value=t),i[0]&128&&r!==(r=!a[7])&&(e.disabled=r)},d(a){a&&C(e),s=!1,n()}}}function AF(o){let e,t,r,s,n;return{c(){e=P("input"),e.value=t=o[4].key,x(e,"type","text"),e.readOnly=!0,x(e,"class","system3-invite svelte-8ji5zx"),e.disabled=r=!o[7]},m(a,i){I(a,e,i),s||(n=te(e,"click",(0,Ze.debounce)(o[41])),s=!0)},p(a,i){i[0]&16&&t!==(t=a[4].key)&&e.value!==t&&(e.value=t),i[0]&128&&r!==(r=!a[7])&&(e.disabled=r)},d(a){a&&C(e),s=!1,n()}}}function MF(o){let e;function t(n,a){return n[7]?PF:DF}let r=t(o,[-1,-1,-1]),s=r(o);return{c(){e=P("div"),s.c(),x(e,"class","share-key-container svelte-8ji5zx")},m(n,a){I(n,e,a),s.m(e,null)},p(n,a){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e,null)))},d(n){n&&C(e),s.d()}}}function nv(o){let e,t;return e=new Be({props:{name:"Rotate key",description:"Create a new share key. The old key will no longer work.",$$slots:{default:[EF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[2]&16384&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function EF(o){let e,t,r;return{c(){e=P("button"),e.textContent="Rotate key",x(e,"class","mod-destructive")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Ze.debounce)(o[34])),t=!0)},p:J,d(s){s&&C(e),t=!1,r()}}}function RF(o){let e,t,r,s;return e=new Ge({props:{name:"Membership"}}),r=new Be({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[UF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment)},m(n,a){B(e,n,a),I(n,t,a),B(r,n,a),s=!0},p(n,a){let i={};a[2]&16384&&(i.$$scope={dirty:a,ctx:n}),r.$set(i)},i(n){s||(S(e.$$.fragment,n),S(r.$$.fragment,n),s=!0)},o(n){T(e.$$.fragment,n),T(r.$$.fragment,n),s=!1},d(n){n&&C(t),N(e,n),N(r,n)}}}function OF(o){let e,t,r,s,n,a,i,l,c,u,d;e=new Ge({props:{name:"Plan"}});let m=[BF,$F],g=[];function h(v,A){return v[14]?0:1}r=h(o,[-1,-1,-1]),s=g[r]=m[r](o);let _=o[15]&&o[15].quota>0&&lv(o),w=o[0].provider&&cv(o);return l=new Ge({props:{name:"Danger zone"}}),u=new Be({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[oA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment),t=U(),s.c(),n=U(),_&&_.c(),a=U(),w&&w.c(),i=U(),H(l.$$.fragment),c=U(),H(u.$$.fragment)},m(v,A){B(e,v,A),I(v,t,A),g[r].m(v,A),I(v,n,A),_&&_.m(v,A),I(v,a,A),w&&w.m(v,A),I(v,i,A),B(l,v,A),I(v,c,A),B(u,v,A),d=!0},p(v,A){let O=r;r=h(v,A),r===O?g[r].p(v,A):(pe(),T(g[O],1,1,()=>{g[O]=null}),me(),s=g[r],s?s.p(v,A):(s=g[r]=m[r](v),s.c()),S(s,1),s.m(n.parentNode,n)),v[15]&&v[15].quota>0?_?(_.p(v,A),A[0]&32768&&S(_,1)):(_=lv(v),_.c(),S(_,1),_.m(a.parentNode,a)):_&&(pe(),T(_,1,1,()=>{_=null}),me()),v[0].provider?w?(w.p(v,A),A[0]&1&&S(w,1)):(w=cv(v),w.c(),S(w,1),w.m(i.parentNode,i)):w&&(pe(),T(w,1,1,()=>{w=null}),me());let M={};A[0]&512|A[2]&16384&&(M.$$scope={dirty:A,ctx:v}),u.$set(M)},i(v){d||(S(e.$$.fragment,v),S(s),S(_),S(w),S(l.$$.fragment,v),S(u.$$.fragment,v),d=!0)},o(v){T(e.$$.fragment,v),T(s),T(_),T(w),T(l.$$.fragment,v),T(u.$$.fragment,v),d=!1},d(v){v&&(C(t),C(n),C(a),C(i),C(c)),N(e,v),g[r].d(v),_&&_.d(v),w&&w.d(v),N(l,v),N(u,v)}}}function UF(o){let e,t,r;return{c(){e=P("button"),e.textContent="Leave",x(e,"class","mod-warning")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Ze.debounce)(o[61])),t=!0)},p:J,d(s){s&&C(e),t=!1,r()}}}function $F(o){let e,t;return e=new Be({props:{name:`Plan: ${o[8].plan}`,description:o[8].cta||"Thanks for supporting Relay development",$$slots:{default:[NF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&256&&(n.name=`Plan: ${r[8].plan}`),s[0]&256&&(n.description=r[8].cta||"Thanks for supporting Relay development"),s[0]&256|s[2]&16384&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function BF(o){let e,t,r=!o[9].values()[0].active||o[9].values()[0].cancelAt,s,n;e=new Be({props:{name:`Plan: ${o[8].plan}`,description:"",$$slots:{description:[VF],default:[HF]},$$scope:{ctx:o}}});let a=r&&iv(o);return{c(){H(e.$$.fragment),t=U(),a&&a.c(),s=Ie()},m(i,l){B(e,i,l),I(i,t,l),a&&a.m(i,l),I(i,s,l),n=!0},p(i,l){let c={};l[0]&256&&(c.name=`Plan: ${i[8].plan}`),l[0]&17152|l[2]&16384&&(c.$$scope={dirty:l,ctx:i}),e.$set(c),l[0]&512&&(r=!i[9].values()[0].active||i[9].values()[0].cancelAt),r?a?(a.p(i,l),l[0]&512&&S(a,1)):(a=iv(i),a.c(),S(a,1),a.m(s.parentNode,s)):a&&(pe(),T(a,1,1,()=>{a=null}),me())},i(i){n||(S(e.$$.fragment,i),S(a),n=!0)},o(i){T(e.$$.fragment,i),T(a),n=!1},d(i){i&&(C(t),C(s)),N(e,i),a&&a.d(i)}}}function NF(o){let e,t,r;return{c(){e=P("button"),e.textContent="Upgrade",x(e,"class","mod-cta")},m(s,n){I(s,e,n),t||(r=te(e,"click",function(){ht((0,Ze.debounce)(o[60]))&&(0,Ze.debounce)(o[60]).apply(this,arguments)}),t=!0)},p(s,n){o=s},d(s){s&&C(e),t=!1,r()}}}function av(o){let e,t,r;return{c(){e=P("button"),e.textContent="Cancel",x(e,"class","mod-destructive")},m(s,n){I(s,e,n),t||(r=te(e,"click",function(){ht((0,Ze.debounce)(o[59]))&&(0,Ze.debounce)(o[59]).apply(this,arguments)}),t=!0)},p(s,n){o=s},d(s){s&&C(e),t=!1,r()}}}function HF(o){let e,t,r=o[9].values()[0].active&&!o[9].values()[0].cancelAt,s,n,a,i=r&&av(o);return{c(){e=P("button"),e.textContent="Manage",t=U(),i&&i.c(),s=Ie()},m(l,c){I(l,e,c),I(l,t,c),i&&i.m(l,c),I(l,s,c),n||(a=te(e,"click",function(){ht((0,Ze.debounce)(o[58]))&&(0,Ze.debounce)(o[58]).apply(this,arguments)}),n=!0)},p(l,c){o=l,c[0]&512&&(r=o[9].values()[0].active&&!o[9].values()[0].cancelAt),r?i?i.p(o,c):(i=av(o),i.c(),i.m(s.parentNode,s)):i&&(i.d(1),i=null)},d(l){l&&(C(e),C(t),C(s)),i&&i.d(l),n=!1,a()}}}function VF(o){let e,t=o[8].cta+"",r;return{c(){e=P("fragment"),r=K(t),x(e,"slot","description")},m(s,n){I(s,e,n),k(e,r)},p(s,n){n[0]&256&&t!==(t=s[8].cta+"")&&ne(r,t)},d(s){s&&C(e)}}}function iv(o){let e,t;return e=new Be({props:{description:"",$$slots:{name:[WF],default:[qF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&512|s[2]&16384&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function qF(o){let e=o[18](o[9].values()[0].cancelAt)+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&512&&e!==(e=r[18](r[9].values()[0].cancelAt)+"")&&ne(t,e)},d(r){r&&C(t)}}}function WF(o){let e;return{c(){e=P("span"),e.textContent="Status: Cancelled",x(e,"slot","name"),x(e,"class","mod-warning")},m(t,r){I(t,e,r)},p:J,d(t){t&&C(e)}}}function lv(o){let e,t,r,s,n,a,i,l,c,u;return e=new Ge({props:{name:"Storage"}}),r=new Hb({props:{diskUsagePercentage:Math.round(o[15].usage*100/o[15].quota)}}),n=new Ft({props:{name:"Usage",description:"Storage for images, audio, video, etc",$$slots:{default:[zF]},$$scope:{ctx:o}}}),i=new Ft({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[KF]},$$scope:{ctx:o}}}),c=new Ft({props:{name:"File size limit",description:"Maximum supported file size.",$$slots:{default:[GF]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment),s=U(),H(n.$$.fragment),a=U(),H(i.$$.fragment),l=U(),H(c.$$.fragment)},m(d,m){B(e,d,m),I(d,t,m),B(r,d,m),I(d,s,m),B(n,d,m),I(d,a,m),B(i,d,m),I(d,l,m),B(c,d,m),u=!0},p(d,m){let g={};m[0]&32768&&(g.diskUsagePercentage=Math.round(d[15].usage*100/d[15].quota)),r.$set(g);let h={};m[0]&32768|m[2]&16384&&(h.$$scope={dirty:m,ctx:d}),n.$set(h);let _={};m[0]&32768|m[2]&16384&&(_.$$scope={dirty:m,ctx:d}),i.$set(_);let w={};m[0]&32768|m[2]&16384&&(w.$$scope={dirty:m,ctx:d}),c.$set(w)},i(d){u||(S(e.$$.fragment,d),S(r.$$.fragment,d),S(n.$$.fragment,d),S(i.$$.fragment,d),S(c.$$.fragment,d),u=!0)},o(d){T(e.$$.fragment,d),T(r.$$.fragment,d),T(n.$$.fragment,d),T(i.$$.fragment,d),T(c.$$.fragment,d),u=!1},d(d){d&&(C(t),C(s),C(a),C(l)),N(e,d),N(r,d),N(n,d),N(i,d),N(c,d)}}}function zF(o){let e=wa(o[15].usage)+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&32768&&e!==(e=wa(r[15].usage)+"")&&ne(t,e)},d(r){r&&C(t)}}}function KF(o){let e=wa(o[15].quota)+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&32768&&e!==(e=wa(r[15].quota)+"")&&ne(t,e)},d(r){r&&C(t)}}}function GF(o){let e=wa(o[15].maxFileSize)+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&32768&&e!==(e=wa(r[15].maxFileSize)+"")&&ne(t,e)},d(r){r&&C(t)}}}function cv(o){let e,t,r,s,n,a,i,l,c,u=[YF,jF],d=[];function m(h,_){return h[0].provider.selfHosted?0:1}e=m(o,[-1,-1,-1]),t=d[e]=u[e](o),s=new Be({props:{name:"Name",description:"",$$slots:{default:[JF]},$$scope:{ctx:o}}}),a=new Be({props:{name:"Domain",description:"",$$slots:{default:[QF]},$$scope:{ctx:o}}});let g=o[0].provider.selfHosted&&fv(o);return{c(){t.c(),r=U(),H(s.$$.fragment),n=U(),H(a.$$.fragment),i=U(),g&&g.c(),l=Ie()},m(h,_){d[e].m(h,_),I(h,r,_),B(s,h,_),I(h,n,_),B(a,h,_),I(h,i,_),g&&g.m(h,_),I(h,l,_),c=!0},p(h,_){let w=e;e=m(h,_),e!==w&&(pe(),T(d[w],1,1,()=>{d[w]=null}),me(),t=d[e],t||(t=d[e]=u[e](h),t.c()),S(t,1),t.m(r.parentNode,r));let v={};_[0]&1|_[2]&16384&&(v.$$scope={dirty:_,ctx:h}),s.$set(v);let A={};_[0]&1|_[2]&16384&&(A.$$scope={dirty:_,ctx:h}),a.$set(A),h[0].provider.selfHosted?g?g.p(h,_):(g=fv(h),g.c(),g.m(l.parentNode,l)):g&&(g.d(1),g=null)},i(h){c||(S(t),S(s.$$.fragment,h),S(a.$$.fragment,h),c=!0)},o(h){T(t),T(s.$$.fragment,h),T(a.$$.fragment,h),c=!1},d(h){h&&(C(r),C(n),C(i),C(l)),d[e].d(h),N(s,h),N(a,h),g&&g.d(h)}}}function jF(o){let e,t;return e=new Ge({props:{name:"Host"}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function YF(o){let e,t;return e=new Ge({props:{name:"Self hosting"}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function JF(o){let e=o[0].provider.name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&1&&e!==(e=r[0].provider.name+"")&&ne(t,e)},d(r){r&&C(t)}}}function QF(o){let e=o[0].provider.url+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&1&&e!==(e=r[0].provider.url+"")&&ne(t,e)},d(r){r&&C(t)}}}function fv(o){let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:eA,then:ZF,catch:XF,value:69};return Qo(t=o[17](o[0]),r),{c(){e=Ie(),r.block.c()},m(s,n){I(s,e,n),r.block.m(s,r.anchor=n),r.mount=()=>e.parentNode,r.anchor=e},p(s,n){o=s,r.ctx=o,n[0]&1&&t!==(t=o[17](o[0]))&&Qo(t,r)||da(r,o,n)},d(s){s&&C(e),r.block.d(s),r.token=null,r=null}}}function XF(o){return{c:J,m:J,p:J,d:J}}function ZF(o){let e,t=o[69].level==="warning"&&uv(o);return{c(){t&&t.c(),e=Ie()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[69].level==="warning"?t?t.p(r,s):(t=uv(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function uv(o){let e,t,r=As(o[69].status)+"",s,n=o[69].link&&dv(o);return{c(){e=P("p"),t=new Is(!1),s=U(),n&&n.c(),t.a=s,x(e,"class","mod-warning relay-host-check svelte-8ji5zx")},m(a,i){I(a,e,i),t.m(r,e),k(e,s),n&&n.m(e,null)},p(a,i){i[0]&1&&r!==(r=As(a[69].status)+"")&&t.p(r),a[69].link?n?n.p(a,i):(n=dv(a),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(a){a&&C(e),n&&n.d()}}}function dv(o){let e,t,r,s=As(o[69].link.text)+"",n;return{c(){e=P("br"),t=U(),r=P("a"),x(r,"href",n=o[69].link.url)},m(a,i){I(a,e,i),I(a,t,i),I(a,r,i),r.innerHTML=s},p(a,i){i[0]&1&&s!==(s=As(a[69].link.text)+"")&&(r.innerHTML=s),i[0]&1&&n!==(n=a[69].link.url)&&x(r,"href",n)},d(a){a&&(C(e),C(t),C(r))}}}function eA(o){return{c:J,m:J,p:J,d:J}}function tA(o){let e,t,r;return{c(){e=P("button"),e.textContent="Destroy",x(e,"class","mod-warning")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Ze.debounce)(o[38])),t=!0)},p:J,d(s){s&&C(e),t=!1,r()}}}function rA(o){let e,t;return{c(){e=P("button"),e.textContent="Destroy",e.disabled=t=!0,x(e,"class","mod-warning"),x(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,s){I(r,e,s)},p:J,d(r){r&&C(e)}}}function oA(o){let e,t;function r(a,i){return i[0]&512&&(e=null),e==null&&(e=a[9].values().length>0&&!a[9].values()[0].cancelAt),e?rA:tA}let s=r(o,[-1,-1,-1]),n=s(o);return{c(){n.c(),t=Ie()},m(a,i){n.m(a,i),I(a,t,i)},p(a,i){s===(s=r(a,i))&&n?n.p(a,i):(n.d(1),n=s(a),n&&(n.c(),n.m(t.parentNode,t)))},d(a){a&&C(t),n.d(a)}}}function sA(o){let e,t,r,s,n,a,i,l,c,u,d,m,g,h,_,w,v,A,O,M;e=new Pc({props:{category:Ds,categoryText:"Relay Servers",$$slots:{default:[uF]},$$scope:{ctx:o}}}),e.$on("goBack",o[29]);let E=o[0].owner&&Zb(o);s=new Ge({props:{name:"Folders on this Relay Server"}});let R=Ae(o[11].values()),D=[];for(let G=0;G<R.length;G+=1)D[G]=ev(Xb(o,R,G));let F=G=>T(D[G],1,1,()=>{D[G]=null});i=new Be({props:{description:"",name:"",$$slots:{default:[wF]},$$scope:{ctx:o}}}),c=new Ge({props:{name:"Users",$$slots:{default:[_F]},$$scope:{ctx:o}}});let V=Ae(o[13].values().sort(pv)),q=[];for(let G=0;G<V.length;G+=1)q[G]=rv(Qb(o,V,G));let j=G=>T(q[G],1,1,()=>{q[G]=null});m=new Ge({props:{name:"Sharing"}}),h=new Ft({props:{name:o[0].owner?"Enable key sharing":"Key sharing",$$slots:{description:[TF],default:[kF]},$$scope:{ctx:o}}});let z=o[7]&&sv(o),Y=[OF,RF],he=[];function Fe(G,oe){return G[8].owner?0:1}return v=Fe(o,[-1,-1,-1]),A=he[v]=Y[v](o),{c(){H(e.$$.fragment),t=U(),E&&E.c(),r=U(),H(s.$$.fragment),n=U();for(let G=0;G<D.length;G+=1)D[G].c();a=U(),H(i.$$.fragment),l=U(),H(c.$$.fragment),u=U();for(let G=0;G<q.length;G+=1)q[G].c();d=U(),H(m.$$.fragment),g=U(),H(h.$$.fragment),_=U(),z&&z.c(),w=U(),A.c(),O=Ie()},m(G,oe){B(e,G,oe),I(G,t,oe),E&&E.m(G,oe),I(G,r,oe),B(s,G,oe),I(G,n,oe);for(let Se=0;Se<D.length;Se+=1)D[Se]&&D[Se].m(G,oe);I(G,a,oe),B(i,G,oe),I(G,l,oe),B(c,G,oe),I(G,u,oe);for(let Se=0;Se<q.length;Se+=1)q[Se]&&q[Se].m(G,oe);I(G,d,oe),B(m,G,oe),I(G,g,oe),B(h,G,oe),I(G,_,oe),z&&z.m(G,oe),I(G,w,oe),he[v].m(G,oe),I(G,O,oe),M=!0},p(G,oe){let Se={};if(oe[0]&1|oe[2]&16384&&(Se.$$scope={dirty:oe,ctx:G}),e.$set(Se),G[0].owner?E?(E.p(G,oe),oe[0]&1&&S(E,1)):(E=Zb(G),E.c(),S(E,1),E.m(r.parentNode,r)):E&&(pe(),T(E,1,1,()=>{E=null}),me()),oe[0]&6144|oe[1]&544){R=Ae(G[11].values());let W;for(W=0;W<R.length;W+=1){let Le=Xb(G,R,W);D[W]?(D[W].p(Le,oe),S(D[W],1)):(D[W]=ev(Le),D[W].c(),S(D[W],1),D[W].m(a.parentNode,a))}for(pe(),W=R.length;W<D.length;W+=1)F(W);me()}let je={};oe[2]&16384&&(je.$$scope={dirty:oe,ctx:G}),i.$set(je);let Oe={};if(oe[0]&8448|oe[2]&16384&&(Oe.$$scope={dirty:oe,ctx:G}),c.$set(Oe),oe[0]&8448|oe[1]&256){V=Ae(G[13].values().sort(pv));let W;for(W=0;W<V.length;W+=1){let Le=Qb(G,V,W);q[W]?(q[W].p(Le,oe),S(q[W],1)):(q[W]=rv(Le),q[W].c(),S(q[W],1),q[W].m(d.parentNode,d))}for(pe(),W=V.length;W<q.length;W+=1)j(W);me()}let ce={};oe[0]&1&&(ce.name=G[0].owner?"Enable key sharing":"Key sharing"),oe[0]&129|oe[2]&16384&&(ce.$$scope={dirty:oe,ctx:G}),h.$set(ce),G[7]?z?(z.p(G,oe),oe[0]&128&&S(z,1)):(z=sv(G),z.c(),S(z,1),z.m(w.parentNode,w)):z&&(pe(),T(z,1,1,()=>{z=null}),me());let le=v;v=Fe(G,oe),v===le?he[v].p(G,oe):(pe(),T(he[le],1,1,()=>{he[le]=null}),me(),A=he[v],A?A.p(G,oe):(A=he[v]=Y[v](G),A.c()),S(A,1),A.m(O.parentNode,O))},i(G){if(!M){S(e.$$.fragment,G),S(E),S(s.$$.fragment,G);for(let oe=0;oe<R.length;oe+=1)S(D[oe]);S(i.$$.fragment,G),S(c.$$.fragment,G);for(let oe=0;oe<V.length;oe+=1)S(q[oe]);S(m.$$.fragment,G),S(h.$$.fragment,G),S(z),S(A),M=!0}},o(G){T(e.$$.fragment,G),T(E),T(s.$$.fragment,G),D=D.filter(Boolean);for(let oe=0;oe<D.length;oe+=1)T(D[oe]);T(i.$$.fragment,G),T(c.$$.fragment,G),q=q.filter(Boolean);for(let oe=0;oe<q.length;oe+=1)T(q[oe]);T(m.$$.fragment,G),T(h.$$.fragment,G),T(z),T(A),M=!1},d(G){G&&(C(t),C(r),C(n),C(a),C(l),C(u),C(d),C(g),C(_),C(w),C(O)),N(e,G),E&&E.d(G),N(s,G),nt(D,G),N(i,G),N(c,G),nt(q,G),N(m,G),N(h,G),z&&z.d(G),he[v].d(G)}}}function wa(o,e=2){if(o===0)return"0 MB";let t=1024,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],s=Math.floor(Math.log(o)/Math.log(t));return(o/Math.pow(t,s)).toFixed(e)+" "+r[s]}function pv(o,e){return o.role==="Owner"&&e.role!=="Owner"?-1:o.role!=="Owner"&&e.role==="Owner"||o.user.name>e.user.name?1:-1}function nA(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function aA(o,e,t){let r,s,n,a,i,l=J,c=()=>(l(),l=ir(q,se=>t(64,i=se)),q),u,d=J,m=()=>(d(),d=ir(R,se=>t(8,u=se)),R),g,h,_,w,v=J,A=()=>(v(),v=ir(V,se=>t(12,w=se)),V),O,M,E;o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>d()),o.$$.on_destroy.push(()=>v());let{relay:R}=e;m();let D=R.folders;ge(o,D,se=>t(11,_=se));let{plugin:F}=e,{sharedFolders:V}=e;A();let{relayRoles:q}=e;c();function j(se){return Ke(this,void 0,void 0,function*(){let Me=yield F.loginManager.checkRelayHost(se.guid);if(Me.status===200)return Me.json})}function z(se){if(!se)return"Active";let Me=(0,um.default)(),Rt=(0,um.default)(se).diff(Me,"days");return Rt<=0?"Subscription has ended":Rt===1?"Active for 1 more day":`Active for ${Rt} more days`}let Y=u.subscriptions;ge(o,Y,se=>t(9,g=se));let he=oo(g,se=>{if(se.values().length===0)return;let Me=se.values()[0];return Me.token||F.relayManager.getSubscriptionToken(Me).then(st=>{Me.token=st}),Me});ge(o,he,se=>t(14,M=se));let Fe=u.storageQuota;ge(o,Fe,se=>t(15,E=se));let G=i.filter(se=>se.relayId===R.id);ge(o,G,se=>t(13,O=se));let oe=_e(!0);ge(o,oe,se=>t(5,r=se));let Se;cr(()=>{Se&&Se.value===""&&Se.focus()});let je=Gt();function Oe(se){return Ke(this,void 0,void 0,function*(){var Me;if(!(!((Me=F.loginManager)===null||Me===void 0)&&Me.user))return;let st={relay:se.id,quantity:10,user_email:F.loginManager.user.email},Rt=btoa(JSON.stringify(st)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(F.buildApiUrl(`/subscribe/${Rt}`),"_blank")})}function ce(se){return Ke(this,void 0,void 0,function*(){let Me=se.token,st=se.id;window.open(F.buildApiUrl(`/subscriptions/${st}/manage?token=${Me}`),"_blank")})}function le(se){return Ke(this,void 0,void 0,function*(){let Me=se.token,st=se.id;window.open(F.buildApiUrl(`/subscriptions/${st}/cancel?token=${Me}`),"_blank")})}function W(se){R.owner&&(lt.set(se),F.relayManager.toggleRelayInvitation(pt,a).then(Me=>{lt.set(Me.enabled)}))}function Le(){return Ke(this,void 0,void 0,function*(){F.relayManager.leaveRelay(R),je("goBack",{clear:!0})})}function it(){return Ke(this,void 0,void 0,function*(){je("goBack",{clear:!0})})}let pt,gt=_e(!1);ge(o,gt,se=>t(6,s=se));let lt=_e(!0);ge(o,lt,se=>t(7,a=se));let St,rt=_e(!1);ge(o,rt,se=>t(63,n=se));function Zt(se){St=se;let Me=()=>{n?((0,Ze.setIcon)(se,"clipboard-check"),se.addClass("mod-success")):((0,Ze.setIcon)(se,s?"eye-off":"eye"),se.removeClass("mod-success"))},st=gt.subscribe(()=>{Me()}),Rt=rt.subscribe(()=>{Me()});return Me(),{destroy(){st(),Rt()}}}F.relayManager.getRelayInvitation(R).then(se=>{se&&(t(4,pt=se),lt.set(se.enabled))});function Rs(){return Ke(this,void 0,void 0,function*(){pt&&t(4,pt=yield F.relayManager.rotateKey(pt).catch(se=>{throw se.status===429&&new Ze.Notice("Slow down"),se}))})}function gn(se,Me,st){return Ke(this,void 0,void 0,function*(){let Rt=(0,Ze.normalizePath)((0,mv.join)(st,Me));F.vault.getFolderByPath(Rt)===null&&(yield F.vault.createFolder(Rt));let Bs=F.sharedFolders.new(Rt,se.guid,R.guid,!0);return Bs.remote=se,F.sharedFolders.notifyListeners(),Bs})}let ns=_e(!1);ge(o,ns,se=>t(10,h=se));let ka=F.timeProvider.debounce(()=>{F.relayManager.updateRelay(R).then(()=>{ns.set(!1)})},500),Os=se=>{new Mc(F.app,V,se,gn).open()};function Ca(){oe.set(nA(Se.value)),r&&Se.value!==""&&(ns.set(!0),ka())}function Dr(){F.relayManager.destroyRelay(R),je("goBack",{})}function ct(se){F.relayManager.kick(se)}function Vt(se,Me){se&&je("manageSharedFolder",{folder:se,relay:Me,mount:!1})}function as(se){let Me=se.target;Me.focus(),Me.select(),navigator.clipboard.writeText(Me.value).then(()=>new Ze.Notice("Invite link copied")).catch(st=>{})}function Us(se){pt&&navigator.clipboard.writeText(pt.key).then(()=>{new Ze.Notice("Invite link copied"),rt.set(!0),setTimeout(()=>{rt.set(!1)},800)}).catch(Me=>{})}let kt=new Dc(F.app,V,se=>Ke(void 0,void 0,void 0,function*(){let Me=(0,Ze.normalizePath)(se),st=V.find(Pa=>Pa.path==se);if(st){let Pa=yield F.relayManager.createRemoteFolder(st,R);st.remote=Pa,st.connect(),F.sharedFolders.notifyListeners();return}F.vault.getFolderByPath(Me)===null&&(yield F.vault.createFolder(Me));let Rt=Bn(),Bs=F.sharedFolders.new((0,Ze.normalizePath)(se),Rt,R.guid,!0),vn=yield F.relayManager.createRemoteFolder(Bs,R);Bs.remote=vn,F.sharedFolders.notifyListeners()})),Ia=(se,Me)=>Me.remote===se;function is(){R.name=this.value,m(t(0,R))}function Jt(se){Hr[se?"unshift":"push"](()=>{Se=se,t(3,Se)})}let $e=(se,Me)=>Me.remote===se;function no(se){ro.call(this,o,se)}let ls=se=>{let Me=w.find(st=>st.remote===se);Me&&Vt(Me,se.relay)},yn=se=>{Os(se)},La=()=>{kt.open()},Ta=se=>{ct(se)},xn=se=>W(se.currentTarget.checked),qt=()=>W(!a),bn=()=>W(!a),$s=()=>gt.update(se=>!se),X=()=>gt.update(se=>!se),ue=()=>{ce(M)},ot=()=>{le(M)},Vr=()=>{Oe(u)},Qt=()=>{Le()};return o.$$set=se=>{"relay"in se&&m(t(0,R=se.relay)),"plugin"in se&&t(43,F=se.plugin),"sharedFolders"in se&&A(t(1,V=se.sharedFolders)),"relayRoles"in se&&c(t(2,q=se.relayRoles))},[R,V,q,Se,pt,r,s,a,u,g,h,_,w,O,M,E,D,j,z,Y,he,Fe,G,oe,Oe,ce,le,W,Le,it,gt,lt,rt,Zt,Rs,ns,Os,Ca,Dr,ct,Vt,Us,kt,F,Ia,is,Jt,$e,no,ls,yn,La,Ta,xn,qt,bn,$s,X,ue,ot,Vr,Qt]}var dm=class extends ee{constructor(e){super(),re(this,e,aA,sA,Z,{relay:0,plugin:43,sharedFolders:1,relayRoles:2},lF,[-1,-1,-1])}},_a=dm;function iA(o){let e,t,r,s,n,a;return r=new Sd({}),{c(){e=P("div"),t=P("div"),H(r.$$.fragment),x(t,"class","clickable-icon"),x(t,"aria-label","Back"),x(t,"tabindex","0"),x(t,"role","button"),x(e,"class","modal-setting-nav-bar")},m(i,l){I(i,e,l),k(e,t),B(r,t,null),s=!0,n||(a=[te(t,"click",o[0]),te(t,"keypress",o[1])],n=!0)},p:J,i(i){s||(S(r.$$.fragment,i),s=!0)},o(i){T(r.$$.fragment,i),s=!1},d(i){i&&C(e),N(r),n=!1,Ce(a)}}}function lA(o){let e=Gt();function t(){e("goBack",{})}function r(s){s.key==="Escape"&&(e("goBack",{}),s.stopPropagation())}return[t,r]}var pm=class extends ee{constructor(e){super(),re(this,e,lA,iA,Z,{})}},hv=pm;var Ms=require("obsidian");function gv(o,e,t){let r=o.slice();return r[32]=e[t][0],r[33]=e[t][1],r}function cA(o){let e=o[1].name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&2&&e!==(e=r[1].name+"")&&ne(t,e)},d(r){r&&C(t)}}}function fA(o){let e,t;return e=new Be({props:{description:"This folder is tracking edits, but is not connected to a Relay Server."}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p:J,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function uA(o){let e,t;return e=new Ft({props:{$$slots:{name:[mA],default:[dA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&128|s[1]&32&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function dA(o){let e,t;return e=new dn({}),e.$on("settings",function(){ht((0,Ms.debounce)(o[22]))&&(0,Ms.debounce)(o[22]).apply(this,arguments)}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){o=r},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function pA(o){let e=o[7].name+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s[0]&128&&e!==(e=r[7].name+"")&&ne(t,e)},d(r){r&&C(t)}}}function mA(o){let e,t;return e=new Ds({props:{slot:"name",relay:o[7],$$slots:{default:[pA]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[21]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&128&&(n.relay=r[7]),s[0]&128|s[1]&32&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function yv(o){let e,t,r,s,n;e=new Ge({props:{name:"Sync settings",helpText:"You must have attachment storage available in order to sync attachments."}});let a=Ae(o[4]),i=[];for(let u=0;u<a.length;u+=1)i[u]=bv(gv(o,a,u));let l=u=>T(i[u],1,1,()=>{i[u]=null}),c=o[6]&&o[7]&&vv(o);return{c(){H(e.$$.fragment),t=U();for(let u=0;u<i.length;u+=1)i[u].c();r=U(),c&&c.c(),s=Ie()},m(u,d){B(e,u,d),I(u,t,d);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(u,d);I(u,r,d),c&&c.m(u,d),I(u,s,d),n=!0},p(u,d){if(d[0]&16728){a=Ae(u[4]);let m;for(m=0;m<a.length;m+=1){let g=gv(u,a,m);i[m]?(i[m].p(g,d),S(i[m],1)):(i[m]=bv(g),i[m].c(),S(i[m],1),i[m].m(r.parentNode,r))}for(pe(),m=a.length;m<i.length;m+=1)l(m);me()}u[6]&&u[7]?c?(c.p(u,d),d[0]&192&&S(c,1)):(c=vv(u),c.c(),S(c,1),c.m(s.parentNode,s)):c&&(pe(),T(c,1,1,()=>{c=null}),me())},i(u){if(!n){S(e.$$.fragment,u);for(let d=0;d<a.length;d+=1)S(i[d]);S(c),n=!0}},o(u){T(e.$$.fragment,u),i=i.filter(Boolean);for(let d=0;d<i.length;d+=1)T(i[d]);T(c),n=!1},d(u){u&&(C(t),C(r),C(s)),N(e,u),nt(i,u),c&&c.d(u)}}}function xv(o){let e,t;return e=new Tc({}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function hA(o){let e,t,r,s,n,a,i,l,c,u,d,m=o[6]&&xv(o);function g(...w){return o[23](o[32],...w)}function h(){return o[24](o[32])}function _(){return o[25](o[32])}return{c(){e=P("div"),m&&m.c(),t=U(),r=P("div"),s=P("input"),a=U(),i=P("div"),x(s,"type","checkbox"),s.checked=n=o[8][o[32]]&&!o[6],s.disabled=o[3],x(i,"class","checkbox-toggle"),x(r,"role","checkbox"),x(r,"aria-checked",l=o[8][o[32]]&&!o[6]),x(r,"tabindex","0"),x(r,"class","checkbox-container"),Ne(r,"is-enabled",o[8][o[32]]&&!o[6]),x(e,"class","setting-item-control")},m(w,v){I(w,e,v),m&&m.m(e,null),k(e,t),k(e,r),k(r,s),k(r,a),k(r,i),c=!0,u||(d=[te(s,"change",g),te(r,"keypress",h),te(r,"click",_)],u=!0)},p(w,v){o=w,o[6]?m?v[0]&64&&S(m,1):(m=xv(o),m.c(),S(m,1),m.m(e,t)):m&&(pe(),T(m,1,1,()=>{m=null}),me()),(!c||v[0]&336&&n!==(n=o[8][o[32]]&&!o[6]))&&(s.checked=n),(!c||v[0]&8)&&(s.disabled=o[3]),(!c||v[0]&336&&l!==(l=o[8][o[32]]&&!o[6]))&&x(r,"aria-checked",l),(!c||v[0]&336)&&Ne(r,"is-enabled",o[8][o[32]]&&!o[6])},i(w){c||(S(m),c=!0)},o(w){T(m),c=!1},d(w){w&&C(e),m&&m.d(),u=!1,Ce(d)}}}function bv(o){let e,t;return e=new Ft({props:{name:o[33].name,description:o[33].description,$$slots:{default:[hA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&16&&(n.name=r[33].name),s[0]&16&&(n.description=r[33].description),s[0]&344|s[1]&32&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function vv(o){let e,t;return e=new Ft({props:{name:"",$$slots:{default:[gA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&128|s[1]&32&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function gA(o){let e,t,r;return{c(){e=P("button"),e.textContent="Buy storage",x(e,"class","mod-cta")},m(s,n){I(s,e,n),t||(r=te(e,"click",function(){ht((0,Ms.debounce)(o[26]))&&(0,Ms.debounce)(o[26]).apply(this,arguments)}),t=!0)},p(s,n){o=s},d(s){s&&C(e),t=!1,r()}}}function yA(o){let e,t,r;return{c(){e=P("button"),e.textContent="Delete local",x(e,"class","mod-warning")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Ms.debounce)(o[27])),t=!0)},p:J,d(s){s&&C(e),t=!1,r()}}}function xA(o){let e,t,r,s,n,a,i;return{c(){e=P("button"),t=K("Delete metadata"),x(e,"class",r=o[7]?"mod-disabled":"mod-warning"),e.disabled=s=!!o[7],x(e,"aria-label",n=o[7]?"Metadata is required for sharing.":"")},m(l,c){I(l,e,c),k(e,t),a||(i=te(e,"click",(0,Ms.debounce)(o[28])),a=!0)},p(l,c){c[0]&128&&r!==(r=l[7]?"mod-disabled":"mod-warning")&&x(e,"class",r),c[0]&128&&s!==(s=!!l[7])&&(e.disabled=s),c[0]&128&&n!==(n=l[7]?"Metadata is required for sharing.":"")&&x(e,"aria-label",n)},d(l){l&&C(e),a=!1,i()}}}function wv(o){var s,n,a,i,l;let e,t,r=(((s=o[7])==null?void 0:s.owner)||((i=(a=(n=o[5])==null?void 0:n.remote)==null?void 0:a.creator)==null?void 0:i.id)===((l=o[0].relayManager.user)==null?void 0:l.id))&&_v(o);return{c(){r&&r.c(),e=Ie()},m(c,u){r&&r.m(c,u),I(c,e,u),t=!0},p(c,u){var d,m,g,h,_;(d=c[7])!=null&&d.owner||((h=(g=(m=c[5])==null?void 0:m.remote)==null?void 0:g.creator)==null?void 0:h.id)===((_=c[0].relayManager.user)==null?void 0:_.id)?r?(r.p(c,u),u[0]&161&&S(r,1)):(r=_v(c),r.c(),S(r,1),r.m(e.parentNode,e)):r&&(pe(),T(r,1,1,()=>{r=null}),me())},i(c){t||(S(r),t=!0)},o(c){T(r),t=!1},d(c){c&&C(e),r&&r.d(c)}}}function _v(o){let e,t,r,s;return e=new Ge({props:{name:"Remote Folder"}}),r=new Be({props:{name:"Remove from relay",description:"Deletes the remote folder from the relay. Local files will be preserved.",$$slots:{default:[bA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment)},m(n,a){B(e,n,a),I(n,t,a),B(r,n,a),s=!0},p(n,a){let i={};a[1]&32&&(i.$$scope={dirty:a,ctx:n}),r.$set(i)},i(n){s||(S(e.$$.fragment,n),S(r.$$.fragment,n),s=!0)},o(n){T(e.$$.fragment,n),T(r.$$.fragment,n),s=!1},d(n){n&&C(t),N(e,n),N(r,n)}}}function bA(o){let e,t,r;return{c(){e=P("button"),e.textContent="Delete remote",x(e,"class","mod-destructive")},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,Ms.debounce)(o[17])),t=!0)},p:J,d(s){s&&C(e),t=!1,r()}}}function vA(o){let e,t,r,s,n,a,i,l=o[7]&&Je().enableAttachmentSync,c,u,d,m,g,h,_,w,v;e=new Pc({props:{category:So,categoryText:"Shared Folders",$$slots:{default:[cA]},$$scope:{ctx:o}}}),e.$on("goBack",o[15]),r=new Ge({props:{name:"Relay Server"}});let A=[uA,fA],O=[];function M(D,F){return D[7]?0:1}n=M(o,[-1,-1]),a=O[n]=A[n](o);let E=l&&yv(o);u=new Ge({props:{name:"Local folder"}}),m=new Be({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[yA]},$$scope:{ctx:o}}}),h=new Be({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[xA]},$$scope:{ctx:o}}});let R=o[7]&&wv(o);return{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment),s=U(),a.c(),i=U(),E&&E.c(),c=U(),H(u.$$.fragment),d=U(),H(m.$$.fragment),g=U(),H(h.$$.fragment),_=U(),R&&R.c(),w=Ie()},m(D,F){B(e,D,F),I(D,t,F),B(r,D,F),I(D,s,F),O[n].m(D,F),I(D,i,F),E&&E.m(D,F),I(D,c,F),B(u,D,F),I(D,d,F),B(m,D,F),I(D,g,F),B(h,D,F),I(D,_,F),R&&R.m(D,F),I(D,w,F),v=!0},p(D,F){let V={};F[0]&2|F[1]&32&&(V.$$scope={dirty:F,ctx:D}),e.$set(V);let q=n;n=M(D,F),n===q?O[n].p(D,F):(pe(),T(O[q],1,1,()=>{O[q]=null}),me(),a=O[n],a?a.p(D,F):(a=O[n]=A[n](D),a.c()),S(a,1),a.m(i.parentNode,i)),F[0]&128&&(l=D[7]&&Je().enableAttachmentSync),l?E?(E.p(D,F),F[0]&128&&S(E,1)):(E=yv(D),E.c(),S(E,1),E.m(c.parentNode,c)):E&&(pe(),T(E,1,1,()=>{E=null}),me());let j={};F[1]&32&&(j.$$scope={dirty:F,ctx:D}),m.$set(j);let z={};F[0]&128|F[1]&32&&(z.$$scope={dirty:F,ctx:D}),h.$set(z),D[7]?R?(R.p(D,F),F[0]&128&&S(R,1)):(R=wv(D),R.c(),S(R,1),R.m(w.parentNode,w)):R&&(pe(),T(R,1,1,()=>{R=null}),me())},i(D){v||(S(e.$$.fragment,D),S(r.$$.fragment,D),S(a),S(E),S(u.$$.fragment,D),S(m.$$.fragment,D),S(h.$$.fragment,D),S(R),v=!0)},o(D){T(e.$$.fragment,D),T(r.$$.fragment,D),T(a),T(E),T(u.$$.fragment,D),T(m.$$.fragment,D),T(h.$$.fragment,D),T(R),v=!1},d(D){D&&(C(t),C(s),C(i),C(c),C(d),C(g),C(_),C(w)),N(e,D),N(r,D),O[n].d(D),E&&E.d(D),N(u,D),N(m,D),N(h,D),R&&R.d(D)}}}function wA(o,e,t){let r,s,n,a,i=J,l=()=>(i(),i=ir(g,ce=>t(29,a=ce)),g),c,u;o.$$.on_destroy.push(()=>i());let{plugin:d}=e,{sharedFolder:m}=e,{sharedFolders:g}=e;l();let{relayRoles:h}=e;function _(ce){return Ke(this,void 0,void 0,function*(){var le;if(!(!((le=d.loginManager)===null||le===void 0)&&le.user))return;let W={relay:ce.id,quantity:10,user_email:d.loginManager.user.email},Le=btoa(JSON.stringify(W)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(d.buildApiUrl(`/subscribe/${Le}?action="buy_storage"`),"_blank")})}let w=oo(a,ce=>ce.find(le=>le===m));ge(o,w,ce=>t(5,s=ce));let v=m.syncSettingsManager;ge(o,v,ce=>t(8,u=ce));let A=oo([w,h],([ce,le])=>{var W;return(W=le.find(Le=>{var it;return Le.relay===((it=ce==null?void 0:ce.remote)===null||it===void 0?void 0:it.relay)}))===null||W===void 0?void 0:W.relay});ge(o,A,ce=>t(7,c=ce));let O=oo([w,h],([ce,le])=>{var W,Le,it;return((it=(Le=(W=le.find(pt=>{var gt;return pt.relay===((gt=ce==null?void 0:ce.remote)===null||gt===void 0?void 0:gt.relay)}))===null||W===void 0?void 0:W.relay)===null||Le===void 0?void 0:Le.storageQuota)===null||it===void 0?void 0:it.quota)===0});ge(o,O,ce=>t(6,n=ce));let M=!1;function E(ce,le){return Ke(this,void 0,void 0,function*(){if(!M&&!n){t(3,M=!0);try{yield v.toggleCategory(ce,le),t(4,r=Object.entries(v.getCategories()))}catch(W){}finally{t(3,M=!1)}}})}let R;cr(()=>{!m&&R&&R.value===""&&R.focus()});let D=Gt();function F(){return Ke(this,void 0,void 0,function*(){D("goBack",{clear:!0})})}function V(ce){ce&&D("manageRelay",{relay:ce})}function q(){return Ke(this,void 0,void 0,function*(){yield d.relayManager.deleteRemote(m),d.sharedFolders.notifyListeners()})}function j(){return Ke(this,void 0,void 0,function*(){s&&d.sharedFolders.delete(s),D("goBack",{clear:!0})})}function z(){let ce=d.vault.getFolderByPath(m.path);ce&&d.app.vault.trash(ce,!1),D("goBack",{})}function Y(ce){ro.call(this,o,ce)}let he=()=>{V(c)},Fe=(ce,le)=>E(ce,le.currentTarget.checked),G=ce=>E(ce,!u[ce]),oe=ce=>E(ce,!u[ce]),Se=()=>{_(c)},je=()=>{z()},Oe=()=>{j()};o.$$set=ce=>{"plugin"in ce&&t(0,d=ce.plugin),"sharedFolder"in ce&&t(1,m=ce.sharedFolder),"sharedFolders"in ce&&l(t(2,g=ce.sharedFolders)),"relayRoles"in ce&&t(20,h=ce.relayRoles)};e:t(4,r=Object.entries(v.getCategories()));return[d,m,g,M,r,s,n,c,u,_,w,v,A,O,E,F,V,q,j,z,h,Y,he,Fe,G,oe,Se,je,Oe]}var mm=class extends ee{constructor(e){super(),re(this,e,wA,vA,Z,{plugin:0,sharedFolder:1,sharedFolders:2,relayRoles:20},null,[-1,-1])}},hm=mm;function _A(o){De(o,"svelte-d22j3",".relay-version.svelte-d22j3{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-d22j3{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-d22j3{padding-left:48px !important}.system3-announcement.svelte-d22j3{color:var(--text-on-accent)}")}function SA(o){let e,t,r,s,n=o[0].networkStatus.status&&Sv(o);return{c(){e=P("div"),t=P("span"),n&&n.c(),x(t,"class","system3-announcement svelte-d22j3"),de(t,"color",o[0].networkStatus.status.color?o[0].networkStatus.status.color:"var(--text-on-accent)",1),x(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-d22j3"),x(e,"role","button"),x(e,"tabindex","0"),de(e,"background-color",o[0].networkStatus.status.backgroundColor?o[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},m(a,i){I(a,e,i),k(e,t),n&&n.m(t,null),r||(s=[te(e,"click",o[17]),te(e,"keypress",o[18])],r=!0)},p(a,i){a[0].networkStatus.status?n?n.p(a,i):(n=Sv(a),n.c(),n.m(t,null)):n&&(n.d(1),n=null),i&1&&de(t,"color",a[0].networkStatus.status.color?a[0].networkStatus.status.color:"var(--text-on-accent)",1),i&1&&de(e,"background-color",a[0].networkStatus.status.backgroundColor?a[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},i:J,o:J,d(a){a&&C(e),n&&n.d(),r=!1,Ce(s)}}}function kA(o){let e,t;return e=new hv({}),e.$on("goBack",o[9]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p:J,i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Sv(o){let e,t=As(o[0].networkStatus.status.status)+"",r;return{c(){e=new Is(!1),r=Ie(),e.a=r},m(s,n){e.m(t,s,n),I(s,r,n)},p(s,n){n&1&&t!==(t=As(s[0].networkStatus.status.status)+"")&&e.p(t)},d(s){s&&(C(r),e.d())}}}function CA(o){let e,t;return e=new Cb({props:{plugin:o[0],$$slots:{default:[TA]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),s&8388609&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function IA(o){let e,t;return e=new _a({props:{plugin:o[0],relayRoles:o[3],relay:o[2],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageSharedFolder",o[7]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),s&4&&(n.relay=r[2]),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function LA(o){let e,t;return e=new hm({props:{plugin:o[0],relayRoles:o[3],sharedFolder:o[1],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageRelay",o[6]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),s&2&&(n.sharedFolder=r[1]),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function TA(o){let e,t;return e=new ko({props:{relays:o[4],plugin:o[0]}}),e.$on("manageRelay",o[6]),e.$on("manageSharedFolder",o[7]),e.$on("createRelay",o[8]),e.$on("joinRelay",o[11]),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function kv(o){let e,t=o[0].version+"",r;return{c(){e=P("span"),r=K(t),x(e,"class","relay-version svelte-d22j3")},m(s,n){I(s,e,n),k(e,r)},p(s,n){n&1&&t!==(t=s[0].version+"")&&ne(r,t)},d(s){s&&C(e)}}}function PA(o){let e,t,r,s,n,a,i,l,c,u=[kA,SA],d=[];function m(v,A){return v[2]||v[1]?0:v[0].networkStatus.status?1:-1}~(e=m(o,-1))&&(t=d[e]=u[e](o));let g=[LA,IA,CA],h=[];function _(v,A){return v[1]?0:v[2]?1:2}n=_(o,-1),a=h[n]=g[n](o);let w=o[0].manifest.version!==o[0].version&&kv(o);return{c(){t&&t.c(),r=U(),s=P("div"),a.c(),i=U(),w&&w.c(),l=Ie(),x(s,"class","vertical-tab-content svelte-d22j3")},m(v,A){~e&&d[e].m(v,A),I(v,r,A),I(v,s,A),h[n].m(s,null),I(v,i,A),w&&w.m(v,A),I(v,l,A),c=!0},p(v,[A]){let O=e;e=m(v,A),e===O?~e&&d[e].p(v,A):(t&&(pe(),T(d[O],1,1,()=>{d[O]=null}),me()),~e?(t=d[e],t?t.p(v,A):(t=d[e]=u[e](v),t.c()),S(t,1),t.m(r.parentNode,r)):t=null);let M=n;n=_(v,A),n===M?h[n].p(v,A):(pe(),T(h[M],1,1,()=>{h[M]=null}),me(),a=h[n],a?a.p(v,A):(a=h[n]=g[n](v),a.c()),S(a,1),a.m(s,null)),v[0].manifest.version!==v[0].version?w?w.p(v,A):(w=kv(v),w.c(),w.m(l.parentNode,l)):w&&(w.d(1),w=null)},i(v){c||(S(t),S(a),c=!0)},o(v){T(t),T(a),c=!1},d(v){v&&(C(r),C(s),C(i),C(l)),~e&&d[e].d(v),h[n].d(),w&&w.d(v)}}}function DA(o,e,t){let r,{plugin:s}=e,{path:n=void 0}=e,a=s.app,i=s.relayManager,l=i.relayRoles,c=i.relays;ge(o,c,q=>t(16,r=q));let u=s.sharedFolders,d,m=ko,g,h=[{component:ko}],{close:_}=e;function w(q){if(t(2,g=void 0),t(1,d=void 0),q==="/"){t(15,m=ko);return}let j=new URLSearchParams(q.split("?")[1]||""),z=j.get("id");if(q.startsWith("/relays")){z?(t(2,g=i.relays.find(Y=>Y.guid===z)),t(15,m=_a)):t(15,m=ko);return}if(q.startsWith("/shared-folders")){if(z){t(1,d=u.find(he=>he.guid===z));let Y=j.get("relay");Y&&t(2,g=i.relays.get(Y)),t(15,m=hm)}return}}function v(q){h.push({currentRelay:g,sharedFolder:d,component:m}),t(2,g=q.detail.relay),t(1,d=void 0),t(15,m=_a)}function A(q){h.push({currentRelay:g,sharedFolder:d,component:m}),t(1,d=q.detail.folder),t(2,g=q.detail.relay)}function O(q){return Ke(this,void 0,void 0,function*(){h.push({currentRelay:g,sharedFolder:d,component:m}),t(2,g=yield s.relayManager.createRelay("")),t(15,m=_a)})}function M(q){if(q.detail.clear){h.length=0,t(2,g=void 0),t(1,d=void 0),t(15,m=ko);return}let j=h.pop();if(j)for(;j;){if(!j.currentRelay&&!j.sharedFolder)t(2,g=j.currentRelay),t(1,d=j.sharedFolder),t(15,m=j.component);else if(j.sharedFolder&&u.has(j.sharedFolder)){t(2,g=j.currentRelay),t(1,d=j.sharedFolder),t(15,m=j.component);break}else if(j.currentRelay&&i.relays.get(j.currentRelay.id)){t(2,g=j.currentRelay),t(1,d=j.sharedFolder),t(15,m=j.component);break}j=h.pop()}else t(2,g=void 0),t(1,d=void 0),t(15,m=ko)}function E(q){h.length=0,_()}function R(q){t(2,g=q.detail.relay),t(15,m=_a)}function D(){var q;!((q=s.networkStatus.status)===null||q===void 0)&&q.versions&&(s.releaseSettings.get().channel==="stable"?s.installVersion(s.networkStatus.status.versions.stable):s.releaseSettings.get().channel==="beta"&&s.installVersion(s.networkStatus.status.versions.beta))}let F=()=>{var q,j;(q=s.networkStatus.status)!=null&&q.versions?D():(j=s.networkStatus.status)!=null&&j.link&&window.open(s.networkStatus.status.link)},V=()=>{var q,j;(q=s.networkStatus.status)!=null&&q.versions?D():(j=s.networkStatus.status)!=null&&j.link&&window.open(s.networkStatus.status.link)};return o.$$set=q=>{"plugin"in q&&t(0,s=q.plugin),"path"in q&&t(13,n=q.path),"close"in q&&t(14,_=q.close)},o.$$.update=()=>{if(o.$$.dirty&8192){e:n&&w(n)}if(o.$$.dirty&65540){e:g&&!r.has(g.id)&&(t(2,g=void 0),t(15,m=ko))}if(o.$$.dirty&2){e:d&&!u.has(d)&&(t(1,d=void 0),t(15,m=ko))}if(o.$$.dirty&32774){e:(m||g||d)&&setTimeout(()=>{let q=document.querySelector(".vertical-tab-content");q&&(q.scrollTop=0)},0)}},[s,d,g,l,c,u,v,A,O,M,E,R,D,n,_,m,r,F,V]}var gm=class extends ee{constructor(e){super(),re(this,e,DA,PA,Z,{plugin:0,path:13,close:14},_A)}},Cv=gm;var Ec=class extends Iv.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new Cv({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(t){var r;(r=this.component)==null||r.$set({path:t})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var Oc=require("obsidian");var Rc=class extends hi{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(s){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let s=r;typeof r!="string"&&(s=JSON.stringify(r)),window.localStorage.setItem(t,s)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var Uc=class extends ft{constructor(t,r,s,n){var i;super();this.beforeLogin=n;let a=Pe("[Pocketbase]","debug");this.authStore=new Rc(`pocketbase_auth_${t}`),this.pb=new aa("https://auth.system3.md",this.authStore),this.pb.beforeSend=(l,c)=>(a(l,c),c.fetch=Et,c.headers=Object.assign({},c.headers,{"Relay-Version":"0.5.5"}),{url:l,options:c}),this.refreshToken(),s.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(i=this.pb.authStore.model)!=null&&i.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).then(()=>{this.getFlags()}).catch(l=>{l.status===404&&this.logout()}),Bt.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,s]=r.split("."),n=JSON.parse(atob(s)),a=new Date(n.exp*1e3),i=new Date,l=Math.ceil((a.getTime()-i.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:a.toLocaleString(),expiresIn:`${l} days`,userId:n.id,email:n.email})}))}setup(t){var r,s;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(r=t==null?void 0:t.meta)==null?void 0:r.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(s=t.meta)==null?void 0:s.rawUser}).then(()=>{this.notifyListeners()}).catch(n=>{this.log(n)}),!0):(this.notifyListeners(),!1)}async checkRelayHost(t){let r={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.5.5"};return(0,Oc.requestUrl)({url:`https://api.system3.md/relay/${t}/check-host`,method:"GET",headers:r})}getFlags(){let t={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.5.5"};(0,Oc.requestUrl)({url:"https://api.system3.md/flags",method:"GET",headers:t}).then(r=>{if(r.status===200){let s=r.json;Nt.getInstance().applyServerFlags(s)}}).catch(r=>{this.log(r)})}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,Oc.requestUrl)({url:"https://api.system3.md/whoami",method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}get hasUser(){return this.user!==void 0}makeUser(t,r){var s,n,a,i;return new Cc((s=t.model)==null?void 0:s.id,((n=t.model)==null?void 0:n.name)||(r==null?void 0:r.name),(a=t.model)==null?void 0:a.email,((i=t.model)==null?void 0:i.picture)||(r==null?void 0:r.picture),t.token)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}webviewIntercept(){let t=this.pb.buildUrl("/api/oauth2-redirect"),r="https:\\/\\/accounts\\.google\\.com\\/o\\/oauth2\\/auth";return new RegExp(`^${r}.*?[?&]redirect_uri=(${t}|${encodeURIComponent(t)})`,"i")}async initiateManualOAuth2CodeFlow(t){this.beforeLogin();let s=(await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError})).authProviders[0],n=this.pb.buildUrl("/api/oauth2-redirect");return[s.authUrl+n,s,async a=>this.pb.collection("users").authWithOAuth2Code(s.name,a,s.codeVerifier,n,{fetch:t}).then(i=>(this.setup(i),i))]}async poll(t,r){let s=0,n=1e3;return new Promise((a,i)=>{let l=setInterval(()=>{if(s+=1,s>=30)return clearInterval(l),i(new Error(`Auth timeout: Timed out after ${s*n/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.state.slice(0,15)).then(c=>{if(c)return clearInterval(l),a(r(c.code))}).catch(c=>{})},n)})}async login(){this.beforeLogin();let t=await this.pb.collection("users").authWithOAuth2({provider:"google"});return this.setup(t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,s)=>{let n=()=>{this.loggedIn&&(this.off(n),r(!0)),r(!1)};this.on(n)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};var jt=crypto;var Co=new TextEncoder,Tr=new TextDecoder,$q=2**32;var Lv=o=>{let e=o;typeof e=="string"&&(e=Co.encode(e));let t=32768,r=[];for(let s=0;s<e.length;s+=t)r.push(String.fromCharCode.apply(null,e.subarray(s,s+t)));return btoa(r.join(""))},so=o=>Lv(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Tv=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},pn=o=>{let e=o;e instanceof Uint8Array&&(e=Tr.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Tv(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var ym={};If(ym,{JOSEAlgNotAllowed:()=>Di,JOSEError:()=>Ht,JOSENotSupported:()=>Tt,JWEDecryptionFailed:()=>Fi,JWEInvalid:()=>Pr,JWKInvalid:()=>Bc,JWKSInvalid:()=>Nc,JWKSMultipleMatchingKeys:()=>Hc,JWKSNoMatchingKey:()=>Ai,JWKSTimeout:()=>Vc,JWSInvalid:()=>rs,JWSSignatureVerificationFailed:()=>Mi,JWTClaimValidationFailed:()=>Pi,JWTExpired:()=>$c,JWTInvalid:()=>ur});var Ht=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},Pi=class extends Ht{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},$c=class extends Ht{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},Di=class extends Ht{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},Tt=class extends Ht{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},Fi=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},Pr=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},rs=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},ur=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},Bc=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},Nc=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},Ai=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},Hc=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},Vc=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},Mi=class extends Ht{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var qc=jt.getRandomValues.bind(jt);function RA(o){return typeof o=="object"&&o!==null}function dr(o){if(!RA(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var GA=Symbol();var oM,Kc,Bv;(typeof navigator=="undefined"||!((Bv=(Kc=navigator.userAgent)==null?void 0:Kc.startsWith)!=null&&Bv.call(Kc,"Mozilla/5.0 ")))&&(oM="jose/v5.3.0");var vm={};If(vm,{decode:()=>Gc,encode:()=>sM});var sM=so,Gc=pn;function wm(o){if(typeof o!="string")throw new ur("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new ur("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new ur("Invalid JWT");if(!e)throw new ur("JWTs must contain a payload");let r;try{r=Gc(e)}catch(n){throw new ur("Failed to base64url decode the payload")}let s;try{s=JSON.parse(Tr.decode(r))}catch(n){throw new ur("Failed to parse the decoded payload as JSON")}if(!dr(s))throw new ur("Invalid JWT Claims Set");return s}var mn=class extends Error{constructor(e){super(e),this.name="[System3] Relay Error"}};function Nv(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function nM(o){let e=wm(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var jc=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=nM,this.maxConnections=t,this.refreshInterval=null,Bt.set(this,"TokenStore")}onRefresh(e){return new Promise((r,s)=>{let n=i=>{r(i)},a=i=>{this.removeFromRefreshQueue(e),s(i)};this.refresh(e,n,a)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=s=>{this.onTokenRefreshed(e,s),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let s=this.tokenMap.get(e),n=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...s,token:t,expiryTime:r}),n(t),this.log(`Token refreshed for ${s.friendlyName} (${e})`)}}onRefreshFailure(e){let t=this.tokenMap.get(e),r=(t==null?void 0:t.attempts)||0+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){let s=this._activePromises.get(e);if(s)return s;this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:0}),this.callbacks.set(e,r);let n=this.onRefresh(e).then(a=>(this.onTokenRefreshed(e,a),this._activePromises.delete(e),a)).catch(a=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),a});return this._activePromises.set(e,n),n}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new mn("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let s=this.tokenMap.get(e);if(s.token&&this.isTokenValid(s))return this.callbacks.set(e,r),s.friendlyName=t,r(s.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(s.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),s=Array.from(this.tokenMap.entries()).sort((n,a)=>n[1].expiryTime-a[1].expiryTime);for(let[n,{friendlyName:a,expiryTime:i,attempts:l}]of s){if(!e(n))continue;let c=i-r,u="";c>0?u=`expires in ${Nv(c-this.expiryMargin)}`:u="expired",t.push(`${n} (${a}): ${l} attempts, (${u})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${Nv(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(e){e?this.tokenMap.forEach((t,r)=>{e(t)&&(this.tokenMap.delete(r),this.refreshQueue.delete(r))}):(this.tokenMap.clear(),this.refreshQueue.clear())}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};function aM(o){return o.expiryTime||0}function iM(o,e){return(...t)=>e(o,...t)}async function lM(o,e,t,r){var c;let s=Pe("[TokenStore][Refresh]","debug"),n=Pe("[TokenStore][Refresh]","error");s(`${e}`);let a=vt.decode(e),i;if(a instanceof $r)i=JSON.stringify({docId:a.documentId,relay:a.relayId,folder:a.folderId});else if(a instanceof nr)i=JSON.stringify({docId:a.canvasId,relay:a.relayId,folder:a.folderId});else if(a instanceof Vo)i=JSON.stringify({docId:a.folderId,relay:a.relayId,folder:a.folderId});else if(a instanceof qo)i=JSON.stringify({docId:a.fileId,relay:a.relayId,folder:a.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(c=o.user)==null?void 0:c.token}`,"Relay-Version":"0.5.5"};try{let u=await Et("https://api.system3.md/token",{method:"POST",headers:l,body:i});if(!u.ok){s(u.status,await u.text()),r(Error(`Received status code ${u.status} from an API.`));return}let d=await u.json();t(d)}catch(u){n(u,i),r(u)}}var Yc=class extends jc{constructor(t,r,s,n=5){super({log:Pe("[LiveTokenStore]","debug"),refresh:iM(t,lM),getJwtExpiry:aM,getStorage:function(){return new jo("TokenStore/"+s)},getTimeProvider:()=>r},n);this.loginManager=t}async getFileTokenFromNetwork(t,r,s,n){let a=`${t}${r}`,i=this._activePromises.get(a);if(i)return i;this.tokenMap.set(t,{token:null,expiryTime:0,attempts:0});let l=this.fetchFileToken(t,r,s,n).then(c=>{let u=this.getJwtExpiry(c),d=this.tokenMap.get(a);return this.tokenMap.set(r,{...d,token:c,expiryTime:u}),this._activePromises.delete(a),c}).catch(c=>{throw this._activePromises.delete(a),c});return this._activePromises.set(a,l),l}async fetchFileToken(t,r,s,n){var m;let a=Pe("[TokenStore][Fetch]","debug");a(`${t}`);let i=vt.decode(t),l;if(i instanceof qo)l=JSON.stringify({docId:i.fileId,relay:i.relayId,folder:i.folderId,hash:r,contentType:s,contentLength:n});else throw new Error(`No remote to connect to for ${t}`);if(!this.loginManager.loggedIn)throw new Error("Not logged in");let c={Authorization:`Bearer ${(m=this.loginManager.user)==null?void 0:m.token}`,"Relay-Version":"0.5.5"},u=await Et("https://api.system3.md/file-token",{method:"POST",headers:c,body:l});if(!u.ok){a(u.status,await u.text());let g=await u.json();throw new Error(g.error)}return await u.json()}async getFileToken(t,r,s,n){let a=`${t}${r}`,i=this.tokenMap.get(a);return i&&i.token&&this.isTokenValid(i)?(this.log("token was valid, cache hit!"),this._activePromises.delete(a),Promise.resolve(i.token)):this.getFileTokenFromNetwork(t,r,s,n)}};var Hv=require("obsidian");var _m=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Pe("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,Hv.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"0.5.5"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,this.onOffline.forEach(t=>t(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},Vv=_m;function Sm(o){return typeof o.id=="string"}function cM(o){return typeof o.name=="string"}var km=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function qv(o){return typeof o.aggregate_root=="object"}function Wv(o){return typeof o.acl=="object"}var Ri=class{get aggregate_root(){}get acl(){}},Cm=class extends ft{constructor(t,r){super();this.storageQuota=t;this.relays=r}update(t){return this.storageQuota=t,this}get id(){return this.storageQuota.id}get quota(){return this.storageQuota.quota}get pending(){return this.storageQuota.pending}get usage(){return this.storageQuota.usage}get maxFileSize(){return this.storageQuota.max_file_size}get updated(){return this.storageQuota.updated}get created(){return this.storageQuota.created}},Im=class{constructor(e,t){this.storageQuota=e;this.relays=t;this.collectionName="storage_quotas"}items(){return this.storageQuota.values()}clear(){this.storageQuota.clear()}get(e){return this.storageQuota.get(e)}ingest(e){let t=this.storageQuota.get(e.id);if(t)return t.update(e),this.storageQuota.notifyListeners(),t;let r=new Cm(e,this.relays);return this.storageQuota.set(e.id,r),r}delete(e){this.storageQuota.delete(e)}},Jc=class extends Ri{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}get email(){return this.user.email}get picture(){return this.user.picture}update(t){return this.user=t,this}},Lm=class extends ft{constructor(t){super();this.provider=t}get id(){return this.provider.id}get name(){return this.provider.name}get url(){return this.provider.url}get selfHosted(){return this.provider.self_hosted}update(t){return this.provider=t,this}},Tm=class{constructor(e){this.providers=e;this.collectionName="providers"}items(){return this.providers.values()}clear(){this.providers.clear()}get(e){return this.providers.get(e)}ingest(e){let t=this.providers.get(e.id);if(t)return t.update(e),this.providers.notifyListeners(),t;let r=new Lm(e);return this.providers.set(e.id,r),r}delete(e){this.providers.delete(e)}},Pm=class extends Ri{constructor(t,r,s){super();this.remoteFolder=t;this.relays=r;this.users=s}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get aggregate_root(){return["relays",this.remoteFolder.relay]}get acl(){return["relays",this.remoteFolder.relay]}},Dm=class{constructor(e,t,r){this.remoteFolders=e;this.relays=t;this.users=r;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new Pm(e,this.relays,this.users);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},Fm=class{constructor(e,t,r,s,n,a,i,l,c){this.relays=e;this.roles=t;this.relayRoles=r;this.relayInvitations=s;this.remoteFolders=n;this.subscriptions=a;this.storageQuotas=i;this.providers=l;this.user=c;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new Qc(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},Am=class{constructor(e,t,r,s){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=s}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new Um(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},Mm=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new $m(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},Em=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new Jc(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},Rm=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new Bm(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},Om=class extends Dt{constructor(t){super();this.collections=new Map,this.relationships=new Map;for(let r of t)this.collections.set(r.collectionName,r);Bt.set(this,"Store")}getCollection(t){let r=this.collections.get(t);if(!r)throw this.error("No collection found for",t),new Error("No collection found for "+t);return r}clear(){let t=Nr.getInstance();t.beginTransaction(),this.collections.forEach(r=>{r.clear()}),this.collections.clear(),this.relationships.clear(),t.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(t){return this.ingestBatch(t==null?void 0:t.items)}ingestBatch(t){if(t)return t.map(r=>this.ingest(r))}ingest(t){let r=Nr.getInstance();r.beginTransaction();let s=this._ingest(t);return r.commitTransaction(),s}_ingest(t){if(!t)return;let r,s=this.collections.get(t.collectionName);if(s?r=s.ingest(t):this.error("No collection found for record",t),qv(r)){let n=r.aggregate_root;if(n){let a=t.id,i=this.relationships.get(n.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(n.join(":"),i)}}if(Wv(r)){let n=r.acl;if(n){let a=t.id,i=this.relationships.get(n.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(n.join(":"),i)}}if(t.expand)for(let[,n]of Object.entries(t.expand))Array.isArray(n)?this.ingestBatch(n):this.ingest(n);return r}delete(t){this.cascade(t.collectionName,t.id)}graphviz(){let t=`digraph G {
`;for(let[r,s]of this.collections)for(let n of s.items()){if(!Sm(n)){this.warn("record has no id",n);continue}let a=r+"_"+n.id;if(cM(n)&&(a=r+"_"+n.name),t+=`  ${r}_${n.id} [label="${a}"];
`,Sm(n)&&qv(n)&&n.aggregate_root){let[i,l]=n.aggregate_root;t+=`  ${r}_${n.id} -> ${i}_${l};
`}if(Sm(n)&&Wv(n)&&n.acl){let[i,l]=n.acl;t+=`  ${r}_${n.id} -> ${i}_${l} [style=dotted];
`}}return t+="}",t}cascade(t,r){let s=this.collections.get(t),n=this.relationships.get([t,r].join(":")),a=Nr.getInstance();a.beginTransaction(),s&&(this.warn("cascade delete parent",t,r),s.delete(r)),this.relationships.delete([t,r].join(":"));for(let i of n||[]){let[l,c]=i.split(":");this.warn("cascade delete child",l,c),this.getCollection(l)&&this.cascade(l,c)}a.commitTransaction()}},Um=class extends Ri{constructor(t,r,s,n){super();this.users=s,this.roles=n,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return t}get aggregate_root(){return["relays",this.relayRole.relay]}get acl(){return["users",this.relayRole.user]}},$m=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get enabled(){return this.relayInvitation.enabled}get aggregate_root(){return["relays",this.relayInvitation.relay]}},Bm=class extends ft{constructor(t,r,s){super();this.subscription=t;this.relays=r;this.users=s}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get acl(){return["users",this.subscription.user]}},Qc=class extends ft{constructor(t,r,s,n,a,i,l,c){super();this.relay=t;this.relayRoles=r;this.relayInvitations=s;this.remoteFolders=n;this._subscriptions=a;this.storageQuotas=i;this.providers=l;this.user=c}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get userLimit(){return this.relay.user_limit}get role(){var s;let t=this.relay.creator===this.user.id,r=(s=this.relayRoles.find(n=>n.relayId===this.relay.id&&n.userId===this.user.id))==null?void 0:s.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get storageQuota(){return this.storageQuotas.find(t=>t.id===this.relay.storage_quota)}get folders(){return this.remoteFolders.filter(t=>t.relay.id===this.id)}get subscriptions(){return this._subscriptions.filter(t=>t.relay.id===this.id)}get acl(){var r;let t=(r=this.relayRoles.find(s=>s.relayId===this.id&&s.userId===this.user.id))==null?void 0:r.id;if(t)return["relay_roles",t]}get provider(){if(this.relay.provider)return this.providers.get(this.relay.provider)}get providerId(){return this.relay.provider}},Xc=class extends Dt{constructor(t){super();this.loginManager=t;this.destroyed=!1;this.pb=this.loginManager.pb,this.users=new fr("users"),this.relays=new fr("relays"),this.providers=new fr("providers"),this.remoteFolders=new fr("remote folders"),this.relayInvitations=new fr("relay invitations"),this.relayRoles=new fr("relay roles"),this.roles=new fr("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new fr("subscriptions"),this.storageQuotas=new fr("storage quotas"),this._offLoginManager=this.loginManager.on(()=>{this.login()}),this.setUser(),this.user&&(Bt.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user)return;if(!this.pb){console.warn("no pb!");return}if(this.store)return;let t=new km(this.roles),r=new Em(this.users),s=new Tm(this.providers),n=new Fm(this.relays,this.roles,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user),a=new Am(this.relayRoles,this.relays,this.users,this.roles),i=new Mm(this.relayInvitations,this.relays,this.roles),l=new Dm(this.remoteFolders,this.relays,this.users),c=new Rm(this.subscriptions,this.relays,this.users),u=new Im(this.storageQuotas,this.relays);this.store=new Om([t,r,n,a,i,l,c,u,s])}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new Jc(this.authUser),this.users.set(this.user.id,this.user))}login(){this.setUser(),this.buildGraph(),this.subscribe(),this.update()}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async rotateKey(t){if(!this.pb)throw new Error("missing pocketbase");return this.pb.send("/api/rotate-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then(r=>{var n;let s=(n=this.store)==null?void 0:n.ingest(r);if(!s)throw new Error("unable to rotate key");return s})}async toggleRelayInvitation(t,r){if(!this.pb)throw new Error("missing pocketbase");return this.pb.collection("relay_invitations").update(t.id,{enabled:r}).then(s=>{var a;let n=(a=this.store)==null?void 0:a.ingest(s);if(!n)throw new Error("unable to toggle invitation enable");return n})}async getRelayInvitation(t){if(!this.pb)return;let r=this.relayInvitations.find(s=>s.relay.id===t.id);return r||this.pb.collection("relay_invitations").getList(0,200).then(s=>{s.items.forEach(a=>{var i;(i=this.store)==null||i.ingest(a)});let n=this.relayInvitations.find(a=>a.relay.id===t.id);if(n)return n})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,s=await this.pb.send(r,{method:"POST"});if(s!==200)throw new Error("Token API failed");return s.json().token}async subscribe(){var s;if(!this.pb||!this.pb.authStore.isValid||((s=this.pb.authStore.model)==null?void 0:s.id)===void 0)return;let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","subscriptions_via_relay.relay.storage_quota","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"providers",expand:[]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"subscriptions",expand:["user","relay"]}],r=(n,a)=>{var i,l;this.debug(`[Event]: ${n}`,a.action,a.record),a.action==="delete"?(i=this.store)==null||i.delete(a.record):(l=this.store)==null||l.ingest(a.record)};for(let n of t)this.pb.collection(n.name).subscribe("*",a=>r(n.name,a),{expand:n.expand.join(","),fetch:Et})}async update(){let t=(s,n={})=>{var a;return!this.pb||!this.pb.authStore.isValid||((a=this.pb.authStore.model)==null?void 0:a.id)===void 0?Promise.resolve([]):(typeof n=="function"&&(n=n(this.pb.authStore.model.id)),this.pb.collection(s).getFullList(n))};[t("users",s=>({filter:`id="${s}"`,expand:["relay_roles_via_user","relay_roles_via_user.relay","relay_roles_via_user.relay.storage_quota","relay_roles_via_user.role"].join(",")})),t("relay_roles",{expand:"user"}),t("providers"),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("subscriptions",{expand:"relay,user"})].forEach(async s=>{let n=await s;for(let a of n)!this.destroyed&&this.store&&this.store.ingest(a)})}async acceptInvitation(t){var n;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})}).catch(a=>{throw a});this.debug("[InviteAccept]",r);let s=(n=this.store)==null?void 0:n.ingest(r);if(!s)throw new Error("Failed to accept invitation");return s}async createRelay(t){var a;let r=na(),s=await((a=this.pb)==null?void 0:a.collection("relays").create({guid:r,name:t,path:null},{expand:"relay_roles_via_relay,relay_invitations_via_relay,storage_quota"}));if(!s)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let n=new Qc(s,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user);return this.relays.set(n.id,n),n}async updateRelay(t){var n;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),s=(n=this.store)==null?void 0:n.ingest(r);if(!s)throw new Error("Failed to update relay");return s}async deleteRemote(t){var s;t.remote=void 0;let r=this.remoteFolders.find(n=>n.guid===t.guid);return r?(await((s=this.pb)==null?void 0:s.collection("shared_folders").delete(r.id)),t.remote=void 0,!0):!1}async createRemoteFolder(t,r){var a,i;if(!this.pb)throw new Error("Failed to create folder");let s=await this.pb.collection("shared_folders").create({name:t.name,guid:t.guid,relay:r.id,creator:(a=this.user)==null?void 0:a.id,private:!1},{expand:"relay"}),n=(i=this.store)==null?void 0:i.ingest(s);if(!n)throw new Error("Failed to create folder");return n}async destroyRelay(t){var r,s;return(r=this.store)==null||r.cascade("relays",t.id),await((s=this.pb)==null?void 0:s.collection("relays").delete(t.id)),!0}async leaveRelay(t){var s,n;let r=this.relayRoles.find(a=>{var i;return a.userId===((i=this.user)==null?void 0:i.id)&&a.relayId===t.id});r?await((s=this.pb)==null?void 0:s.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(n=this.store)==null||n.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}destroy(){var t,r,s;this.destroyed=!0,(t=this._offLoginManager)==null||t.call(this),this._offLoginManager=null,(r=this.pb)==null||r.cancelAllRequests(),this.loginManager=null,(s=this.store)==null||s.destroy(),this.pb=null,this.authUser=null,this.store=null}};var b_=require("obsidian");var Yv=require("obsidian");var Gv=require("obsidian");function fM(o){De(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function zv(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function Kv(o){let e,t,r,s=o[8]+"",n,a,i,l,c=o[8]+"",u,d,m,g,h,_,w,v,A,O,M,E;function R(){return o[6](o[8])}function D(){return o[7](o[8])}return{c(){e=P("div"),t=P("div"),r=P("div"),n=K(s),a=U(),i=P("div"),l=K("Toggle "),u=K(c),d=K(" on or off"),m=U(),g=P("div"),h=P("div"),_=P("input"),v=U(),A=P("div"),x(r,"class","setting-item-name"),x(i,"class","setting-item-description"),x(t,"class","setting-item-info"),x(_,"type","checkbox"),x(_,"tabindex","-1"),_.checked=w=o[9],x(A,"class","checkbox-toggle"),x(h,"role","checkbox"),x(h,"aria-checked",O=o[9]),x(h,"tabindex","0"),x(h,"class","checkbox-container svelte-4kkvmr"),Ne(h,"is-enabled",o[9]),x(g,"class","setting-item-control"),x(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(F,V){I(F,e,V),k(e,t),k(t,r),k(r,n),k(t,a),k(t,i),k(i,l),k(i,u),k(i,d),k(e,m),k(e,g),k(g,h),k(h,_),k(h,v),k(h,A),M||(E=[te(h,"keypress",R),te(h,"click",D)],M=!0)},p(F,V){o=F,V&2&&s!==(s=o[8]+"")&&ne(n,s),V&2&&c!==(c=o[8]+"")&&ne(u,c),V&2&&w!==(w=o[9])&&(_.checked=w),V&2&&O!==(O=o[9])&&x(h,"aria-checked",O),V&2&&Ne(h,"is-enabled",o[9])},d(F){F&&C(e),M=!1,Ce(E)}}}function uM(o){let e,t,r,s,n,a,i,l,c,u=Ae(Object.entries(o[1])),d=[];for(let m=0;m<u.length;m+=1)d[m]=Kv(zv(o,u,m));return{c(){e=P("div"),t=P("h2"),t.textContent="Feature Flags",r=U();for(let m=0;m<d.length;m+=1)d[m].c();s=U(),n=P("div"),a=P("div"),i=P("button"),i.textContent="Apply",x(i,"aria-label","apply flag settings"),x(i,"tabindex","0"),x(a,"class","setting-item-control"),x(n,"class","setting-item"),x(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(m,g){I(m,e,g),k(e,t),k(e,r);for(let h=0;h<d.length;h+=1)d[h]&&d[h].m(e,null);k(e,s),k(e,n),k(n,a),k(a,i),l||(c=[te(i,"click",function(){ht(o[0])&&o[0].apply(this,arguments)}),te(i,"keypress",function(){ht(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(m,[g]){if(o=m,g&26){u=Ae(Object.entries(o[1]));let h;for(h=0;h<u.length;h+=1){let _=zv(o,u,h);d[h]?d[h].p(_,g):(d[h]=Kv(_),d[h].c(),d[h].m(e,s))}for(;h<d.length;h+=1)d[h].d(1);d.length=u.length}},i:J,o:J,d(m){m&&C(e),nt(d,m),l=!1,Ce(c)}}}function dM(o,e,t){let r,s,{reload:n}=e,a=Nt.getInstance();ge(o,a,d=>t(5,s=d));function i(d){let m=!r[d];t(1,r[d]=m,r),a.setFlag(d,r[d])}function l(d){return d in r}cr(()=>{Object.keys(r).forEach(d=>{let m=document.getElementById(`toggle-${d}`);m&&(0,Gv.setIcon)(m,"check")})});let c=d=>{if(!l(d))throw new Error("Unexpected feature flag!");i(d)},u=d=>{if(!l(d))throw new Error("Unexpected feature flag!");i(d)};return o.$$set=d=>{"reload"in d&&t(0,n=d.reload)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(1,r=Object.assign({},s.flags))}},[n,r,a,i,l,s,c,u]}var Nm=class extends ee{constructor(e){super(),re(this,e,dM,uM,Z,{reload:0},fM)}},jv=Nm;var Zc=class extends Yv.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new jv({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var nw=require("obsidian");var ow=require("obsidian");function Jv(o,e,t){let r=o.slice();return r[13]=e[t],r}function Qv(o,e,t){let r=o.slice();return r[16]=e[t],r}function pM(o){let e,t,r;return{c(){e=P("button"),e.textContent="Refresh"},m(s,n){I(s,e,n),t||(r=te(e,"click",(0,ow.debounce)(o[12])),t=!0)},p:J,d(s){s&&C(e),t=!1,r()}}}function mM(o){let e=navigator.userAgent+"",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p:J,d(r){r&&C(t)}}}function hM(o){let e;return{c(){e=K(o[1])},m(t,r){I(t,e,r)},p(t,r){r&2&&ne(e,t[1])},d(t){t&&C(e)}}}function gM(o){let e;return{c(){e=K(o[2])},m(t,r){I(t,e,r)},p(t,r){r&4&&ne(e,t[2])},d(t){t&&C(e)}}}function yM(o){let e;return{c(){e=K(o[3])},m(t,r){I(t,e,r)},p(t,r){r&8&&ne(e,t[3])},d(t){t&&C(e)}}}function xM(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=K(e)},m(r,s){I(r,t,s)},p(r,s){s&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&ne(t,e)},d(r){r&&C(t)}}}function Xv(o){let e,t=`${o[16]}`,r,s;return{c(){e=P("div"),r=K(t),s=U()},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&16&&t!==(t=`${n[16]}`)&&ne(r,t)},d(n){n&&C(e)}}}function bM(o){let e,t=Ae(Object.keys(o[4].cancelControllers)),r=[];for(let s=0;s<t.length;s+=1)r[s]=Xv(Qv(o,t,s));return{c(){e=P("div");for(let s=0;s<r.length;s+=1)r[s].c();x(e,"slot","description")},m(s,n){I(s,e,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,n){if(n&16){t=Ae(Object.keys(s[4].cancelControllers));let a;for(a=0;a<t.length;a+=1){let i=Qv(s,t,a);r[a]?r[a].p(i,n):(r[a]=Xv(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&C(e),nt(r,s)}}}function Zv(o){let e,t=`${o[13]}`,r,s;return{c(){e=P("div"),r=K(t),s=U()},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&32&&t!==(t=`${n[13]}`)&&ne(r,t)},d(n){n&&C(e)}}}function vM(o){let e,t=Ae(o[5]),r=[];for(let s=0;s<t.length;s+=1)r[s]=Zv(Jv(o,t,s));return{c(){e=P("div");for(let s=0;s<r.length;s+=1)r[s].c();x(e,"slot","description")},m(s,n){I(s,e,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,n){if(n&32){t=Ae(s[5]);let a;for(a=0;a<t.length;a+=1){let i=Jv(s,t,a);r[a]?r[a].p(i,n):(r[a]=Zv(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&C(e),nt(r,s)}}}function wM(o){let e,t,r,s,n,a,i,l,c,u,d,m,g,h,_,w,v,A,O,M,E,R,D;return s=new Ge({props:{name:"Environment",$$slots:{default:[pM]},$$scope:{ctx:o}}}),a=new Be({props:{name:"User Agent",description:"",$$slots:{default:[mM]},$$scope:{ctx:o}}}),l=new Be({props:{name:"Fetch",description:"",$$slots:{default:[hM]},$$scope:{ctx:o}}}),u=new Be({props:{name:"Response",description:"",$$slots:{default:[gM]},$$scope:{ctx:o}}}),m=new Be({props:{name:"Blink Fetch",description:"",$$slots:{default:[yM]},$$scope:{ctx:o}}}),h=new Be({props:{name:"Startup Time",description:"",$$slots:{default:[xM]},$$scope:{ctx:o}}}),w=new Ge({props:{name:"Connections"}}),A=new Be({props:{name:"",description:"",$$slots:{description:[bM]},$$scope:{ctx:o}}}),M=new Ge({props:{name:"Log Files"}}),R=new Be({props:{name:"",description:"",$$slots:{description:[vM]},$$scope:{ctx:o}}}),{c(){e=P("div"),e.textContent="Debug Info",t=U(),r=P("div"),H(s.$$.fragment),n=U(),H(a.$$.fragment),i=U(),H(l.$$.fragment),c=U(),H(u.$$.fragment),d=U(),H(m.$$.fragment),g=U(),H(h.$$.fragment),_=U(),H(w.$$.fragment),v=U(),H(A.$$.fragment),O=U(),H(M.$$.fragment),E=U(),H(R.$$.fragment),x(e,"class","modal-title"),x(r,"class","modal-content")},m(F,V){I(F,e,V),I(F,t,V),I(F,r,V),B(s,r,null),k(r,n),B(a,r,null),k(r,i),B(l,r,null),k(r,c),B(u,r,null),k(r,d),B(m,r,null),k(r,g),B(h,r,null),k(r,_),B(w,r,null),k(r,v),B(A,r,null),k(r,O),B(M,r,null),k(r,E),B(R,r,null),D=!0},p(F,[V]){let q={};V&524288&&(q.$$scope={dirty:V,ctx:F}),s.$set(q);let j={};V&524288&&(j.$$scope={dirty:V,ctx:F}),a.$set(j);let z={};V&524290&&(z.$$scope={dirty:V,ctx:F}),l.$set(z);let Y={};V&524292&&(Y.$$scope={dirty:V,ctx:F}),u.$set(Y);let he={};V&524296&&(he.$$scope={dirty:V,ctx:F}),m.$set(he);let Fe={};V&524289&&(Fe.$$scope={dirty:V,ctx:F}),h.$set(Fe);let G={};V&524304&&(G.$$scope={dirty:V,ctx:F}),A.$set(G);let oe={};V&524320&&(oe.$$scope={dirty:V,ctx:F}),R.$set(oe)},i(F){D||(S(s.$$.fragment,F),S(a.$$.fragment,F),S(l.$$.fragment,F),S(u.$$.fragment,F),S(m.$$.fragment,F),S(h.$$.fragment,F),S(w.$$.fragment,F),S(A.$$.fragment,F),S(M.$$.fragment,F),S(R.$$.fragment,F),D=!0)},o(F){T(s.$$.fragment,F),T(a.$$.fragment,F),T(l.$$.fragment,F),T(u.$$.fragment,F),T(m.$$.fragment,F),T(h.$$.fragment,F),T(w.$$.fragment,F),T(A.$$.fragment,F),T(M.$$.fragment,F),T(R.$$.fragment,F),D=!1},d(F){F&&(C(e),C(t),C(r)),N(s),N(a),N(l),N(u),N(m),N(h),N(w),N(A),N(M),N(R)}}}function ew(){try{return Response.toString()}catch(o){return"undefined"}}function tw(){try{return fetch.toString()}catch(o){return"undefined"}}function rw(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function _M(o,e,t){let r,s,n,a,i,{plugin:l}=e,c=_e(ew());ge(o,c,w=>t(2,s=w));let u=_e(tw());ge(o,u,w=>t(1,r=w));let d=_e(rw());ge(o,d,w=>t(3,n=w));let m=_e(l.loginManager.pb);ge(o,m,w=>t(4,a=w));let g=_e([]);ge(o,g,w=>t(5,i=w)),$l().then(w=>{g.set(w)});function h(){c.set(ew()),u.set(tw()),d.set(rw()),m.set(l.loginManager.pb)}let _=()=>{h()};return o.$$set=w=>{"plugin"in w&&t(0,l=w.plugin)},[l,r,s,n,a,i,c,u,d,m,g,h,_]}var Hm=class extends ee{constructor(e){super(),re(this,e,_M,wM,Z,{plugin:0})}},sw=Hm;var ef=class extends nw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new sw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var aw=require("obsidian"),tf=class{notify(e){new aw.Notice(e)}},rf=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var hw=require("obsidian");var pw=require("obsidian");function SM(o){De(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function iw(o,e,t){let r=o.slice();return r[21]=e[t],r}function kM(o){let e,t,r,s,n,a,i,l,c,u,d,m,g;r=new Be({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),i=new Be({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[LM]},$$scope:{ctx:o}}});let h=o[4]&&lw(o);return u=new Be({props:{name:"",description:"",$$slots:{default:[PM]},$$scope:{ctx:o}}}),{c(){e=P("div"),t=P("div"),H(r.$$.fragment),s=U(),n=P("textarea"),a=U(),H(i.$$.fragment),l=U(),h&&h.c(),c=U(),H(u.$$.fragment),x(n,"placeholder","Describe the issue here..."),x(n,"class","svelte-jmqfac"),x(t,"class","form-content svelte-jmqfac"),x(e,"class","report-container svelte-jmqfac")},m(_,w){I(_,e,w),k(e,t),B(r,t,null),k(t,s),k(t,n),lr(n,o[3]),k(t,a),B(i,t,null),k(t,l),h&&h.m(t,null),k(e,c),B(u,e,null),d=!0,m||(g=te(n,"input",o[13]),m=!0)},p(_,w){w&8&&lr(n,_[3]);let v={};w&16777232&&(v.$$scope={dirty:w,ctx:_}),i.$set(v),_[4]?h?(h.p(_,w),w&16&&S(h,1)):(h=lw(_),h.c(),S(h,1),h.m(t,null)):h&&(pe(),T(h,1,1,()=>{h=null}),me());let A={};w&16777293&&(A.$$scope={dirty:w,ctx:_}),u.$set(A)},i(_){d||(S(r.$$.fragment,_),S(i.$$.fragment,_),S(h),S(u.$$.fragment,_),d=!0)},o(_){T(r.$$.fragment,_),T(i.$$.fragment,_),T(h),T(u.$$.fragment,_),d=!1},d(_){_&&C(e),N(r),N(i),h&&h.d(),N(u),m=!1,g()}}}function CM(o){let e;return{c(){e=P("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',x(e,"class","centered-message svelte-jmqfac")},m(t,r){I(t,e,r)},p:J,i:J,o:J,d(t){t&&C(e)}}}function IM(o){let e,t,r;return t=new Be({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=P("div"),H(t.$$.fragment),x(e,"class","centered-message svelte-jmqfac")},m(s,n){I(s,e,n),B(t,e,null),r=!0},p:J,i(s){r||(S(t.$$.fragment,s),r=!0)},o(s){T(t.$$.fragment,s),r=!1},d(s){s&&C(e),N(t)}}}function LM(o){let e,t,r,s,n,a;return{c(){e=P("div"),t=P("input"),r=U(),s=P("div"),x(t,"type","checkbox"),x(t,"tabindex","-1"),t.checked=o[4],x(s,"class","checkbox-toggle"),x(e,"role","checkbox"),x(e,"aria-checked",o[4]),x(e,"tabindex","0"),x(e,"class","checkbox-container"),Ne(e,"is-enabled",o[4])},m(i,l){I(i,e,l),k(e,t),k(e,r),k(e,s),n||(a=[te(e,"keypress",FM),te(e,"click",o[14])],n=!0)},p(i,l){l&16&&(t.checked=i[4]),l&16&&x(e,"aria-checked",i[4]),l&16&&Ne(e,"is-enabled",i[4])},d(i){i&&C(e),n=!1,Ce(a)}}}function lw(o){let e,t;return e=new Be({props:{name:"Logs",description:"",$$slots:{description:[TM]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&16777248&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function cw(o){let e,t=`${o[21]}
`,r,s;return{c(){e=P("div"),r=K(t),s=U()},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&32&&t!==(t=`${n[21]}
`)&&ne(r,t)},d(n){n&&C(e)}}}function TM(o){let e,t=Ae(o[5]),r=[];for(let s=0;s<t.length;s+=1)r[s]=cw(iw(o,t,s));return{c(){e=P("div");for(let s=0;s<r.length;s+=1)r[s].c();x(e,"slot","description")},m(s,n){I(s,e,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,n){if(n&32){t=Ae(s[5]);let a;for(a=0;a<t.length;a+=1){let i=iw(s,t,a);r[a]?r[a].p(i,n):(r[a]=cw(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&C(e),nt(r,s)}}}function PM(o){let e,t,r,s;return{c(){e=P("button"),t=K("Send"),e.disabled=o[2]},m(n,a){I(n,e,a),k(e,t),r||(s=te(e,"click",o[15]),r=!0)},p(n,a){a&4&&(e.disabled=n[2])},d(n){n&&C(e),r=!1,s()}}}function DM(o){let e,t,r,s,n,a,i=[IM,CM,kM],l=[];function c(u,d){return u[1]?0:u[2]&&!u[1]?1:2}return s=c(o,-1),n=l[s]=i[s](o),{c(){e=P("div"),e.textContent="Send Bug Report",t=U(),r=P("div"),n.c(),x(e,"class","modal-title"),x(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(u,d){I(u,e,d),I(u,t,d),I(u,r,d),l[s].m(r,null),a=!0},p(u,[d]){let m=s;s=c(u,d),s===m?l[s].p(u,d):(pe(),T(l[m],1,1,()=>{l[m]=null}),me(),n=l[s],n?n.p(u,d):(n=l[s]=i[s](u),n.c()),S(n,1),n.m(r,null))},i(u){a||(S(n),a=!0)},o(u){T(n),a=!1},d(u){u&&(C(e),C(t),C(r)),l[s].d()}}}function fw(){try{return Response.toString()}catch(o){return"undefined"}}function uw(){try{return fetch.toString()}catch(o){return"undefined"}}function dw(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var FM=()=>{};function AM(o,e,t){let r,s,n,a,i,l,{plugin:c}=e,u=_e(fw()),d=_e(uw()),m=_e(dw()),g=_e("");ge(o,g,F=>t(3,n=F));let h=_e(!1);ge(o,h,F=>t(4,a=F));let _=_e(!1),w=_e(!1);ge(o,w,F=>t(2,s=F));let v=_e(!1);ge(o,v,F=>t(1,r=F));let A=_e(c.loginManager.pb);ge(o,A,F=>t(6,l=F));let O=_e([]);ge(o,O,F=>t(5,i=F)),$l().then(F=>{O.set(F)});function M(){u.set(fw()),d.set(uw()),m.set(dw()),A.set(c.loginManager.pb)}function E(){n=this.value,g.set(n)}let R=()=>{let F=!a;h.set(F)},D=async()=>{var V;let F=`Bug Report

`;if(F+=JSON.stringify({userAgent:navigator.userAgent,manifest:c.manifest,user:(V=l==null?void 0:l.authStore.model)==null?void 0:V.id,loadTime:c.loadTime,description:n},null,2),F+=`

`,h){let q=await Qy();F+=q}(0,pw.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:F,headers:{"Content-Type":"text/plain"}}).then(()=>{v.set(!0)}),w.set(!0)};return o.$$set=F=>{"plugin"in F&&t(0,c=F.plugin)},[c,r,s,n,a,i,l,g,h,w,v,A,O,E,R,D]}var Vm=class extends ee{constructor(e){super(),re(this,e,AM,DM,Z,{plugin:0},SM)}},mw=Vm;var of=class extends hw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new mw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var kw=require("obsidian");async function gw(o){let{appId:e,filterByAppId:t,onProgress:r}=o,s=await window.indexedDB.databases(),n=s.length,a=[],i=0,l=0,c=0,u=0;for(let d of s)if(d.name){try{let m=await new Promise((g,h)=>{let _=indexedDB.open(d.name);_.onerror=()=>h(_.error),_.onsuccess=w=>g(w.target.result)});try{let g=Array.from(m.objectStoreNames);if(!g.includes("updates")||!g.includes("custom"))continue;let h=m.transaction(["updates","custom"],"readonly"),_=h.objectStore("updates"),w=h.objectStore("custom"),v=await new Promise(O=>{let M=w.get("appId");M.onsuccess=()=>O(M.result||"")});i++;let A=await new Promise((O,M)=>{let E=_.count();E.onsuccess=()=>O(E.result),E.onerror=()=>M(E.error)});if(l+=A,A>0){let O=0;if(await new Promise((M,E)=>{let R=_.openCursor();R.onsuccess=D=>{let F=D.target.result;if(F){let V=F.value instanceof Uint8Array?F.value.byteLength:JSON.stringify(F.value).length;O+=V,F.continue()}else M()},R.onerror=()=>E(R.error)}),c+=O,O>1024*1024&&(!t||v===e)){let M=await new Promise(D=>{let F=w.get("path");F.onsuccess=()=>D(F.result||"")}),E=await new Promise(D=>{let F=w.get("relay");F.onsuccess=()=>D(F.result||"")}),R=!d.name.startsWith(`${e}-relay`);a.push({slug:`${d.name}/${_.name}`,path:M,relay:E,appId:v||"unknown",count:A,estimatedSizeMB:Math.round(O/(1024*1024)*100)/100,isLegacy:R})}}}finally{m.close()}}catch(m){console.error(`Error processing database ${d.name}:`,m);continue}u++,r&&r(u/s.length*100)}return{totalStores:i,totalItems:l,totalSizeMB:Math.round(c/(1024*1024)*100)/100,databaseCount:n,largeStores:a.sort((d,m)=>m.estimatedSizeMB-d.estimatedSizeMB)}}async function yw(o){let[e,t]=o.split("/"),r=await new Promise((s,n)=>{let a=indexedDB.open(e);a.onerror=()=>n(a.error),a.onsuccess=()=>s(a.result)});try{let n=r.transaction(t,"readwrite").objectStore(t);await new Promise((a,i)=>{let l=n.clear();l.onsuccess=()=>a(),l.onerror=()=>i(l.error)})}catch(s){console.error(`Error deleting store: ${o}`,s)}finally{r.close()}}var jY=require("obsidian");function MM(o){De(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function xw(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function bw(o,e,t){let r=o.slice();return r[22]=e[t],r}function EM(o){let e,t,r,s,n,a=o[0].databaseCount.toLocaleString()+"",i,l,c,u,d,m,g,h,_=o[0].totalStores+"",w,v,A,O,M,E,R=o[0].totalItems.toLocaleString()+"",D,F,V,q,j,z,Y=o[0].totalSizeMB.toFixed(2)+"",he,Fe,G,oe,Se;function je(W,Le){if(W[0].databaseCount>45e3)return $M;if(W[0].databaseCount>4e4)return UM}let Oe=je(o,-1),ce=Oe&&Oe(o),le=o[0].largeStores.length>0&&vw(o);return{c(){e=P("div"),t=P("div"),r=P("div"),r.textContent="Global Database Limit",s=U(),n=P("div"),i=K(a),l=K(" / 50,000"),c=U(),ce&&ce.c(),u=U(),d=P("div"),m=P("div"),m.textContent="Relay Databases",g=U(),h=P("div"),w=K(_),v=U(),A=P("div"),O=P("div"),O.textContent="Document Updates",M=U(),E=P("div"),D=K(R),F=U(),V=P("div"),q=P("div"),q.textContent="Total Size",j=U(),z=P("div"),he=K(Y),Fe=K(" MB"),G=U(),le&&le.c(),oe=Ie(),x(r,"class","system3-stat-label svelte-1n3w4sk"),x(n,"class","system3-stat-value svelte-1n3w4sk"),Ne(n,"system3-warning",o[0].databaseCount>4e4),Ne(n,"system3-critical",o[0].databaseCount>45e3),x(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),x(m,"class","system3-stat-label svelte-1n3w4sk"),x(h,"class","system3-stat-value svelte-1n3w4sk"),x(d,"class","system3-stat-item svelte-1n3w4sk"),x(O,"class","system3-stat-label svelte-1n3w4sk"),x(E,"class","system3-stat-value svelte-1n3w4sk"),x(A,"class","system3-stat-item svelte-1n3w4sk"),x(q,"class","system3-stat-label svelte-1n3w4sk"),x(z,"class","system3-stat-value svelte-1n3w4sk"),x(V,"class","system3-stat-item svelte-1n3w4sk"),x(e,"class","system3-summary-stats svelte-1n3w4sk")},m(W,Le){I(W,e,Le),k(e,t),k(t,r),k(t,s),k(t,n),k(n,i),k(n,l),k(t,c),ce&&ce.m(t,null),k(e,u),k(e,d),k(d,m),k(d,g),k(d,h),k(h,w),k(e,v),k(e,A),k(A,O),k(A,M),k(A,E),k(E,D),k(e,F),k(e,V),k(V,q),k(V,j),k(V,z),k(z,he),k(z,Fe),I(W,G,Le),le&&le.m(W,Le),I(W,oe,Le),Se=!0},p(W,Le){(!Se||Le&1)&&a!==(a=W[0].databaseCount.toLocaleString()+"")&&ne(i,a),(!Se||Le&1)&&Ne(n,"system3-warning",W[0].databaseCount>4e4),(!Se||Le&1)&&Ne(n,"system3-critical",W[0].databaseCount>45e3),Oe!==(Oe=je(W,Le))&&(ce&&ce.d(1),ce=Oe&&Oe(W),ce&&(ce.c(),ce.m(t,null))),(!Se||Le&1)&&_!==(_=W[0].totalStores+"")&&ne(w,_),(!Se||Le&1)&&R!==(R=W[0].totalItems.toLocaleString()+"")&&ne(D,R),(!Se||Le&1)&&Y!==(Y=W[0].totalSizeMB.toFixed(2)+"")&&ne(he,Y),W[0].largeStores.length>0?le?(le.p(W,Le),Le&1&&S(le,1)):(le=vw(W),le.c(),S(le,1),le.m(oe.parentNode,oe)):le&&(pe(),T(le,1,1,()=>{le=null}),me())},i(W){Se||(S(le),Se=!0)},o(W){T(le),Se=!1},d(W){W&&(C(e),C(G),C(oe)),ce&&ce.d(),le&&le.d(W)}}}function RM(o){let e,t;return{c(){e=P("div"),t=K(o[5]),x(e,"class","system3-error-message svelte-1n3w4sk")},m(r,s){I(r,e,s),k(e,t)},p(r,s){s&32&&ne(t,r[5])},i:J,o:J,d(r){r&&C(e)}}}function OM(o){let e,t,r,s,n,a,i;return{c(){e=P("div"),t=P("div"),r=U(),s=P("div"),s.textContent="Analyzing Databases...",n=U(),a=P("div"),i=P("div"),x(t,"class","system3-loading-spinner svelte-1n3w4sk"),x(s,"class","loading-text"),x(i,"class","system3-progress-fill svelte-1n3w4sk"),de(i,"width",o[4]+"%"),x(a,"class","system3-progress-bar svelte-1n3w4sk"),x(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,c){I(l,e,c),k(e,t),k(e,r),k(e,s),k(e,n),k(e,a),k(a,i)},p(l,c){c&16&&de(i,"width",l[4]+"%")},i:J,o:J,d(l){l&&C(e)}}}function UM(o){let e;return{c(){e=P("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,x(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function $M(o){let e;return{c(){e=P("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,x(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function vw(o){let e,t,r,s;e=new Ge({props:{name:"Large Stores (>1MB)"}});let n=Ae(o[2]),a=[];for(let l=0;l<n.length;l+=1)a[l]=_w(xw(o,n,l));let i=l=>T(a[l],1,1,()=>{a[l]=null});return{c(){H(e.$$.fragment),t=U();for(let l=0;l<a.length;l+=1)a[l].c();r=Ie()},m(l,c){B(e,l,c),I(l,t,c);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,c);I(l,r,c),s=!0},p(l,c){if(c&2052){n=Ae(l[2]);let u;for(u=0;u<n.length;u+=1){let d=xw(l,n,u);a[u]?(a[u].p(d,c),S(a[u],1)):(a[u]=_w(d),a[u].c(),S(a[u],1),a[u].m(r.parentNode,r))}for(pe(),u=n.length;u<a.length;u+=1)i(u);me()}},i(l){if(!s){S(e.$$.fragment,l);for(let c=0;c<n.length;c+=1)S(a[c]);s=!0}},o(l){T(e.$$.fragment,l),a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)T(a[c]);s=!1},d(l){l&&(C(t),C(r)),N(e,l),nt(a,l)}}}function BM(o){let e,t,r,s,n;function a(){return o[17](o[22])}return{c(){e=P("div"),t=P("button"),t.textContent="Delete",r=U(),x(t,"class","mod-warning"),x(t,"title","Delete all data in this store"),x(e,"class","system3-actions svelte-1n3w4sk")},m(i,l){I(i,e,l),k(e,t),I(i,r,l),s||(n=te(t,"click",a),s=!0)},p(i,l){o=i},d(i){i&&(C(e),C(r)),s=!1,n()}}}function ww(o){let e,t;return e=new Be({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[BM]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&4&&(n.name=r[22].path||r[22].slug),s&4&&(n.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),s&33554436&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function _w(o){let e,t,r,s;e=new Ge({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let n=Ae(o[19]),a=[];for(let l=0;l<n.length;l+=1)a[l]=ww(bw(o,n,l));let i=l=>T(a[l],1,1,()=>{a[l]=null});return{c(){H(e.$$.fragment),t=U();for(let l=0;l<a.length;l+=1)a[l].c();r=Ie()},m(l,c){B(e,l,c),I(l,t,c);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,c);I(l,r,c),s=!0},p(l,c){let u={};if(c&4&&(u.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(u),c&2052){n=Ae(l[19]);let d;for(d=0;d<n.length;d+=1){let m=bw(l,n,d);a[d]?(a[d].p(m,c),S(a[d],1)):(a[d]=ww(m),a[d].c(),S(a[d],1),a[d].m(r.parentNode,r))}for(pe(),d=n.length;d<a.length;d+=1)i(d);me()}},i(l){if(!s){S(e.$$.fragment,l);for(let c=0;c<n.length;c+=1)S(a[c]);s=!0}},o(l){T(e.$$.fragment,l),a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)T(a[c]);s=!1},d(l){l&&(C(t),C(r)),N(e,l),nt(a,l)}}}function NM(o){let e,t,r,s,n,a,i,l,c,u,d,m,g,h,_,w,v,A=[OM,RM,EM],O=[];function M(E,R){return E[3]?0:E[5]?1:E[0]?2:-1}return~(g=M(o,-1))&&(h=O[g]=A[g](o)),{c(){e=P("div"),e.textContent="Relay database analysis",t=U(),r=P("div"),s=P("div"),n=P("div"),n.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,a=U(),i=P("div"),l=P("div"),c=P("input"),u=U(),d=P("div"),m=U(),h&&h.c(),x(e,"class","modal-title"),x(n,"class","setting-item-info"),x(c,"type","checkbox"),x(c,"tabindex","-1"),c.checked=o[1],x(d,"class","checkbox-toggle"),x(l,"role","checkbox"),x(l,"aria-checked",o[1]),x(l,"tabindex","0"),x(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),Ne(l,"is-enabled",o[1]),x(i,"class","setting-item-control"),x(s,"class","setting-item"),x(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(E,R){I(E,e,R),I(E,t,R),I(E,r,R),k(r,s),k(s,n),k(s,a),k(s,i),k(i,l),k(l,c),k(l,u),k(l,d),k(r,m),~g&&O[g].m(r,null),_=!0,w||(v=[te(l,"keypress",o[15]),te(l,"click",o[16])],w=!0)},p(E,[R]){(!_||R&2)&&(c.checked=E[1]),(!_||R&2)&&x(l,"aria-checked",E[1]),(!_||R&2)&&Ne(l,"is-enabled",E[1]);let D=g;g=M(E,R),g===D?~g&&O[g].p(E,R):(h&&(pe(),T(O[D],1,1,()=>{O[D]=null}),me()),~g?(h=O[g],h?h.p(E,R):(h=O[g]=A[g](E),h.c()),S(h,1),h.m(r,null)):h=null)},i(E){_||(S(h),_=!0)},o(E){T(h),_=!1},d(E){E&&(C(e),C(t),C(r)),~g&&O[g].d(),w=!1,Ce(v)}}}function HM(o,e,t){let r,s,n,a,i,l;var c;let{plugin:u}=e,d=_e(!0);ge(o,d,E=>t(3,a=E));let m=_e(0);ge(o,m,E=>t(4,i=E));let g=_e(null);ge(o,g,E=>t(0,n=E));let h=_e(null);ge(o,h,E=>t(5,l=E));let _=!1;function w(){return Ke(this,void 0,void 0,function*(){d.set(!0),h.set(null);try{let E=yield gw({appId:u.appId,filterByAppId:!_,onProgress:R=>m.set(R)});g.set(E)}catch(E){h.set(`Analysis failed: ${E.message}`)}finally{d.set(!1)}})}function v(E){return Ke(this,void 0,void 0,function*(){try{yield yw(E),n&&Ix(g,n.largeStores=n.largeStores.filter(R=>R.slug!==E),n)}catch(R){h.set(`Failed to delete ${E}: ${R.message}`)}})}cr(()=>{w()});let A=()=>{t(1,_=!_),w()},O=()=>{t(1,_=!_),w()},M=E=>v(E.slug);return o.$$set=E=>{"plugin"in E&&t(12,u=E.plugin)},o.$$.update=()=>{if(o.$$.dirty&8193){e:t(14,r=t(13,c=n==null?void 0:n.largeStores.reduce((E,R)=>{let D=R.relay||"local";return E[D]||(E[D]=[]),E[D].push(R),E},{}))!==null&&c!==void 0?c:{})}if(o.$$.dirty&16384){e:t(2,s=Object.entries(r).sort(([E],[R])=>E==="local"?-1:R==="local"?1:E.localeCompare(R)))}},[n,_,s,a,i,l,d,m,g,h,w,v,u,c,r,A,O,M]}var qm=class extends ee{constructor(e){super(),re(this,e,HM,NM,Z,{plugin:12},MM)}},Sw=qm;var sf=class extends kw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Sw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Xw=require("obsidian");var{Boolean:Ow}=nn;function VM(o){De(o,"svelte-18bqwhy",".file-name.svelte-18bqwhy{display:flex;align-items:center;gap:6px;font-size:0.9rem;flex:1;min-width:0}.details-container.svelte-18bqwhy{margin-left:auto;text-align:right;padding-left:8px;padding-right:8px}.details.svelte-18bqwhy{font-size:0.75rem;color:var(--text-muted)}.error-message.svelte-18bqwhy{color:var(--text-error);margin-top:2px;text-align:right}.more-files.svelte-18bqwhy{font-size:0.8rem;color:var(--text-muted);text-align:center}button.mod-warning.svelte-18bqwhy{display:flex;align-items:center;gap:4px;background-color:var(--background-modifier-error);color:var(--text-error)}.mod-primary{color:var(--interactive-accent)}.mod-success{color:var(--interactive-success)}.mod-warning{color:var(--text-warning)}.show-more-link.svelte-18bqwhy{color:var(--text-accent);cursor:pointer;font-size:0.8rem}.show-more-link.svelte-18bqwhy:hover{text-decoration:underline}")}function Cw(o,e,t){let r=o.slice();return r[20]=e[t],r}function Iw(o,e,t){let r=o.slice();return r[23]=e[t],r}function qM(o){return{c:J,m:J,p:J,i:J,o:J,d:J}}function WM(o){let e,t,r=Ae(Rw(o[19].documents)),s=[];for(let a=0;a<r.length;a+=1)s[a]=Aw(Cw(o,r,a));let n=a=>T(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=Ie()},m(a,i){for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(a,i);I(a,e,i),t=!0},p(a,i){if(i&8311){r=Ae(Rw(a[19].documents));let l;for(l=0;l<r.length;l+=1){let c=Cw(a,r,l);s[l]?(s[l].p(c,i),S(s[l],1)):(s[l]=Aw(c),s[l].c(),S(s[l],1),s[l].m(e.parentNode,e))}for(pe(),l=r.length;l<s.length;l+=1)n(l);me()}},i(a){if(!t){for(let i=0;i<r.length;i+=1)S(s[i]);t=!0}},o(a){s=s.filter(Ow);for(let i=0;i<s.length;i+=1)T(s[i]);t=!1},d(a){a&&C(e),nt(s,a)}}}function Lw(o){let e,t=Ew(o[23].queueState.timestamp)+"",r;return{c(){e=K("\u2022 "),r=K(t)},m(s,n){I(s,e,n),I(s,r,n)},p(s,n){n&3&&t!==(t=Ew(s[23].queueState.timestamp)+"")&&ne(r,t)},d(s){s&&(C(e),C(r))}}}function Tw(o){let e,t=o[23].queueState.error+"",r;return{c(){e=P("div"),r=K(t),x(e,"class","error-message svelte-18bqwhy")},m(s,n){I(s,e,n),k(e,r)},p(s,n){n&3&&t!==(t=s[23].queueState.error+"")&&ne(r,t)},d(s){s&&C(e)}}}function Pw(o){let e,t,r,s,n,a;t=new Kd({props:{size:14,class:"svg-icon lucide-refresh-cw"}});function i(){return o[10](o[23])}return{c(){e=P("button"),H(t.$$.fragment),r=K(`
							Retry`),x(e,"class","mod-warning svelte-18bqwhy")},m(l,c){I(l,e,c),B(t,e,null),k(e,r),s=!0,n||(a=te(e,"click",i),n=!0)},p(l,c){o=l},i(l){s||(S(t.$$.fragment,l),s=!0)},o(l){T(t.$$.fragment,l),s=!1},d(l){l&&C(e),N(t),n=!1,a()}}}function zM(o){var g,h,_;let e,t,r=o[5](o[23]).text+"",s,n,a,i,l,c,u=((g=o[23].queueState)==null?void 0:g.timestamp)&&Lw(o),d=((h=o[23].queueState)==null?void 0:h.error)&&Tw(o),m=((_=o[23].queueState)==null?void 0:_.status)==="failed"&&Pw(o);return{c(){e=P("div"),t=P("span"),s=K(r),n=U(),u&&u.c(),a=U(),d&&d.c(),i=U(),m&&m.c(),l=Ie(),x(t,"class","details svelte-18bqwhy"),x(e,"class","details-container svelte-18bqwhy")},m(w,v){I(w,e,v),k(e,t),k(t,s),k(t,n),u&&u.m(t,null),k(t,a),d&&d.m(t,null),I(w,i,v),m&&m.m(w,v),I(w,l,v),c=!0},p(w,v){var A,O,M;(!c||v&3)&&r!==(r=w[5](w[23]).text+"")&&ne(s,r),(A=w[23].queueState)!=null&&A.timestamp?u?u.p(w,v):(u=Lw(w),u.c(),u.m(t,a)):u&&(u.d(1),u=null),(O=w[23].queueState)!=null&&O.error?d?d.p(w,v):(d=Tw(w),d.c(),d.m(t,null)):d&&(d.d(1),d=null),((M=w[23].queueState)==null?void 0:M.status)==="failed"?m?(m.p(w,v),v&3&&S(m,1)):(m=Pw(w),m.c(),S(m,1),m.m(l.parentNode,l)):m&&(pe(),T(m,1,1,()=>{m=null}),me())},i(w){c||(S(m),c=!0)},o(w){T(m),c=!1},d(w){w&&(C(e),C(i),C(l)),u&&u.d(),d&&d.d(),m&&m.d(w)}}}function KM(o){let e,t=o[9].default,r=ye(t,o,o[13],null),s=r||zM(o);return{c(){s&&s.c()},m(n,a){s&&s.m(n,a),e=!0},p(n,a){r?r.p&&(!e||a&8192)&&be(r,t,n,n[13],e?xe(t,n[13],a,null):ve(n[13]),null):s&&s.p&&(!e||a&3)&&s.p(n,e?a:-1)},i(n){e||(S(s,n),e=!0)},o(n){T(s,n),e=!1},d(n){s&&s.d(n)}}}function GM(o){let e,t,r,s,n=o[23].path.split("/").pop()+"",a,i;var l=o[5](o[23]).icon;function c(u,d){return{props:{size:16,class:"svg-icon "+u[5](u[23]).iconClass}}}return l&&(t=ca(l,c(o))),{c(){e=P("span"),t&&H(t.$$.fragment),r=U(),s=P("span"),a=K(n),x(e,"slot","name"),x(e,"class","file-name svelte-18bqwhy")},m(u,d){I(u,e,d),t&&B(t,e,null),k(e,r),k(e,s),k(s,a),i=!0},p(u,d){if(d&3&&l!==(l=u[5](u[23]).icon)){if(t){pe();let m=t;T(m.$$.fragment,1,0,()=>{N(m,1)}),me()}l?(t=ca(l,c(u,d)),H(t.$$.fragment),S(t.$$.fragment,1),B(t,e,r)):t=null}else if(l){let m={};d&3&&(m.class="svg-icon "+u[5](u[23]).iconClass),t.$set(m)}(!i||d&3)&&n!==(n=u[23].path.split("/").pop()+"")&&ne(a,n)},i(u){i||(t&&S(t.$$.fragment,u),i=!0)},o(u){t&&T(t.$$.fragment,u),i=!1},d(u){u&&C(e),t&&N(t)}}}function Dw(o){let e,t;return e=new Ft({props:{$$slots:{name:[GM],default:[KM]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&8195&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Fw(o){let e,t;return e=new Ft({props:{$$slots:{name:[jM]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&8195&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function jM(o){let e,t,r=Mw(o[1](o[20]).remainingCount)+"",s,n,a=o[20].title.toLowerCase()+"",i,l,c,u,d,m,g,h;function _(){return o[11](o[20])}function w(...v){return o[12](o[20],...v)}return{c(){var v;e=P("span"),t=K("...and "),s=K(r),n=K(` more
					`),i=K(a),l=U(),c=P("span"),u=K("(show more)"),m=U(),x(c,"class","show-more-link svelte-18bqwhy"),x(c,"role","button"),x(c,"tabindex","0"),x(c,"aria-label",d=`Show ${((v=o[2][o[20].title])==null?void 0:v.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`),x(e,"slot","name"),x(e,"class","more-files svelte-18bqwhy")},m(v,A){I(v,e,A),k(e,t),k(e,s),k(e,n),k(e,i),k(e,l),k(e,c),k(c,u),k(e,m),g||(h=[te(c,"click",_),te(c,"keydown",w)],g=!0)},p(v,A){var O;o=v,A&3&&r!==(r=Mw(o[1](o[20]).remainingCount)+"")&&ne(s,r),A&1&&a!==(a=o[20].title.toLowerCase()+"")&&ne(i,a),A&1&&d!==(d=`Show ${((O=o[2][o[20].title])==null?void 0:O.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`)&&x(c,"aria-label",d)},d(v){v&&C(e),g=!1,Ce(h)}}}function Aw(o){let e,t,r,s=o[1](o[20]).remainingCount>0,n,a;e=new Ge({props:{name:o[20].title}});let i=Ae(o[1](o[20]).visibleDocs),l=[];for(let d=0;d<i.length;d+=1)l[d]=Dw(Iw(o,i,d));let c=d=>T(l[d],1,1,()=>{l[d]=null}),u=s&&Fw(o);return{c(){H(e.$$.fragment),t=U();for(let d=0;d<l.length;d+=1)l[d].c();r=U(),u&&u.c(),n=Ie()},m(d,m){B(e,d,m),I(d,t,m);for(let g=0;g<l.length;g+=1)l[g]&&l[g].m(d,m);I(d,r,m),u&&u.m(d,m),I(d,n,m),a=!0},p(d,m){let g={};if(m&1&&(g.name=d[20].title),e.$set(g),m&8291){i=Ae(d[1](d[20]).visibleDocs);let h;for(h=0;h<i.length;h+=1){let _=Iw(d,i,h);l[h]?(l[h].p(_,m),S(l[h],1)):(l[h]=Dw(_),l[h].c(),S(l[h],1),l[h].m(r.parentNode,r))}for(pe(),h=i.length;h<l.length;h+=1)c(h);me()}m&3&&(s=d[1](d[20]).remainingCount>0),s?u?(u.p(d,m),m&3&&S(u,1)):(u=Fw(d),u.c(),S(u,1),u.m(n.parentNode,n)):u&&(pe(),T(u,1,1,()=>{u=null}),me())},i(d){if(!a){S(e.$$.fragment,d);for(let m=0;m<i.length;m+=1)S(l[m]);S(u),a=!0}},o(d){T(e.$$.fragment,d),l=l.filter(Ow);for(let m=0;m<l.length;m+=1)T(l[m]);T(u),a=!1},d(d){d&&(C(t),C(r),C(n)),N(e,d),nt(l,d),u&&u.d(d)}}}function YM(o){let e;return{c(){e=P("div"),e.textContent="Loading...",x(e,"class","loading")},m(t,r){I(t,e,r)},p:J,i:J,o:J,d(t){t&&C(e)}}}function JM(o){let e,t,r,s={ctx:o,current:null,token:null,hasCatch:!1,pending:YM,then:WM,catch:qM,value:19,blocks:[,,,]};return Qo(t=o[0],s),{c(){e=Ie(),s.block.c()},m(n,a){I(n,e,a),s.block.m(n,s.anchor=a),s.mount=()=>e.parentNode,s.anchor=e,r=!0},p(n,[a]){o=n,s.ctx=o,a&1&&t!==(t=o[0])&&Qo(t,s)||da(s,o,a)},i(n){r||(S(s.block),r=!0)},o(n){for(let a=0;a<3;a+=1){let i=s.blocks[a];T(i)}r=!1},d(n){n&&C(e),s.block.d(n),s.token=null,s=null}}}function Mw(o){return new Intl.NumberFormat().format(o)}function Ew(o){let e=new Date(o),r=new Date().getTime()-e.getTime(),s=Math.floor(r/(1e3*60));if(s<1)return"just now";if(s===1)return"1 minute ago";if(s<60)return`${s} minutes ago`;let n=Math.floor(s/60);if(n===1)return"1 hour ago";if(n<24)return`${n} hours ago`;let a=Math.floor(n/24);return a===1?"yesterday":`${a} days ago`}function Rw(o){let e=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="running"}),t=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="failed"}),r=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="pending"}),s=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="completed"});return[e.length>0&&{title:"Active Files",documents:e},t.length>0&&{title:"Stuck Files",documents:t},r.length>0&&{title:"Queued Files",documents:r},s.length>0&&{title:"Completed Files",documents:s}].filter(Boolean)}function QM(o,e,t){let r,s,n,a,i,{$$slots:l={},$$scope:c}=e,{folder:u}=e,{backgroundSync:d}=e,m={"Active Files":{initialCount:1/0,incrementCount:100},"Stuck Files":{initialCount:1/0,incrementCount:100},"Queued Files":{initialCount:10,incrementCount:100},"Completed Files":{initialCount:5,incrementCount:100},default:{initialCount:1/0,incrementCount:100}},g=_e({}),h=oo(g,R=>D=>{let F=m[D.title]||m.default,V=R[D.title]||F.initialCount,q=D.documents.slice(0,V),j=D.documents.length-V;return{visibleCount:V,visibleDocs:q,remainingCount:j}});ge(o,h,R=>t(1,i=R));function _(R){let D=m[R]||m.default;g.update(F=>Object.assign(Object.assign({},F),{[R]:(F[R]||D.initialCount)+D.incrementCount}))}function w(R){return Ke(this,void 0,void 0,function*(){var D;let F=[],V=Array.from(R.docs.values());for(let q of V){let j=yield q.getOrigin(),z=yield q.getServerSynced(),Y={guid:q.guid,path:R.getPath(q.path),doc:q,origin:j||"unknown",serverSynced:z},he=Array.from(r).find(oe=>oe.guid===q.guid),Fe=Array.from(s).find(oe=>oe.guid===q.guid),G=n.find(oe=>oe.guid===q.guid);if(he||Fe||G){let oe=he||Fe||G;Y.queueState={status:oe.status,type:"type"in oe?oe.type:"sync",error:"error"in oe?oe.error:void 0,timestamp:"timestamp"in oe?oe.timestamp:Date.now()}}else j==="local"&&!z?Y.queueState={status:"pending",type:"sync",timestamp:Date.now()}:z?Y.queueState={status:"completed",type:"sync",timestamp:Date.now()}:Y.queueState={status:"pending",type:"sync",timestamp:Date.now()};F.push(Y)}return{folder:R,documents:F,progress:((D=d.getGroupProgress(R))===null||D===void 0?void 0:D.percent)||0}})}function v(R){let{origin:D,serverSynced:F,queueState:V}=R,q=(V==null?void 0:V.status)||"completed",j=(V==null?void 0:V.type)||"sync";return D==="remote"&&!F&&q==="running"&&j==="download"?{text:"Downloading",description:"Initial acquisition",icon:Fd,iconClass:"mod-primary"}:D==="remote"&&!F&&q==="pending"&&j==="download"?{text:"Queued for Download",description:"Waiting to download",icon:ki,iconClass:""}:D==="remote"&&!F&&q==="failed"&&j==="download"?{text:"Download stuck",description:"Needs retry",icon:Ci,iconClass:"mod-warning"}:D==="local"&&!F&&q==="running"&&j==="sync"?{text:"Uploading",description:"First-time upload",icon:Xd,iconClass:"mod-primary"}:D==="local"&&!F&&q==="pending"&&j==="sync"?{text:"Queued for Upload",description:"Waiting to upload",icon:ki,iconClass:""}:D==="local"&&!F&&q==="failed"&&j==="sync"?{text:"Upload stuck",description:"Needs retry",icon:Ci,iconClass:"mod-warning"}:F&&q==="running"&&j==="sync"?{text:"Syncing",description:"Collaborative update",icon:wd,iconClass:"mod-primary"}:F&&q==="pending"&&j==="sync"?{text:"Queued for Sync",description:"Waiting to sync",icon:ki,iconClass:""}:F&&q==="failed"&&j==="sync"?{text:"Sync stuck",description:"Needs retry",icon:Ci,iconClass:"mod-warning"}:F&&q==="completed"?{text:"Complete",description:"Fully synchronized",icon:Ld,iconClass:"mod-success"}:{text:"Unknown",description:"Status unknown",icon:Rd,iconClass:""}}function A(R){return Ke(this,void 0,void 0,function*(){var D,F;let V={id:R.guid,guid:R.guid,path:R.path,timestamp:((D=R.queueState)===null||D===void 0?void 0:D.timestamp)||Date.now(),type:((F=R.queueState)===null||F===void 0?void 0:F.type)||"sync",status:"failed",sharedFolderGuid:R.doc.sharedFolder.guid};yield d.retryLogItem(V)})}let O=R=>A(R),M=R=>{_(R.title)},E=(R,D)=>D.key==="Enter"&&_(R.title);return o.$$set=R=>{"folder"in R&&t(7,u=R.folder),"backgroundSync"in R&&t(8,d=R.backgroundSync),"$$scope"in R&&t(13,c=R.$$scope)},o.$$.update=()=>{if(o.$$.dirty&256){e:r=new Set(d.activeSync.items())}if(o.$$.dirty&256){e:s=new Set(d.activeDownloads.items())}if(o.$$.dirty&256){e:n=d.getSyncLog()}if(o.$$.dirty&128){e:t(0,a=w(u))}},[a,i,m,h,_,v,A,u,d,l,O,M,E,c]}var Wm=class extends ee{constructor(e){super(),re(this,e,QM,JM,Z,{folder:7,backgroundSync:8},VM)}},zm=Wm;var{Map:XM}=nn;function ZM(o){De(o,"svelte-ztgdsf",".folder-header.svelte-ztgdsf{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;width:100%;text-align:left;color:inherit;font:inherit}.arrow.svelte-ztgdsf{margin-right:8px;font-size:0.8em;transition:transform 0.15s ease}.arrow.is-expanded.svelte-ztgdsf{transform:rotate(90deg)}.sync-stats.svelte-ztgdsf{margin-left:8px;display:flex;gap:4px}.tag.svelte-ztgdsf{font-size:0.7em;padding:2px 6px;border-radius:4px;background-color:var(--background-modifier-border);color:var(--text-muted)}.tag.mod-success.svelte-ztgdsf{background-color:var(--interactive-success);color:var(--text-on-accent)}.tag.mod-warning.svelte-ztgdsf{background-color:var(--text-warning);color:var(--text-on-accent)}.progress-container.svelte-ztgdsf{display:flex;align-items:center;margin-top:4px;width:100%}.progress-bar.svelte-ztgdsf{flex:1;height:6px;background-color:var(--background-modifier-border);border-radius:3px;overflow:hidden;margin-right:8px}.progress-value.svelte-ztgdsf{height:100%;background-color:var(--interactive-accent);border-radius:3px}.progress-text.svelte-ztgdsf{font-size:0.75rem;color:var(--text-muted)}")}function Uw(o,e,t){let r=o.slice();r[25]=e[t];let s=r[4].get(r[25].guid);return r[26]=s,r}function $w(o){let e,t;return e=new Ge({props:{name:"Sync Status"}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Bw(o){let e,t;return e=new Be({props:{name:o[11]?"Sync in Progress":o[10]?"Queued Files":"Sync Complete",description:`${o[2]} active \u2022 ${o[7]} stuck \u2022 ${o[3]} queued \u2022 ${o[8]} complete`,$$slots:{default:[rE]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&3072&&(n.name=r[11]?"Sync in Progress":r[10]?"Queued Files":"Sync Complete"),s&396&&(n.description=`${r[2]} active \u2022 ${r[7]} stuck \u2022 ${r[3]} queued \u2022 ${r[8]} complete`),s&536874496&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Nw(o){let e,t,r,s,n,a,i=[tE,eE],l=[];function c(u,d){return u[9]?0:1}return t=c(o,-1),r=l[t]=i[t](o),{c(){e=P("button"),r.c(),x(e,"class","mod-cta")},m(u,d){I(u,e,d),l[t].m(e,null),s=!0,n||(a=te(e,"click",o[16]),n=!0)},p(u,d){let m=t;t=c(u,d),t!==m&&(pe(),T(l[m],1,1,()=>{l[m]=null}),me(),r=l[t],r||(r=l[t]=i[t](u),r.c()),S(r,1),r.m(e,null))},i(u){s||(S(r),s=!0)},o(u){T(r),s=!1},d(u){u&&C(e),l[t].d(),n=!1,a()}}}function eE(o){let e,t,r;return e=new Vd({props:{size:16,class:"svg-icon lucide-pause",style:"margin-right: 8px;"}}),{c(){H(e.$$.fragment),t=K(`
						Pause`)},m(s,n){B(e,s,n),I(s,t,n),r=!0},i(s){r||(S(e.$$.fragment,s),r=!0)},o(s){T(e.$$.fragment,s),r=!1},d(s){s&&C(t),N(e,s)}}}function tE(o){let e,t,r;return e=new Wd({props:{size:16,class:"svg-icon lucide-play",style:"margin-right: 8px;"}}),{c(){H(e.$$.fragment),t=K(`
						Resume`)},m(s,n){B(e,s,n),I(s,t,n),r=!0},i(s){r||(S(e.$$.fragment,s),r=!0)},o(s){T(e.$$.fragment,s),r=!1},d(s){s&&C(t),N(e,s)}}}function rE(o){let e,t,r=(o[11]||o[10])&&Nw(o);return{c(){r&&r.c(),e=Ie()},m(s,n){r&&r.m(s,n),I(s,e,n),t=!0},p(s,n){s[11]||s[10]?r?(r.p(s,n),n&3072&&S(r,1)):(r=Nw(s),r.c(),S(r,1),r.m(e.parentNode,e)):r&&(pe(),T(r,1,1,()=>{r=null}),me())},i(s){t||(S(r),t=!0)},o(s){T(r),t=!1},d(s){s&&C(e),r&&r.d(s)}}}function oE(o){let e=[],t=new XM,r,s,n=Ae(o[6]),a=i=>i[25].guid;for(let i=0;i<n.length;i+=1){let l=Uw(o,n,i),c=a(l);t.set(c,e[i]=Kw(c,l))}return{c(){for(let i=0;i<e.length;i+=1)e[i].c();r=Ie()},m(i,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(i,l);I(i,r,l),s=!0},p(i,l){l&32851&&(n=Ae(i[6]),pe(),e=$x(e,l,a,1,i,n,t,r.parentNode,Ux,Kw,r,Uw),me())},i(i){if(!s){for(let l=0;l<n.length;l+=1)S(e[l]);s=!0}},o(i){for(let l=0;l<e.length;l+=1)T(e[l]);s=!1},d(i){i&&C(r);for(let l=0;l<e.length;l+=1)e[l].d(i)}}}function sE(o){let e,t,r,s;return e=new Ge({props:{$$slots:{name:[fE],default:[lE]},$$scope:{ctx:o}}}),r=new zm({props:{folder:o[5],backgroundSync:o[0]}}),{c(){H(e.$$.fragment),t=U(),H(r.$$.fragment)},m(n,a){B(e,n,a),I(n,t,a),B(r,n,a),s=!0},p(n,a){let i={};a&536875040&&(i.$$scope={dirty:a,ctx:n}),e.$set(i);let l={};a&32&&(l.folder=n[5]),a&1&&(l.backgroundSync=n[0]),r.$set(l)},i(n){s||(S(e.$$.fragment,n),S(r.$$.fragment,n),s=!0)},o(n){T(e.$$.fragment,n),T(r.$$.fragment,n),s=!1},d(n){n&&C(t),N(e,n),N(r,n)}}}function Hw(o){let e,t,r,s,n,a=o[26].progress+"",i,l;return{c(){e=P("div"),t=P("div"),r=P("div"),s=U(),n=P("span"),i=K(a),l=K("%"),x(r,"class","progress-value svelte-ztgdsf"),de(r,"width",o[26].progress+"%"),x(t,"class","progress-bar svelte-ztgdsf"),x(n,"class","progress-text svelte-ztgdsf"),x(e,"class","progress-container svelte-ztgdsf")},m(c,u){I(c,e,u),k(e,t),k(t,r),k(e,s),k(e,n),k(n,i),k(n,l)},p(c,u){u&80&&de(r,"width",c[26].progress+"%"),u&80&&a!==(a=c[26].progress+"")&&ne(i,a)},d(c){c&&C(e)}}}function nE(o){let e,t=o[26]&&(o[26].running>0||o[26].failed>0)&&Hw(o);return{c(){t&&t.c(),e=Ie()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[26]&&(r[26].running>0||r[26].failed>0)?t?t.p(r,s):(t=Hw(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function Vw(o){let e,t=o[26].running+"",r,s;return{c(){e=P("span"),r=K(t),s=K(" active"),x(e,"class","tag mod-success svelte-ztgdsf")},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&80&&t!==(t=n[26].running+"")&&ne(r,t)},d(n){n&&C(e)}}}function qw(o){let e,t=o[26].failed+"",r,s;return{c(){e=P("span"),r=K(t),s=K(" stuck"),x(e,"class","tag mod-warning svelte-ztgdsf")},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&80&&t!==(t=n[26].failed+"")&&ne(r,t)},d(n){n&&C(e)}}}function Ww(o){let e,t=o[26].pending+"",r,s;return{c(){e=P("span"),r=K(t),s=K(" queued"),x(e,"class","tag svelte-ztgdsf")},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&80&&t!==(t=n[26].pending+"")&&ne(r,t)},d(n){n&&C(e)}}}function aE(o){var M,E,R;let e,t,r,s,n,a=o[25].name+"",i,l,c,u,d,m,g,h,_=((M=o[26])==null?void 0:M.running)>0&&Vw(o),w=((E=o[26])==null?void 0:E.failed)>0&&qw(o),v=((R=o[26])==null?void 0:R.pending)>0&&Ww(o);function A(){return o[22](o[25])}function O(...D){return o[23](o[25],...D)}return{c(){e=P("div"),t=P("span"),r=K("\u25B6"),n=U(),i=K(a),l=U(),c=P("span"),_&&_.c(),u=U(),w&&w.c(),d=U(),v&&v.c(),x(t,"class",s="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf"),x(c,"class","sync-stats svelte-ztgdsf"),x(e,"class","folder-header svelte-ztgdsf"),x(e,"role","button"),x(e,"tabindex","0"),x(e,"aria-expanded",m=!!o[1][o[25].guid])},m(D,F){I(D,e,F),k(e,t),k(t,r),k(e,n),k(e,i),k(e,l),k(e,c),_&&_.m(c,null),k(c,u),w&&w.m(c,null),k(c,d),v&&v.m(c,null),g||(h=[te(e,"click",A),te(e,"keydown",O)],g=!0)},p(D,F){var V,q,j;o=D,F&66&&s!==(s="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf")&&x(t,"class",s),F&64&&a!==(a=o[25].name+"")&&ne(i,a),((V=o[26])==null?void 0:V.running)>0?_?_.p(o,F):(_=Vw(o),_.c(),_.m(c,u)):_&&(_.d(1),_=null),((q=o[26])==null?void 0:q.failed)>0?w?w.p(o,F):(w=qw(o),w.c(),w.m(c,d)):w&&(w.d(1),w=null),((j=o[26])==null?void 0:j.pending)>0?v?v.p(o,F):(v=Ww(o),v.c(),v.m(c,null)):v&&(v.d(1),v=null),F&66&&m!==(m=!!o[1][o[25].guid])&&x(e,"aria-expanded",m)},d(D){D&&C(e),_&&_.d(),w&&w.d(),v&&v.d(),g=!1,Ce(h)}}}function iE(o){let e,t;return e=new So({props:{folder:o[25],$$slots:{default:[aE]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&64&&(n.folder=r[25]),s&536870994&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function zw(o){let e,t;return e=new zm({props:{folder:o[25],backgroundSync:o[0]}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&64&&(n.folder=r[25]),s&1&&(n.backgroundSync=r[0]),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Kw(o,e){let t,r,s,n,a;r=new Ge({props:{$$slots:{name:[iE],default:[nE]},$$scope:{ctx:e}}});let i=e[1][e[25].guid]&&zw(e);return{key:o,first:null,c(){t=Ie(),H(r.$$.fragment),s=U(),i&&i.c(),n=Ie(),this.first=t},m(l,c){I(l,t,c),B(r,l,c),I(l,s,c),i&&i.m(l,c),I(l,n,c),a=!0},p(l,c){e=l;let u={};c&536870994&&(u.$$scope={dirty:c,ctx:e}),r.$set(u),e[1][e[25].guid]?i?(i.p(e,c),c&66&&S(i,1)):(i=zw(e),i.c(),S(i,1),i.m(n.parentNode,n)):i&&(pe(),T(i,1,1,()=>{i=null}),me())},i(l){a||(S(r.$$.fragment,l),S(i),a=!0)},o(l){T(r.$$.fragment,l),T(i),a=!1},d(l){l&&(C(t),C(s),C(n)),N(r,l),i&&i.d(l)}}}function Gw(o){let e,t,r,s,n,a=o[12].progress+"",i,l;return{c(){e=P("div"),t=P("div"),r=P("div"),s=U(),n=P("span"),i=K(a),l=K("%"),x(r,"class","progress-value svelte-ztgdsf"),de(r,"width",o[12].progress+"%"),x(t,"class","progress-bar svelte-ztgdsf"),x(n,"class","progress-text svelte-ztgdsf"),x(e,"class","progress-container svelte-ztgdsf")},m(c,u){I(c,e,u),k(e,t),k(t,r),k(e,s),k(e,n),k(n,i),k(n,l)},p(c,u){u&4096&&de(r,"width",c[12].progress+"%"),u&4096&&a!==(a=c[12].progress+"")&&ne(i,a)},d(c){c&&C(e)}}}function lE(o){let e,t=(o[12].running>0||o[12].failed>0)&&Gw(o);return{c(){t&&t.c(),e=Ie()},m(r,s){t&&t.m(r,s),I(r,e,s)},p(r,s){r[12].running>0||r[12].failed>0?t?t.p(r,s):(t=Gw(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function jw(o){let e,t=o[12].running+"",r,s;return{c(){e=P("span"),r=K(t),s=K(" active"),x(e,"class","tag mod-success svelte-ztgdsf")},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&4096&&t!==(t=n[12].running+"")&&ne(r,t)},d(n){n&&C(e)}}}function Yw(o){let e,t=o[12].failed+"",r,s;return{c(){e=P("span"),r=K(t),s=K(" stuck"),x(e,"class","tag mod-warning svelte-ztgdsf")},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&4096&&t!==(t=n[12].failed+"")&&ne(r,t)},d(n){n&&C(e)}}}function Jw(o){let e,t=o[12].pending+"",r,s;return{c(){e=P("span"),r=K(t),s=K(" queued"),x(e,"class","tag svelte-ztgdsf")},m(n,a){I(n,e,a),k(e,r),k(e,s)},p(n,a){a&4096&&t!==(t=n[12].pending+"")&&ne(r,t)},d(n){n&&C(e)}}}function cE(o){let e,t=o[5].name+"",r,s,n,a,i,l=o[12].running>0&&jw(o),c=o[12].failed>0&&Yw(o),u=o[12].pending>0&&Jw(o);return{c(){e=P("div"),r=K(t),s=U(),n=P("span"),l&&l.c(),a=U(),c&&c.c(),i=U(),u&&u.c(),x(n,"class","sync-stats svelte-ztgdsf"),x(e,"class","folder-header svelte-ztgdsf")},m(d,m){I(d,e,m),k(e,r),k(e,s),k(e,n),l&&l.m(n,null),k(n,a),c&&c.m(n,null),k(n,i),u&&u.m(n,null)},p(d,m){m&32&&t!==(t=d[5].name+"")&&ne(r,t),d[12].running>0?l?l.p(d,m):(l=jw(d),l.c(),l.m(n,a)):l&&(l.d(1),l=null),d[12].failed>0?c?c.p(d,m):(c=Yw(d),c.c(),c.m(n,i)):c&&(c.d(1),c=null),d[12].pending>0?u?u.p(d,m):(u=Jw(d),u.c(),u.m(n,null)):u&&(u.d(1),u=null)},d(d){d&&C(e),l&&l.d(),c&&c.d(),u&&u.d()}}}function fE(o){let e,t;return e=new So({props:{folder:o[5],$$slots:{default:[cE]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s&32&&(n.folder=r[5]),s&536875040&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function uE(o){let e,t,r,s,n,a,i=!o[5]&&$w(o),l=!o[5]&&Bw(o),c=[sE,oE],u=[];function d(m,g){return m[5]&&m[12]?0:1}return s=d(o,-1),n=u[s]=c[s](o),{c(){e=P("div"),i&&i.c(),t=U(),l&&l.c(),r=U(),n.c(),x(e,"class","setting-item-container")},m(m,g){I(m,e,g),i&&i.m(e,null),k(e,t),l&&l.m(e,null),k(e,r),u[s].m(e,null),a=!0},p(m,[g]){m[5]?i&&(pe(),T(i,1,1,()=>{i=null}),me()):i?g&32&&S(i,1):(i=$w(m),i.c(),S(i,1),i.m(e,t)),m[5]?l&&(pe(),T(l,1,1,()=>{l=null}),me()):l?(l.p(m,g),g&32&&S(l,1)):(l=Bw(m),l.c(),S(l,1),l.m(e,r));let h=s;s=d(m,g),s===h?u[s].p(m,g):(pe(),T(u[h],1,1,()=>{u[h]=null}),me(),n=u[s],n?n.p(m,g):(n=u[s]=c[s](m),n.c()),S(n,1),n.m(e,null))},i(m){a||(S(i),S(l),S(n),a=!0)},o(m){T(i),T(l),T(n),a=!1},d(m){m&&C(e),i&&i.d(),l&&l.d(),u[s].d()}}}function dE(o,e,t){let r,s,n,a,i,l,c,u,d,m,g,{backgroundSync:h}=e,{sharedFolders:_}=e,{focusedFolderGuid:w}=e,v={},A=0,O=0,M=0,E=0,{activeSync:R,activeDownloads:D}=h;ge(o,R,z=>t(21,g=z)),ge(o,D,z=>t(20,m=z));function F(z){t(1,v[z]=!v[z],v),t(1,v),t(6,r),t(17,_)}function V(){l?h.resume():h.pause()}let q=z=>F(z.guid),j=(z,Y)=>Y.key==="Enter"&&F(z.guid);return o.$$set=z=>{"backgroundSync"in z&&t(0,h=z.backgroundSync),"sharedFolders"in z&&t(17,_=z.sharedFolders),"focusedFolderGuid"in z&&t(18,w=z.focusedFolderGuid)},o.$$.update=()=>{if(o.$$.dirty&131072){e:t(6,r=_.items().sort((z,Y)=>z.name.localeCompare(Y.name)))}if(o.$$.dirty&66){e:r.forEach(z=>{z.guid in v||t(1,v[z.guid]=!0,v)}),t(1,v),t(6,r),t(17,_)}if(o.$$.dirty&393216){e:t(5,s=w?_.items().find(z=>z.guid===w):void 0)}if(o.$$.dirty&3145793){e:t(4,n=new Map(r.map(z=>{var Y,he;return[z.guid,{progress:((Y=h.getGroupProgress(z))===null||Y===void 0?void 0:Y.percent)||0,running:[...g.items(),...m.items()].filter(Fe=>Fe.sharedFolder.guid===z.guid).length,failed:((he=h.syncGroups.get(z))===null||he===void 0?void 0:he.status)==="failed"?1:0,pending:[...h.pendingSyncs,...h.pendingDownloads].filter(Fe=>Fe.sharedFolder.guid===z.guid).length,completed:(()=>{let Fe=h.syncGroups.get(z);return((Fe==null?void 0:Fe.completedSyncs)||0)+((Fe==null?void 0:Fe.completedDownloads)||0)})(),sharedFolder:z}]})))}if(o.$$.dirty&48){e:t(12,a=s?n.get(s.guid):void 0)}if(o.$$.dirty&1){e:t(19,i=h.getQueueStatus())}if(o.$$.dirty&524288){e:t(9,l=i.isPaused)}if(o.$$.dirty&524288){e:c=i.syncsActive>0||i.downloadsActive>0}if(o.$$.dirty&16){e:{let z=0,Y=0,he=0,Fe=0;for(let G of n.values())z+=G.running,Y+=G.failed,he+=G.pending,Fe+=G.completed;t(2,A=z),t(7,O=Y),t(3,M=he),t(8,E=Fe)}}if(o.$$.dirty&4){e:t(11,u=A>0)}if(o.$$.dirty&8){e:t(10,d=M>0)}},[h,v,A,M,n,s,r,O,E,l,d,u,a,R,D,F,V,_,w,i,m,g,q,j]}var Km=class extends ee{constructor(e){super(),re(this,e,dE,uE,Z,{backgroundSync:0,sharedFolders:17,focusedFolderGuid:18},ZM)}},Qw=Km;var Oi=class extends Xw.Modal{constructor(t,r,s,n){super(t);this.backgroundSync=r;this.sharedFolders=s;this.focusedFolderGuid=n}onOpen(){let{contentEl:t}=this;t.empty(),this.component=new Qw({target:t,props:{backgroundSync:this.backgroundSync,sharedFolders:this.sharedFolders,focusedFolderGuid:this.focusedFolderGuid,closeModal:()=>this.close()}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function Gm(o){return o.startsWith("v")?o.slice(1):o}function pE(o,e){return o.map((t,r)=>[t,e[r]])}function mE(o,e){try{let t=Gm(o).split(".").map(parseInt),r=Gm(e).split(".").map(parseInt);for(let[s,n]of pE(t,r))if(s>n)return!0}catch(t){}return!1}var nf=class extends ft{constructor(t,r,s){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.releaseSettings=s;this.updateCheckInterval=null;this.lastReleaseCheck=0;this.lastChannelCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.githubReleases=new jo("system3-relay/releases"),this.releaseChannels=new jo("system3-relay/releaseChannels")}get releases(){return[...this.githubReleases.values()].sort((t,r)=>r.tag_name.localeCompare(t.tag_name,void 0,{numeric:!0,sensitivity:"base"}))}get beta(){return this.releaseChannels.get("beta")}get stable(){return this.releaseChannels.get("stable")}async fetchReleases(){let r=await Et("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);let s=await r.json();return Je().enableNetworkLogging&&this.debug("GitHub releases fetched:",s),s}async fetchLatestRelease(){try{let s="https://api.github.com/repos/No-Instructions/Relay/releases/latest";this.debug(`Fetching latest release from: ${s}`);let n=await Et(s,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}});if(!n.ok)throw new Error(`GitHub API error: ${n.status}`);return await n.json()}catch(t){return this.error("Failed to fetch latest release:",t),null}}async fetchLatestTagFromChannel(t){try{let r={beta:"manifest-beta.json",stable:"manifest.json"}[t],s=r?await this.fetchRepoManifest(r):null;return s?(this.debug("repo manifest",s),s.version):null}catch(r){this.error("Failed to check for updates:",r)}return null}async getReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<5*60*1e3&&this.githubReleases.size>0)return[...this.githubReleases.values()];this.lastReleaseCheck=t;let r=await this.fetchReleases(),s=new Set([...this.githubReleases.keys()]),n=new Set;r.forEach(i=>{this.githubReleases.set(i.tag_name,i),n.add(i.tag_name)}),s.forEach(i=>{n.has(i)||this.githubReleases.delete(i)});let a=await this.fetchLatestRelease();a&&(a.latest=!0,this.githubReleases.set(a.tag_name,a)),this.notifyListeners()}catch(t){this.error("Failed to fetch GitHub releases:",t)}return[...this.githubReleases.values()]}async getChannelRelease(){let t=Date.now(),r=this.releaseChannels.get(this.releaseSettings.get().channel);if(t-this.lastChannelCheck<5*60*1e3&&r)return r;this.lastReleaseCheck=t;let s=await this.getReleases();if(s.length===0)return this.debug("No releases found"),null;let n=this.releaseSettings.get().channel;if(!n)return null;let a=await this.fetchLatestTagFromChannel(n);if(!a)return null;let i=s.find(l=>Gm(l.tag_name)===a);return i?(this.releaseChannels.set(n,i),this.notifyListeners(),i):null}async update(){await this.getReleases(),await this.getChannelRelease()}start(){this.update(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.update(),this.CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null)}async fetchRepoManifest(t,r="main"){try{let a=`https://raw.githubusercontent.com/No-Instructions/Relay/${r}/${t}`;this.debug(`Fetching ${a}`);let i=await Et(a);if(!i.ok)throw new Error("unable to fetch manifest");return await i.json()}catch(s){return this.error("Failed to fetch:",s),null}}async fetchReleaseManifest(t){try{let r=t.assets.find(a=>a.name==="manifest.json");if(!r)return this.debug("No manifest found in release assets"),null;this.debug("Fetching manifest from release asset:",r.browser_download_url);let s=await Et(r.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!s.ok)throw new Error(`Failed to fetch manifest asset: ${s.status}`);let n=await s.json();return Je().enableNetworkLogging&&this.debug("manifest fetched:",n),n}catch(r){return this.error("Failed to fetch manifest for release:",t,r),null}}getNewRelease(){let t=this.releaseChannels.get(this.releaseSettings.get().channel);if(t&&mE(t.tag_name,this.plugin.version))return t}async installUpdate(t){let r=await this.fetchReleaseManifest(t);try{this.debug(`Installing update from v${this.plugin.version} to v${r.version}...`,r),await this.plugin.app.plugins.installPlugin("No-Instructions/Relay",r.version,r),this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let s="system3-relay",n=this.plugin.app.plugins;return await n.disablePlugin(s),await n.enablePlugin(s),!0}catch(s){return this.error("Failed to install update:",s),!1}}destroy(){this.stop(),this.githubReleases=null,this.releaseChannels=null,super.destroy()}};var g_=require("obsidian");var m_=require("obsidian");function hE(o){De(o,"svelte-12doke6",'.modal-content.svelte-12doke6.svelte-12doke6{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-12doke6.svelte-12doke6{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-12doke6.svelte-12doke6{height:0.5rem}.checkbox-container.svelte-12doke6.svelte-12doke6{cursor:pointer}.loading-text.svelte-12doke6.svelte-12doke6,.no-releases-text.svelte-12doke6.svelte-12doke6{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-12doke6.svelte-12doke6{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-12doke6.svelte-12doke6{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-12doke6.svelte-12doke6:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-12doke6.svelte-12doke6{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.development-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.main-branch-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.beta-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.release-tag-item.stable-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.prerelease-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-12doke6.svelte-12doke6{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-12doke6.svelte-12doke6{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-12doke6.svelte-12doke6{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-12doke6 h3.svelte-12doke6{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-12doke6.svelte-12doke6{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-12doke6.svelte-12doke6{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-12doke6.svelte-12doke6{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-12doke6.svelte-12doke6{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-12doke6.svelte-12doke6{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-12doke6.svelte-12doke6{flex:1}.manifest-version-mismatch.svelte-12doke6.svelte-12doke6{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-12doke6.svelte-12doke6{font-size:1.2em}.release-changelog.svelte-12doke6.svelte-12doke6{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-content.svelte-12doke6.svelte-12doke6{overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-12doke6.svelte-12doke6{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-12doke6.svelte-12doke6{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-12doke6.svelte-12doke6{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-12doke6.svelte-12doke6{margin-bottom:12px}')}function Zw(o,e,t){let r=o.slice();return r[71]=e[t],r}function gE(o){let e,t;return e=new Ft({props:{name:"Automatically install updates",$$slots:{default:[yE]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&128|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function yE(o){let e,t,r,s,n,a;return{c(){e=P("div"),t=P("input"),r=U(),s=P("div"),x(t,"type","checkbox"),t.checked=o[7],x(s,"class","checkbox-toggle"),x(e,"class","checkbox-container svelte-12doke6"),x(e,"role","checkbox"),x(e,"aria-checked",o[7]),x(e,"tabindex","0"),Ne(e,"is-enabled",o[7])},m(i,l){I(i,e,l),k(e,t),k(e,r),k(e,s),n||(a=[te(e,"click",o[44]),te(e,"keydown",o[45])],n=!0)},p(i,l){l[0]&128&&(t.checked=i[7]),l[0]&128&&x(e,"aria-checked",i[7]),l[0]&128&&Ne(e,"is-enabled",i[7])},d(i){i&&C(e),n=!1,Ce(a)}}}function e_(o){let e,t;return e=new Ft({props:{name:"Show all releases",$$slots:{default:[xE]},$$scope:{ctx:o}}}),{c(){H(e.$$.fragment)},m(r,s){B(e,r,s),t=!0},p(r,s){let n={};s[0]&64|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(S(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function xE(o){let e,t,r,s,n,a;return{c(){e=P("div"),t=P("input"),r=U(),s=P("div"),x(t,"type","checkbox"),t.checked=o[6],x(s,"class","checkbox-toggle"),x(e,"class","checkbox-container svelte-12doke6"),x(e,"role","checkbox"),x(e,"aria-checked",o[6]),x(e,"tabindex","0"),Ne(e,"is-enabled",o[6])},m(i,l){I(i,e,l),k(e,t),k(e,r),k(e,s),n||(a=[te(e,"click",o[46]),te(e,"keydown",o[47])],n=!0)},p(i,l){l[0]&64&&(t.checked=i[6]),l[0]&64&&x(e,"aria-checked",i[6]),l[0]&64&&Ne(e,"is-enabled",i[6])},d(i){i&&C(e),n=!1,Ce(a)}}}function bE(o){let e,t,r=(!o[1]||o[7])&&t_(o);function s(i,l){if(i[12])return kE;if(i[17])return SE}let n=s(o,[-1,-1,-1]),a=n&&n(o);return{c(){r&&r.c(),e=U(),a&&a.c(),t=Ie()},m(i,l){r&&r.m(i,l),I(i,e,l),a&&a.m(i,l),I(i,t,l)},p(i,l){!i[1]||i[7]?r?r.p(i,l):(r=t_(i),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),n===(n=s(i,l))&&a?a.p(i,l):(a&&a.d(1),a=n&&n(i),a&&(a.c(),a.m(t.parentNode,t)))},d(i){i&&(C(e),C(t)),r&&r.d(i),a&&a.d(i)}}}function vE(o){let e;return{c(){e=P("div"),e.textContent="No matching releases found with the current filter",x(e,"class","no-releases-text svelte-12doke6")},m(t,r){I(t,e,r)},p:J,d(t){t&&C(e)}}}function wE(o){let e;return{c(){e=P("div"),e.textContent="No GitHub releases found",x(e,"class","no-releases-text svelte-12doke6")},m(t,r){I(t,e,r)},p:J,d(t){t&&C(e)}}}function _E(o){let e;return{c(){e=P("div"),e.textContent="Loading GitHub releases...",x(e,"class","loading-text svelte-12doke6")},m(t,r){I(t,e,r)},p:J,d(t){t&&C(e)}}}function t_(o){let e,t,r,s=!o[7]&&!o[9].some(o[43]),n,a=o[5]&&r_(o),i=o[4]&&o_(o),l=s&&s_(o),c=!o[7]&&!o[1]&&n_(o);return{c(){e=P("div"),a&&a.c(),t=U(),i&&i.c(),r=U(),l&&l.c(),n=U(),c&&c.c(),x(e,"class","release-tags-container svelte-12doke6")},m(u,d){I(u,e,d),a&&a.m(e,null),k(e,t),i&&i.m(e,null),k(e,r),l&&l.m(e,null),k(e,n),c&&c.m(e,null)},p(u,d){u[5]?a?a.p(u,d):(a=r_(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null),u[4]?i?i.p(u,d):(i=o_(u),i.c(),i.m(e,r)):i&&(i.d(1),i=null),d[0]&640&&(s=!u[7]&&!u[9].some(u[43])),s?l?l.p(u,d):(l=s_(u),l.c(),l.m(e,n)):l&&(l.d(1),l=null),!u[7]&&!u[1]?c?c.p(u,d):(c=n_(u),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},d(u){u&&C(e),a&&a.d(),i&&i.d(),l&&l.d(),c&&c.d()}}}function r_(o){let e,t,r,s,n;return{c(){e=P("div"),t=P("div"),t.textContent="Stable",x(t,"class","tag-name svelte-12doke6"),x(e,"class","release-tag-item main-branch-version stable-version svelte-12doke6"),x(e,"role","tab"),x(e,"aria-selected",r=o[10]==="stable"),x(e,"tabindex","0")},m(a,i){I(a,e,i),k(e,t),s||(n=[te(e,"click",o[48]),te(e,"keydown",o[49])],s=!0)},p(a,i){i[0]&1024&&r!==(r=a[10]==="stable")&&x(e,"aria-selected",r)},d(a){a&&C(e),s=!1,Ce(n)}}}function o_(o){let e,t,r,s,n;return{c(){e=P("div"),t=P("div"),t.textContent="Beta",x(t,"class","tag-name svelte-12doke6"),x(e,"class","release-tag-item main-branch-version beta-version svelte-12doke6"),x(e,"role","tab"),x(e,"aria-selected",r=o[10]==="beta"),x(e,"tabindex","0")},m(a,i){I(a,e,i),k(e,t),s||(n=[te(e,"click",o[50]),te(e,"keydown",o[51])],s=!0)},p(a,i){i[0]&1024&&r!==(r=a[10]==="beta")&&x(e,"aria-selected",r)},d(a){a&&C(e),s=!1,Ce(n)}}}function s_(o){let e,t,r,s,n;return{c(){e=P("div"),t=P("div"),t.textContent="Dev",x(t,"class","tag-name svelte-12doke6"),x(e,"class","release-tag-item development-version svelte-12doke6"),x(e,"role","tab"),x(e,"aria-selected",r=o[11]===o[0].version),x(e,"tabindex","0")},m(a,i){I(a,e,i),k(e,t),s||(n=[te(e,"click",o[52]),te(e,"keydown",o[53])],s=!0)},p(a,i){i[0]&2049&&r!==(r=a[11]===a[0].version)&&x(e,"aria-selected",r)},d(a){a&&C(e),s=!1,Ce(n)}}}function n_(o){let e,t=Ae(o[9]),r=[];for(let s=0;s<t.length;s+=1)r[s]=a_(Zw(o,t,s));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=Ie()},m(s,n){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(s,n);I(s,e,n)},p(s,n){if(n[0]&536873472|n[1]&130){t=Ae(s[9]);let a;for(a=0;a<t.length;a+=1){let i=Zw(s,t,a);r[a]?r[a].p(i,n):(r[a]=a_(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&C(e),nt(r,s)}}}function a_(o){let e,t,r=o[71].tag_name+"",s,n,a,i,l,c;function u(){return o[54](o[71])}function d(...m){return o[55](o[71],...m)}return{c(){e=P("div"),t=P("div"),s=K(r),n=U(),x(t,"class","tag-name svelte-12doke6"),x(e,"class",a="release-tag-item "+(o[29](o[71].tag_name)?"current-version":"")+" "+(p_(o[71])?"pre-release":"")+" svelte-12doke6"),x(e,"role","tab"),x(e,"aria-selected",i=o[11]===o[71].tag_name),x(e,"tabindex","0")},m(m,g){I(m,e,g),k(e,t),k(t,s),k(e,n),l||(c=[te(e,"click",u),te(e,"keydown",d)],l=!0)},p(m,g){o=m,g[0]&512&&r!==(r=o[71].tag_name+"")&&ne(s,r),g[0]&512&&a!==(a="release-tag-item "+(o[29](o[71].tag_name)?"current-version":"")+" "+(p_(o[71])?"pre-release":"")+" svelte-12doke6")&&x(e,"class",a),g[0]&2560&&i!==(i=o[11]===o[71].tag_name)&&x(e,"aria-selected",i)},d(m){m&&C(e),l=!1,Ce(c)}}}function SE(o){let e,t,r,s,n,a,i;return{c(){e=P("div"),t=P("div"),r=K(o[17]),s=U(),n=P("button"),n.textContent="Close",x(t,"class","manifest-error-message svelte-12doke6"),x(n,"class","manifest-close-btn svelte-12doke6"),x(e,"class","manifest-error svelte-12doke6")},m(l,c){I(l,e,c),k(e,t),k(t,r),k(e,s),k(e,n),a||(i=te(n,"click",o[40]),a=!0)},p(l,c){c[0]&131072&&ne(r,l[17])},d(l){l&&C(e),a=!1,i()}}}function kE(o){var z;let e,t,r,s,n,a,i=(z=o[41](o[11]))==null?void 0:z.prerelease,l,c,u,d,m,g,h,_,w,v,A=i&&i_(o),O=o[13][o[11]]==="beta-alias"&&l_(o),M=o[13][o[11]]==="stable-alias"&&c_(o);function E(Y,he){if(he[0]&18432&&(m=null),he[0]&2048&&(g=null),m==null&&(m=!!((Y[41](Y[11])||Y[14][Y[11]]==="stable-alias"||Y[14][Y[11]]==="beta-alias")&&!Y[29](Y[11]))),m)return IE;if(g==null&&(g=!!Y[29](Y[11])),g)return CE}let R=E(o,[-1,-1,-1]),D=R&&R(o);function F(Y,he){return Y[14][Y[11]]==="stable-alias"||Y[14][Y[11]]==="beta-alias"||Y[10]==="development"?FE:Y[11]?DE:PE}let V=F(o,[-1,-1,-1]),q=V(o),j=o[16]&&f_(o);return{c(){e=P("div"),t=P("div"),r=P("h3"),s=K("Release Details: "),n=K(o[11]),a=U(),A&&A.c(),l=U(),O&&O.c(),c=U(),M&&M.c(),u=U(),d=P("div"),D&&D.c(),h=U(),_=P("div"),w=P("div"),q.c(),v=U(),j&&j.c(),x(r,"class","svelte-12doke6"),x(d,"class","manifest-header-actions svelte-12doke6"),x(t,"class","manifest-header svelte-12doke6"),x(w,"class","release-changelog-content svelte-12doke6"),x(_,"class","release-changelog svelte-12doke6"),x(e,"class","manifest-container svelte-12doke6")},m(Y,he){I(Y,e,he),k(e,t),k(t,r),k(r,s),k(r,n),k(r,a),A&&A.m(r,null),k(r,l),O&&O.m(r,null),k(r,c),M&&M.m(r,null),k(t,u),k(t,d),D&&D.m(d,null),k(e,h),k(e,_),k(_,w),q.m(w,null),k(e,v),j&&j.m(e,null)},p(Y,he){var Fe;he[0]&2048&&ne(n,Y[11]),he[0]&2048&&(i=(Fe=Y[41](Y[11]))==null?void 0:Fe.prerelease),i?A||(A=i_(Y),A.c(),A.m(r,l)):A&&(A.d(1),A=null),Y[13][Y[11]]==="beta-alias"?O||(O=l_(Y),O.c(),O.m(r,c)):O&&(O.d(1),O=null),Y[13][Y[11]]==="stable-alias"?M||(M=c_(Y),M.c(),M.m(r,null)):M&&(M.d(1),M=null),R===(R=E(Y,he))&&D?D.p(Y,he):(D&&D.d(1),D=R&&R(Y),D&&(D.c(),D.m(d,null))),V===(V=F(Y,he))&&q?q.p(Y,he):(q.d(1),q=V(Y),q&&(q.c(),q.m(w,null))),Y[16]?j?j.p(Y,he):(j=f_(Y),j.c(),j.m(e,null)):j&&(j.d(1),j=null)},d(Y){Y&&C(e),A&&A.d(),O&&O.d(),M&&M.d(),D&&D.d(),q.d(),j&&j.d()}}}function i_(o){let e;return{c(){e=P("span"),e.textContent="Pre-release",x(e,"class","prerelease-badge svelte-12doke6")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function l_(o){let e;return{c(){e=P("span"),e.textContent="Beta",x(e,"class","channel-badge beta-badge svelte-12doke6")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function c_(o){let e;return{c(){e=P("span"),e.textContent="Stable",x(e,"class","channel-badge stable-badge svelte-12doke6")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function CE(o){let e;return{c(){e=P("span"),e.textContent="Installed",x(e,"class","currently-installed svelte-12doke6")},m(t,r){I(t,e,r)},p:J,d(t){t&&C(e)}}}function IE(o){let e,t,r,s;function n(l,c){return l[15]===l[11]?TE:LE}let a=n(o,[-1,-1,-1]),i=a(o);return{c(){e=P("button"),i.c(),x(e,"class","install-version-btn mod-cta svelte-12doke6"),e.disabled=t=o[15]===o[11]||o[2]},m(l,c){I(l,e,c),i.m(e,null),r||(s=te(e,"click",o[56]),r=!0)},p(l,c){a!==(a=n(l,c))&&(i.d(1),i=a(l),i&&(i.c(),i.m(e,null))),c[0]&34820&&t!==(t=l[15]===l[11]||l[2])&&(e.disabled=t)},d(l){l&&C(e),i.d(),r=!1,s()}}}function LE(o){let e;return{c(){e=K("Install")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function TE(o){let e;return{c(){e=K("Installing...")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function PE(o){let e;return{c(){e=K('"No changelog available"')},m(t,r){I(t,e,r)},p:J,d(t){t&&C(e)}}}function DE(o){var s;let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:EE,then:ME,catch:AE,value:70};return Qo(t=o[37](((s=o[41](o[11]))==null?void 0:s.body)||"No changelog available"),r),{c(){e=Ie(),r.block.c()},m(n,a){I(n,e,a),r.block.m(n,r.anchor=a),r.mount=()=>e.parentNode,r.anchor=e},p(n,a){var i;o=n,r.ctx=o,a[0]&2048&&t!==(t=o[37](((i=o[41](o[11]))==null?void 0:i.body)||"No changelog available"))&&Qo(t,r)||da(r,o,a)},d(n){n&&C(e),r.block.d(n),r.token=null,r=null}}}function FE(o){let e;function t(n,a){if(n[14][n[11]]==="stable-alias")return UE;if(n[14][n[11]]==="beta-alias")return OE;if(n[11]===n[0].version)return RE}let r=t(o,[-1,-1,-1]),s=r&&r(o);return{c(){s&&s.c(),e=Ie()},m(n,a){s&&s.m(n,a),I(n,e,a)},p(n,a){r!==(r=t(n,a))&&(s&&s.d(1),s=r&&r(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&C(e),s&&s.d(n)}}}function AE(o){return{c:J,m:J,p:J,d:J}}function ME(o){let e,t=o[70]+"",r;return{c(){e=new Is(!1),r=Ie(),e.a=r},m(s,n){e.m(t,s,n),I(s,r,n)},p(s,n){n[0]&2048&&t!==(t=s[70]+"")&&e.p(t)},d(s){s&&(C(r),e.d())}}}function EE(o){let e;return{c(){e=K('"loading..."')},m(t,r){I(t,e,r)},p:J,d(t){t&&C(e)}}}function RE(o){let e;return{c(){e=P("p"),e.textContent="Current development version"},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function OE(o){let e;return{c(){e=P("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function UE(o){let e;return{c(){e=P("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function f_(o){let e,t,r,s,n,a=o[12].version+"",i,l,c=o[11]!==o[12].version&&!o[11].startsWith("v"+o[12].version),u,d,m,g,h,_=o[12].name+"",w,v,A,O,M,E,R=o[12].author+"",D,F,V,q,j,z,Y=o[12].description+"",he,Fe,G,oe,Se,je,Oe=o[12].isDesktopOnly?"Yes":"No",ce,le,W,Le,it,pt,gt=o[12].minAppVersion+"",lt,St=c&&u_(o);return{c(){e=P("div"),t=P("div"),r=P("span"),r.textContent="Version:",s=U(),n=P("span"),i=K(a),l=U(),St&&St.c(),u=U(),d=P("div"),m=P("span"),m.textContent="Name:",g=U(),h=P("span"),w=K(_),v=U(),A=P("div"),O=P("span"),O.textContent="Author:",M=U(),E=P("span"),D=K(R),F=U(),V=P("div"),q=P("span"),q.textContent="Description:",j=U(),z=P("span"),he=K(Y),Fe=U(),G=P("div"),oe=P("span"),oe.textContent="isDesktopOnly:",Se=U(),je=P("span"),ce=K(Oe),le=U(),W=P("div"),Le=P("span"),Le.textContent="minAppVersion:",it=U(),pt=P("span"),lt=K(gt),x(r,"class","manifest-label svelte-12doke6"),x(n,"class","manifest-value svelte-12doke6"),x(t,"class","manifest-field svelte-12doke6"),x(m,"class","manifest-label svelte-12doke6"),x(h,"class","manifest-value svelte-12doke6"),x(d,"class","manifest-field svelte-12doke6"),x(O,"class","manifest-label svelte-12doke6"),x(E,"class","manifest-value svelte-12doke6"),x(A,"class","manifest-field svelte-12doke6"),x(q,"class","manifest-label svelte-12doke6"),x(z,"class","manifest-value svelte-12doke6"),x(V,"class","manifest-field svelte-12doke6"),x(oe,"class","manifest-label svelte-12doke6"),x(je,"class","manifest-value svelte-12doke6"),x(G,"class","manifest-field svelte-12doke6"),x(Le,"class","manifest-label svelte-12doke6"),x(pt,"class","manifest-value svelte-12doke6"),x(W,"class","manifest-field svelte-12doke6"),x(e,"class","manifest-content svelte-12doke6")},m(rt,Zt){I(rt,e,Zt),k(e,t),k(t,r),k(t,s),k(t,n),k(n,i),k(t,l),St&&St.m(t,null),k(e,u),k(e,d),k(d,m),k(d,g),k(d,h),k(h,w),k(e,v),k(e,A),k(A,O),k(A,M),k(A,E),k(E,D),k(e,F),k(e,V),k(V,q),k(V,j),k(V,z),k(z,he),k(e,Fe),k(e,G),k(G,oe),k(G,Se),k(G,je),k(je,ce),k(e,le),k(e,W),k(W,Le),k(W,it),k(W,pt),k(pt,lt)},p(rt,Zt){Zt[0]&4096&&a!==(a=rt[12].version+"")&&ne(i,a),Zt[0]&6144&&(c=rt[11]!==rt[12].version&&!rt[11].startsWith("v"+rt[12].version)),c?St||(St=u_(rt),St.c(),St.m(t,null)):St&&(St.d(1),St=null),Zt[0]&4096&&_!==(_=rt[12].name+"")&&ne(w,_),Zt[0]&4096&&R!==(R=rt[12].author+"")&&ne(D,R),Zt[0]&4096&&Y!==(Y=rt[12].description+"")&&ne(he,Y),Zt[0]&4096&&Oe!==(Oe=rt[12].isDesktopOnly?"Yes":"No")&&ne(ce,Oe),Zt[0]&4096&&gt!==(gt=rt[12].minAppVersion+"")&&ne(lt,gt)},d(rt){rt&&C(e),St&&St.d()}}}function u_(o){let e;return{c(){e=P("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-12doke6">\u26A0\uFE0F</span>
									Version mismatch`,x(e,"class","manifest-version-mismatch svelte-12doke6")},m(t,r){I(t,e,r)},d(t){t&&C(e)}}}function $E(o){let e,t=o[1]?"Relay installer":"Relay releases",r,s,n,a,i,l,c=Je().enableAutomaticUpdatesOption,u,d,m,g=c&&gE(o),h=!o[7]&&!o[1]&&e_(o);function _(A,O){return A[8]?_E:A[3].length===0?wE:A[9].length===0?vE:bE}let w=_(o,[-1,-1,-1]),v=w(o);return{c(){e=P("div"),r=K(t),s=U(),n=P("div"),a=P("div"),i=U(),l=P("div"),g&&g.c(),u=U(),h&&h.c(),d=U(),v.c(),x(e,"class","modal-title"),x(a,"class","settings-spacer svelte-12doke6"),x(l,"class","settings-container svelte-12doke6"),x(n,"class","modal-content svelte-12doke6")},m(A,O){I(A,e,O),k(e,r),I(A,s,O),I(A,n,O),k(n,a),k(n,i),k(n,l),g&&g.m(l,null),k(l,u),h&&h.m(l,null),k(n,d),v.m(n,null),m=!0},p(A,O){(!m||O[0]&2)&&t!==(t=A[1]?"Relay installer":"Relay releases")&&ne(r,t),c&&g.p(A,O),!A[7]&&!A[1]?h?(h.p(A,O),O[0]&130&&S(h,1)):(h=e_(A),h.c(),S(h,1),h.m(l,null)):h&&(pe(),T(h,1,1,()=>{h=null}),me()),w===(w=_(A,O))&&v?v.p(A,O):(v.d(1),v=w(A),v&&(v.c(),v.m(n,null)))},i(A){m||(S(g),S(h),m=!0)},o(A){T(g),T(h),m=!1},d(A){A&&(C(e),C(s),C(n)),g&&g.d(),h&&h.d(),v.d()}}}var d_="system3-relay";function hn(o){return o.startsWith("v")?o.substring(1):o}function p_(o){return(o==null?void 0:o.prerelease)===!0}function BE(o,e,t){let r,s,n,a,i,l,c,u,d,m,g,h,_,w,v,A,O,{plugin:M}=e,{version:E}=e,R=_e(M.manifest.version),D=_e(!1),F=_e(""),V=_e(""),q=_e(!1);ge(o,q,X=>t(8,u=X));let j=_e(!1);ge(o,j,X=>t(6,l=X));let z=_e(null);ge(o,z,X=>t(12,h=X));let Y=_e("");ge(o,Y,X=>t(11,g=X));let he=_e(null),Fe=_e(null);ge(o,Fe,X=>t(17,O=X));let G=_e(!1);ge(o,G,X=>t(16,A=X));let oe=_e(null);ge(o,oe,X=>t(5,n=X));let Se=_e(null);ge(o,Se,X=>t(4,s=X));let je=_e(null);ge(o,je,X=>t(58,i=X));let Oe=_e(null);ge(o,Oe,X=>t(57,a=X));let ce=_e(!1),le=!1,W=_e(null);ge(o,W,X=>t(15,v=X));let Le=M.app;function it(X){let ue=hn(X),ot=hn(M.version);return ue===ot}let pt=_e({});ge(o,pt,X=>t(14,w=X));let gt=_e({});ge(o,gt,X=>t(13,_=X));let lt=_e(M.releaseSettings.get().channel);ge(o,lt,X=>t(10,m=X));let St=_e(!1);ge(o,St,X=>t(7,c=X));function rt(X){return Ke(this,void 0,void 0,function*(){St.set(X);let ue=M.releaseSettings.get().channel;lt.set(ue),M.releaseSettings.update(ot=>Object.assign(Object.assign({},ot),{automaticUpdates:X})),ct(ue)})}cr(()=>{ns(),Zt(),!E&&!r.some(X=>{X.tag_name,M.version})?(M.releaseSettings.update(X=>Object.assign(Object.assign({},X),{automaticUpdates:!1})),lt.set(null)):lt.set(M.releaseSettings.get().channel),z.set({version:E||M.version,name:M.manifest.name,author:M.manifest.author,description:M.manifest.description,isDesktopOnly:M.manifest.isDesktopOnly,minAppVersion:M.manifest.minAppVersion}),Y.set(E||M.version)});function Zt(){return Ke(this,void 0,void 0,function*(){ce.set(!0);try{let X=yield M.updateManager.fetchRepoManifest("manifest.json");X&&(oe.set(X),je.set(X.version));let ue=yield M.updateManager.fetchRepoManifest("manifest-beta.json");ue&&(Se.set(ue),Oe.set(ue.version))}catch(X){M.error("Error fetching main branch manifests:",X)}finally{ce.set(!1)}})}let Rs=oo(M.updateManager,()=>M.updateManager.releases);ge(o,Rs,X=>t(3,r=X));let gn=oo([Rs,j],()=>r&&r.length>0?Os(l).sort():[]);ge(o,gn,X=>t(9,d=X)),r.forEach(X=>Ke(void 0,void 0,void 0,function*(){try{let ue=yield M.updateManager.fetchReleaseManifest(X);ue&&pt.update(ot=>Object.assign(Object.assign({},ot),{[X.tag_name]:ue.version}))}catch(ue){}}));function ns(){return Ke(this,void 0,void 0,function*(){q.set(!0);try{yield M.updateManager.getReleases(),Os(l)}catch(X){M.error("Error refreshing GitHub releases:",X)}finally{q.set(!1)}})}function ka(X){return Ke(this,void 0,void 0,function*(){let ue=document.createElement("div");return yield m_.MarkdownRenderer.render(M.app,X,ue,"",M),ue.innerHTML})}function Os(X){return X?r:E?r.filter(ue=>E===hn(ue.tag_name)):r.filter(ue=>{let ot=ue.tag_name;return Ca(ue)})}function Ca(X){if(X.prerelease||X.draft)return!1;if(X.latest||hn(X.tag_name)===i||hn(X.tag_name)===a)return!0;let ue=new Date(X.created_at),ot=new Date;return ot.setMonth(ot.getMonth()-3),ue>ot}function Dr(X){return Ke(this,void 0,void 0,function*(){Fe.set(null),he.set(X);try{let ue=as(X);if(!ue){Fe.set(`Could not find release for ${X}`);return}let ot=yield M.updateManager.fetchReleaseManifest(ue);ot?(z.set(ot),Y.set(X),G.set(!1),pt.update(Vr=>Object.assign(Object.assign({},Vr),{[X]:ot.version}))):Fe.set(`Could not find manifest for ${X}`)}catch(ue){M.error("Error fetching manifest:",ue),Fe.set(`Error fetching manifest: ${ue.message||"Unknown error"}`)}finally{he.set(null)}})}function ct(X){let ue=X==="stable"?n:s;if(ue){let ot=ue.version;lt.set(X);let Vr=[...r.values()].find(Qt=>hn(Qt.tag_name)===hn(ot));Vr?(X==="stable"?gt.update(Qt=>Object.assign(Object.assign({},Qt),{[Vr.tag_name]:"stable-alias"})):gt.update(Qt=>Object.assign(Object.assign({},Qt),{[Vr.tag_name]:"beta-alias"})),Dr(Vr.tag_name)):(z.set(ue),Y.set(ot),X==="stable"?gt.update(Qt=>Object.assign(Object.assign({},Qt),{[ot]:"stable-alias"})):gt.update(Qt=>Object.assign(Object.assign({},Qt),{[ot]:"beta-alias"})),G.set(!1))}else Fe.set(`Could not find ${X} manifest`)}function Vt(){z.set(null),Y.set(""),Fe.set(null)}function as(X){return[...r.values()].find(ue=>ue.tag_name===X)}function Us(X){return Ke(this,void 0,void 0,function*(){try{W.set(X);let ue=as(X);if(!ue)throw new Error(`Could not find release for ${X}`);let ot=yield M.updateManager.fetchReleaseManifest(ue);if(!ot)throw new Error(`Could not find manifest for ${X}`);t(2,le=!0),yield Le.plugins.installPlugin(M.repo,X,ot),yield Le.plugins.disablePlugin(d_),yield Le.plugins.enablePlugin(d_)}catch(ue){console.error(`Error installing version ${X}:`,ue),M&&M.error(`Error installing version ${X}:`,ue)}finally{M&&(t(2,le=!1),W.set(null))}})}let kt=X=>it(X.tag_name),Ia=()=>{rt(!c)},is=X=>{(X.key==="Enter"||X.key===" ")&&rt(!c)},Jt=()=>{j.update(X=>!X)},$e=X=>{(X.key==="Enter"||X.key===" ")&&j.update(ue=>!ue)},no=()=>{M.releaseSettings.update(X=>({...X,channel:"stable"})),lt.set("stable"),ct("stable")},ls=X=>{(X.key==="Enter"||X.key===" ")&&(M.releaseSettings.update(ue=>({...ue,channel:"stable"})),lt.set("stable"),ct("stable"))},yn=()=>{M.releaseSettings.update(X=>({...X,channel:"beta"})),lt.set("beta"),ct("beta")},La=X=>{(X.key==="Enter"||X.key===" ")&&(M.releaseSettings.update(ue=>({...ue,channel:"beta"})),lt.set("beta"),ct("beta"))},Ta=()=>{lt.set(null),z.set({version:M.manifest.version,name:M.manifest.name,author:M.manifest.author,description:M.manifest.description,isDesktopOnly:M.manifest.isDesktopOnly,minAppVersion:M.manifest.minAppVersion}),Y.set(M.version),G.set(!1)},xn=X=>{(X.key==="Enter"||X.key===" ")&&(lt.set(null),z.set({version:M.manifest.version,name:M.manifest.name,author:M.manifest.author,description:M.manifest.description,isDesktopOnly:M.manifest.isDesktopOnly,minAppVersion:M.manifest.minAppVersion}),Y.set(M.version),G.set(!1))},qt=X=>{lt.set(null),Dr(X.tag_name)},bn=(X,ue)=>{(ue.key==="Enter"||ue.key===" ")&&(lt.set(null),Dr(X.tag_name))},$s=async()=>{Us(g)};return o.$$set=X=>{"plugin"in X&&t(0,M=X.plugin),"version"in X&&t(1,E=X.version)},[M,E,le,r,s,n,l,c,u,d,m,g,h,_,w,v,A,O,q,j,z,Y,Fe,G,oe,Se,je,Oe,W,it,pt,gt,lt,St,rt,Rs,gn,ka,Dr,ct,Vt,as,Us,kt,Ia,is,Jt,$e,no,ls,yn,La,Ta,xn,qt,bn,$s]}var jm=class extends ee{constructor(e){super(),re(this,e,BE,$E,Z,{plugin:0,version:1},hE,[-1,-1,-1])}},h_=jm;var Ui=class extends g_.Modal{constructor(t,r,s){super(t);this.plugin=r;this.version=s}onOpen(){let{contentEl:t}=this;this.component=new h_({target:t,props:{plugin:this.plugin,version:this.version}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var NE={debugging:!1},HE={release:{channel:"stable"},sharedFolders:[],...Bl,...NE},af=class extends b_.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.5.5";this.repo="No-Instructions/Relay"}enableDebugging(t){Ul(!0),console.warn("RelayInstances",Bt),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){Ul(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return Ul(r),t&&this.debugSettings.update(s=>({...s,debugging:r})),r}buildApiUrl(t){return"https://api.system3.md"+t}async onload(){this.appId=this.app.appId;let t=Yt.moment.now();Bt.set(this,"plugin"),this.timeProvider=new sa,this.register(()=>{this.timeProvider.destroy()}),Yy(new rf(this.app.vault),this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new tf,this.toast=Xy(this.notifier),this.debug=Pe("[System 3][Relay]","debug"),this.log=Pe("[System 3][Relay]","log"),this.warn=Pe("[System 3][Relay]","warn"),this.error=Pe("[System 3][Relay]","error"),this.settings=new Yl(this,HE),await this.settings.load(),this.featureSettings=new kr(this.settings,"(enable*)"),this.debugSettings=new kr(this.settings,"(debugging)"),this.folderSettings=new kr(this.settings,"sharedFolders"),this.releaseSettings=new kr(this.settings,"release"),Nt.getInstance().setSettings(this.featureSettings),this.settingsTab=new Ec(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new nf(this,this.timeProvider,this.releaseSettings),this.debugSettings.subscribe(n=>{n.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Show feature flags",callback:()=>{let a=new Zc(this.app,()=>{this.reload()});this.openModals.push(a),a.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let a=new of(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let a=new ef(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-release-manager",name:"Show releases",callback:()=>{let a=new Ui(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze database",callback:()=>{let a=new sf(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}}),this.addCommand({id:"show-sync-status",name:"Sync status",callback:()=>{let a=new Oi(this.app,this.backgroundSync,this.sharedFolders);this.openModals.push(a),a.open()}})):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-sync-status"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))}),this.addCommand({id:"reload",name:"Reload Relay",callback:()=>{this.reload()}}),this.updateManager.subscribe(()=>{let n=this.updateManager.getNewRelease();n?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.version} \u2192 ${n.tag_name})`,callback:async()=>{await this.updateManager.installUpdate(n)}}),this.log(`Update available: v${this.version} \u2192 ${n.tag_name}`)):this.removeCommand("update-plugin")}),this.vault=this.app.vault;let s=this.vault.getName();this.fileManager=this.app.fileManager,this.hashStore=new Jl(this.appId),this.loginManager=new Uc(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this)),this.relayManager=new Xc(this.loginManager),this.sharedFolders=new Xl(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new Yc(this.loginManager,this.timeProvider,s,3),this.networkStatus=new Vv(this.timeProvider,"https://api.system3.md/health?version=0.5.5"),this.backgroundSync=new lc(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new Yt.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new xc(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),y_.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(n=>n.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(ga,n=>new pc(n)),this.registerEvent(this.app.workspace.on("file-menu",(n,a)=>{if(a instanceof Yt.TFolder){let i=this.sharedFolders.find(l=>l.path===a.path);if(!i)return;i.relayId&&n.addItem(l=>{l.setTitle(i.connected?"Disconnect":"Connect").setIcon("satellite").onClick(()=>{i.connected?(i.shouldConnect=!1,i.disconnect()):(i.shouldConnect=!0,i.connect()),this._liveViews.refresh("folder connection toggle")})}),n.addItem(l=>{l.setTitle("Folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${i.guid}&relay=${i.relayId}`)})}),i.relayId&&Je().enableSyncModal&&n.addItem(l=>{l.setTitle("Sync Status").setIcon("list-checks").onClick(()=>{let c=new Oi(this.app,this.backgroundSync,this.sharedFolders,i.guid);this.openModals.push(c),c.open()})}),Je().enableSyncMenu&&i.relayId&&i.connected&&n.addItem(l=>{l.setTitle("Sync").setIcon("folder-sync").onClick(()=>{i.netSync()})})}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=Yt.moment.now()-t})}async reload(){let t=this.manifest.id,r=this.app.plugins;await r.disablePlugin(t),await r.enablePlugin(t)}_createSharedFolder(t,r,s,n){let a=new kr(this.settings,`sharedFolders/[guid=${r}]`),i={guid:r,path:t};return s&&(i.relay=s),a.update(c=>({...c,path:t,guid:r,...s?{relay:s}:{},sync:c.sync?c.sync:Cs.defaultFlags}),!0),new Ql(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.app.metadataCache,this.hashStore,this.backgroundSync,a,s,n)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,s,n;let t=this;try{if(this.webviewerPatched)return;let a=(s=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:s.webviewer;if(!((n=a==null?void 0:a.instance)!=null&&n.options)||!a.enabled){this.warn("Webviewer plugin not found or not initialized");return}let i=a.instance.options,l=Object.getOwnPropertyDescriptor(i,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(i,"openExternalURLs",{get(){var m;let d=window.event;if((d==null?void 0:d.type)==="open-url"&&((m=d==null?void 0:d.detail)!=null&&m.url)){let g=d.detail.url;for(let h of t.interceptedUrls)if(typeof h=="string"&&g.startsWith(h)||h instanceof RegExp&&h.test(g))return t.log("Intercepted webviewer, opening in default browser",d.detail.url),!1}return l.value},set(d){l.value=d},configurable:!0}),this.register(()=>{Object.defineProperty(i,"openExternalURLs",l)});let c=this.loginManager.webviewIntercept();this.debug("Intercepting Webviewer for URL pattern",c.source),this.interceptedUrls.push(c);let u=new RegExp("https://api.system3.md".replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",u.source),this.interceptedUrls.push(u),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(a){this.error("Failed to patch webviewer:",a)}}setup(){this.folderNavDecorations=new wc(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=Pe("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",c=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Pe("[System 3][Relay][Vault]","log"),s=c=>{let u=c.error;u&&u instanceof mn&&this.toast(u)};window.addEventListener("error",s,!0),this.register(()=>window.removeEventListener("error",s,!0));let n=c=>{c.reason instanceof mn&&this.toast(c.reason)},a=c=>n(c);window.addEventListener("unhandledrejection",a,!0),this.register(()=>window.removeEventListener("unhandledrejection",a,!0)),this.registerEvent(this.app.vault.on("create",c=>{let u=this.sharedFolders.lookup(c.path);if(u){let d=u.getVirtualPath(c.path);u.placeHold([c]).length>0?u.uploadFile(d):u.whenReady().then(g=>{g.getFile(d)})}})),this.registerEvent(this.app.vault.on("delete",c=>{if(c instanceof Yt.TFolder){let d=this.sharedFolders.find(m=>m.path===c.path);if(d){this.sharedFolders.delete(d);return}}let u=this.sharedFolders.lookup(c.path);u&&(r("Delete",c.path),u.whenReady().then(d=>{d.proxy.deleteFile(c.path)}))})),this.registerEvent(this.app.vault.on("rename",(c,u)=>{if(c instanceof Yt.TFolder){let h=this.sharedFolders.find(_=>_.path==u);if(h){h.move(c.path),this.sharedFolders.update();return}}let d=this.sharedFolders.lookup(u),m=this.sharedFolders.lookup(c.path),g=d||m;d&&m?(r("Rename",c.path,u),d.renameFile(c,u),m.renameFile(c,u),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):g&&(r("Rename",c,u),g.renameFile(c,u),this._liveViews.refresh("rename"),this.folderNavDecorations.refresh())})),this.registerEvent(this.app.vault.on("modify",c=>{let u=this.sharedFolders.lookup(c.path);if(u){r("Modify",c.path),Je().enableDesyncPill&&this.folderNavDecorations.quickRefresh();let d=u.proxy.getFile(c.path);d&&Jo(d)&&d.sync(),this.app.metadataCache.trigger("resolve",d)}}));let i=this,l=un(Yt.MarkdownView.prototype,{onUnloadFile(c){return function(u){return i._liveViews.wipe(),c.call(this,u)}}});this.register(l),this.patchWebviewer(),zo(yo.enableNewLinkFormat,()=>{let c=un(Yt.MetadataCache.prototype,{fileToLinktext(u){return function(d,m,g){if(i.sharedFolders.lookup(d.path)){g===void 0&&(g=!0);let _=d.extension==="md"&&g?d.basename:d.name,w=(0,Yt.normalizePath)(d.name),v=i.app.metadataCache.uniqueFileLookup.get(w.toLowerCase());if(v&&v.length===1&&v[0]===d)return _;{let A=d.extension==="md"&&g?d.path.slice(0,d.path.length-3):d.path,O=(0,x_.relative)(m,A);return O==="../"+_?"./"+_:O}}return u.call(this,d,m,g)}}});this.register(c)}),this.registerObsidianProtocolHandler("relay/settings/relays",async c=>{let u=c,d=new URLSearchParams({...u}).toString(),m=`/${u.action.split("/").slice(-1)}?${d}`;this.openSettings(m)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async c=>{let u=c,d=new URLSearchParams({...u}).toString(),m=`/${u.action.split("/").slice(-1)}?${d}`;this.openSettings(m)}),this.registerObsidianProtocolHandler("relay/upgrade",async c=>{var m;let d=(m=c.version)==null?void 0:m.trim();this.installVersion(d)}),this.backgroundSync.start(),this.updateManager.start()}installVersion(t){let r=new Ui(this.app,this,t);this.app.setting.close(),this.openModals.push(r),r.open()}removeCommand(t){if((0,Yt.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,s=r.commands,n=`system3-relay:${t}`;(s.commands.hasOwnProperty(n)||r.hotkeyManager.removeDefaultHotkeys(n))&&(delete s.commands[n],delete s.editorCommands[n])}}onunload(){var t,r,s,n,a,i,l,c,u,d,m,g,h,_;(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(ga),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(s=this._liveViews)==null||s.destroy(),this._liveViews=null,(n=this.relayManager)==null||n.destroy(),this.relayManager=null,(a=this.tokenStore)==null||a.stop(),(i=this.tokenStore)==null||i.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(c=this.networkStatus)==null||c.stop(),(u=this.networkStatus)==null||u.destroy(),this.networkStatus=null,this.openModals.forEach(w=>{w.close()}),this.openModals.length=0,(d=this.sharedFolders)==null||d.destroy(),this.sharedFolders=null,(m=this.settingsTab)==null||m.destroy(),this.settingsTab=null,(g=this.loginManager)==null||g.destroy(),this.loginManager=null,(h=this.backgroundSync)==null||h.destroy(),this.backgroundSync=null,this.hashStore.destroy(),this.hashStore=null,(_=this.app)==null||_.workspace.updateOptions(),this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,this.featureSettings.destroy(),this.featureSettings=null,this.releaseSettings.destroy(),this.releaseSettings=null,this.interceptedUrls.length=0,Nt.destroy(),Nr.destroy(),this.notifier=null,this.toast=null,ex(),Bu()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

moment/moment.js:
  (*! moment.js *)
  (*! version : 2.29.4 *)
  (*! authors : Tim Wood, Iskren Chernev, Moment.js contributors *)
  (*! license : MIT *)
  (*! momentjs.com *)

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-up-down.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-check-big.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-help.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/clock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/download.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/info.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/lock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/message-square-heart.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/pause.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/play.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/refresh-cw.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/triangle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/upload.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */